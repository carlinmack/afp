<div id="FSM">
<div class="head">
<h1>Theory FSM</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> FSM
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../Transition_Systems_and_Automata/Sequence_Zip.html">Transition_Systems_and_Automata.Sequence_Zip</a>"</span>
  <span class="quoted">"<a href="../Transition_Systems_and_Automata/Transition_System.html">Transition_Systems_and_Automata.Transition_System</a>"</span>
  <span class="quoted">"<a href="../Transition_Systems_and_Automata/Transition_System_Extra.html">Transition_Systems_and_Automata.Transition_System_Extra</a>"</span>
  <span class="quoted">"<a href="../Transition_Systems_and_Automata/Transition_System_Construction.html">Transition_Systems_and_Automata.Transition_System_Construction</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Finite state machines ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We formalise finite state machines as a 4-tuples, omitting the explicit formulation of the state 
set,as it can easily be calculated from the successor function.
This definition does not require the successor function to be restricted to the input or output 
alphabet, which is later expressed by the property <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">well_formed</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, together with the 
finiteness of the state set.
›</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">=</span>
  succ    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'state</span> set"</span></span>
  inputs  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'in</span> set"</span></span>
  outputs <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'out</span> set"</span></span>
  initial <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'state</span>"</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ FSMs as transition systems ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We interpret FSMs as transition systems with a singleton initial state set, based on 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Transition_Systems_and_Automata-AFP"<span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
›</span></span>
                                   
<span class="keyword1"><span class="command">global_interpretation</span></span> FSM <span class="main">:</span> transition_system_initial
  <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">p</span><span class="main">.</span> snd <span class="bound">a</span>"</span></span>                    <span class="comment1">― ‹execute›</span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">p</span><span class="main">.</span> snd <span class="bound">a</span> <span class="main">∈</span> succ <span class="free">A</span> <span class="main">(</span>fst <span class="bound">a</span><span class="main">)</span> <span class="bound">p</span>"</span></span> <span class="comment1">― ‹enabled›</span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">=</span> initial <span class="free">A</span>"</span></span>              <span class="comment1">― ‹initial›</span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">defines</span></span> path <span class="main">=</span> <span class="quoted">FSM.path</span> 
      <span class="keyword2"><span class="keyword">and</span></span> run <span class="main">=</span> <span class="quoted">FSM.run</span> 
      <span class="keyword2"><span class="keyword">and</span></span> reachable <span class="main">=</span> <span class="quoted">FSM.reachable</span> 
      <span class="keyword2"><span class="keyword">and</span></span> nodes <span class="main">=</span> <span class="quoted">FSM.nodes</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">this</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">size_FSM</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> card <span class="main">(</span>nodes <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">notation</span></span> 
  size_FSM <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">|</span>_<span class="keyword1">|</span><span class="keyword3">)</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Language ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following definitions establish basic notions for FSMs similarly to those of nondeterministic
finite automata as defined in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Transition_Systems_and_Automata-AFP"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.

In particular, the language of an FSM state are the IO-parts of the paths in the FSM enabled from
that state.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">target</span> <span class="main">≡</span> FSM.target"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">states</span> <span class="main">≡</span> FSM.states"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">trace</span> <span class="main">≡</span> FSM.trace"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">successors</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">,</span> <span class="tfree">'more</span><span class="main">)</span> FSM_scheme <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'state</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">successors</span> <span class="main">≡</span> FSM.successors <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'in</span><span class="main">)</span> <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'out</span><span class="main">)</span> <span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'more</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="FSM-states_alt_def"><span class="command">lemma</span></span> states_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"states <span class="free">r</span> <span class="free">p</span> <span class="main">=</span> map snd <span class="free">r</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1" id="FSM-trace_alt_def"><span class="command">lemma</span></span> trace_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"trace <span class="free">r</span> <span class="free">p</span> <span class="main">=</span> smap snd <span class="free">r</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">language_state</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'state</span> 
                              <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">LS</span>"</span><span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">language_state</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="main">{</span>map fst <span class="bound">r</span> <span class="main">|</span><span class="bound">r</span> <span class="main">.</span> path <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">r</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The language of an FSM is the language of its initial state.
›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="keyword1">LS</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span>
  

<span class="keyword1" id="FSM-language_state_alt_def"><span class="command">lemma</span></span> language_state_alt_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span> <span class="main">=</span> <span class="main">{</span><span class="bound">io</span> <span class="main">|</span> <span class="bound">io</span> <span class="bound">tr</span> <span class="main">.</span> path <span class="free">M</span> <span class="main">(</span><span class="bound">io</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">∧</span> length <span class="bound">io</span> <span class="main">=</span> length <span class="bound">tr</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span> <span class="main">⊆</span> <span class="main">{</span> <span class="bound">io</span> <span class="main">|</span> <span class="bound">io</span> <span class="bound">tr</span> <span class="main">.</span> path <span class="free">M</span>  <span class="main">(</span><span class="bound">io</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">∧</span> length <span class="bound">io</span> <span class="main">=</span> length <span class="bound">tr</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xr</span> <span class="keyword3"><span class="command">assume</span></span> xr_assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xr</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r_def <span class="main">:</span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">xr</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="skolem">r</span> <span class="free">q</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> language_state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> xr_split <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xr</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span>"</span></span> 
                                       <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">ys</span>"</span></span> 
                                       <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">xr</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_map zip_map_fst_snd<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">io</span> <span class="main">|</span> <span class="bound">io</span> <span class="bound">tr</span> <span class="main">.</span> path <span class="free">M</span>  <span class="main">(</span><span class="bound">io</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">∧</span> length <span class="bound">io</span> <span class="main">=</span> length <span class="bound">tr</span> <span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span> <span class="main">=</span> map fst <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> xr_split<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">||</span> take <span class="main">(</span>min <span class="main">(</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>map snd <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                                  <span class="main">(</span>map snd <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> length 
                                  <span class="main">(</span>take <span class="main">(</span>min <span class="main">(</span>length <span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span>map snd <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xr</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">io</span> <span class="main">|</span> <span class="bound">io</span> <span class="bound">tr</span> <span class="main">.</span> path <span class="free">M</span>  <span class="main">(</span><span class="bound">io</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">∧</span> length <span class="bound">io</span> <span class="main">=</span> length <span class="bound">tr</span> <span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> xr_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">io</span> <span class="main">|</span> <span class="bound">io</span> <span class="bound">tr</span> <span class="main">.</span> path <span class="free">M</span>  <span class="main">(</span><span class="bound">io</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">∧</span> length <span class="bound">io</span> <span class="main">=</span> length <span class="bound">tr</span> <span class="main">}</span> <span class="main">⊆</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="keyword3"><span class="command">assume</span></span> xs_assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">io</span> <span class="main">|</span> <span class="bound">io</span> <span class="bound">tr</span> <span class="main">.</span> path <span class="free">M</span>  <span class="main">(</span><span class="bound">io</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">∧</span> length <span class="bound">io</span> <span class="main">=</span> length <span class="bound">tr</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> ys_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">ys</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> map fst <span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ys_def <span class="keyword1"><span class="command">unfolding</span></span> language_state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword1" id="FSM-language_state"><span class="command">lemma</span></span> language_state<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> language_state_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="FSM-language_state_elim"><span class="command">lemma</span></span> language_state_elim<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> language_state_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> split_zip_ex<span class="main">)</span>

<span class="keyword1" id="FSM-language_state_split"><span class="command">lemma</span></span> language_state_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">@</span> <span class="free">w2</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">tr1</span> <span class="free">tr2</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">w1</span> <span class="main">||</span> <span class="free">tr1</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w1</span> <span class="main">=</span> length <span class="free">tr1</span>"</span></span>
        <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">w2</span> <span class="main">||</span> <span class="free">tr2</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span><span class="free">w1</span> <span class="main">||</span> <span class="free">tr1</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w2</span> <span class="main">=</span> length <span class="free">tr2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">(</span><span class="free">w1</span> <span class="main">@</span> <span class="free">w2</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">w1</span> <span class="main">@</span> <span class="free">w2</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tr1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="skolem">tr</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tr2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="skolem">tr</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> tr_split <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?tr1</span> <span class="main">@</span> <span class="var">?tr2</span> <span class="main">=</span> <span class="skolem">tr</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">w1</span> <span class="main">+</span> length <span class="free">w2</span> <span class="main">=</span> length <span class="skolem">tr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tr_def<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">w2</span> <span class="main">=</span> length <span class="skolem">tr</span> <span class="main">-</span> length <span class="free">w1</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w1</span> <span class="main">=</span> length <span class="main">(</span>take <span class="main">(</span>length <span class="free">w1</span><span class="main">)</span> <span class="skolem">tr</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> tr_split diff_add_inverse2 length_append length_drop<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> FSM.path_append_elim length_drop that tr_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zip_append1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-language_state_prefix"><span class="command">lemma</span></span> language_state_prefix <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">@</span> <span class="free">w2</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> language_state language_state_split<span class="main">)</span> 


<span class="keyword1" id="FSM-succ_nodes"><span class="command">lemma</span></span> succ_nodes <span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">)</span> FSM"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> succ <span class="free">A</span> <span class="free">w</span> <span class="free">q1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> surj_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> successors <span class="free">A</span> <span class="free">q1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> reachable <span class="free">A</span> <span class="free">q1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> reachable <span class="free">A</span> <span class="main">(</span>initial <span class="free">A</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-states_target_index"><span class="command">lemma</span></span> states_target_index <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>states <span class="free">p</span> <span class="free">q1</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> target <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="free">q1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Product machine for language intersection ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following describes the construction of a product machine from two FSMs <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> such that the language of the product machine is the intersection of the 
language of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and the language of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">product</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> FSM <span class="main">⇒</span>
  <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state1</span> <span class="main">×</span><span class="tfree">'state2</span><span class="main">)</span> FSM"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">product</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span>
  <span class="main">⦇</span>
    succ <span class="main">=</span> <span class="main">λ</span> <span class="bound">a</span> <span class="main">(</span><span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">.</span> succ <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">a</span> <span class="bound">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">×</span> succ <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="bound">a</span> <span class="bound">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span>
    inputs <span class="main">=</span> inputs <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> inputs <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">,</span>
    outputs <span class="main">=</span> outputs <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> outputs <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">,</span>
    initial <span class="main">=</span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> initial <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>
  <span class="main">⦈</span>"</span></span>

<span class="keyword1" id="FSM-product_simps"><span class="command">lemma</span></span> product_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"succ <span class="main">(</span>product <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">a</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> succ <span class="free">A</span> <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">×</span> succ <span class="free">B</span> <span class="free">a</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"inputs <span class="main">(</span>product <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> inputs <span class="free">A</span> <span class="main">∪</span> inputs <span class="free">B</span>"</span></span>
  <span class="quoted"><span class="quoted">"outputs <span class="main">(</span>product <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> outputs <span class="free">A</span> <span class="main">∪</span> outputs <span class="free">B</span>"</span></span>
  <span class="quoted"><span class="quoted">"initial <span class="main">(</span>product <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>initial <span class="free">A</span><span class="main">,</span> initial <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> product_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="FSM-product_target"><span class="command">lemma</span></span> product_target<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="free">r<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">r<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> length <span class="free">r<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">||</span> <span class="free">r<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct3<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1" id="FSM-product_path"><span class="command">lemma</span></span> product_path<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="free">r<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">r<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> length <span class="free">r<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span>product <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">||</span> <span class="free">r<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">⟷</span> path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">p<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="quoted"><span class="free">p<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct3<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="FSM-product_language_state"><span class="command">lemma</span></span> product_language_state<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">LS</span> <span class="main">(</span>product <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">q1</span><span class="main">,</span><span class="free">q2</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">LS</span> <span class="free">A</span> <span class="free">q1</span> <span class="main">∩</span> <span class="keyword1">LS</span> <span class="free">B</span> <span class="free">q2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">iff</span><span class="main"><span class="main">:</span></span> split_zip<span class="main">)</span>

<span class="keyword1" id="FSM-product_nodes"><span class="command">lemma</span></span> product_nodes <span class="main">:</span>
  <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>product <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">A</span> <span class="main">×</span> nodes <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> nodes <span class="main">(</span>product <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> nodes <span class="free">A</span> <span class="main">×</span> nodes <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> FSM.nodes.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>initial <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>execute <span class="skolem">p</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">p</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">p</span> <span class="main">∈</span> nodes <span class="free">B</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span>succ <span class="free">A</span> <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span>succ <span class="free">B</span> <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> execute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> succ <span class="free">A</span> <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">p</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> succ <span class="free">B</span> <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">p</span> <span class="main">∈</span> nodes <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹fst <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> succ <span class="free">A</span> <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">p</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.simps fst_conv snd_conv<span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> nodes <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹snd <span class="skolem">p</span> <span class="main">∈</span> nodes <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹snd <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> succ <span class="free">B</span> <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">p</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.simps fst_conv snd_conv<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem_Times_iff<span class="main">)</span> 
      
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Required properties ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
FSMs used by the adaptive state counting algorithm are required to satisfy certain properties which
are introduced in here.
Most notably, the observability property (see function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">observable</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>) implies the 
uniqueness of certain paths and hence allows for several stronger variations of previous results.
›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">finite_FSM</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finite_FSM</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">(</span>finite <span class="main">(</span>nodes <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> 
                  <span class="main">∧</span> finite <span class="main">(</span>inputs <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> 
                  <span class="main">∧</span> finite <span class="main">(</span>outputs <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">observable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">observable</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">t</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s1</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span>succ <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="bound">t</span> <span class="bound">s1</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> 
                                <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s2</span> <span class="main">.</span> <span class="main">(</span>succ <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="bound">t</span> <span class="bound">s1</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s2</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">completely_specified</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">completely_specified</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> nodes <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> inputs <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">.</span> 
                              <span class="main">∃</span> <span class="bound">y</span> <span class="main">∈</span> outputs <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">.</span> 
                                <span class="main">∃</span> <span class="bound">s2</span> <span class="main">.</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="main">(</span>succ <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="bound">s1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">well_formed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">well_formed</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">(</span>finite_FSM <span class="free"><span class="bound"><span class="entity">M</span></span></span>
                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∉</span> inputs <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">∨</span> <span class="bound">y</span> <span class="main">∉</span> outputs <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> 
                                    <span class="main">⟶</span> succ <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="bound">s1</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>
                    <span class="main">∧</span> inputs <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≠</span> <span class="main">{}</span>
                    <span class="main">∧</span> outputs <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">OFSM</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> well_formed <span class="free"><span class="bound"><span class="entity">M</span></span></span> 
                        <span class="main">∧</span> observable <span class="free"><span class="bound"><span class="entity">M</span></span></span> 
                        <span class="main">∧</span> completely_specified <span class="free"><span class="bound"><span class="entity">M</span></span></span>"</span></span>

<span class="keyword1" id="FSM-OFSM_props"><span class="command">lemma</span></span> OFSM_props<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span></span></span></span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M</span>"</span></span> 
      <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span> 
      <span class="quoted"><span class="quoted">"completely_specified <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FSM-set_of_succs_finite"><span class="command">lemma</span></span> set_of_succs_finite <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>succ <span class="free">M</span> <span class="free">io</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>succ <span class="free">M</span> <span class="free">io</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">M</span> <span class="free">io</span> <span class="free">q</span> <span class="main">⊆</span> nodes <span class="free">M</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsetI succ_nodes<span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> infinite_super <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-well_formed_path_io_containment"><span class="command">lemma</span></span> well_formed_path_io_containment <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map fst <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>inputs <span class="free">M</span> <span class="main">×</span> outputs <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span>inputs <span class="free">M</span> <span class="main">×</span> outputs <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">a</span> <span class="main">∉</span> inputs <span class="free">M</span> <span class="main">×</span> outputs <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">∉</span> inputs <span class="free">M</span> <span class="main">∨</span> snd <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">∉</span> outputs <span class="free">M</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SigmaI prod.collapse<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">M</span> <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.collapse well_formed.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> succ <span class="free">M</span> <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="skolem">q</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map fst <span class="skolem">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>inputs <span class="free">M</span> <span class="main">×</span> outputs <span class="free">M</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM-path_input_containment"><span class="command">lemma</span></span> path_input_containment <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="free">p</span> <span class="free">q</span>"</span></span>  
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map fst <span class="main">(</span>map fst <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> inputs <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>inputs <span class="free">M</span> <span class="main">×</span> outputs <span class="free">M</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> well_formed_path_io_containment<span class="main">[</span><span class="operator">OF</span> snoc.prems<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>inputs <span class="free">M</span> <span class="main">×</span> outputs <span class="free">M</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> inputs <span class="free">M</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map fst <span class="main">(</span>map fst <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> inputs <span class="free">M</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> snoc.IH<span class="main">[</span><span class="operator">OF</span> snoc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-path_state_containment"><span class="command">lemma</span></span> path_state_containment <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map snd <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes_states states_alt_def<span class="main">)</span> 


<span class="keyword1" id="FSM-language_state_inputs"><span class="command">lemma</span></span> language_state_inputs <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> language_state <span class="free">M</span> <span class="free">q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span> <span class="main">⊆</span> inputs <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tr</span> <span class="main">=</span> length <span class="free">io</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">tr</span><span class="main">.</span> <span class="main">⟦</span>path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="free">q</span><span class="main">;</span> length <span class="bound">tr</span> <span class="main">=</span> length <span class="free">io</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span> 
        assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> map_fst_zip path_input_containment<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1" id="FSM-set_of_paths_finite"><span class="command">lemma</span></span> set_of_paths_finite <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span> <span class="bound">p</span> <span class="main">.</span> path <span class="free">M</span> <span class="bound">p</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="bound">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="bound">p</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?trs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">tr</span> <span class="main">.</span> set <span class="bound">tr</span> <span class="main">⊆</span> nodes <span class="free">M</span> <span class="main">∧</span> length <span class="bound">tr</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ios</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">io</span> <span class="main">.</span> set <span class="bound">io</span> <span class="main">⊆</span> inputs <span class="free">M</span> <span class="main">×</span> outputs <span class="free">M</span> <span class="main">∧</span> length <span class="bound">io</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?iotrs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"image <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">io</span><span class="main">,</span><span class="bound">tr</span><span class="main">)</span> <span class="main">.</span> <span class="bound">io</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="main">(</span><span class="var">?ios</span> <span class="main">×</span> <span class="var">?trs</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?paths</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">p</span> <span class="main">.</span> path <span class="free">M</span> <span class="bound">p</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="bound">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="bound">p</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">}</span>"</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>inputs <span class="free">M</span> <span class="main">×</span> outputs <span class="free">M</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?ios</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_lists_length_le<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?trs</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_lists_length_le<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?iotrs</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?paths</span> <span class="main">⊆</span> <span class="var">?iotrs</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> p_assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">p</span> <span class="main">.</span> path <span class="free">M</span> <span class="bound">p</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="bound">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="bound">p</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_split <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">io</span> <span class="main">||</span> <span class="skolem">tr</span> <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="skolem">tr</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> length_map zip_map_fst_snd<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> <span class="var">?ios</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> well_formed_path_io_containment
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="skolem">p</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="skolem">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="skolem">p</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p_assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">io</span> <span class="main">⊆</span> inputs <span class="free">M</span> <span class="main">×</span> outputs <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> map_fst_zip p_split well_formed_path_io_containment<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_split<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tr</span> <span class="main">∈</span> <span class="var">?trs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_split
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> 
                  <span class="main">∧</span> length <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> path <span class="free">M</span> <span class="bound">p</span> <span class="free">q1</span> 
                  <span class="main">∧</span> target <span class="bound">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="bound">p</span> <span class="main">≤</span> <span class="free">k</span><span class="main">}</span>›</span></span> p_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">tr</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_split<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">tr</span> <span class="main">⊆</span> nodes <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> length_map p_split path_state_containment 
                      zip_eq zip_map_fst_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?iotrs</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> p_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> Finite_Set.finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1" id="FSM-non_distinct_duplicate_indices"><span class="command">lemma</span></span> non_distinct_duplicate_indices <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> distinct <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i1</span> <span class="bound">i2</span> <span class="main">.</span> <span class="bound">i1</span> <span class="main">≠</span> <span class="bound">i2</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i1</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i2</span> <span class="main">∧</span> <span class="bound">i1</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">∧</span> <span class="bound">i2</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> distinct_conv_nth less_imp_le<span class="main">)</span> 

<span class="keyword1" id="FSM-reaching_path_without_repetition"><span class="command">lemma</span></span> reaching_path_without_repetition <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> reachable <span class="free">M</span> <span class="free">q1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> path <span class="free">M</span> <span class="bound">p</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="bound">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> distinct <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="bound">p</span> <span class="free">q1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> shorten_nondistinct <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span>path <span class="free">M</span> <span class="bound">p</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="bound">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> <span class="main">¬</span> distinct <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="bound">p</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p'</span> <span class="main">.</span> path <span class="free">M</span> <span class="bound">p'</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="bound">p'</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="bound">p'</span> <span class="main">&lt;</span> length <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>path <span class="free">M</span> <span class="skolem">p</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="skolem">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> <span class="main">¬</span> distinct <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p'</span> <span class="main">.</span> path <span class="free">M</span> <span class="bound">p'</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="bound">p'</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="bound">p'</span> <span class="main">&lt;</span> length <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> assm <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="skolem">p</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="skolem">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> <span class="main">¬</span> distinct <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p'</span><span class="main">.</span> path <span class="free">M</span> <span class="bound">p'</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="bound">p'</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="bound">p'</span> <span class="main">&lt;</span> length <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> set <span class="main">(</span>states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i1</span> <span class="main">.</span> target <span class="main">(</span>take <span class="bound">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q1</span> <span class="main">∧</span> <span class="bound">i1</span> <span class="main">≤</span> length <span class="skolem">p</span> <span class="main">∧</span> <span class="bound">i1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i1</span><span class="main">.</span> target <span class="main">(</span>take <span class="bound">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q1</span> <span class="main">∧</span> <span class="bound">i1</span> <span class="main">≤</span> length <span class="skolem">p</span> <span class="main">∧</span> <span class="bound">i1</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i1</span> <span class="main">.</span> <span class="main">(</span>states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i1</span> <span class="main">=</span> <span class="free">q1</span> <span class="main">∧</span> <span class="bound">i1</span> <span class="main">≤</span> length <span class="main">(</span>states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True in_set_conv_nth less_eq_Suc_le scan_length scan_nth zero_less_Suc<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∉</span> set <span class="main">(</span>states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> in_set_conv_nth less_imp_le<span class="main">)</span>  
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="keyword2"><span class="keyword">where</span></span> i1_def <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span>take <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q1</span> <span class="main">∧</span> <span class="skolem">i1</span> <span class="main">≤</span> length <span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">i1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span>take <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append_elim append_take_drop_id<span class="main">)</span>  
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span>drop <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> i1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append_elim append_take_drop_id assm<span class="main">)</span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span>drop <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> <span class="main">∧</span> <span class="main">(</span>target <span class="main">(</span>drop <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> i1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> append_take_drop_id assm fold_append o_apply<span class="main">)</span>
        
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>drop <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> i1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
     <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> assm' <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="skolem">p</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="skolem">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> <span class="main">¬</span> distinct <span class="main">(</span>states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i1</span> <span class="bound">i2</span> <span class="main">.</span> <span class="bound">i1</span> <span class="main">≠</span> <span class="bound">i2</span> <span class="main">∧</span> target <span class="main">(</span>take <span class="bound">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> target <span class="main">(</span>take <span class="bound">i2</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> 
                        <span class="main">∧</span> <span class="bound">i1</span> <span class="main">≤</span> length <span class="skolem">p</span> <span class="main">∧</span> <span class="bound">i2</span> <span class="main">≤</span> length <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i1</span> <span class="bound">i2</span> <span class="main">.</span> <span class="bound">i1</span> <span class="main">≠</span> <span class="bound">i2</span> <span class="main">∧</span> target <span class="main">(</span>take <span class="bound">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> target <span class="main">(</span>take <span class="bound">i2</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> 
                                <span class="main">∧</span> <span class="bound">i1</span> <span class="main">≤</span> length <span class="skolem">p</span> <span class="main">∧</span> <span class="bound">i2</span> <span class="main">≤</span> length <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i1</span> <span class="bound">i2</span> <span class="main">.</span> <span class="bound">i1</span> <span class="main">≠</span> <span class="bound">i2</span> <span class="main">∧</span> <span class="main">(</span>states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i1</span> <span class="main">=</span> <span class="main">(</span>states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i2</span> 
                                  <span class="main">∧</span> <span class="bound">i1</span> <span class="main">≤</span> length <span class="main">(</span>states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i2</span> <span class="main">≤</span> length <span class="main">(</span>states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_leI assm' distinct_conv_nth nat.inject 
                scan_length scan_nth<span class="main">)</span> 
    
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> non_distinct_duplicate_indices <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> assm' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">&lt;</span> <span class="skolem">i2</span> <span class="main">∧</span> target <span class="main">(</span>take <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> target <span class="main">(</span>take <span class="skolem">i2</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> 
                                          <span class="main">∧</span> <span class="skolem">i1</span> <span class="main">≤</span> length <span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">i2</span> <span class="main">≤</span> length <span class="skolem">p</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat_neq_iff<span class="main">)</span>
    
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span>take <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append_elim append_take_drop_id<span class="main">)</span>  
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span>drop <span class="skolem">i2</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>take <span class="skolem">i2</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append_elim append_take_drop_id assm<span class="main">)</span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">(</span>take <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>drop <span class="skolem">i2</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">q1</span> 
                          <span class="main">∧</span> <span class="main">(</span>target <span class="main">(</span><span class="main">(</span>take <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>drop <span class="skolem">i2</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> i_def assm
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append append_take_drop_id fold_append o_apply<span class="main">)</span> 
    
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span>take <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>drop <span class="skolem">i2</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">(</span>take <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>drop <span class="skolem">i2</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">q1</span> 
                          <span class="main">∧</span> target <span class="main">(</span><span class="main">(</span>take <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>drop <span class="skolem">i2</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> 
                          <span class="main">∧</span> length <span class="main">(</span><span class="main">(</span>take <span class="skolem">i1</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>drop <span class="skolem">i2</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>      
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="skolem">p</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="skolem">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?paths</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p'</span> <span class="main">.</span> <span class="main">(</span>path <span class="free">M</span> <span class="bound">p'</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="bound">p'</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="bound">p'</span> <span class="main">≤</span> length <span class="skolem">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?minPath</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"arg_min length <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> <span class="bound">io</span> <span class="main">∈</span> <span class="var">?paths</span><span class="main">)</span>"</span></span> 
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?paths</span> <span class="main">≠</span> empty"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?paths</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_of_paths_finite<span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> minPath_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?minPath</span> <span class="main">∈</span> <span class="var">?paths</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p'</span> <span class="main">∈</span> <span class="var">?paths</span> <span class="main">.</span> length <span class="var">?minPath</span> <span class="main">≤</span> length <span class="bound">p'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> arg_min_nat_lemma equals0I<span class="main">)</span> 
  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="var">?minPath</span> <span class="free">q1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> distinct <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="var">?minPath</span> <span class="free">q1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p'</span> <span class="main">.</span> path <span class="free">M</span> <span class="bound">p'</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="bound">p'</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="bound">p'</span> <span class="main">&lt;</span> length <span class="var">?minPath</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> shorten_nondistinct minPath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> minPath_def <span class="keyword1"><span class="command">using</span></span> arg_min_nat_le dual_order.strict_trans1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>





<span class="keyword1" id="FSM-observable_path_unique"><span class="command">lemma</span></span> observable_path_unique<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr1</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="free">tr1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr2</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="free">tr2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">tr1</span> <span class="main">=</span> <span class="free">tr2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> tr_assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tr1</span> <span class="main">≠</span> <span class="free">tr2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> state_diff <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>states <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr1</span><span class="main">)</span> <span class="free">q</span> <span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>states <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr2</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> map_snd_zip states_alt_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms tr_assm <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">io</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="free">tr1</span></span> <span class="quoted"><span class="free">tr2</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">io_hd</span> <span class="skolem">io_tl</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1_hd</span></span> <span class="skolem"><span class="skolem">tr1_tl</span></span> <span class="skolem"><span class="skolem">tr2_hd</span></span> <span class="skolem"><span class="skolem">tr2_tl</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr_split <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tr1</span> <span class="main">=</span> <span class="skolem">tr1_hd</span> <span class="main">#</span> <span class="skolem">tr1_tl</span> 
                                                              <span class="main">∧</span> <span class="skolem">tr2</span> <span class="main">=</span> <span class="skolem">tr2_hd</span> <span class="main">#</span> <span class="skolem">tr2_tl</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv neq_Nil_conv<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">[</span><span class="skolem">io_hd</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">tr1_hd</span><span class="main">]</span><span class="main">)</span> <span class="skolem">q</span>"</span></span>   
      <span class="keyword1"><span class="command">using</span></span> Cons.prems tr_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">[</span><span class="skolem">io_hd</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">tr2_hd</span><span class="main">]</span><span class="main">)</span> <span class="skolem">q</span>"</span></span>   
      <span class="keyword1"><span class="command">using</span></span> Cons.prems tr_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> tr_hd_eq <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tr1_hd</span> <span class="main">=</span> <span class="skolem">tr2_hd</span>"</span></span>           
      <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">unfolding</span></span> observable.simps
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="bound">s1</span><span class="main">.</span> succ <span class="free">M</span> <span class="bound">t</span> <span class="bound">s1</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s2</span><span class="main">.</span> succ <span class="free">M</span> <span class="bound">t</span> <span class="bound">s1</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s2</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> p1 p2 FSM.path_cons_elim empty_iff prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> singletonD 
            zip_Cons_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons.IH Cons.prems<span class="main">(</span>3<span class="main">)</span> Cons.prems<span class="main">(</span>4<span class="main">)</span> Cons.prems<span class="main">(</span>5<span class="main">)</span> Cons.prems<span class="main">(</span>6<span class="main">)</span> Cons.prems<span class="main">(</span>7<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> 
            tr_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM-observable_path_unique_ex"><span class="command">lemma</span></span> observable_path_unique_ex<span class="main">[</span><span class="operator">elim</span><span class="main">]</span> <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">tr</span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">t</span> <span class="main">.</span> path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">t</span><span class="main">)</span> <span class="free">q</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="bound">t</span> <span class="main">}</span> <span class="main">=</span> <span class="main">{</span> <span class="free">tr</span> <span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">tr</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">t</span> <span class="main">.</span> path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">t</span><span class="main">)</span> <span class="free">q</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="bound">t</span> <span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">t</span> <span class="main">.</span> path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">t</span><span class="main">)</span> <span class="free">q</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="bound">t</span> <span class="main">}</span> <span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="skolem">tr</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms tr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-well_formed_product"><span class="command">lemma</span></span> well_formed_product<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="var">?PM</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> well_formed.simps <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="var">?PM</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> product_nodes assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_FSM <span class="var">?PM</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> infinite_subset assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inputs <span class="var">?PM</span> <span class="main">=</span> inputs <span class="free">M2</span> <span class="main">∪</span> inputs <span class="free">M1</span>"</span></span> 
       <span class="quoted"><span class="quoted">"outputs <span class="var">?PM</span> <span class="main">=</span> outputs <span class="free">M2</span> <span class="main">∪</span> outputs <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> inputs <span class="var">?PM</span> <span class="main">∨</span> <span class="bound">y</span> <span class="main">∉</span> outputs <span class="var">?PM</span> <span class="main">⟶</span> succ <span class="var">?PM</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">s1</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> 
                                                              <span class="main">∧</span> inputs <span class="var">?PM</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> outputs <span class="var">?PM</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ States reached by a given IO-sequence ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">io_targets</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> collects all states of an FSM reached from a given state by a 
given IO-sequence.
Notably, for any observable FSM, this set contains at most one state.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">io_targets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'state</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">io_targets</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">io</span></span></span> <span class="main">=</span> <span class="main">{</span> target <span class="main">(</span><span class="free"><span class="bound"><span class="entity">io</span></span></span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">|</span> <span class="bound">tr</span> <span class="main">.</span> path <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">io</span></span></span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> length <span class="free"><span class="bound"><span class="entity">io</span></span></span> <span class="main">=</span> length <span class="bound">tr</span> <span class="main">}</span>"</span></span>

<span class="keyword1" id="FSM-io_target_implies_L"><span class="command">lemma</span></span> io_target_implies_L <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">io</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> L <span class="free">M</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>"</span></span> 
                  <span class="quoted"><span class="quoted">"length <span class="skolem">tr</span> <span class="main">=</span> length <span class="free">io</span>"</span></span> 
                  <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-io_target_from_path"><span class="command">lemma</span></span> io_target_from_path <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">q</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FSM-io_targets_observable_singleton_ex"><span class="command">lemma</span></span> io_targets_observable_singleton_ex <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q2</span> <span class="main">.</span> io_targets <span class="free">M</span> <span class="free">q1</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">q2</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">t</span> <span class="main">.</span> path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">t</span><span class="main">)</span> <span class="free">q1</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="bound">t</span> <span class="main">}</span> <span class="main">=</span> <span class="main">{</span> <span class="skolem">tr</span> <span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms observable_path_unique_ex <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q1</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span> target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="free">q1</span> <span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-io_targets_observable_singleton_ob"><span class="command">lemma</span></span> io_targets_observable_singleton_ob <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q1</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q2</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q1</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span> <span class="free">q2</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">t</span> <span class="main">.</span> path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">t</span><span class="main">)</span> <span class="free">q1</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="bound">t</span> <span class="main">}</span> <span class="main">=</span> <span class="main">{</span> <span class="skolem">tr</span> <span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms observable_path_unique_ex <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q1</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span> target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="free">q1</span> <span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-io_targets_elim"><span class="command">lemma</span></span> io_targets_elim<span class="main">[</span><span class="operator">elim</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">q</span> <span class="free">io</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">tr</span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∧</span> path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">unfolding</span></span> io_targets.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 


<span class="keyword1" id="FSM-io_targets_reachable"><span class="command">lemma</span></span> io_targets_reachable <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">q1</span> <span class="free">io</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> reachable <span class="free">M</span> <span class="free">q1</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">unfolding</span></span> io_targets.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="FSM-io_targets_nodes"><span class="command">lemma</span></span> io_targets_nodes <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">q1</span> <span class="free">io</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="FSM-observable_io_targets_split"><span class="command">lemma</span></span> observable_io_targets_split <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q1</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">q3</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q1</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q2</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q3</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trV</span></span> <span class="skolem"><span class="skolem">trX</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr_def <span class="main">:</span> 
        <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV</span><span class="main">)</span> <span class="free">q1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> length <span class="skolem">trV</span>"</span></span>
        <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">trX</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV</span><span class="main">)</span> <span class="free">q1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="skolem">trX</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> language_state_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">q1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tgt_V <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> path_X <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">trX</span><span class="main">)</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="free">xs</span> <span class="main">=</span> length <span class="skolem">trX</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> tr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> tgt_all <span class="main">:</span>  <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">||</span> <span class="skolem">trV</span> <span class="main">@</span> <span class="skolem">trX</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q3</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cs</span><span class="main">.</span> <span class="free">q3</span> <span class="main">=</span> target <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">||</span> <span class="bound">cs</span><span class="main">)</span> <span class="free">q1</span> 
                    <span class="main">∧</span> path <span class="free">M</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">||</span> <span class="bound">cs</span><span class="main">)</span> <span class="free">q1</span> <span class="main">∧</span> length <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="bound">cs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">trV</span> <span class="main">+</span> length <span class="skolem">trX</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tr_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tr_def<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">trV</span> <span class="main">@</span> <span class="skolem">trX</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q1</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> observable_path_unique 
                    tr_def<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tr_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tr_def<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> zip_append<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">trX</span><span class="main">)</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q3</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> tr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">trX</span><span class="main">)</span> <span class="free">q2</span> <span class="main">=</span> <span class="free">q3</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> tgt_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q3</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">q2</span> <span class="free">xs</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> path_X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹observable <span class="free">M</span>›</span></span> path_X insert_absorb io_targets_observable_singleton_ex 
        language_state singleton_insert_inj_eq'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 



<span class="keyword1" id="FSM-observable_io_target_unique_target"><span class="command">lemma</span></span> observable_io_target_unique_target <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q1</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="FSM-target_in_states"><span class="command">lemma</span></span> target_in_states <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>states <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">tr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FSM.target_alt_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> states_alt_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="FSM-target_alt_def"><span class="command">lemma</span></span> target_alt_def <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
        <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> last <span class="free">tr</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> last <span class="free">tr</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms last_ConsR length_greater_0_conv map_snd_zip scan_last states_alt_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-obs_target_is_io_targets"><span class="command">lemma</span></span> obs_target_is_io_targets <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span>target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> io_targets_observable_singleton_ex language_state 
      observable_io_target_unique_target<span class="main">)</span>



<span class="keyword1" id="FSM-io_target_target"><span class="command">lemma</span></span> io_target_target <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q1</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q1</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">q1</span> <span class="free">io</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1" id="FSM-index_last_take"><span class="command">lemma</span></span> index_last_take <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> last <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms take_Suc_conv_app_nth<span class="main">)</span> 

<span class="keyword1" id="FSM-path_last_io_target"><span class="command">lemma</span></span> path_last_io_target <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"last <span class="free">tr</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">q</span> <span class="free">xs</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="free">tr</span> <span class="main">=</span> target <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> map_snd_zip states_alt_def target_in_states<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM-path_prefix_io_targets"><span class="command">lemma</span></span> path_prefix_io_targets <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">tr</span><span class="main">)</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">q</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">xs</span> <span class="main">||</span> take <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> FSM.path_append_elim append_take_drop_id assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> take_zip<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> path_last_io_target <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM-states_index_io_target"><span class="command">lemma</span></span> states_index_io_target <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">q</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> last <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> map_snd_zip states_alt_def index_last_take<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> last <span class="main">(</span>states <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">xs</span> <span class="main">||</span> take <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_zip<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> last <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">tr</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> states_alt_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">tr</span><span class="main">)</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">q</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> path_prefix_io_targets<span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM-observable_io_targets_append"><span class="command">lemma</span></span> observable_io_targets_append <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q1</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q2</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q3</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q1</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">q3</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trV</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV</span><span class="main">)</span> <span class="free">q1</span> <span class="main">∧</span> length <span class="skolem">trV</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> target <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> io_targets_elim singletonI<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trX</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">trX</span><span class="main">)</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="skolem">trX</span> <span class="main">=</span> length <span class="free">xs</span> 
                              <span class="main">∧</span> target <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">trX</span><span class="main">)</span> <span class="free">q2</span> <span class="main">=</span> <span class="free">q3</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> io_targets_elim singletonI<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">||</span> <span class="skolem">trV</span> <span class="main">@</span> <span class="skolem">trX</span><span class="main">)</span> <span class="free">q1</span> <span class="main">∧</span> length <span class="main">(</span><span class="skolem">trV</span> <span class="main">@</span> <span class="skolem">trX</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> 
                    <span class="main">∧</span> target <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">||</span> <span class="skolem">trV</span> <span class="main">@</span> <span class="skolem">trX</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q3</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> obs_target_is_io_targets<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM-io_path_states_prefix"><span class="command">lemma</span></span> io_path_states_prefix <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io1</span> <span class="main">||</span> <span class="free">tr1</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">tr1</span> <span class="main">=</span> length <span class="free">io1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io2</span> <span class="main">||</span> <span class="free">tr2</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">tr2</span> <span class="main">=</span> length <span class="free">io2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">io1</span> <span class="free">io2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">tr1</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">tr1</span><span class="main">)</span> <span class="free">tr2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tr1'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">tr1</span><span class="main">)</span> <span class="free">tr2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?io1'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">tr1</span><span class="main">)</span> <span class="free">io2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="var">?io1'</span> <span class="main">||</span> <span class="var">?tr1'</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append_elim append_take_drop_id assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> take_zip<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?tr1'</span> <span class="main">=</span> length <span class="var">?io1'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?io1'</span> <span class="main">=</span> <span class="free">io1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">psa</span><span class="main">.</span> <span class="main">¬</span> prefix <span class="main">(</span><span class="bound">ps</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list<span class="main">)</span> <span class="bound">psa</span> <span class="main">∨</span> length <span class="bound">ps</span> <span class="main">≤</span> length <span class="bound">psa</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prefix_length_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>take <span class="main">(</span>length <span class="free">tr1</span><span class="main">)</span> <span class="free">io2</span><span class="main">)</span> <span class="main">=</span> length <span class="free">io1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>6<span class="main">)</span> min.absorb2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> min.cobounded2 min_def_raw prefix_length_prefix 
          prefix_order.dual_order.antisym take_is_prefix<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">tr1</span> <span class="main">=</span> <span class="var">?tr1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>take <span class="main">(</span>length <span class="free">tr1</span><span class="main">)</span> <span class="free">tr2</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>take <span class="main">(</span>length <span class="free">tr1</span><span class="main">)</span> <span class="free">io2</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹path <span class="free">M</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">tr1</span><span class="main">)</span> <span class="free">io2</span> <span class="main">||</span> take <span class="main">(</span>length <span class="free">tr1</span><span class="main">)</span> <span class="free">tr2</span><span class="main">)</span> <span class="free">q</span>›</span></span> <span class="quoted"><span class="quoted">‹take <span class="main">(</span>length <span class="free">tr1</span><span class="main">)</span> <span class="free">io2</span> <span class="main">=</span> <span class="free">io1</span>›</span></span> 
        assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> language_state observable_path_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

  

<span class="keyword1" id="FSM-observable_io_targets_suffix"><span class="command">lemma</span></span> observable_io_targets_suffix <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q1</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q1</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">q3</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q2</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q3</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">vs</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trV</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV</span><span class="main">)</span> <span class="free">q1</span> <span class="main">∧</span> length <span class="skolem">trV</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">∧</span> target <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> io_targets_elim singletonI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trVX</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">trVX</span><span class="main">)</span> <span class="free">q1</span> 
                                <span class="main">∧</span> length <span class="skolem">trVX</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> target <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">trVX</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q3</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> io_targets_elim singletonI<span class="main">)</span>

  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trV</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">trV</span><span class="main">)</span> <span class="skolem">trVX</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> io_path_states_prefix<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> _ _ _ _ <span class="quoted"><span class="quoted">‹prefix <span class="free">vs</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">trV</span></span> <span class="quoted"><span class="free">q1</span></span> <span class="quoted"><span class="skolem">trVX</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> observable_io_targets_split<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM-observable_io_target_is_singleton"><span class="command">lemma</span></span> observable_io_target_is_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">q</span> <span class="free">io</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">q</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p'</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> io_targets_observable_singleton_ex<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM-observable_path_prefix"><span class="command">lemma</span></span> observable_path_prefix <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">ioP</span> <span class="main">||</span> <span class="free">trP</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">ioP</span> <span class="main">=</span> length <span class="free">trP</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"prefix <span class="free">ioP</span> <span class="free">io</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">trP</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">ioP</span><span class="main">)</span> <span class="free">tr</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ioP_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ioP</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">ioP</span><span class="main">)</span> <span class="free">io</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_conv_conj prefixE<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">ioP</span><span class="main">)</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">ioP</span><span class="main">)</span> <span class="free">io</span> <span class="main">||</span> take <span class="main">(</span>length <span class="free">ioP</span><span class="main">)</span> <span class="free">tr</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> take_zip <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">ioP</span><span class="main">)</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append_elim append_take_drop_id<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span>take <span class="main">(</span>length <span class="free">ioP</span><span class="main">)</span> <span class="free">io</span> <span class="main">||</span> take <span class="main">(</span>length <span class="free">ioP</span><span class="main">)</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span> 
                    <span class="main">∧</span> length <span class="main">(</span>take <span class="main">(</span>length <span class="free">ioP</span><span class="main">)</span> <span class="free">io</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>take <span class="main">(</span>length <span class="free">ioP</span><span class="main">)</span> <span class="free">tr</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">ioP</span> <span class="main">||</span> take <span class="main">(</span>length <span class="free">ioP</span><span class="main">)</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span> <span class="main">∧</span> length <span class="free">ioP</span> <span class="main">=</span> length <span class="main">(</span>take <span class="main">(</span>length <span class="free">ioP</span><span class="main">)</span> <span class="free">tr</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ioP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> language_state observable_path_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM-io_targets_succ"><span class="command">lemma</span></span> io_targets_succ <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">q1</span> <span class="main">[</span><span class="free">xy</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> succ <span class="free">M</span> <span class="free">xy</span> <span class="free">q1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr_def <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="main">[</span><span class="free">xy</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span> 
                           <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">[</span><span class="free">xy</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="free">q1</span>"</span></span> 
                           <span class="quoted"><span class="quoted">"length <span class="main">[</span><span class="free">xy</span><span class="main">]</span> <span class="main">=</span> length <span class="skolem">tr</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tr</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">[</span><span class="free">xy</span><span class="main">]</span> <span class="main">=</span> length <span class="skolem">tr</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tr</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">q2'</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_length_conv length_0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="main">[</span><span class="free">xy</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="skolem">q2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2'</span> <span class="main">=</span> <span class="free">q2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹target <span class="main">(</span><span class="main">[</span><span class="free">xy</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">[</span><span class="free">xy</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="free">q2</span><span class="main">]</span><span class="main">)</span> <span class="free">q1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> tr_def<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">tr</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">q2'</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">[</span><span class="main">(</span><span class="free">xy</span><span class="main">,</span><span class="free">q2</span><span class="main">)</span><span class="main">]</span> <span class="free">q1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> FSM.path.cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">xy</span></span><span class="main"><span class="main">,</span></span><span class="free"><span class="free">q2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">q1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M</span> <span class="main">[</span><span class="main">(</span><span class="free">xy</span><span class="main">,</span><span class="free">q2</span><span class="main">)</span><span class="main">]</span> <span class="free">q1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> cons 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="free">xy</span><span class="main">,</span> <span class="free">q2</span><span class="main">)</span> <span class="main">∈</span> succ <span class="free">M</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">xy</span><span class="main">,</span> <span class="free">q2</span><span class="main">)</span><span class="main">)</span> <span class="free">q1</span> <span class="main">⟹</span> path <span class="free">M</span> <span class="main">[]</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">xy</span><span class="main">,</span> <span class="free">q2</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">⟹</span> <span class="free">q2</span> <span class="main">∈</span> succ <span class="free">M</span> <span class="free">xy</span> <span class="free">q1</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ D-reachability ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A state of some FSM is d-reached (deterministically reached) by some input sequence if any sequence 
in the language of the FSM with this input sequence reaches that state. 
That state is then called d-reachable. 
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>  <span class="quoted"><span class="quoted">"<span class="free">d_reached_by</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≡</span> 
                    <span class="main">(</span><span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">∧</span> length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> length <span class="free"><span class="bound"><span class="entity">tr</span></span></span> 
                    <span class="main">∧</span> <span class="main">(</span>path <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">||</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">||</span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∧</span> target <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">||</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">||</span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> 
                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">ys2</span> <span class="bound">tr2</span> <span class="main">.</span>  <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> length <span class="bound">ys2</span> <span class="main">∧</span> length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> length <span class="bound">tr2</span> 
                    <span class="main">∧</span> path <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">||</span> <span class="bound">ys2</span><span class="main">)</span> <span class="main">||</span> <span class="bound">tr2</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⟶</span> target <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">||</span> <span class="bound">ys2</span><span class="main">)</span> <span class="main">||</span> <span class="bound">tr2</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>  

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">d_reaches</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'in</span> list <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">d_reaches</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">tr</span> <span class="bound">ys</span> <span class="main">.</span> d_reached_by <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">tr</span> <span class="bound">ys</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">d_reachable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'state</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">d_reachable</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">q</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">xs</span> <span class="main">.</span> d_reaches <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">xs</span> <span class="bound">q</span><span class="main">)</span> <span class="main">}</span>"</span></span>


<span class="keyword1" id="FSM-d_reaches_unique"><span class="command">lemma</span></span> d_reaches_unique<span class="main">[</span><span class="operator">elim</span><span class="main">]</span> <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"d_reaches <span class="free">M</span> <span class="free">p</span> <span class="free">xs</span> <span class="free">q1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>    <span class="quoted"><span class="quoted">"d_reaches <span class="free">M</span> <span class="free">p</span> <span class="free">xs</span> <span class="free">q2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> d_reaches.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="FSM-d_reaches_unique_cases"><span class="command">lemma</span></span> d_reaches_unique_cases<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">q</span> <span class="main">.</span> d_reaches <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">xs</span> <span class="bound">q</span> <span class="main">}</span> <span class="main">=</span> <span class="main">{}</span> 
                                      <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q2</span> <span class="main">.</span> <span class="main">{</span> <span class="bound">q</span> <span class="main">.</span> d_reaches <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">xs</span> <span class="bound">q</span> <span class="main">}</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">q2</span> <span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> d_reaches.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="FSM-d_reaches_unique_obtain"><span class="command">lemma</span></span> d_reaches_unique_obtain<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"d_reaches <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">xs</span> <span class="free">q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">p</span> <span class="main">.</span> d_reaches <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">xs</span> <span class="bound">p</span> <span class="main">}</span> <span class="main">=</span> <span class="main">{</span> <span class="free">q</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> d_reaches.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="FSM-d_reaches_io_target"><span class="command">lemma</span></span> d_reaches_io_target <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"d_reaches <span class="free">M</span> <span class="free">p</span> <span class="free">xs</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">ys</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="free">p</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">p</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trQ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">ys</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">trQ</span><span class="main">)</span> <span class="free">p</span> <span class="main">∧</span> length <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">trQ</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trD</span></span> <span class="skolem"><span class="skolem">ysD</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"d_reached_by <span class="free">M</span> <span class="free">p</span> <span class="free">xs</span> <span class="free">q</span> <span class="skolem">trD</span> <span class="skolem">ysD</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">ys</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">trQ</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹d_reached_by <span class="free">M</span> <span class="free">p</span> <span class="free">xs</span> <span class="free">q</span> <span class="skolem">trD</span> <span class="skolem">ysD</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="free">p</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">ys</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="FSM-d_reachable_reachable"><span class="command">lemma</span></span> d_reachable_reachable <span class="main">:</span> <span class="quoted"><span class="quoted">"d_reachable <span class="free">M</span> <span class="free">p</span> <span class="main">⊆</span> reachable <span class="free">M</span> <span class="free">p</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> d_reaches.simps d_reachable.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Deterministic state cover ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The deterministic state cover of some FSM is a minimal set of input sequences such that every
d-reachable state of the FSM is d-reached by a sequence in the set and the set contains the
empty sequence (which d-reaches the initial state). 
›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_det_state_cover_ass</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'in</span> list<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_det_state_cover_ass</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="main">∈</span> d_reachable <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">.</span> 
                                                                d_reaches <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="FSM-det_state_cover_ass_dist"><span class="command">lemma</span></span> det_state_cover_ass_dist <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover_ass <span class="free">M</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">∈</span> d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">s2</span> <span class="main">∈</span> d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">≠</span> <span class="free">s2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>d_reaches <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">s2</span><span class="main">)</span> <span class="free">s1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> d_reaches_unique is_det_state_cover_ass.simps<span class="main">)</span>


<span class="keyword1" id="FSM-det_state_cover_ass_diff"><span class="command">lemma</span></span> det_state_cover_ass_diff <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover_ass <span class="free">M</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">∈</span> d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">s2</span> <span class="main">∈</span> d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">≠</span> <span class="free">s2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s1</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">s2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms det_state_cover_ass_dist is_det_state_cover_ass.simps<span class="main">)</span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_det_state_cover</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'in</span> list set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_det_state_cover</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">f</span> <span class="main">.</span> is_det_state_cover_ass <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">f</span> 
                                    <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> image <span class="bound">f</span> <span class="main">(</span>d_reachable <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="FSM-det_state_cover_d_reachable"><span class="command">lemma</span></span> det_state_cover_d_reachable<span class="main">[</span><span class="operator">elim</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"d_reaches <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">v</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> image_iff is_det_state_cover.simps 
      is_det_state_cover_ass.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>



<span class="keyword1" id="FSM-det_state_cover_card"><span class="command">lemma</span></span> det_state_cover_card<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"card <span class="main">(</span>d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def <span class="main">:</span> <span class="quoted"><span class="quoted">"is_det_state_cover_ass <span class="free">M</span> <span class="skolem">f</span> <span class="main">∧</span> <span class="free">V</span> <span class="main">=</span> image <span class="skolem">f</span> <span class="main">(</span>d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_det_state_cover.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> card_f <span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">V</span> <span class="main">=</span> card <span class="main">(</span>image <span class="skolem">f</span> <span class="main">(</span>d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> d_reachable.simps d_reaches.simps <span class="keyword1"><span class="command">using</span></span> d_reachable_reachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dr_finite <span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms infinite_super <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> card_le <span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>image <span class="skolem">f</span> <span class="main">(</span>d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_image_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>image <span class="skolem">f</span> <span class="main">(</span>d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> card_image det_state_cover_ass_diff f_def inj_onI<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> card_f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-det_state_cover_finite"><span class="command">lemma</span></span> det_state_cover_finite <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> det_state_cover_card<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">M</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> finite_imageI infinite_super 
        is_det_state_cover.simps<span class="main">)</span>    
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM-det_state_cover_initial"><span class="command">lemma</span></span> det_state_cover_initial <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reached_by <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">[]</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FSM.nil<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reaches <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M</span> <span class="main">∈</span> d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹d_reaches <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>›</span></span> d_reachable.simps mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms image_iff is_det_state_cover.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
        is_det_state_cover_ass.simps<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-det_state_cover_empty"><span class="command">lemma</span></span> det_state_cover_empty <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def <span class="main">:</span> <span class="quoted"><span class="quoted">"is_det_state_cover_ass <span class="free">M</span> <span class="skolem">f</span> <span class="main">∧</span> <span class="free">V</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">`</span> d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M</span> <span class="main">∈</span> d_reachable <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reaches <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d_reachable.simps mem_Collect_eq<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> f_def calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ IO reduction ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An FSM is a reduction of another, if its language is a subset of the language of the latter FSM.
›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">io_reduction</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM 
                      <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≼</span>"</span> 200<span class="main">)</span> 
  <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main"><span class="free">≼</span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LS</span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M1</span></span></span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">LS</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="FSM-language_state_inclusion_of_state_reached_by_same_sequence"><span class="command">lemma</span></span> language_state_inclusion_of_state_reached_by_same_sequence <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LS</span> <span class="free">M1</span> <span class="free">q1</span> <span class="main">⊆</span> <span class="keyword1">LS</span> <span class="free">M2</span> <span class="free">q2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="free">q1</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span> <span class="free">q1t</span> <span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="free">q2</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span> <span class="free">q2t</span> <span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LS</span> <span class="free">M1</span> <span class="free">q1t</span> <span class="main">⊆</span> <span class="keyword1">LS</span> <span class="free">M2</span> <span class="free">q2t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M1</span> <span class="free">q1t</span>"</span></span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q1x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="free">q1t</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q1x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M1</span> <span class="free">q1t</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> io_targets_observable_singleton_ex<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M1</span> <span class="free">q1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span><span class="main">@</span><span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M1</span> <span class="free">q1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> observable_io_targets_append<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="free">q1</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span> <span class="free">q1t</span> <span class="main">}</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="free">q1t</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q1x</span><span class="main">}</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> io_targets_elim language_state singletonI<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span><span class="main">@</span><span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M2</span> <span class="free">q2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="free">q2</span> <span class="main">(</span><span class="free">io</span><span class="main">@</span><span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q2x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> io_targets_observable_singleton_ex<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M2</span> <span class="free">q2t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> observable_io_targets_split<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="free">q2</span> <span class="main">(</span><span class="free">io</span> <span class="main">@</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q2x</span><span class="main">}</span>›</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Language subsets for input sequences ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following definitions describe restrictions of languages to only those IO-sequences that 
exhibit a certain input sequence or whose input sequence is contained in a given set of
input sequences.
This allows to define the notion that some FSM is a reduction of another over a given set of
input sequences, but not necessarily over the entire language of the latter FSM.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">language_state_for_input</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'in</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">language_state_for_input</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">||</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">|</span> <span class="bound">ys</span> <span class="main">.</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> length <span class="bound">ys</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">||</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">language_state_for_inputs</span>  <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'in</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list set"</span></span> 
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> _ _ _<span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">]</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">language_state_for_inputs</span>  <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">ISeqs</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">xs</span> <span class="main">||</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">|</span> <span class="bound">xs</span> <span class="bound">ys</span> <span class="main">.</span> <span class="main">(</span><span class="bound">xs</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">ISeqs</span></span></span> 
                                                                  <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">=</span> length <span class="bound">ys</span> 
                                                                  <span class="main">∧</span> <span class="main">(</span><span class="bound">xs</span> <span class="main">||</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">TS</span></span></span> <span class="main">≡</span> <span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">TS</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>  <span class="quoted"><span class="quoted">"<span class="free">io_reduction_on</span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">TS</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">≡</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">TS</span></span></span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">TS</span></span></span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">notation</span></span> 
  io_reduction_on <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">≼⟦</span>_<span class="keyword1">⟧</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 61<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span>  <span class="main">(</span>latex <span class="keyword2"><span class="keyword">output</span></span><span class="main">)</span>
  io_reduction_on <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">≼⇘</span>_<span class="keyword1">⇙</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 61<span class="main">)</span>


<span class="keyword1" id="FSM-language_state_for_input_alt_def"><span class="command">lemma</span></span> language_state_for_input_alt_def <span class="main">:</span>
  <span class="quoted"><span class="quoted">"language_state_for_input <span class="free">M</span> <span class="free">q</span> <span class="free">xs</span> <span class="main">=</span> <span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="free">q</span> <span class="main">{</span><span class="free">xs</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> language_state_for_input.simps language_state_for_inputs.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="FSM-language_state_for_inputs_alt_def"><span class="command">lemma</span></span> language_state_for_inputs_alt_def <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="free">q</span> <span class="free">ISeqs</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>language_state_for_input <span class="free">M</span> <span class="free">q</span><span class="main">)</span> <span class="free">ISeqs</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FSM-language_state_for_inputs_in_language_state"><span class="command">lemma</span></span> language_state_for_inputs_in_language_state <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="free">q</span> <span class="free">T</span> <span class="main">⊆</span> language_state <span class="free">M</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> language_state_for_inputs.simps language_state_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1" id="FSM-language_state_for_inputs_map_fst"><span class="command">lemma</span></span> language_state_for_inputs_map_fst <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> language_state <span class="free">M</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"map fst <span class="free">io</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> <span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="free">q</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map fst <span class="free">io</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ys</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map snd <span class="free">io</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">∧</span> length <span class="var">?xs</span> <span class="main">=</span> length <span class="var">?ys</span> <span class="main">∧</span> <span class="var">?xs</span> <span class="main">||</span> <span class="var">?ys</span> <span class="main">∈</span> language_state <span class="free">M</span> <span class="free">q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs</span> <span class="main">||</span> <span class="var">?ys</span> <span class="main">∈</span> <span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="free">q</span> <span class="free">T</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> language_state_for_inputs.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="FSM-language_state_for_inputs_nonempty"><span class="command">lemma</span></span> language_state_for_inputs_nonempty <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> inputs <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"completely_specified <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="free">q</span> <span class="main">{</span><span class="free">xs</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> inputs <span class="free">M</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_step <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">∈</span> succ <span class="free">M</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> completely_specified.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">q'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∧</span> length <span class="main">[</span><span class="skolem">q</span><span class="main">]</span> <span class="main">=</span> length <span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span>"</span></span> 
            <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">q'</span><span class="main">]</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes_target<span class="main">)</span>            
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="skolem">q'</span> <span class="main">{</span><span class="skolem">xs</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons.prems Cons.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">ys</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="skolem">q'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="skolem">q'</span> <span class="main">∧</span> length <span class="skolem">tr</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">q'</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">tr</span><span class="main">)</span> <span class="skolem">q</span> 
              <span class="main">∧</span> length <span class="main">(</span><span class="main">[</span><span class="skolem">q'</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FSM.path.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> x_step<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">q'</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">tr</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∧</span> length <span class="main">(</span><span class="main">[</span><span class="skolem">q'</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="skolem">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> language_state<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">ys</span> <span class="main">∧</span> <span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="skolem">q'</span>›</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">y</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="skolem">q</span> <span class="main">{</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> language_state_for_inputs.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-language_state_for_inputs_map_fst_contained"><span class="command">lemma</span></span> language_state_for_inputs_map_fst_contained <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> <span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="free">q</span> <span class="free">V</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">vs</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map fst <span class="free">vs</span><span class="main">)</span> <span class="main">||</span> <span class="main">(</span>map snd <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> <span class="free">vs</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map fst <span class="free">vs</span><span class="main">)</span> <span class="main">||</span> <span class="main">(</span>map snd <span class="free">vs</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="free">q</span> <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-language_state_for_inputs_empty"><span class="command">lemma</span></span> language_state_for_inputs_empty <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="free">q</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> language_state_for_input <span class="free">M</span> <span class="free">q</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> language_state_for_inputs_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UN_I assms<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-language_state_for_input_empty"><span class="command">lemma</span></span> language_state_for_input_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"language_state_for_input <span class="free">M</span> <span class="free">q</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="FSM-language_state_for_input_take"><span class="command">lemma</span></span> language_state_for_input_take <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> language_state_for_input <span class="free">M</span> <span class="free">q</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"take <span class="free">n</span> <span class="free">io</span> <span class="main">∈</span> language_state_for_input <span class="free">M</span> <span class="free">q</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">xs</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">||</span> <span class="skolem">ys</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="skolem">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">||</span> <span class="skolem">ys</span> <span class="main">∈</span> language_state <span class="free">M</span> <span class="free">q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">p</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span>take <span class="free">n</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append_elim append_take_drop_id<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="free">n</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">∈</span> language_state <span class="free">M</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">p</span> <span class="main">=</span> length <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">xs</span> <span class="main">=</span> length <span class="skolem">ys</span>›</span></span> language_state take_zip<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>take <span class="free">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">||</span> <span class="main">(</span>take <span class="free">n</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">∈</span> language_state <span class="free">M</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_zip<span class="main">)</span> 
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="free">n</span> <span class="free">io</span> <span class="main">=</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">||</span> <span class="main">(</span>take <span class="free">n</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">io</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">||</span> <span class="skolem">ys</span>›</span></span> take_zip <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>take <span class="free">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>take <span class="free">n</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">xs</span> <span class="main">=</span> length <span class="skolem">ys</span>›</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>take <span class="free">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">||</span> <span class="main">(</span>take <span class="free">n</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">∈</span> language_state <span class="free">M</span> <span class="free">q</span>›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> language_state_for_input.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-language_state_for_inputs_prefix"><span class="command">lemma</span></span> language_state_for_inputs_prefix <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="free">vs'</span><span class="main">@</span><span class="free">xs'</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> length <span class="free">vs'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="free">vs'</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> language_state_prefix<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span>map fst <span class="free">vs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> insertI1 language_state_for_inputs_map_fst<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs'</span> <span class="main">=</span> map fst <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_append_conv assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> language_state_for_inputs_map_fst_contained 
        length_map map_append singletonD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-language_state_for_inputs_union"><span class="command">lemma</span></span> language_state_for_inputs_union <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="free">q</span> <span class="free">T1</span> <span class="main">∪</span> <span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="free">q</span> <span class="free">T2</span> <span class="main">=</span> <span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="free">q</span> <span class="main">(</span><span class="free">T1</span> <span class="main">∪</span> <span class="free">T2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> language_state_for_inputs.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="FSM-io_reduction_on_subset"><span class="command">lemma</span></span> io_reduction_on_subset <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"io_reduction_on <span class="free">M1</span> <span class="free">T</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">T'</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"io_reduction_on <span class="free">M1</span> <span class="free">T'</span> <span class="free">M2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> io_reduction_on <span class="free">M1</span> <span class="free">T'</span> <span class="free">M2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">∈</span> <span class="free">T'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="skolem">xs'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">P</span> <span class="bound">Pa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ps</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list<span class="main">)</span> <span class="main">∉</span> <span class="bound">P</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">P</span> <span class="main">⊆</span> <span class="bound">Pa</span> <span class="main">∨</span> <span class="bound">ps</span> <span class="main">∈</span> <span class="bound">Pa</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pps</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v2</span><span class="main">.</span> <span class="bound">v2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="bound">v2</span> <span class="main">∉</span> <span class="bound">x0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pps</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="skolem">pps</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∉</span> <span class="bound">x0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span> <span class="bound">Pa</span><span class="main">.</span> <span class="skolem">pps</span> <span class="bound">Pa</span> <span class="bound">P</span> <span class="main">∈</span> <span class="bound">P</span> <span class="main">∧</span> <span class="skolem">pps</span> <span class="bound">Pa</span> <span class="bound">P</span> <span class="main">∉</span> <span class="bound">Pa</span> <span class="main">∨</span> <span class="bound">P</span> <span class="main">⊆</span> <span class="bound">Pa</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">f</span> <span class="bound">c</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">ps</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list<span class="main">)</span> <span class="main">∉</span> <span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="bound">f</span> <span class="main">(</span><span class="bound">c</span><span class="main">::</span><span class="tfree">'c</span><span class="main">)</span> <span class="bound">A</span> <span class="main">∨</span> map fst <span class="bound">ps</span> <span class="main">∈</span> <span class="bound">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> language_state_for_inputs_map_fst_contained<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T'</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> language_state_for_inputs_in_language_state 
                    language_state_for_inputs_map_fst set_rev_mp<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f3 f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> io_reduction_on <span class="free">M1</span> <span class="free">T'</span> <span class="free">M2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                          language_state_for_inputs_in_language_state 
                          language_state_for_inputs_map_fst<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> io_reduction_on <span class="free">M1</span> <span class="free">T</span> <span class="free">M2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">as</span><span class="main">.</span> <span class="bound">as</span> <span class="main">∉</span> <span class="free">T'</span> <span class="main">∨</span> <span class="bound">as</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pps</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v2</span><span class="main">.</span> <span class="bound">v2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="bound">v2</span> <span class="main">∉</span> <span class="bound">x0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pps</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="skolem">pps</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∉</span> <span class="bound">x0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span> <span class="bound">Pa</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="bound">P</span> <span class="main">⊆</span> <span class="bound">Pa</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ps</span><span class="main">.</span> <span class="bound">ps</span> <span class="main">∉</span> <span class="bound">P</span> <span class="main">∨</span> <span class="bound">ps</span> <span class="main">∈</span> <span class="bound">Pa</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">∧</span> <span class="main">(</span><span class="bound">P</span> <span class="main">⊆</span> <span class="bound">Pa</span> <span class="main">∨</span> <span class="skolem">pps</span> <span class="bound">Pa</span> <span class="bound">P</span> <span class="main">∈</span> <span class="bound">P</span> <span class="main">∧</span> <span class="skolem">pps</span> <span class="bound">Pa</span> <span class="bound">P</span> <span class="main">∉</span> <span class="bound">Pa</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> io_reduction_on <span class="free">M1</span> <span class="free">T'</span> <span class="free">M2</span>›</span></span> language_state_for_inputs_in_language_state 
                    language_state_for_inputs_map_fst language_state_for_inputs_map_fst_contained<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Sequences to failures ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A sequence to a failure for FSMs <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a sequence such that any 
proper prefix of it is contained in the languages of both <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, while 
the sequence itself is contained only in the language of A.

That is, if a sequence to a failure for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> exists, then 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not a reduction of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sequence_to_failure</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span><span class="tfree">'out</span><span class="main">,</span><span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span><span class="tfree">'out</span><span class="main">,</span><span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sequence_to_failure</span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span>
    <span class="main">(</span>butlast <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>language_state <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M2</span></span></span><span class="main">)</span> <span class="main">∩</span> language_state <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M1</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∈</span> <span class="main">(</span>language_state <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M1</span></span></span><span class="main">)</span> <span class="main">-</span> language_state <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="FSM-sequence_to_failure_ob"><span class="command">lemma</span></span> sequence_to_failure_ob <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>  
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">io</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="free">io</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?diff</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">io</span> <span class="main">.</span> <span class="bound">io</span> <span class="main">∈</span> language_state <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">io</span> <span class="main">∉</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?diff</span> <span class="main">≠</span> empty"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io</span></span> <span class="keyword2"><span class="keyword">where</span></span> io_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">=</span> arg_min length <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> <span class="bound">io</span> <span class="main">∈</span> <span class="var">?diff</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> io_diff <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> <span class="var">?diff</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> all_not_in_conv arg_min_natI<span class="main">)</span> 

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms io_def language_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io_init</span></span> <span class="skolem"><span class="skolem">io_last</span></span> <span class="keyword2"><span class="keyword">where</span></span> io_split<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">=</span> <span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id<span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> io_init_inclusion <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io_init</span> <span class="main">∈</span> language_state <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> 
                            <span class="main">∧</span> <span class="skolem">io_init</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">io_init</span> <span class="main">∈</span> language_state <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> 
                        <span class="main">∧</span> <span class="skolem">io_init</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">∈</span> language_state <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> io_diff io_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io_init</span> <span class="main">∈</span> language_state <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> language_state language_state_split<span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io_init</span> <span class="main">∉</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assm calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io_init</span> <span class="main">∈</span> <span class="var">?diff</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">io_init</span> <span class="main">&lt;</span> length <span class="skolem">io</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> io_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">≠</span> arg_min length <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> <span class="bound">io</span> <span class="main">∈</span> <span class="var">?diff</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> <span class="bound">ps</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">ps</span></span> <span class="main">∈</span> language_state <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">.</span> 
                              <span class="bound">ps</span> <span class="main">∉</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span> <span class="main">¬</span> length <span class="skolem">io</span> <span class="main">≤</span> length <span class="bound">ps</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io_init</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">io</span></span><span class="main">∈</span> language_state <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">.</span> <span class="bound">io</span> <span class="main">∉</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">}</span>›</span></span>
              <span class="quoted"><span class="quoted">‹length <span class="skolem">io_init</span> <span class="main">&lt;</span> length <span class="skolem">io</span>›</span></span> linorder_not_less 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> arg_min_nat_le<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> io_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">io</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> io_split io_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-sequence_to_failure_succ"><span class="command">lemma</span></span> sequence_to_failure_succ <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="free">io</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>butlast <span class="free">io</span><span class="main">)</span> <span class="main">.</span> succ <span class="free">M2</span> <span class="main">(</span>last <span class="free">io</span><span class="main">)</span> <span class="bound">q</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>butlast <span class="free">io</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> target <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
                 <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
                 <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"length <span class="main">(</span>butlast <span class="free">io</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> io_targets.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">M2</span> <span class="main">(</span>last <span class="free">io</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">M2</span> <span class="main">(</span>last <span class="free">io</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">∈</span> succ <span class="free">M2</span> <span class="main">(</span>last <span class="free">io</span><span class="main">)</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">[</span><span class="main">(</span>last <span class="free">io</span><span class="main">,</span> <span class="skolem">q'</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">=</span> target <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>last <span class="free">io</span><span class="main">,</span> <span class="skolem">q'</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">[</span><span class="main">(</span>last <span class="free">io</span><span class="main">,</span> <span class="skolem">q'</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="free">io</span> <span class="main">@</span> <span class="main">[</span>last <span class="free">io</span><span class="main">]</span> <span class="main">=</span> <span class="free">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="free">io</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> append_butlast_last_id<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="main">(</span><span class="skolem">tr</span><span class="main">@</span><span class="main">[</span><span class="skolem">q'</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="main">[</span>last <span class="free">io</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">q'</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FSM.path_append <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">[</span><span class="main">(</span>last <span class="free">io</span><span class="main">,</span> <span class="skolem">q'</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹butlast <span class="free">io</span> <span class="main">@</span> <span class="main">[</span>last <span class="free">io</span><span class="main">]</span> <span class="main">=</span> <span class="free">io</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹length <span class="main">(</span>butlast <span class="free">io</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr</span>›</span></span> zip_append<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tr</span> <span class="main">+</span> <span class="main">(</span><span class="main">0</span> <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> length <span class="free">io</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹butlast <span class="free">io</span> <span class="main">@</span> <span class="main">[</span>last <span class="free">io</span><span class="main">]</span> <span class="main">=</span> <span class="free">io</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>butlast <span class="free">io</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr</span>›</span></span> 
            length_append list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">q'</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-sequence_to_failure_non_nil"><span class="command">lemma</span></span> sequence_to_failure_non_nil <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM-sequence_to_failure_from_arbitrary_failure"><span class="command">lemma</span></span> sequence_to_failure_from_arbitrary_failure <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xs'</span> <span class="main">.</span> prefix <span class="bound">xs'</span> <span class="free">xs</span> <span class="main">∧</span> sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="bound">xs'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff append.assoc language_state_prefix<span class="main">)</span> 

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> True <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> butlast_append<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> sequence_to_failure.simps snoc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">xs'</span> <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>2<span class="main">)</span> snoc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> prefix_snoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>  


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemma shows that if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not a reduction of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, then a 
minimal sequence to a failure exists that is of length at most the number of states in 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> times the number of states in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
›</span></span>

<span class="keyword1" id="FSM-sequence_to_failure_length"><span class="command">lemma</span></span> sequence_to_failure_length <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xs</span> <span class="main">.</span> sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="bound">xs</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">M1</span><span class="main">|</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">seq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">seq</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms sequence_to_failure_ob <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bls</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">seq</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bls</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?bls</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">seq</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1b</span></span> <span class="skolem"><span class="skolem">tr2b</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="var">?bls</span> <span class="main">||</span> <span class="skolem">tr1b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="skolem">tr1b</span> <span class="main">=</span> length <span class="var">?bls</span>"</span></span>
    <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="var">?bls</span> <span class="main">||</span> <span class="skolem">tr2b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"length <span class="var">?bls</span> <span class="main">=</span> length <span class="skolem">tr2b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tr2b</span> <span class="main">=</span> length <span class="skolem">tr1b</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?PM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"product <span class="free">M2</span> <span class="free">M1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="var">?PM</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> well_formed_product<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="var">?PM</span> <span class="main">(</span><span class="var">?bls</span> <span class="main">||</span> <span class="skolem">tr2b</span> <span class="main">||</span> <span class="skolem">tr1b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> product_path<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹length <span class="var">?bls</span> <span class="main">=</span> length <span class="skolem">tr2b</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr2b</span> <span class="main">=</span> length <span class="skolem">tr1b</span>›</span></span><span class="main">,</span> 
                       <span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M1</span> <span class="main">(</span>butlast <span class="skolem">seq</span> <span class="main">||</span> <span class="skolem">tr1b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">(</span>butlast <span class="skolem">seq</span> <span class="main">||</span> <span class="skolem">tr2b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q1b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?bls</span> <span class="main">||</span> <span class="skolem">tr1b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q2b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?bls</span> <span class="main">||</span> <span class="skolem">tr2b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>

   
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="var">?bls</span> <span class="main">=</span> <span class="main">{</span><span class="var">?q2b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>butlast <span class="skolem">seq</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr2b</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">(</span>butlast <span class="skolem">seq</span> <span class="main">||</span> <span class="skolem">tr2b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>›</span></span> 
        assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> obs_target_is_io_targets<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="var">?bls</span> <span class="main">=</span> <span class="main">{</span><span class="var">?q1b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr1b</span> <span class="main">=</span> length <span class="main">(</span>butlast <span class="skolem">seq</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M1</span> <span class="main">(</span>butlast <span class="skolem">seq</span> <span class="main">||</span> <span class="skolem">tr1b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>›</span></span> 
        assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> obs_target_is_io_targets<span class="main">)</span>



  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?q2b</span><span class="main">,</span> <span class="var">?q1b</span><span class="main">)</span> <span class="main">∈</span> reachable <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span>butlast <span class="skolem">seq</span> <span class="main">||</span> <span class="skolem">tr2b</span> <span class="main">||</span> <span class="skolem">tr1b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> 
            <span class="main">∈</span> reachable <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>butlast <span class="skolem">seq</span> <span class="main">||</span> <span class="skolem">tr2b</span> <span class="main">||</span> <span class="skolem">tr1b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>butlast <span class="skolem">seq</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr2b</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr2b</span> <span class="main">=</span> length <span class="skolem">tr1b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">∈</span> nodes <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FSM.nodes.initial<span class="main">)</span> 

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> repFreePath <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span>
        target <span class="skolem">p</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="var">?q2b</span><span class="main">,</span><span class="var">?q1b</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> reaching_path_without_repetition<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹well_formed <span class="var">?PM</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?q2b</span><span class="main">,</span> <span class="var">?q1b</span><span class="main">)</span> <span class="main">∈</span> reachable <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">∈</span> nodes <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span>›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>states <span class="skolem">p</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="var">?PM</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FSM.nodes_states <span class="quoted"><span class="quoted">‹<span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">∈</span> nodes <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span>›</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>states <span class="skolem">p</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span><span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>states <span class="skolem">p</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="var">?PM</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="var">?PM</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="var">?PM</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="main">(</span>states <span class="skolem">p</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>nodes <span class="var">?PM</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">∈</span> nodes <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>states <span class="skolem">p</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹set <span class="main">(</span>states <span class="skolem">p</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span>›</span></span> 
        psubsetI psubset_card_mono<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="main">(</span>states <span class="skolem">p</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">=</span> length <span class="main">(</span>states <span class="skolem">p</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distinct_card repFreePath<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>states <span class="skolem">p</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">|</span><span class="var">?PM</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">p</span> <span class="main">&lt;</span> <span class="main">|</span><span class="var">?PM</span><span class="main">|</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 


  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>fst <span class="main">∘</span> snd<span class="main">)</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pIO</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">p</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="var">?pIO</span> <span class="main">||</span> <span class="var">?p2</span> <span class="main">||</span> <span class="var">?p1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> map_map zip_map_fst_snd<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="var">?pIO</span> <span class="main">||</span> <span class="var">?p2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>  
       <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="var">?pIO</span> <span class="main">||</span> <span class="var">?p1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> product_path<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pIO</span></span></span> <span class="var"><span class="quoted"><span class="var">?p2</span></span></span> <span class="var"><span class="quoted"><span class="var">?p1</span></span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="var">?pIO</span> <span class="main">||</span> <span class="var">?p2</span> <span class="main">||</span> <span class="var">?p1</span>›</span></span> repFreePath<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?q2b</span><span class="main">,</span> <span class="var">?q1b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>target <span class="main">(</span><span class="var">?pIO</span> <span class="main">||</span> <span class="var">?p2</span> <span class="main">||</span> <span class="var">?p1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="var">?pIO</span> <span class="main">||</span> <span class="var">?p2</span> <span class="main">||</span> <span class="var">?p1</span>›</span></span> repFreePath<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q2b</span> <span class="main">=</span> target <span class="main">(</span><span class="var">?pIO</span> <span class="main">||</span> <span class="var">?p2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span> 
            <span class="quoted"><span class="quoted">"<span class="var">?q1b</span> <span class="main">=</span> target <span class="main">(</span><span class="var">?pIO</span> <span class="main">||</span> <span class="var">?p1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="var">?pIO</span> <span class="main">=</span> <span class="main">{</span><span class="var">?q2b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">(</span>map fst <span class="skolem">p</span> <span class="main">||</span> map <span class="main">(</span>fst <span class="main">∘</span> snd<span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹target <span class="main">(</span><span class="var">?bls</span> <span class="main">||</span> <span class="skolem">tr2b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> target <span class="main">(</span>map fst <span class="skolem">p</span> <span class="main">||</span> map <span class="main">(</span>fst <span class="main">∘</span> snd<span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>›</span></span> 
        assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> length_map obs_target_is_io_targets<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="var">?pIO</span> <span class="main">=</span> <span class="main">{</span><span class="var">?q1b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹path <span class="free">M1</span> <span class="main">(</span>map fst <span class="skolem">p</span> <span class="main">||</span> map <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹target <span class="main">(</span><span class="var">?bls</span> <span class="main">||</span> <span class="skolem">tr1b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> target <span class="main">(</span>map fst <span class="skolem">p</span> <span class="main">||</span> map <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>›</span></span> 
        assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> length_map obs_target_is_io_targets<span class="main">)</span>

    
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="main">∉</span> L <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">seq</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="var">?bls</span> <span class="main">=</span> <span class="main">{</span><span class="var">?q1b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr1b</span> <span class="main">=</span> length <span class="main">(</span>butlast <span class="skolem">seq</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M1</span> <span class="main">(</span>butlast <span class="skolem">seq</span> <span class="main">||</span> <span class="skolem">tr1b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>›</span></span> 
        assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> obs_target_is_io_targets<span class="main">)</span>
  
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q1s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">seq</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q1s</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">seq</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> io_targets_observable_singleton_ob<span class="main">)</span>
  

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="main">=</span> <span class="main">(</span>butlast <span class="skolem">seq</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">seq</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>butlast <span class="skolem">seq</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q1s</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="var">?q1b</span> <span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q1s</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> observable_io_targets_suffix<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="var">?bls</span> <span class="main">=</span> <span class="main">{</span><span class="var">?q1b</span><span class="main">}</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>butlast <span class="skolem">seq</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q1s</span><span class="main">}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1s</span> <span class="main">=</span> target <span class="main">(</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr1s</span><span class="main">)</span> <span class="var">?q1b</span>"</span></span> 
                         <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr1s</span><span class="main">)</span> <span class="var">?q1b</span>"</span></span> 
                         <span class="quoted"><span class="quoted">"length <span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">=</span> length <span class="skolem">tr1s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">q1s</span><span class="main">]</span><span class="main">)</span> <span class="var">?q1b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">=</span> length <span class="skolem">tr1s</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹path <span class="free">M1</span> <span class="main">(</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr1s</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="skolem">seq</span> <span class="main">||</span> <span class="skolem">tr1b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="skolem">q1s</span> <span class="main">=</span> target <span class="main">(</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr1s</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="skolem">seq</span> <span class="main">||</span> <span class="skolem">tr1b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        append_Nil append_butlast_last_id butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> length_butlast length_greater_0_conv 
        not_Cons_self2 target_alt_def<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1s</span> <span class="main">∈</span> succ <span class="free">M1</span> <span class="main">(</span>last <span class="skolem">seq</span><span class="main">)</span> <span class="var">?q1b</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">M2</span> <span class="main">(</span>last <span class="skolem">seq</span><span class="main">)</span> <span class="var">?q2b</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">M2</span> <span class="main">(</span>last <span class="skolem">seq</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="skolem">seq</span> <span class="main">||</span> <span class="skolem">tr2b</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2f</span> <span class="main">∈</span> succ <span class="free">M2</span> <span class="main">(</span>last <span class="skolem">seq</span><span class="main">)</span> <span class="var">?q2b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">q2f</span><span class="main">]</span><span class="main">)</span> <span class="var">?q2b</span> <span class="main">=</span> <span class="skolem">q2f</span>"</span></span> 
              <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">q2f</span><span class="main">]</span><span class="main">)</span> <span class="var">?q2b</span>"</span></span> 
              <span class="quoted"><span class="quoted">"length <span class="main">[</span><span class="skolem">q2f</span><span class="main">]</span> <span class="main">=</span> length <span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2f</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="var">?q2b</span> <span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> io_target_from_path<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="var">?q2b</span> <span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q2f</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> observable_io_target_is_singleton<span class="main">)</span>

    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>butlast <span class="skolem">seq</span> <span class="main">@</span> <span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q2f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> observable_io_targets_append<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="var">?bls</span> <span class="main">=</span> <span class="main">{</span><span class="var">?q2b</span><span class="main">}</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="var">?q2b</span> <span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q2f</span><span class="main">}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">seq</span> <span class="main">=</span> butlast <span class="skolem">seq</span> <span class="main">@</span> <span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">seq</span> <span class="main">∉</span> L <span class="free">M2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pIO</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pIO</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M1</span> <span class="main">(</span><span class="var">?pIO</span> <span class="main">||</span> <span class="var">?p1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">(</span><span class="var">?pIO</span> <span class="main">||</span> <span class="var">?p2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="main">(</span><span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> observable_io_targets_append<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="var">?pIO</span> <span class="main">=</span> <span class="main">{</span><span class="var">?q1b</span><span class="main">}</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="var">?q1b</span> <span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q1s</span><span class="main">}</span>›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> all_not_in_conv insert_not_empty io_targets_elim language_state<span class="main">)</span>
           
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">∉</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q2f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> io_targets_observable_singleton_ob<span class="main">)</span>
      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="var">?q2b</span> <span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q2f</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> observable_io_targets_split<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 
            <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q2f</span><span class="main">}</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="var">?q2b</span><span class="main">}</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2f</span> <span class="main">∈</span> succ <span class="free">M2</span> <span class="main">(</span>last <span class="skolem">seq</span><span class="main">)</span> <span class="var">?q2b</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> io_targets_succ<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹succ <span class="free">M2</span> <span class="main">(</span>last <span class="skolem">seq</span><span class="main">)</span> <span class="var">?q2b</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹butlast <span class="main">(</span><span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="var">?pIO</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="var">?PM</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">p</span> <span class="main">&lt;</span> <span class="main">|</span><span class="var">?PM</span><span class="main">|</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">M1</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_cartesian_product<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="var">?PM</span><span class="main">|</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">M1</span><span class="main">|</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">M1</span><span class="main">|</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>›</span></span> 
        card_mono dual_order.trans product_nodes<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">M1</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span><span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="var">?PM</span><span class="main">|</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> length <span class="main">(</span><span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">M1</span><span class="main">|</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="var">?pIO</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">seq</span><span class="main">]</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Minimal sequence to failure extending ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A minimal sequence to a failure extending some some set of IO-sequences is a sequence to a failure
of minimal length such that a prefix of that sequence is contained in the set.
›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">minimal_sequence_to_failure_extending</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'in</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span><span class="tfree">'out</span><span class="main">,</span><span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span><span class="tfree">'out</span><span class="main">,</span><span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list 
    <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minimal_sequence_to_failure_extending</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="free"><span class="bound"><span class="entity">io</span></span></span> <span class="main">=</span> <span class="main">(</span>
   <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∧</span> sequence_to_failure <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">io</span></span></span><span class="main">)</span> 
              <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">io'</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">w'</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">.</span> sequence_to_failure <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">(</span><span class="bound">w'</span> <span class="main">@</span> <span class="bound">io'</span><span class="main">)</span> 
                                                            <span class="main">∧</span> length <span class="bound">io'</span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">io</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="FSM-minimal_sequence_to_failure_extending_det_state_cover_ob"><span class="command">lemma</span></span> minimal_sequence_to_failure_extending_det_state_cover_ob <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">vs</span> <span class="free">xs</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"minimal_sequence_to_failure_extending <span class="free">V</span> <span class="free">M1</span> <span class="free">M2</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹set of all IO-sequences that extend some reaction of M1 to V to a failure›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?exts</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">vs'</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span> sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="bound">vs'</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span><span class="main">}</span>"</span></span>
  
  <span class="comment1">― ‹arbitrary sequence to failure›</span>
  <span class="comment1">― ‹must be contained in ?exts as V contains the empty sequence›</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">stf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">stf</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms sequence_to_failure_ob <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="skolem">stf</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> det_state_cover_initial language_state_for_inputs_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">stf</span> <span class="main">∈</span> <span class="var">?exts</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="comment1">― ‹the minimal length sequence of ?exts›</span>
  <span class="comment1">― ‹is a minimal sequence to a failure extending V by construction›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xsMin</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"arg_min length <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">∈</span> <span class="var">?exts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> xsMin_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?xsMin</span> <span class="main">∈</span> <span class="var">?exts</span> 
                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> <span class="var">?exts</span><span class="main">.</span> length  <span class="var">?xsMin</span> <span class="main">≤</span> length <span class="bound">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">stf</span> <span class="main">∈</span> <span class="var">?exts</span>›</span></span> arg_min_nat_lemma<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span> 
                        <span class="main">∧</span> sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="var">?xsMin</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">xs</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">ws</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span> sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="bound">ws</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span> 
                                         <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">&lt;</span> length <span class="var">?xsMin</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leD xsMin_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"minimal_sequence_to_failure_extending <span class="free">V</span> <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">vs</span> <span class="var">?xsMin</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="FSM-mstfe_prefix_input_in_V"><span class="command">lemma</span></span> mstfe_prefix_input_in_V <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"minimal_sequence_to_failure_extending <span class="free">V</span> <span class="free">M1</span> <span class="free">M2</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map fst <span class="free">vs</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> language_state_for_inputs_map_fst_contained <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Complete test suite derived from the product machine ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The classical result of testing FSMs for language inclusion :
Any failure can be observed by a sequence of length at
most n*m where n is the number of states of the reference 
model (here FSM <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>) and m is an upper bound on the number
of states of the SUT (here FSM <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>).
›</span></span>

<span class="keyword1" id="FSM-product_suite_soundness"><span class="command">lemma</span></span> product_suite_soundness <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"inputs <span class="free">M2</span> <span class="main">=</span> inputs <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">M1</span><span class="main">|</span> <span class="main">≤</span> <span class="free">m</span> "</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">M1</span> <span class="main">≼⟦</span><span class="main">{</span><span class="bound">xs</span> <span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> inputs <span class="free">M2</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">}</span><span class="main">⟧</span> <span class="free">M2</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">M1</span> <span class="main">≼⟦</span><span class="var">?TS</span><span class="main">⟧</span> <span class="free">M2</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">stf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">stf</span> <span class="main">∧</span> length <span class="skolem">stf</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">M1</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sequence_to_failure_length<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">stf</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">stf</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">M1</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">stf</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">stf</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?xs</span> <span class="main">⊆</span> inputs <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">stf</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> language_state_inputs<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?xs</span> <span class="main">⊆</span> inputs <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?xs</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">M1</span><span class="main">|</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">stf</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">M1</span><span class="main">|</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?xs</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>map fst <span class="skolem">stf</span><span class="main">)</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">M1</span><span class="main">|</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">|</span><span class="free">M1</span><span class="main">|</span> <span class="main">≤</span> <span class="free">m</span>›</span></span> 
          dual_order.trans mult.commute mult_le_mono1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">stf</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="var">?xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">stf</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> insertI1 language_state_for_inputs_map_fst<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs</span> <span class="main">∈</span> <span class="var">?TS</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set <span class="var">?xs</span> <span class="main">⊆</span> inputs <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="var">?xs</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">stf</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="var">?TS</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹map fst <span class="skolem">stf</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> inputs <span class="free">M2</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">}</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹<span class="skolem">stf</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> language_state_for_inputs_map_fst<span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">stf</span> <span class="main">∉</span> L <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">stf</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">stf</span> <span class="main">∉</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="var">?TS</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼⟦</span><span class="var">?TS</span><span class="main">⟧</span> <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">stf</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="var">?TS</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">stf</span> <span class="main">∉</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="var">?TS</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM-product_suite_completeness"><span class="command">lemma</span></span> product_suite_completeness <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"inputs <span class="free">M2</span> <span class="main">=</span> inputs <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">M1</span><span class="main">|</span> <span class="main">≤</span> <span class="free">m</span> "</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span> <span class="main">⟷</span> <span class="free">M1</span> <span class="main">≼⟦</span><span class="main">{</span><span class="bound">xs</span> <span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> inputs <span class="free">M2</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">}</span><span class="main">⟧</span> <span class="free">M2</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span> <span class="main">⟷</span> <span class="free">M1</span> <span class="main">≼⟦</span><span class="var">?TS</span><span class="main">⟧</span> <span class="free">M2</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span> <span class="main">⟹</span> <span class="free">M1</span> <span class="main">≼⟦</span><span class="var">?TS</span><span class="main">⟧</span> <span class="free">M2</span>"</span></span> <span class="comment1">― ‹soundness holds trivially›</span>
    <span class="keyword1"><span class="command">unfolding</span></span> language_state_for_inputs.simps io_reduction.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼⟦</span><span class="var">?TS</span><span class="main">⟧</span> <span class="free">M2</span> <span class="main">⟹</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> product_suite_soundness<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="FSM_Product">
<div class="head">
<h1>Theory FSM_Product</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> FSM_Product
<span class="keyword2"><span class="keyword">imports</span></span> <a href="FSM.html">FSM</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Product machines with an additional fail state ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We extend the product machine for language intersection presented in theory FSM by an additional
state that is reached only by sequences such that any proper prefix of the sequence is in the
language intersection, whereas the full sequence is only contained in the language of the machine
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">B</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for which we want to check whether it is a reduction of some machine <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">A</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

To allow for free choice of the FAIL state, we define the following property that holds iff 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">AB</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the product machine of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">A</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">B</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> extended with fail state 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">FAIL</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>




<span class="keyword1"><span class="command">fun</span></span> <span class="entity">productF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'state1</span> <span class="main">×</span> <span class="tfree">'state2</span><span class="main">)</span>  
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state1</span> <span class="main">×</span><span class="tfree">'state2</span><span class="main">)</span> FSM <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">productF</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">FAIL</span></span></span> <span class="free"><span class="bound"><span class="entity">AB</span></span></span> <span class="main">=</span> <span class="main">(</span> 
    <span class="main">(</span>inputs <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> inputs <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">FAIL</span></span></span> <span class="main">∉</span> nodes <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">FAIL</span></span></span> <span class="main">∉</span> nodes <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>
  <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">AB</span></span></span> <span class="main">=</span>  <span class="main">⦇</span>
            succ <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="main">(</span><span class="bound">p1</span><span class="main">,</span><span class="bound">p2</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">p1</span> <span class="main">∈</span> nodes <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">p2</span> <span class="main">∈</span> nodes <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∧</span> <span class="main">(</span>fst <span class="bound">a</span> <span class="main">∈</span> inputs <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> 
                                        <span class="main">∧</span> <span class="main">(</span>snd <span class="bound">a</span> <span class="main">∈</span> outputs <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> outputs <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">)</span>
                                    <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>succ <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">a</span> <span class="bound">p1</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> succ <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="bound">a</span> <span class="bound">p2</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>
                                      <span class="keyword1">then</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">FAIL</span></span></span><span class="main">}</span> 
                                      <span class="keyword1">else</span> <span class="main">(</span>succ <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">a</span> <span class="bound">p1</span> <span class="main">×</span> succ <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="bound">a</span> <span class="bound">p2</span><span class="main">)</span><span class="main">)</span>
                                    <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
            inputs <span class="main">=</span> inputs <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span>
            outputs <span class="main">=</span> outputs <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> outputs <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">,</span>
            initial <span class="main">=</span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> initial <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>
          <span class="main">⦈</span> <span class="main">)</span>"</span></span>

<span class="keyword1" id="FSM_Product-productF_simps"><span class="command">lemma</span></span> productF_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span> <span class="main">⟹</span> succ <span class="free">AB</span> <span class="free">a</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">p1</span> <span class="main">∈</span> nodes <span class="free">A</span> <span class="main">∧</span> <span class="free">p2</span> <span class="main">∈</span> nodes <span class="free">B</span> 
                                        <span class="main">∧</span> <span class="main">(</span>fst <span class="free">a</span> <span class="main">∈</span> inputs <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="free">a</span> <span class="main">∈</span> outputs <span class="free">A</span> <span class="main">∪</span> outputs <span class="free">B</span><span class="main">)</span><span class="main">)</span>
                                    <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>succ <span class="free">A</span> <span class="free">a</span> <span class="free">p1</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> succ <span class="free">B</span> <span class="free">a</span> <span class="free">p2</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>
                                      <span class="keyword1">then</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span> 
                                      <span class="keyword1">else</span> <span class="main">(</span>succ <span class="free">A</span> <span class="free">a</span> <span class="free">p1</span> <span class="main">×</span> succ <span class="free">B</span> <span class="free">a</span> <span class="free">p2</span><span class="main">)</span><span class="main">)</span>
                                    <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span> <span class="main">⟹</span> inputs <span class="free">AB</span> <span class="main">=</span> inputs <span class="free">A</span>"</span></span>
  <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span> <span class="main">⟹</span> outputs <span class="free">AB</span> <span class="main">=</span> outputs <span class="free">A</span> <span class="main">∪</span> outputs <span class="free">B</span>"</span></span>
  <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span> <span class="main">⟹</span> initial <span class="free">AB</span> <span class="main">=</span> <span class="main">(</span>initial <span class="free">A</span><span class="main">,</span> initial <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> productF.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1" id="FSM_Product-fail_next_productF"><span class="command">lemma</span></span> fail_next_productF <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">PM</span> <span class="free">a</span> <span class="free">FAIL</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>fst <span class="free">FAIL</span><span class="main">)</span> <span class="main">∈</span> nodes <span class="free">M2</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="free">FAIL</span><span class="main">)</span> <span class="main">∈</span> nodes <span class="free">M1</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>succ <span class="free">M2</span> <span class="free">a</span> <span class="main">(</span>fst <span class="free">FAIL</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span>fst <span class="free">a</span> <span class="main">∈</span> inputs <span class="free">M2</span><span class="main">)</span> 
                                                      <span class="main">∧</span> <span class="main">(</span>snd <span class="free">a</span> <span class="main">∈</span> outputs <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="FSM_Product-nodes_productF"><span class="command">lemma</span></span> nodes_productF <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">PM</span> <span class="main">⊆</span> insert <span class="free">FAIL</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> q_assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> nodes <span class="free">PM</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> insert <span class="free">FAIL</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> initial
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>execute <span class="skolem">p</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">q1</span></span> <span class="skolem"><span class="skolem">q2</span></span>  <span class="keyword2"><span class="keyword">where</span></span> p_a_split<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span>"</span></span> 
                                                         <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span>"</span></span> 
                                                         <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span><span class="skolem">q2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_snd_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> subnodes <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">∈</span> nodes <span class="free">M2</span> <span class="main">∧</span> <span class="skolem">p2</span> <span class="main">∈</span> nodes <span class="free">M1</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> inputs <span class="free">M2</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> outputs <span class="free">M2</span> <span class="main">∪</span> outputs <span class="free">M1</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">p1</span> <span class="main">∈</span> nodes <span class="free">M2</span> <span class="main">∧</span> <span class="skolem">p2</span> <span class="main">∈</span> nodes <span class="free">M1</span>  <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> inputs <span class="free">M2</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> outputs <span class="free">M2</span> <span class="main">∪</span> outputs <span class="free">M1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">PM</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> execute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
      
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>succ <span class="free">M2</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">p1</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> succ <span class="free">M1</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">p2</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> subnodes assms<span class="main">(</span>3<span class="main">)</span> execute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">PM</span> <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> succ <span class="free">M2</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">p1</span> <span class="main">×</span> succ <span class="free">M1</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">p2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> subnodes assms<span class="main">(</span>3<span class="main">)</span> execute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="main">(</span>succ <span class="free">M2</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">p1</span> <span class="main">×</span> succ <span class="free">M1</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> execute <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> q_succ <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q1</span><span class="main">,</span><span class="skolem">q2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>succ <span class="free">M2</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">p1</span> <span class="main">×</span> succ <span class="free">M1</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">∈</span> succ <span class="free">M2</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">p1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> q_succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">∈</span> successors <span class="free">M2</span> <span class="skolem">p1</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">∈</span> reachable <span class="free">M2</span> <span class="skolem">p1</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">∈</span> reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> subnodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nodes1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> succ <span class="free">M1</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">p2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> q_succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> successors <span class="free">M1</span> <span class="skolem">p2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> reachable <span class="free">M1</span> <span class="skolem">p2</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> reachable <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> subnodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nodes2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> nodes <span class="free">M1</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> nodes1 nodes2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1" id="FSM_Product-well_formed_productF"><span class="command">lemma</span></span> well_formed_productF<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">PM</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> well_formed.simps <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="free">FAIL</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">PM</span> <span class="main">⊆</span> insert <span class="free">FAIL</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nodes_productF assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inputs <span class="free">PM</span> <span class="main">=</span> inputs <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"outputs <span class="free">PM</span> <span class="main">=</span> outputs <span class="free">M2</span> <span class="main">∪</span> outputs <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite_FSM <span class="free">PM</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> infinite_subset assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inputs <span class="free">PM</span> <span class="main">=</span> inputs <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"outputs <span class="free">PM</span> <span class="main">=</span> outputs <span class="free">M2</span> <span class="main">∪</span> outputs <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> inputs <span class="free">PM</span> <span class="main">∨</span> <span class="bound">y</span> <span class="main">∉</span> outputs <span class="free">PM</span> <span class="main">⟶</span> succ <span class="free">PM</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">s1</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> 
              <span class="main">∧</span> inputs <span class="free">PM</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> outputs <span class="free">PM</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM_Product-observable_productF"><span class="command">lemma</span></span> observable_productF<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">PM</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> observable.simps
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span> <span class="bound">s</span> <span class="main">.</span> succ <span class="free">M1</span> <span class="bound">t</span> <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s2</span><span class="main">.</span> succ <span class="free">M1</span> <span class="bound">t</span> <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s2</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span> <span class="bound">s</span> <span class="main">.</span> succ <span class="free">M2</span> <span class="bound">t</span> <span class="main">(</span>snd <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s2</span><span class="main">.</span> succ <span class="free">M2</span> <span class="bound">t</span> <span class="main">(</span>snd <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s2</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> sub_succs <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span> <span class="bound">s</span> <span class="main">.</span> succ <span class="free">M2</span> <span class="bound">t</span> <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">×</span> succ <span class="free">M1</span> <span class="bound">t</span> <span class="main">(</span>snd <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> 
                                        <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s2</span> <span class="main">.</span> succ <span class="free">M2</span> <span class="bound">t</span> <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">×</span> succ <span class="free">M1</span> <span class="bound">t</span> <span class="main">(</span>snd <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s2</span><span class="main">}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> succ_split <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span> <span class="bound">s</span> <span class="main">.</span> succ <span class="free">PM</span> <span class="bound">t</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">{}</span> 
                                      <span class="main">∨</span> succ <span class="free">PM</span> <span class="bound">t</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span> 
                                      <span class="main">∨</span> succ <span class="free">PM</span> <span class="bound">t</span> <span class="bound">s</span> <span class="main">=</span> succ <span class="free">M2</span> <span class="bound">t</span> <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">×</span> succ <span class="free">M1</span> <span class="bound">t</span> <span class="main">(</span>snd <span class="bound">s</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="bound">s</span><span class="main">.</span> succ <span class="free">PM</span> <span class="bound">t</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s2</span><span class="main">.</span> succ <span class="free">PM</span> <span class="bound">t</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s2</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
<span class="keyword1"><span class="command">qed</span></span>
  


<span class="keyword1" id="FSM_Product-no_transition_after_FAIL"><span class="command">lemma</span></span> no_transition_after_FAIL <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">AB</span> <span class="free">io</span> <span class="free">FAIL</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="FSM_Product-no_prefix_targets_FAIL"><span class="command">lemma</span></span> no_prefix_targets_FAIL <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> length <span class="free">p</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span>take <span class="free">k</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span> <span class="main">≠</span> <span class="free">FAIL</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> assm <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span>take <span class="free">k</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span>take <span class="free">k</span> <span class="free">p</span> <span class="main">@</span> drop <span class="free">k</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span>drop <span class="free">k</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>take <span class="free">k</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> path_from_FAIL <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span>drop <span class="free">k</span> <span class="free">p</span><span class="main">)</span> <span class="free">FAIL</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>drop <span class="free">k</span> <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"drop <span class="free">k</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">io</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_nth_drop_Suc assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> prod_cases3<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">PM</span> <span class="skolem">io</span> <span class="free">FAIL</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> path_from_FAIL <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> no_transition_after_FAIL assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM_Product-productF_path_inclusion"><span class="command">lemma</span></span> productF_path_inclusion <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">r1</span> <span class="main">=</span> length <span class="free">r2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">∈</span> nodes <span class="free">B</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">AB</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">w</span> <span class="skolem">ws</span> <span class="skolem">r1</span> <span class="skolem">r1s</span> <span class="skolem">r2</span> <span class="skolem">r2s</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r1</span><span class="main">]</span><span class="main">)</span> <span class="skolem">p1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r2</span><span class="main">]</span><span class="main">)</span> <span class="skolem">p2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> succs <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">∈</span> succ <span class="free">A</span> <span class="skolem">w</span> <span class="skolem">p1</span> <span class="main">∧</span> <span class="skolem">r2</span> <span class="main">∈</span> succ <span class="free">B</span> <span class="skolem">w</span> <span class="skolem">p2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">A</span> <span class="skolem">w</span> <span class="skolem">p1</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w_elem <span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">w</span> <span class="main">∈</span> inputs <span class="free">A</span> <span class="main">∧</span> snd <span class="skolem">w</span> <span class="main">∈</span> outputs <span class="free">A</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> prod.collapse well_formed.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r1</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span> <span class="main">∈</span> succ <span class="free">AB</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons succs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> path_head <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="main">(</span><span class="skolem">r1</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span><span class="main">)</span> <span class="skolem">r1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="skolem">r2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">∈</span> nodes <span class="free">A</span> <span class="main">∧</span> <span class="skolem">r2</span> <span class="main">∈</span> nodes <span class="free">B</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> succs Cons.prems succ_nodes<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r1</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">p1</span></span><span class="main">]</span> succ_nodes<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r2</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">p2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r1</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> path_head <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM_Product-productF_path_forward"><span class="command">lemma</span></span> productF_path_forward <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">r1</span> <span class="main">=</span> length <span class="free">r2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">(</span>path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span> 
            <span class="main">∨</span> <span class="main">(</span>target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>
              <span class="main">∧</span> length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>
              <span class="main">∧</span> path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span>
              <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span>
              <span class="main">∧</span> succ <span class="free">A</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>
              <span class="main">∧</span> succ <span class="free">B</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">∈</span> nodes <span class="free">B</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="free">AB</span><span class="main">)</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">w</span> <span class="skolem">ws</span> <span class="skolem">r1</span> <span class="skolem">r1s</span> <span class="skolem">r2</span> <span class="skolem">r2s</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>path <span class="free">A</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1</span> <span class="main">#</span> <span class="skolem">r1s</span><span class="main">)</span> <span class="skolem">p1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2</span> <span class="main">#</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons productF_path_inclusion<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">#</span> <span class="skolem">r1s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">#</span> <span class="skolem">r2s</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">AB</span></span> <span class="quoted"><span class="skolem">p1</span></span> <span class="quoted"><span class="skolem">p2</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fail_prop <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1</span> <span class="main">#</span> <span class="skolem">r1s</span> <span class="main">||</span> <span class="skolem">r2</span> <span class="main">#</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span> <span class="main">∧</span>
                <span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span> <span class="main">∧</span>
                path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1</span> <span class="main">#</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p1</span> <span class="main">∧</span>
                path <span class="free">B</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2</span> <span class="main">#</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p2</span> <span class="main">∧</span>
                succ <span class="free">A</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1</span> <span class="main">#</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
                succ <span class="free">B</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2</span> <span class="main">#</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ws</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1s</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2s</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fail_prop_0 <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r1</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r2</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span> <span class="main">∧</span>
                <span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
                path <span class="free">A</span> <span class="main">[]</span> <span class="skolem">p1</span> <span class="main">∧</span>
                path <span class="free">B</span> <span class="main">[]</span> <span class="skolem">p2</span> <span class="main">∧</span>
                succ <span class="free">A</span> <span class="skolem">w</span> <span class="skolem">p1</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
                succ <span class="free">B</span> <span class="skolem">w</span> <span class="skolem">p2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> fail_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">w</span> <span class="main">∈</span> inputs <span class="free">B</span> <span class="main">∧</span> snd <span class="skolem">w</span> <span class="main">∈</span> outputs <span class="free">B</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.collapse well_formed.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> inputs_0 <span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">w</span> <span class="main">∈</span> inputs <span class="free">A</span> <span class="main">∧</span> snd <span class="skolem">w</span> <span class="main">∈</span> outputs <span class="free">B</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> fail_elems_0 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r1</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> fail_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">AB</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> fail_prop_0 Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r1</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r2</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Cons.prems fail_elems_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
      
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> path_r1 <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r1</span><span class="main">]</span><span class="main">)</span> <span class="skolem">p1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> fail_prop 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> FSM.nil FSM.path.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> FSM.path_cons_elim Suc_neq_Zero 
            butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> length_0_conv zip_Cons_Cons zip_Nil zip_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> path_r1s <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Suc
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Cons.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> FSM.path_cons_elim Suc_neq_Zero butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
            fail_prop length_0_conv snd_conv zip.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zip_Cons_Cons zip_eq<span class="main">)</span> 
      
      <span class="keyword1"><span class="command">have</span></span> path_r2 <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r2</span><span class="main">]</span><span class="main">)</span> <span class="skolem">p2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Suc fail_prop 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> FSM.nil FSM.path.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> FSM.path_cons_elim 
            Suc_neq_Zero butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> length_0_conv zip_Cons_Cons zip_Nil zip_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> path_r2s <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Suc
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Cons.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> FSM.path_cons_elim Suc_neq_Zero 
            butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> fail_prop length_0_conv snd_conv zip.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zip_Cons_Cons zip_eq<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r1</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> fail_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Cons.prems path_r1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_cons_elim snd_conv succ_nodes zip_Cons_Cons<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">∈</span> nodes <span class="free">B</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Cons.prems path_r2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_cons_elim snd_conv succ_nodes zip_Cons_Cons<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">A</span> <span class="main">(</span>last <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Cons.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Suc Suc_neq_Zero butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> fail_prop 
            fold_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> last_ConsR list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> snd_conv zip_Cons_Cons zip_Nil zip_eq<span class="main">)</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">B</span> <span class="main">(</span>last <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Cons.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Suc Suc_neq_Zero butlast.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
            fail_prop fold_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> last_ConsR list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> snd_conv zip_Cons_Cons zip_Nil zip_eq<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r1</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons.IH Suc <span class="quoted"><span class="quoted">‹succ <span class="free">B</span> <span class="main">(</span>last <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> 
              assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span> calculation<span class="main">(</span>1-4<span class="main">)</span> path_r1s path_r2s zero_less_Suc 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r1</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r2</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> path_r1 path_r2 productF_path_inclusion<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">w</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">r1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">r2</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">AB</span></span> <span class="quoted"><span class="skolem">p1</span></span> <span class="quoted"><span class="skolem">p2</span></span><span class="main">]</span> 
              Cons.prems 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>





<span class="keyword1" id="FSM_Product-butlast_zip_cons"><span class="command">lemma</span></span> butlast_zip_cons <span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ws</span> <span class="main">=</span> length <span class="free">r1s</span> <span class="main">⟹</span> <span class="free">ws</span> <span class="main">≠</span> <span class="main">[]</span> 
                            <span class="main">⟹</span> butlast <span class="main">(</span><span class="free">w</span> <span class="main">#</span> <span class="free">ws</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">#</span> <span class="free">r1s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="free">r1</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">ws</span> <span class="main">||</span> <span class="free">r1s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ws</span> <span class="main">=</span> length <span class="free">r1s</span>"</span></span>
<span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">w</span> <span class="main">#</span> <span class="free">ws</span><span class="main">)</span> <span class="main">=</span> length <span class="free">r1s</span> <span class="main">+</span> Suc <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">w</span> <span class="main">#</span> <span class="free">ws</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="free">r1</span> <span class="main">#</span> <span class="free">r1s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">@</span> <span class="free">w</span> <span class="main">#</span> <span class="free">ws</span> <span class="main">≠</span> <span class="free">w</span> <span class="main">#</span> <span class="free">ws</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> append_self_conv2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">ws</span> <span class="main">@</span> <span class="free">w</span> <span class="main">#</span> <span class="free">ws</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="free">r1s</span> <span class="main">@</span> <span class="free">r1</span> <span class="main">#</span> <span class="free">r1s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">@</span> <span class="free">w</span> <span class="main">#</span> <span class="free">ws</span> <span class="main">||</span> <span class="free">r1s</span> <span class="main">@</span> <span class="free">r1</span> <span class="main">#</span> <span class="free">r1s</span> <span class="main">≠</span> <span class="free">w</span> <span class="main">#</span> <span class="free">ws</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">#</span> <span class="free">r1s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f4 f3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> zip_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM_Product-productF_succ_fail_imp"><span class="command">lemma</span></span> productF_succ_fail_imp <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">∈</span> succ <span class="free">AB</span> <span class="free">w</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">B</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">∈</span> nodes <span class="free">A</span> <span class="main">∧</span> <span class="free">p2</span> <span class="main">∈</span> nodes <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span>fst <span class="free">w</span> <span class="main">∈</span> inputs <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="free">w</span> <span class="main">∈</span> outputs <span class="free">A</span> <span class="main">∪</span> outputs <span class="free">B</span><span class="main">)</span> 
        <span class="main">∧</span> succ <span class="free">AB</span> <span class="free">w</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span> <span class="main">∧</span> succ <span class="free">A</span> <span class="free">w</span> <span class="free">p1</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> succ <span class="free">B</span> <span class="free">w</span> <span class="free">p2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> path_head <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="main">[</span><span class="free">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="free">FAIL</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> succ_nonempty <span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">AB</span> <span class="free">w</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> succ_if_1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">∈</span> nodes <span class="free">A</span> <span class="main">∧</span> <span class="free">p2</span> <span class="main">∈</span> nodes <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span>fst <span class="free">w</span> <span class="main">∈</span> inputs <span class="free">A</span><span class="main">)</span> 
                            <span class="main">∧</span> <span class="main">(</span>snd <span class="free">w</span> <span class="main">∈</span> outputs <span class="free">A</span> <span class="main">∪</span> outputs <span class="free">B</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="free">FAIL</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">A</span> <span class="free">w</span> <span class="free">p1</span> <span class="main">⊆</span> nodes <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms succ_if_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsetI succ_nodes<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">B</span> <span class="free">w</span> <span class="free">p2</span> <span class="main">⊆</span> nodes <span class="free">B</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms succ_if_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subsetI succ_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">∉</span> <span class="main">(</span>succ <span class="free">A</span> <span class="free">w</span> <span class="free">p1</span> <span class="main">×</span> succ <span class="free">B</span> <span class="free">w</span> <span class="free">p2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> succ_no_inclusion <span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">AB</span> <span class="free">w</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>succ <span class="free">A</span> <span class="free">w</span> <span class="free">p1</span> <span class="main">×</span> succ <span class="free">B</span> <span class="free">w</span> <span class="free">p2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms succ_if_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">AB</span> <span class="free">w</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> succ <span class="free">AB</span> <span class="free">w</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span> 
                  <span class="main">∨</span> succ <span class="free">AB</span> <span class="free">w</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>succ <span class="free">A</span> <span class="free">w</span> <span class="free">p1</span> <span class="main">×</span> succ <span class="free">B</span> <span class="free">w</span> <span class="free">p2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> succ_fail <span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">AB</span> <span class="free">w</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> succ_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">A</span> <span class="free">w</span> <span class="free">p1</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> succ <span class="free">B</span> <span class="free">w</span> <span class="free">p2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>succ <span class="free">A</span> <span class="free">w</span> <span class="free">p1</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> succ <span class="free">B</span> <span class="free">w</span> <span class="free">p2</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">AB</span> <span class="free">w</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>succ <span class="free">A</span> <span class="free">w</span> <span class="free">p1</span> <span class="main">×</span> succ <span class="free">B</span> <span class="free">w</span> <span class="free">p2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> succ_no_inclusion <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> succ_if_1 succ_fail <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  


<span class="keyword1" id="FSM_Product-productF_path_reverse"><span class="command">lemma</span></span> productF_path_reverse <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">r1</span> <span class="main">=</span> length <span class="free">r2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">∈</span> nodes <span class="free">B</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span> 
            <span class="main">∨</span> <span class="main">(</span>target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>
              <span class="main">∧</span> length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>
              <span class="main">∧</span> path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span>
              <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span>
              <span class="main">∧</span> succ <span class="free">A</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>
              <span class="main">∧</span> succ <span class="free">B</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">w</span> <span class="skolem">ws</span> <span class="skolem">r1</span> <span class="skolem">r1s</span> <span class="skolem">r2</span> <span class="skolem">r2s</span><span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> path_head <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="main">(</span><span class="skolem">r1</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> succ_nonempty <span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">AB</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> succ_if_1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">∈</span> nodes <span class="free">A</span> <span class="main">∧</span> <span class="skolem">p2</span> <span class="main">∈</span> nodes <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span>fst <span class="skolem">w</span> <span class="main">∈</span> inputs <span class="free">A</span><span class="main">)</span> 
                          <span class="main">∧</span> <span class="main">(</span>snd <span class="skolem">w</span> <span class="main">∈</span> outputs <span class="free">A</span> <span class="main">∪</span> outputs <span class="free">B</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="free">FAIL</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> path_tail <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r1</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> path_head Cons  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r1</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1s</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">r1s</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="skolem">r1s</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="skolem">r2s</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="free">FAIL</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> True path_tail <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="main">[</span>hd <span class="skolem">ws</span><span class="main">]</span> <span class="main">@</span> tl <span class="skolem">ws</span> <span class="main">||</span> <span class="main">[</span>hd <span class="skolem">r1s</span><span class="main">]</span> <span class="main">@</span> tl <span class="skolem">r1s</span> <span class="main">||</span> <span class="main">[</span>hd <span class="skolem">r2s</span><span class="main">]</span> <span class="main">@</span> tl <span class="skolem">r2s</span><span class="main">)</span> <span class="free">FAIL</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="main">[</span>hd <span class="skolem">ws</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span>hd <span class="skolem">r1s</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span>hd <span class="skolem">r2s</span><span class="main">]</span><span class="main">)</span> <span class="free">FAIL</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">AB</span> <span class="main">(</span>hd <span class="skolem">ws</span><span class="main">)</span> <span class="free">FAIL</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> no_transition_after_FAIL 
        <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tail_nil <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">r1s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">r2s</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> succ_fail <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">∈</span> succ <span class="free">AB</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> path_head True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> succs <span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">A</span> <span class="skolem">w</span> <span class="skolem">p1</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> succ <span class="free">B</span> <span class="skolem">w</span> <span class="skolem">p2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> productF_succ_fail_imp<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1</span> <span class="main">#</span> <span class="skolem">r1s</span> <span class="main">||</span> <span class="skolem">r2</span> <span class="main">#</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> True tail_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1</span> <span class="main">#</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> tail_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2</span> <span class="main">#</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> tail_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">A</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1</span> <span class="main">#</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> succs tail_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">B</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2</span> <span class="main">#</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> succs tail_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r1</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span> <span class="main">∈</span> succ <span class="free">AB</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> path_head <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> succ_not_fail <span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">AB</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> succ_nonempty False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>succ <span class="free">A</span> <span class="skolem">w</span> <span class="skolem">p1</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> succ <span class="free">B</span> <span class="skolem">w</span> <span class="skolem">p2</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">¬</span> <span class="main">(</span>succ <span class="free">A</span> <span class="skolem">w</span> <span class="skolem">p1</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> succ <span class="free">B</span> <span class="skolem">w</span> <span class="skolem">p2</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">AB</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> succ_if_1 Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> succ_not_fail <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">AB</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span><span class="skolem">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>succ <span class="free">A</span> <span class="skolem">w</span> <span class="skolem">p1</span> <span class="main">×</span> succ <span class="free">B</span> <span class="skolem">w</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> succ_if_1 Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r1</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>succ <span class="free">A</span> <span class="skolem">w</span> <span class="skolem">p1</span> <span class="main">×</span> succ <span class="free">B</span> <span class="skolem">w</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> succs_next <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">∈</span> succ <span class="free">A</span> <span class="skolem">w</span> <span class="skolem">p1</span> <span class="main">∧</span> <span class="skolem">r2</span> <span class="main">∈</span> succ <span class="free">B</span> <span class="skolem">w</span> <span class="skolem">p2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nodes_next <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">∈</span> nodes <span class="free">A</span> <span class="main">∧</span> <span class="skolem">r2</span> <span class="main">∈</span> nodes <span class="free">B</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons succ_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>     

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> path_tail <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r1</span><span class="main">,</span><span class="skolem">r2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> prop_tail <span class="main">:</span> 
        <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span><span class="main">)</span> <span class="skolem">r1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="skolem">r2</span> <span class="main">∨</span>
            target <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r1</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span> <span class="main">∧</span>
            <span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">ws</span> <span class="main">∧</span>
            path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r1</span> <span class="main">∧</span>
            path <span class="free">B</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r2</span> <span class="main">∧</span>
            succ <span class="free">A</span> <span class="main">(</span>last <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
            succ <span class="free">B</span> <span class="main">(</span>last <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r1</span></span> <span class="quoted"><span class="skolem">r2</span></span><span class="main">]</span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r1</span><span class="main">]</span><span class="main">)</span> <span class="skolem">p1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r2</span><span class="main">]</span><span class="main">)</span> <span class="skolem">p2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> succs_next <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span><span class="main">)</span> <span class="skolem">r1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="skolem">r2</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> paths_head <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r1</span><span class="main">]</span><span class="main">)</span> <span class="skolem">p1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r2</span><span class="main">]</span><span class="main">)</span> <span class="skolem">p2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> succs_next <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> FSM.path.simps FSM.path_cons_elim True eq_snd_iff 
            paths_head zip_Cons_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fail_prop <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r1</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span> <span class="main">∧</span>
            <span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">ws</span> <span class="main">∧</span>
            path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r1</span> <span class="main">∧</span>
            path <span class="free">B</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r2</span> <span class="main">∧</span>
            succ <span class="free">A</span> <span class="main">(</span>last <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
            succ <span class="free">B</span> <span class="main">(</span>last <span class="skolem">ws</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> prop_tail <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> paths_head <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r1</span><span class="main">]</span><span class="main">)</span> <span class="skolem">p1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="main">[</span><span class="skolem">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">r2</span><span class="main">]</span><span class="main">)</span> <span class="skolem">p2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> succs_next <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>last <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> last <span class="skolem">ws</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> fail_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1</span> <span class="main">#</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> fail_prop Cons.hyps<span class="main">(</span>1<span class="main">)</span> butlast_zip_cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2</span> <span class="main">#</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> fail_prop Cons.hyps<span class="main">(</span>1<span class="main">)</span> Cons.hyps<span class="main">(</span>2<span class="main">)</span> butlast_zip_cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">A</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1</span> <span class="main">#</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> 
                        <span class="main">∧</span> succ <span class="free">B</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2</span> <span class="main">#</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> fail_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1</span> <span class="main">#</span> <span class="skolem">r1s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> fail_prop paths_head <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r2</span> <span class="main">#</span> <span class="skolem">r2s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> fail_prop paths_head <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">||</span> <span class="skolem">r1</span> <span class="main">#</span> <span class="skolem">r1s</span> <span class="main">||</span> <span class="skolem">r2</span> <span class="main">#</span> <span class="skolem">r2s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p1</span><span class="main">,</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> fail_prop paths_head <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM_Product-butlast_zip"><span class="command">lemma</span></span> butlast_zip<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"butlast <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>butlast <span class="free">xs</span> <span class="main">||</span> butlast <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> map_butlast map_fst_zip map_snd_zip zip_map_fst_snd<span class="main">)</span> 



<span class="keyword1" id="FSM_Product-productF_path_reverse_ob"><span class="command">lemma</span></span> productF_path_reverse_ob <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">r1</span> <span class="main">=</span> length <span class="free">r2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">∈</span> nodes <span class="free">B</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r2'</span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2'</span><span class="main">)</span> <span class="free">p2</span> <span class="main">∧</span> length <span class="free">w</span> <span class="main">=</span> length <span class="free">r2'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> path_prop <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span> 
                    <span class="main">∨</span> <span class="main">(</span>target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>
                      <span class="main">∧</span> length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>
                      <span class="main">∧</span> path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span>
                      <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span>
                      <span class="main">∧</span> succ <span class="free">A</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>
                      <span class="main">∧</span> succ <span class="free">B</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms productF_path_reverse<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">AB</span></span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">r1'</span> <span class="main">.</span> path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="bound">r1'</span><span class="main">)</span> <span class="free">p2</span> <span class="main">∧</span> length <span class="free">w</span> <span class="main">=</span> length <span class="bound">r1'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> B_prop <span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>
                <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span>
                <span class="main">∧</span> succ <span class="free">B</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> path_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rx</span> <span class="main">∈</span> succ <span class="free">B</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span><span class="main">[</span>last <span class="free">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">rx</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> B_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span><span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="main">[</span>last <span class="free">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">rx</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> B_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>butlast <span class="free">w</span> <span class="main">||</span> butlast <span class="free">r2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span><span class="main">(</span>butlast <span class="free">w</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>last <span class="free">w</span><span class="main">]</span> <span class="main">||</span> <span class="main">(</span>butlast <span class="free">r2</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">rx</span><span class="main">]</span><span class="main">)</span> <span class="free">p2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms B_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>butlast <span class="free">w</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>last <span class="free">w</span><span class="main">]</span> <span class="main">=</span> <span class="free">w</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> B_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span>butlast <span class="free">r2</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">rx</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> length <span class="free">w</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms B_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">r1'</span><span class="main">)</span> <span class="free">p2</span> <span class="main">∧</span> length <span class="free">w</span> <span class="main">=</span> length <span class="skolem">r1'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemma formalizes the property of paths of the product machine as described 
in the section introduction.
›</span></span>


<span class="keyword1" id="FSM_Product-productF_path"><span class="command">lemma</span></span> productF_path<span class="main">[</span><span class="operator">iff</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">r1</span> <span class="main">=</span> length <span class="free">r2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">∈</span> nodes <span class="free">B</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span>path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span> 
            <span class="main">∨</span> <span class="main">(</span>target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>
              <span class="main">∧</span> length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>
              <span class="main">∧</span> path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span>
              <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span>
              <span class="main">∧</span> succ <span class="free">A</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>
              <span class="main">∧</span> succ <span class="free">B</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?path</span> <span class="main">⟷</span> <span class="var">?paths</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?path</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?paths</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms productF_path_reverse<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">AB</span></span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?paths</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?path</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms productF_path_forward<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">AB</span></span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM_Product-path_last_succ"><span class="command">lemma</span></span> path_last_succ <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="free">ws</span> <span class="main">||</span> <span class="free">r1s</span><span class="main">)</span> <span class="free">p1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">r1s</span> <span class="main">=</span> length <span class="free">ws</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">ws</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"last <span class="free">r1s</span> <span class="main">∈</span> succ <span class="free">A</span> <span class="main">(</span>last <span class="free">ws</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">ws</span> <span class="main">||</span> <span class="free">r1s</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">ws</span> <span class="main">||</span> <span class="free">r1s</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span> 
        <span class="main">∧</span> path <span class="free">A</span> <span class="main">[</span>last <span class="main">(</span><span class="free">ws</span> <span class="main">||</span> <span class="free">r1s</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">ws</span> <span class="main">||</span> <span class="free">r1s</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append_elim append_butlast_last_id assms length_greater_0_conv 
        list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> zip_Nil zip_eq<span class="main">)</span> 

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>last <span class="main">(</span><span class="free">ws</span> <span class="main">||</span> <span class="free">r1s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> 
              succ <span class="free">A</span> <span class="main">(</span>fst <span class="main">(</span>last <span class="main">(</span><span class="free">ws</span> <span class="main">||</span> <span class="free">r1s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">ws</span> <span class="main">||</span> <span class="free">r1s</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">||</span> <span class="free">r1s</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_zip list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> min.idem neq0_conv<span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="free">r1s</span> <span class="main">∈</span> succ <span class="free">A</span> <span class="main">(</span>last <span class="free">ws</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">ws</span> <span class="main">||</span> <span class="free">r1s</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="FSM_Product-zip_last"><span class="command">lemma</span></span> zip_last <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">r1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">r1</span> <span class="main">=</span> length <span class="free">r2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>last <span class="free">r1</span><span class="main">,</span> last <span class="free">r2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_nat_zero_code list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
      map_fst_zip zip_Nil zip_last<span class="main">)</span>
  


<span class="keyword1" id="FSM_Product-productF_path_reverse_ob_2"><span class="command">lemma</span></span> productF_path_reverse_ob_2 <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">r1</span> <span class="main">=</span> length <span class="free">r2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">p1</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">∈</span> nodes <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> language_state <span class="free">A</span> <span class="free">p1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">∧</span> length <span class="free">w</span> <span class="main">=</span> length <span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span> <span class="main">∧</span> length <span class="free">w</span> <span class="main">=</span> length <span class="free">r2</span>"</span></span>
      <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">=</span> fst <span class="main">(</span>target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span> <span class="main">=</span> snd <span class="main">(</span>target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span> 
            <span class="main">∨</span> <span class="main">(</span>target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>
              <span class="main">∧</span> length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>
              <span class="main">∧</span> path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span>
              <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span>
              <span class="main">∧</span> succ <span class="free">A</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>
              <span class="main">∧</span> succ <span class="free">B</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> productF_path<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">AB</span></span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span> 
                  <span class="main">∧</span> succ <span class="free">A</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> 
                  <span class="main">∧</span> length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> assm <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span> 
                    <span class="main">∧</span> succ <span class="free">A</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> 
                    <span class="main">∧</span> length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> r1'_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">r1'</span><span class="main">)</span> <span class="free">p1</span> <span class="main">∧</span> length <span class="skolem">r1'</span> <span class="main">=</span> length <span class="free">w</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">r1'</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span> <span class="main">∧</span> length <span class="main">(</span>butlast <span class="skolem">r1'</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>butlast <span class="free">w</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append_elim append_butlast_last_id butlast.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> length_butlast<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span> <span class="main">∧</span> length <span class="main">(</span>butlast <span class="free">r1</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>butlast <span class="free">w</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assm assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="free">r1</span> <span class="main">=</span> butlast <span class="skolem">r1'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> butlast_zip language_state observable_path_unique r1'_def<span class="main">)</span> 

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="main">=</span> butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">r1'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> r1'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">A</span> <span class="main">(</span>last <span class="free">w</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">r1'</span><span class="main">)</span><span class="main">)</span> <span class="free">p1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assm empty_iff path_last_succ r1'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> paths <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">∧</span> path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">∧</span> length <span class="free">w</span> <span class="main">=</span> length <span class="free">r1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span> <span class="main">∧</span> length <span class="free">w</span> <span class="main">=</span> length <span class="free">r2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> paths <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span> <span class="main">=</span> last <span class="main">(</span><span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="main">(</span><span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> target_alt_def<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">=</span> fst <span class="main">(</span>target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">∧</span> target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span> <span class="main">=</span> snd <span class="main">(</span>target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">w</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span> <span class="main">=</span> last <span class="main">(</span><span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="main">(</span><span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> target_alt_def<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">=</span> last <span class="free">r1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> target_alt_def<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">p1</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span> <span class="main">=</span> last <span class="free">r2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> target_alt_def<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">r2</span></span> <span class="quoted"><span class="free">p2</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>last <span class="free">r1</span><span class="main">,</span> last <span class="free">r2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> zip_last<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">r2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span><span class="main">)</span> <span class="free">p1</span> <span class="main">=</span> fst <span class="main">(</span>target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="free">p2</span> <span class="main">=</span> snd <span class="main">(</span>target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">r1</span> <span class="main">||</span> <span class="free">r2</span><span class="main">)</span> <span class="main">(</span><span class="free">p1</span><span class="main">,</span><span class="free">p2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1" id="FSM_Product-productF_path_unzip"><span class="command">lemma</span></span> productF_path_unzip <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"length <span class="free">tr</span> <span class="main">=</span> length <span class="free">w</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="main">(</span>map fst <span class="free">tr</span> <span class="main">||</span> map snd <span class="free">tr</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">tr</span> <span class="main">||</span> map snd <span class="free">tr</span> <span class="main">=</span> <span class="free">tr</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>





<span class="keyword1" id="FSM_Product-productF_path_io_targets"><span class="command">lemma</span></span> productF_path_io_targets <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"io_targets <span class="free">AB</span> <span class="main">(</span><span class="free">qA</span><span class="main">,</span><span class="free">qB</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">pA</span><span class="main">,</span><span class="free">pB</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> language_state <span class="free">A</span> <span class="free">qA</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> language_state <span class="free">B</span> <span class="free">qB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">qA</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">qB</span> <span class="main">∈</span> nodes <span class="free">B</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">pA</span> <span class="main">∈</span> io_targets <span class="free">A</span> <span class="free">qA</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">pB</span> <span class="main">∈</span> io_targets <span class="free">B</span> <span class="free">qB</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr_def <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">qA</span><span class="main">,</span><span class="free">qB</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">pA</span><span class="main">,</span><span class="free">pB</span><span class="main">)</span> 
                            <span class="main">∧</span> path <span class="free">AB</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">qA</span><span class="main">,</span><span class="free">qB</span><span class="main">)</span> 
                            <span class="main">∧</span> length <span class="free">w</span> <span class="main">=</span> length <span class="skolem">tr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> path_A <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> map fst <span class="skolem">tr</span><span class="main">)</span> <span class="free">qA</span> <span class="main">∧</span> length <span class="free">w</span> <span class="main">=</span> length <span class="main">(</span>map fst <span class="skolem">tr</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_path_reverse_ob_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map fst <span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">tr</span></span></span></span>"</span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map snd <span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">tr</span></span></span></span>"</span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">FAIL</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">AB</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">qA</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">qB</span></span></span></span></span></span></span></span><span class="main">]</span> 
          assms tr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> path_B <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> map snd <span class="skolem">tr</span><span class="main">)</span> <span class="free">qB</span> <span class="main">∧</span> length <span class="free">w</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="skolem">tr</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_path_reverse_ob_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map fst <span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">tr</span></span></span></span>"</span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map snd <span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">tr</span></span></span></span>"</span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">FAIL</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">AB</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">qA</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">qB</span></span></span></span></span></span></span></span><span class="main">]</span> 
          assms tr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> targets <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> map fst <span class="skolem">tr</span><span class="main">)</span> <span class="free">qA</span> <span class="main">=</span> <span class="free">pA</span> <span class="main">∧</span> target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> map snd <span class="skolem">tr</span><span class="main">)</span> <span class="free">qB</span> <span class="main">=</span> <span class="free">pB</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">tr</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">qA</span> <span class="main">=</span> <span class="free">pA</span> <span class="main">∧</span> <span class="free">qB</span> <span class="main">=</span> <span class="free">pB</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> tr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.Nil<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">tr</span> <span class="main">=</span> <span class="main">(</span><span class="free">pA</span><span class="main">,</span><span class="free">pB</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> tr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tr_def FSM.target_alt_def states_alt_def<span class="main">)</span> 
     
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> map fst <span class="skolem">tr</span><span class="main">)</span> <span class="free">qA</span> <span class="main">=</span> last <span class="main">(</span>map fst <span class="skolem">tr</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FSM.target_alt_def states_alt_def tr_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>map fst <span class="skolem">tr</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>last <span class="skolem">tr</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> last_map Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> map snd <span class="skolem">tr</span><span class="main">)</span> <span class="free">qB</span> <span class="main">=</span> last <span class="main">(</span>map snd <span class="skolem">tr</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FSM.target_alt_def states_alt_def tr_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>map snd <span class="skolem">tr</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>last <span class="skolem">tr</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> last_map Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">pA</span> <span class="main">∈</span> io_targets <span class="free">A</span> <span class="free">qA</span> <span class="free">w</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> path_A targets <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">pB</span> <span class="main">∈</span> io_targets <span class="free">B</span> <span class="free">qB</span> <span class="free">w</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> path_B targets <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="FSM_Product-productF_path_io_targets_reverse"><span class="command">lemma</span></span> productF_path_io_targets_reverse <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">pA</span> <span class="main">∈</span> io_targets <span class="free">A</span> <span class="free">qA</span> <span class="free">w</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">pB</span> <span class="main">∈</span> io_targets <span class="free">B</span> <span class="free">qB</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> language_state <span class="free">A</span> <span class="free">qA</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> language_state <span class="free">B</span> <span class="free">qB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">qA</span> <span class="main">∈</span> nodes <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">qB</span> <span class="main">∈</span> nodes <span class="free">B</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">AB</span> <span class="main">(</span><span class="free">qA</span><span class="main">,</span><span class="free">qB</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">pA</span><span class="main">,</span><span class="free">pB</span><span class="main">)</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trA</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">trA</span><span class="main">)</span> <span class="free">qA</span>"</span></span> 
                   <span class="quoted"><span class="quoted">"length <span class="free">w</span> <span class="main">=</span> length <span class="skolem">trA</span>"</span></span> 
                   <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">trA</span><span class="main">)</span> <span class="free">qA</span> <span class="main">=</span> <span class="free">pA</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trB</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">trB</span><span class="main">)</span> <span class="free">qB</span>"</span></span> 
                   <span class="quoted"><span class="quoted">"length <span class="skolem">trA</span> <span class="main">=</span> length <span class="skolem">trB</span>"</span></span> 
                   <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">trB</span><span class="main">)</span> <span class="free">qB</span> <span class="main">=</span> <span class="free">pB</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">w</span> <span class="main">=</span> length <span class="skolem">trA</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">trA</span> <span class="main">||</span> <span class="skolem">trB</span><span class="main">)</span> <span class="main">(</span><span class="free">qA</span><span class="main">,</span><span class="free">qB</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">trA</span> <span class="main">||</span> <span class="skolem">trB</span><span class="main">)</span> <span class="main">=</span> length <span class="free">w</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_path_inclusion
          <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹length <span class="free">w</span> <span class="main">=</span> length <span class="skolem">trA</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">trA</span> <span class="main">=</span> length <span class="skolem">trB</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span> _ assms<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">,</span></span>11<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">trA</span> <span class="main">=</span> length <span class="skolem">trB</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">w</span> <span class="main">=</span> length <span class="skolem">trA</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">A</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">trA</span><span class="main">)</span> <span class="free">qA</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹path <span class="free">B</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">trB</span><span class="main">)</span> <span class="free">qB</span>›</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">trA</span> <span class="main">||</span> <span class="skolem">trB</span><span class="main">)</span> <span class="main">(</span><span class="free">qA</span><span class="main">,</span><span class="free">qB</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">pA</span><span class="main">,</span><span class="free">pB</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">trA</span> <span class="main">=</span> length <span class="skolem">trB</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">w</span> <span class="main">=</span> length <span class="skolem">trA</span>›</span></span> <span class="quoted"><span class="quoted">‹target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">trA</span><span class="main">)</span> <span class="free">qA</span> <span class="main">=</span> <span class="free">pA</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">trB</span><span class="main">)</span> <span class="free">qB</span> <span class="main">=</span> <span class="free">pB</span>›</span></span><span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">pA</span><span class="main">,</span><span class="free">pB</span><span class="main">)</span> <span class="main">∈</span> io_targets <span class="free">AB</span> <span class="main">(</span><span class="free">qA</span><span class="main">,</span><span class="free">qB</span><span class="main">)</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span><span class="skolem">trA</span> <span class="main">||</span> <span class="skolem">trB</span><span class="main">)</span> <span class="main">=</span> length <span class="free">w</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">AB</span> <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">trA</span> <span class="main">||</span> <span class="skolem">trB</span><span class="main">)</span> <span class="main">(</span><span class="free">qA</span><span class="main">,</span> <span class="free">qB</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹target <span class="main">(</span><span class="free">w</span> <span class="main">||</span> <span class="skolem">trA</span> <span class="main">||</span> <span class="skolem">trB</span><span class="main">)</span> <span class="main">(</span><span class="free">qA</span><span class="main">,</span> <span class="free">qB</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">pA</span><span class="main">,</span> <span class="free">pB</span><span class="main">)</span>›</span></span> io_target_from_path<span class="main">)</span>  

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">AB</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> observable_productF<span class="main">)</span> 

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">pA</span><span class="main">,</span> <span class="free">pB</span><span class="main">)</span> <span class="main">∈</span> io_targets <span class="free">AB</span> <span class="main">(</span><span class="free">qA</span><span class="main">,</span> <span class="free">qB</span><span class="main">)</span> <span class="free">w</span>›</span></span> <span class="quoted"><span class="quoted">‹observable <span class="free">AB</span>›</span></span> 
        observable_io_target_is_singleton<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Sequences to failure in the product machine ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A sequence to a failure for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">A</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">B</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> reaches the fail state of any product 
machine of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">A</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">B</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with added fail state.
›</span></span>

<span class="keyword1" id="FSM_Product-fail_reachable_by_sequence_to_failure"><span class="command">lemma</span></span> fail_reachable_by_sequence_to_failure <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="free">io</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span><span class="main">||</span><span class="free">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">p</span> <span class="main">=</span> length <span class="free">io</span> <span class="main">∧</span> target <span class="main">(</span><span class="free">io</span><span class="main">||</span><span class="free">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io_init</span></span> <span class="skolem"><span class="skolem">io_last</span></span> <span class="keyword2"><span class="keyword">where</span></span> io_split<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">=</span> <span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> io_init_inclusion <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io_init</span> <span class="main">∈</span> language_state <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> 
                            <span class="main">∧</span> <span class="skolem">io_init</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">∈</span> language_state <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1_init</span></span> <span class="skolem"><span class="skolem">tr1_last</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr1_def <span class="main">:</span> 
    <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr1_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">tr1_last</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> 
      <span class="main">∧</span> length <span class="main">(</span><span class="skolem">tr1_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">tr1_last</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id language_state_elim length_0_conv length_append_singleton 
        nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> path_init_1 <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="skolem">io_init</span> <span class="main">||</span> <span class="skolem">tr1_init</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> 
                            <span class="main">∧</span> length <span class="skolem">tr1_init</span> <span class="main">=</span> length <span class="skolem">io_init</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">tr1_last</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span><span class="skolem">io_init</span> <span class="main">||</span> <span class="skolem">tr1_init</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> tr1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> succ_1 <span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">M1</span> <span class="skolem">io_last</span> <span class="main">(</span>target <span class="main">(</span><span class="skolem">io_init</span> <span class="main">||</span> <span class="skolem">tr1_init</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr2</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr2_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="skolem">io_init</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">tr2</span> <span class="main">=</span> length <span class="skolem">io_init</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> io_init_inclusion <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> succ_2 <span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">M2</span> <span class="skolem">io_last</span> <span class="main">(</span>target <span class="main">(</span><span class="skolem">io_init</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">M2</span> <span class="skolem">io_last</span> <span class="main">(</span>target <span class="main">(</span><span class="skolem">io_init</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr2_last</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tr2_last</span> <span class="main">∈</span> succ <span class="free">M2</span> <span class="skolem">io_last</span> <span class="main">(</span>target <span class="main">(</span><span class="skolem">io_init</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">tr2_last</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span><span class="skolem">io_init</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append language_state length_Cons length_append list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> tr2_def 
          zip_append<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms io_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> fail_lengths <span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">tr2</span> <span class="main">@</span> <span class="main">[</span>fst <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span> 
                        <span class="main">∧</span> length <span class="main">(</span><span class="skolem">tr2</span> <span class="main">@</span> <span class="main">[</span>fst <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">tr1_init</span> <span class="main">@</span> <span class="main">[</span>snd <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms tr2_def tr1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fail_tgt <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr2</span> <span class="main">@</span> <span class="main">[</span>fst <span class="free">FAIL</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr1_init</span> <span class="main">@</span> <span class="main">[</span>snd <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span> 
                                <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> fail_butlast_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> 
    <span class="quoted"><span class="quoted">"butlast <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr2</span> <span class="main">@</span> <span class="main">[</span>fst <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">io_init</span> <span class="main">||</span> <span class="skolem">tr2</span>"</span></span> 
    <span class="quoted"><span class="quoted">"butlast <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr1_init</span> <span class="main">@</span> <span class="main">[</span>snd <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">io_init</span> <span class="main">||</span> <span class="skolem">tr1_init</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> fail_lengths <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr2</span> <span class="main">@</span> <span class="main">[</span>fst <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> 
        <span class="main">∧</span> path <span class="free">M1</span> <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr1_init</span> <span class="main">@</span> <span class="main">[</span>snd <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> tr1_def tr2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">M2</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr2</span> <span class="main">@</span> <span class="main">[</span>fst <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> succ_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">M1</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr1_init</span> <span class="main">@</span> <span class="main">[</span>snd <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> succ_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span> <span class="main">∈</span> nodes <span class="free">M2</span> <span class="main">∧</span> initial <span class="free">M1</span> <span class="main">∈</span> nodes <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr2</span> <span class="main">@</span> <span class="main">[</span>fst <span class="free">FAIL</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr1_init</span> <span class="main">@</span> <span class="main">[</span>snd <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span> 
                    <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> fail_lengths fail_tgt assms path_init_1 tr2_def productF_path_forward
          <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tr2</span> <span class="main">@</span> <span class="main">[</span>fst <span class="free">FAIL</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tr1_init</span> <span class="main">@</span> <span class="main">[</span>snd <span class="free">FAIL</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">PM</span></span> 
              <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M1</span>"</span></span> <span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">PM</span> <span class="main">=</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> productF_simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr2</span> <span class="main">@</span> <span class="main">[</span>fst <span class="free">FAIL</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr1_init</span> <span class="main">@</span> <span class="main">[</span>snd <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>
     <span class="main">∧</span> length <span class="main">(</span><span class="skolem">tr2</span> <span class="main">@</span> <span class="main">[</span>fst <span class="free">FAIL</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr1_init</span> <span class="main">@</span> <span class="main">[</span>snd <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span><span class="main">)</span>
     <span class="main">∧</span> target <span class="main">(</span><span class="skolem">io_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">io_last</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr2</span> <span class="main">@</span> <span class="main">[</span>fst <span class="free">FAIL</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">tr1_init</span> <span class="main">@</span> <span class="main">[</span>snd <span class="free">FAIL</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">=</span> <span class="free">FAIL</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fail_lengths fail_tgt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that 
    <span class="keyword1"><span class="command">using</span></span> io_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM_Product-fail_reachable"><span class="command">lemma</span></span> fail_reachable <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">∈</span> reachable <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">io</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> sequence_to_failure_ob assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms fail_reachable_by_sequence_to_failure<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="skolem">io</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">PM</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.reachable.reflexive FSM.reachable_target<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM_Product-fail_reachable_ob"><span class="command">lemma</span></span> fail_reachable_ob <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="free">p</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"target <span class="free">p</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms fail_reachable <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.reachable_target_elim<span class="main">)</span> 


<span class="keyword1" id="FSM_Product-fail_reachable_reverse"><span class="command">lemma</span></span> fail_reachable_reverse <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">∈</span> reachable <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pathF</span></span> <span class="keyword2"><span class="keyword">where</span></span> pathF_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="skolem">pathF</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> target <span class="skolem">pathF</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?io</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">pathF</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tr2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span>map snd <span class="skolem">pathF</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tr1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map snd <span class="main">(</span>map snd <span class="skolem">pathF</span><span class="main">)</span>"</span></span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">PM</span> <span class="main">≠</span> <span class="free">FAIL</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pathF</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> pathF_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">PM</span> <span class="main">=</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> path <span class="free">M1</span> <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∨</span>
                    target <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span> <span class="main">||</span> <span class="var">?tr1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span> <span class="main">∧</span>
                    <span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="var">?io</span><span class="main">)</span> <span class="main">∧</span>
                    path <span class="free">M2</span> <span class="main">(</span>butlast <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span>
                    path <span class="free">M1</span> <span class="main">(</span>butlast <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span>
                    succ <span class="free">M2</span> <span class="main">(</span>last <span class="main">(</span><span class="var">?io</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
                    succ <span class="free">M1</span> <span class="main">(</span>last <span class="main">(</span><span class="var">?io</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_path_reverse<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?io</span></span></span> <span class="var"><span class="quoted"><span class="var">?tr2</span></span></span> <span class="var"><span class="quoted"><span class="var">?tr1</span></span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M1</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">using</span></span> assms pathF_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span> <span class="main">||</span> <span class="var">?tr1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹initial <span class="free">PM</span> <span class="main">=</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>›</span></span> pathF_def zip_map_fst_snd<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="var">?io</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">pathF</span> <span class="main">⟶</span> length <span class="main">(</span><span class="var">?io</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="var">?tr2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="var">?io</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">pathF</span> <span class="main">∧</span> length <span class="main">(</span><span class="var">?tr2</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="var">?tr1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> f2 f1 <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>path <span class="free">M2</span> <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> path <span class="free">M1</span> <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">¬</span> <span class="main">(</span>path <span class="free">M2</span> <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span>
          path <span class="free">M1</span> <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">≠</span> fst <span class="free">FAIL</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> pathF_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">=</span> target <span class="main">(</span>map fst <span class="skolem">pathF</span> <span class="main">||</span> map fst <span class="main">(</span>map snd <span class="skolem">pathF</span><span class="main">)</span> <span class="main">||</span> map snd <span class="main">(</span>map snd <span class="skolem">pathF</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹initial <span class="free">PM</span> <span class="main">=</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹path <span class="free">PM</span> <span class="skolem">pathF</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> target <span class="skolem">pathF</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>›</span></span> zip_map_fst_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹target <span class="main">(</span>map fst <span class="skolem">pathF</span> <span class="main">||</span> map fst <span class="main">(</span>map snd <span class="skolem">pathF</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">≠</span> fst <span class="free">FAIL</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> fail_prop <span class="main">:</span> 
          <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span> <span class="main">||</span> <span class="var">?tr1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span> <span class="main">∧</span>
            <span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="var">?io</span><span class="main">)</span> <span class="main">∧</span>
            path <span class="free">M2</span> <span class="main">(</span>butlast <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span>
            path <span class="free">M1</span> <span class="main">(</span>butlast <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span>
            succ <span class="free">M2</span> <span class="main">(</span>last <span class="main">(</span><span class="var">?io</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span>
            succ <span class="free">M1</span> <span class="main">(</span>last <span class="main">(</span><span class="var">?io</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?io</span> <span class="main">∈</span> language_state <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span>map fst <span class="skolem">pathF</span> <span class="main">||</span> map fst <span class="main">(</span>map snd <span class="skolem">pathF</span><span class="main">)</span> <span class="main">||</span> map snd <span class="main">(</span>map snd <span class="skolem">pathF</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹initial <span class="free">PM</span> <span class="main">=</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>›</span></span> pathF_def zip_map_fst_snd<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> initial <span class="main">(</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> FSM<span class="main">)</span> <span class="main">∨</span> <span class="bound">c</span> <span class="main">∈</span> nodes <span class="bound">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> language_state length_map 
                    productF_path_reverse_ob<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?io</span> <span class="main">∉</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?io</span> <span class="main">∉</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?io</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr2'_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="skolem">tr2'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> 
                                        <span class="main">∧</span> length <span class="var">?io</span> <span class="main">=</span> length <span class="skolem">tr2'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr2'_init</span></span> <span class="skolem"><span class="skolem">tr2'_last</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr2'_split <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tr2'</span> <span class="main">=</span> <span class="skolem">tr2'_init</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">tr2'_last</span><span class="main">]</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> fail_prop <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">pathF</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> append_butlast_last_id length_0_conv map_is_Nil_conv<span class="main">)</span> 

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="var">?io</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> fail_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> path <span class="free">M2</span> <span class="main">(</span>butlast <span class="var">?io</span> <span class="main">||</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> length <span class="main">(</span>butlast <span class="var">?io</span><span class="main">)</span> <span class="main">=</span> length <span class="bound">t</span><span class="main">}</span> 
                <span class="main">=</span> <span class="main">{</span>butlast <span class="var">?tr2</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> observable_path_unique<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"butlast <span class="var">?io</span>"</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"butlast <span class="var">?tr2</span>"</span></span><span class="main">]</span> 
            fail_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span> <span class="bound">ts</span> <span class="main">.</span> path <span class="free">M2</span> <span class="main">(</span><span class="main">(</span>butlast <span class="var">?io</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>last <span class="var">?io</span><span class="main">]</span> <span class="main">||</span> <span class="bound">ts</span> <span class="main">@</span> <span class="main">[</span><span class="bound">t</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> 
                          <span class="main">∧</span> length <span class="main">(</span><span class="main">(</span>butlast <span class="var">?io</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>last <span class="var">?io</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="bound">ts</span> <span class="main">@</span> <span class="main">[</span><span class="bound">t</span><span class="main">]</span><span class="main">)</span> 
                        <span class="main">⟶</span> <span class="bound">ts</span> <span class="main">=</span> butlast <span class="var">?tr2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> FSM.path_append_elim 
          <span class="quoted"><span class="quoted">‹butlast <span class="main">(</span>map fst <span class="skolem">pathF</span><span class="main">)</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> butlast_snoc 
          butlast_zip fail_prop length_butlast length_map observable_path_unique zip_append<span class="main">)</span>
    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tr2'_init</span> <span class="main">=</span> butlast <span class="var">?tr2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> tr2'_def tr2'_split <span class="quoted"><span class="quoted">‹<span class="skolem">pathF</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="main">(</span>butlast <span class="var">?io</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>last <span class="var">?io</span><span class="main">]</span> <span class="main">||</span> <span class="main">(</span>butlast <span class="var">?tr2</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">tr2'_last</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> 
                <span class="main">∧</span> length <span class="main">(</span><span class="main">(</span>butlast <span class="var">?io</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>last <span class="var">?io</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="main">(</span>butlast <span class="var">?tr2</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">tr2'_last</span><span class="main">]</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> tr2'_def fail_prop tr2'_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="main">[</span>last <span class="var">?io</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">tr2'_last</span><span class="main">]</span><span class="main">)</span> 
                        <span class="main">(</span>target <span class="main">(</span>butlast <span class="var">?io</span> <span class="main">||</span> butlast <span class="var">?tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">∧</span> length <span class="main">[</span>last <span class="var">?io</span><span class="main">]</span> <span class="main">=</span> length <span class="main">[</span><span class="skolem">tr2'_last</span><span class="main">]</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tr2'_last</span> <span class="main">∈</span> succ <span class="free">M2</span> <span class="main">(</span>last <span class="main">(</span><span class="var">?io</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="main">(</span><span class="var">?io</span> <span class="main">||</span> <span class="var">?tr2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> fail_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="FSM_Product-fail_reachable_iff"><span class="command">lemma</span></span> fail_reachable_iff<span class="main">[</span><span class="operator">iff</span><span class="main">]</span> <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">∈</span> reachable <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">∈</span> reachable <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms fail_reachable_reverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span> <span class="main">⟹</span> <span class="free">FAIL</span> <span class="main">∈</span> reachable <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms fail_reachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>





<span class="keyword1" id="FSM_Product-reaching_path_length"><span class="command">lemma</span></span> reaching_path_length <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> reachable <span class="free">AB</span> <span class="free">q1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">≠</span> <span class="free">FAIL</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">AB</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> path <span class="free">AB</span> <span class="bound">p</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="bound">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="bound">p</span> <span class="main">&lt;</span> card <span class="main">(</span>nodes <span class="free">A</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>nodes <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="skolem">p</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="skolem">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> distinct <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms reaching_path_without_repetition <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> well_formed_productF<span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">≠</span> <span class="free">FAIL</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">FAIL</span> <span class="main">∉</span> set <span class="main">(</span>butlast <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>butlast <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">∧</span> butlast <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_Ex1 distinct_butlast p_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> local.Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_butlast_last_id length_append_singleton list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> local.Cons<span class="main">)</span> 
  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> target <span class="main">(</span>take <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> i_def assm <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_lessD nth_Cons_Suc nth_butlast states_target_index<span class="main">)</span>  
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span>take <span class="skolem">i</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">k</span> <span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> length <span class="skolem">p</span> <span class="main">⟶</span> target <span class="main">(</span>take <span class="bound">k</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">q1</span> <span class="main">≠</span> <span class="free">FAIL</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> no_prefix_targets_FAIL<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">AB</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="free">q1</span></span><span class="main">]</span> assms p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> linorder_neqE_nat nat_less_le order_refl p_def take_all<span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span> <span class="main">≠</span> <span class="free">FAIL</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> local.Cons p_def transition_system_universal.target_alt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> UnE append_butlast_last_id list.set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> set_append singletonD<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">AB</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes_states insert_subset list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> p_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> states_subset <span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">q1</span> <span class="main">#</span> states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">A</span> <span class="main">×</span> nodes <span class="free">B</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nodes_productF assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

  <span class="keyword1"><span class="command">have</span></span> finite_nodes <span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">A</span> <span class="main">×</span> nodes <span class="free">B</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">p</span> <span class="main">≤</span> length <span class="main">(</span>states <span class="skolem">p</span> <span class="free">q1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">p</span> <span class="main">&lt;</span> card <span class="main">(</span>nodes <span class="free">A</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>nodes <span class="free">B</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> finite_nodes states_subset card_cartesian_product card_mono distinct_card 
        impossible_Cons less_le_trans not_less p_def<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
<span class="keyword1"><span class="command">qed</span></span> 
  

<span class="keyword1" id="FSM_Product-reaching_path_fail_length"><span class="command">lemma</span></span> reaching_path_fail_length <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> reachable <span class="free">AB</span> <span class="free">q1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">AB</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="main">.</span> path <span class="free">AB</span> <span class="bound">p</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="bound">p</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="bound">p</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">A</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>nodes <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> q2_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">px</span></span> <span class="keyword2"><span class="keyword">where</span></span> px_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="skolem">px</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="skolem">px</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> px_nonempty <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">px</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> q2_def False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span>butlast <span class="skolem">px</span><span class="main">)</span> <span class="free">q1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qx</span> <span class="main">∈</span> reachable <span class="free">AB</span> <span class="free">q1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> px_def px_nonempty
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append_elim FSM.reachable.reflexive FSM.reachable_target 
          append_butlast_last_id<span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qx</span> <span class="main">≠</span> <span class="free">FAIL</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> False q2_def assms 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_pred butlast_conv_take length_greater_0_conv lessI 
          no_prefix_targets_FAIL px_def px_nonempty<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">px'</span></span> <span class="keyword2"><span class="keyword">where</span></span> px'_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="skolem">px'</span> <span class="free">q1</span> 
                                            <span class="main">∧</span> target <span class="skolem">px'</span> <span class="free">q1</span> <span class="main">=</span> <span class="var">?qx</span> 
                                            <span class="main">∧</span> length <span class="skolem">px'</span> <span class="main">&lt;</span> card <span class="main">(</span>nodes <span class="free">A</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>nodes <span class="free">B</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms reaching_path_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">AB</span></span> <span class="var"><span class="quoted"><span class="var">?qx</span></span></span> <span class="quoted"><span class="free">q1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  

    <span class="keyword1"><span class="command">have</span></span> px_split <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="main">(</span>butlast <span class="skolem">px</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>last <span class="skolem">px</span><span class="main">]</span><span class="main">)</span> <span class="free">q1</span> 
                      <span class="main">∧</span> target <span class="main">(</span><span class="main">(</span>butlast <span class="skolem">px</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>last <span class="skolem">px</span><span class="main">]</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> px_def px_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">[</span>last <span class="skolem">px</span><span class="main">]</span> <span class="var">?qx</span> <span class="main">∧</span> target <span class="main">[</span>last <span class="skolem">px</span><span class="main">]</span> <span class="var">?qx</span> <span class="main">=</span> <span class="free">q2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> px_nonempty
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">[</span>last <span class="skolem">px</span><span class="main">]</span> <span class="main">(</span>target <span class="main">(</span>butlast <span class="skolem">px</span><span class="main">)</span> <span class="free">q1</span><span class="main">)</span> <span class="main">=</span> <span class="free">q2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> px_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> px_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> 

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="skolem">px'</span> <span class="main">@</span> <span class="main">[</span>last <span class="skolem">px</span><span class="main">]</span><span class="main">)</span> <span class="free">q1</span> <span class="main">∧</span> target <span class="main">(</span><span class="skolem">px'</span> <span class="main">@</span> <span class="main">[</span>last <span class="skolem">px</span><span class="main">]</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> px'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">px'</span> <span class="main">@</span> <span class="main">[</span>last <span class="skolem">px</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">A</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>nodes <span class="free">B</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> px'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms reaching_path_length <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_imp_le<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM_Product-productF_language"><span class="command">lemma</span></span> productF_language <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">A</span> <span class="free">B</span> <span class="free">FAIL</span> <span class="free">AB</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> L <span class="free">A</span> <span class="main">∩</span> L <span class="free">B</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> L <span class="free">AB</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trA</span></span> <span class="skolem"><span class="skolem">trB</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">A</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">trA</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">trA</span>"</span></span> 
                                <span class="quoted"><span class="quoted">"path <span class="free">B</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">trB</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">B</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">trB</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">AB</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">trA</span> <span class="main">||</span> <span class="skolem">trB</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">A</span><span class="main">,</span> initial <span class="free">B</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial productF_path_inclusion<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> tr_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> language_state length_zip min.idem productF_simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM_Product-productF_language_state_intermediate"><span class="command">lemma</span></span> productF_language_state_intermediate <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q2</span> <span class="free">q1</span> <span class="free">tr</span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> L <span class="free">PM</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_language<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trVX</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">trVX</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">trVX</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tgt_VX <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>target <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">trVX</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> obs_target_is_io_targets observable_productF<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> L <span class="free">PM</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">PM</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> language_state_prefix<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trV</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">trV</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tgt_V <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span>target <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> obs_target_is_io_targets observable_productF<span class="main">)</span> 

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>target <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>target <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span>"</span></span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">PM</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> observable_productF<span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span><span class="var">?q2</span><span class="main">,</span><span class="var">?q1</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">{</span>target <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">||</span> <span class="skolem">trVX</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> observable_io_targets_split<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹observable <span class="free">PM</span>›</span></span> tgt_VX tgt_V<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> language_state <span class="free">PM</span> <span class="main">(</span><span class="var">?q2</span><span class="main">,</span><span class="var">?q1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span><span class="var">?q2</span><span class="main">,</span><span class="var">?q1</span><span class="main">)</span>"</span></span> 
                       <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="skolem">tr</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.collapse tgt_V that<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="FSM_Product-sequence_to_failure_reaches_FAIL"><span class="command">lemma</span></span> sequence_to_failure_reaches_FAIL <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="free">io</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> 
                    <span class="main">∧</span> length <span class="skolem">p</span> <span class="main">=</span> length <span class="free">io</span> 
                    <span class="main">∧</span> target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> fail_reachable_by_sequence_to_failure<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="FSM_Product-sequence_to_failure_reaches_FAIL_ob"><span class="command">lemma</span></span> sequence_to_failure_reaches_FAIL_ob <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="free">io</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> sequence_to_failure_reaches_FAIL<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">PM</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> observable_productF<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="free">FAIL</span> <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span>›</span></span> <span class="quoted"><span class="quoted">‹observable <span class="free">PM</span>›</span></span> 
        observable_io_target_is_singleton<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="FSM_Product-sequence_to_failure_alt_def"><span class="command">lemma</span></span> sequence_to_failure_alt_def <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="free">io</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>"</span></span> 
                 <span class="quoted"><span class="quoted">"length <span class="skolem">p</span> <span class="main">=</span> length <span class="free">io</span>"</span></span> 
                 <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">=</span> <span class="free">FAIL</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> io_targets_elim singletonI<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span>initial <span class="free">PM</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">PM</span> <span class="main">≠</span> <span class="free">FAIL</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">PM</span> <span class="main">=</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">PM</span> <span class="main">∈</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FSM.nodes.initial<span class="main">)</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">∉</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">io</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span>butlast <span class="main">(</span><span class="free">io</span><span class="main">||</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">≠</span> <span class="free">FAIL</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> no_prefix_targets_FAIL<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">io</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">io</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">p</span> <span class="main">=</span> length <span class="free">io</span>›</span></span> butlast_conv_take 
        diff_less length_map less_numeral_extra<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> map_fst_zip<span class="main">)</span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span>butlast <span class="main">(</span><span class="free">io</span><span class="main">||</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∈</span> nodes <span class="free">PM</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial FSM.nodes_target FSM.path_append_elim 
        <span class="quoted"><span class="quoted">‹path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>›</span></span> append_butlast_last_id butlast.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">PM</span> <span class="main">⊆</span> insert <span class="free">FAIL</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nodes_productF<span class="main">[</span><span class="operator">OF</span> _ _ assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span>butlast <span class="main">(</span><span class="free">io</span><span class="main">||</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∈</span> insert <span class="free">FAIL</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span>butlast <span class="main">(</span><span class="free">io</span><span class="main">||</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹target <span class="main">(</span>butlast <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∈</span> insert <span class="free">FAIL</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹target <span class="main">(</span>butlast <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">≠</span> <span class="free">FAIL</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span>butlast <span class="main">(</span><span class="free">io</span><span class="main">||</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">)</span>"</span></span> 
                          <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> nodes <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>butlast <span class="free">io</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>map fst <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
       <span class="quoted"><span class="quoted">"length <span class="main">(</span>map fst <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">p</span> <span class="main">=</span> length <span class="free">io</span>›</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span>butlast <span class="main">(</span><span class="free">io</span><span class="main">||</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append_elim <span class="quoted"><span class="quoted">‹path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>›</span></span> append_butlast_last_id 
        butlast.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="main">(</span>butlast <span class="free">io</span><span class="main">)</span> <span class="main">||</span> <span class="main">(</span>map fst <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">||</span> <span class="main">(</span>map snd <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">p</span> <span class="main">=</span> length <span class="free">io</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> map fst <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span> <span class="main">||</span> map snd <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> 
        <span class="main">≠</span> <span class="free">FAIL</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">p</span> <span class="main">=</span> length <span class="free">io</span>›</span></span> <span class="quoted"><span class="quoted">‹target <span class="main">(</span>butlast <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">≠</span> <span class="free">FAIL</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> map fst <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span>
          path <span class="free">M1</span> <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> map snd <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∨</span>
        target <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> map fst <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span> <span class="main">||</span> map snd <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> 
          <span class="main">=</span> <span class="free">FAIL</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_path_reverse
          <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>butlast <span class="free">io</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>map fst <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹length <span class="main">(</span>map fst <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span> 
              assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> _ _ 
              <span class="quoted"><span class="quoted">‹path <span class="free">PM</span> <span class="main">(</span><span class="main">(</span>butlast <span class="free">io</span><span class="main">)</span> <span class="main">||</span> <span class="main">(</span>map fst <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">||</span> <span class="main">(</span>map snd <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>›</span></span> _ _<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> map fst <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> map snd <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹target <span class="main">(</span>butlast <span class="free">io</span> <span class="main">||</span> map fst <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span> <span class="main">||</span> map snd <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">≠</span> <span class="free">FAIL</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="free">io</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>butlast <span class="free">io</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>map fst <span class="main">(</span>butlast <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> map fst <span class="skolem">p</span> <span class="main">||</span> map snd <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="main">(</span>map fst <span class="skolem">p</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"length <span class="main">(</span>map fst <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">p</span> <span class="main">=</span> length <span class="free">io</span>›</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p1'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">p1'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> productF_path_reverse_ob
          <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹length <span class="free">io</span> <span class="main">=</span> length <span class="main">(</span>map fst <span class="skolem">p</span><span class="main">)</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹length <span class="main">(</span>map fst <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="skolem">p</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> _ _ 
              <span class="quoted"><span class="quoted">‹path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> map fst <span class="skolem">p</span> <span class="main">||</span> map snd <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∉</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>  
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span> <span class="comment1">― ‹ only possible if io does not target FAIL ›</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p2'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">p2'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">p2'</span> <span class="main">=</span> length <span class="skolem">p1'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M1</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p1'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">p1'</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p2'</span> <span class="main">||</span> <span class="skolem">p1'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> productF_path_inclusion<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">p2'</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">p2'</span> <span class="main">=</span> length <span class="skolem">p1'</span>›</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">,</span> 
                                    <span class="operator">of</span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M1</span>"</span></span><span class="main">]</span>
            <span class="quoted"><span class="quoted">‹path <span class="free">M1</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p1'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">p1'</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p2'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p2'</span> <span class="main">||</span> <span class="skolem">p1'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">p2'</span>›</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M1</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p1'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">p1'</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p2'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAIL</span> <span class="main">∉</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p2'</span> <span class="main">||</span> <span class="skolem">p1'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">≠</span> <span class="free">FAIL</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">p2'</span> <span class="main">||</span> <span class="skolem">p1'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">p2'</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">p2'</span> <span class="main">=</span> length <span class="skolem">p1'</span>›</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p2'</span> <span class="main">||</span> <span class="skolem">p1'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> 
            <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="free">io</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p2'</span> <span class="main">||</span> <span class="skolem">p1'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">io</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">p2'</span> <span class="main">||</span> <span class="skolem">p1'</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> io_targets.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span> <span class="main">≠</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p2'</span> <span class="main">||</span> <span class="skolem">p1'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> 
              <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="free">io</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">p2'</span> <span class="main">||</span> <span class="skolem">p1'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">≠</span> <span class="free">FAIL</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="free">io</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹butlast <span class="free">io</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">io</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="ATC">
<div class="head">
<h1>Theory ATC</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ATC
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="FSM.html">../FSM/FSM</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Adaptive test cases ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Adaptive test cases (ATCs) are tree-like structures that label nodes with inputs and edges with
outputs such that applying an ATC to some FSM is performed by applying the label of its root node
and then applying the ATC connected to the root node by an edge labeled with the observed output of
the FSM. The result of such an application is here called an ATC-reaction.

ATCs are here modelled to have edges for every possible output from each non-leaf node. This is not
a restriction on the definition of ATCs by Hierons <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "hierons"<span class="antiquote"><span class="antiquote">}</span></span></span></span> as a missing edge can be 
expressed by an edge to a leaf.
›</span></span>


<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC <span class="main">=</span> Leaf <span class="main">|</span> Node <span class="tfree"><span class="quoted"><span class="tfree">'in</span></span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'out</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">atc_reaction</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC 
                            <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>
  leaf<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">atc_reaction</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">q1</span></span></span> Leaf <span class="main">[]</span>"</span></span> <span class="main">|</span>
  node<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">q2</span></span></span> <span class="main">∈</span> succ <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q1</span></span></span> 
                  <span class="main">⟹</span> <span class="free">atc_reaction</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">q2</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">io</span></span></span> 
                  <span class="main">⟹</span> <span class="free">atc_reaction</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">q1</span></span></span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">io</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> leaf_elim<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"atc_reaction <span class="free">M</span> <span class="free">q1</span> Leaf <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> node_elim<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"atc_reaction <span class="free">M</span> <span class="free">q1</span> <span class="main">(</span>Node <span class="free">x</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">#</span><span class="free">io</span><span class="main">)</span>"</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Properties of ATC-reactions ›</span></span>

<span class="keyword1" id="ATC-atc_reaction_empty"><span class="command">lemma</span></span> atc_reaction_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"atc_reaction <span class="free">M</span> <span class="free">q</span> <span class="free">t</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> Leaf"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms atc_reaction.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 

<span class="keyword1" id="ATC-atc_reaction_nonempty_no_leaf"><span class="command">lemma</span></span> atc_reaction_nonempty_no_leaf <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"atc_reaction <span class="free">M</span> <span class="free">q</span> <span class="free">t</span> <span class="main">(</span>Cons <span class="free">a</span> <span class="free">io</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≠</span> Leaf"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="bound">c</span> <span class="bound">a</span> <span class="bound">ps</span><span class="main">.</span> <span class="main">¬</span> atc_reaction <span class="bound">f</span> <span class="main">(</span><span class="bound">c</span><span class="main">::</span><span class="tfree">'c</span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> ATC<span class="main">)</span> <span class="bound">ps</span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">≠</span> Leaf <span class="main">∨</span> <span class="bound">a</span> <span class="main">≠</span> Leaf <span class="main">∨</span> <span class="bound">ps</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> atc_reaction.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1" id="ATC-atc_reaction_nonempty"><span class="command">lemma</span></span> atc_reaction_nonempty<span class="main">[</span><span class="operator">elim</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"atc_reaction <span class="free">M</span> <span class="free">q1</span> <span class="free">t</span> <span class="main">(</span>Cons <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="free">io</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q2</span> <span class="free">f</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> Node <span class="free">x</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> succ <span class="free">M</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="free">q1</span>"</span></span>  <span class="quoted"><span class="quoted">"atc_reaction <span class="free">M</span> <span class="free">q2</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="free">io</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> Node <span class="skolem">x2</span> <span class="skolem">f</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ATC.exhaust atc_reaction_nonempty_no_leaf<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">x2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms calculation atc_reaction.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ATC-atc_reaction_path_ex"><span class="command">lemma</span></span> atc_reaction_path_ex <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"atc_reaction <span class="free">M</span> <span class="free">q1</span> <span class="free">t</span> <span class="free">io</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">tr</span> <span class="main">.</span> path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="free">q1</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="bound">tr</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">io</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q1</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FSM.nil<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">io_hd</span> <span class="skolem">io_tl</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> io_hd_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io_hd</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> surj_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span>Node <span class="skolem">x</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons atc_reaction_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="keyword2"><span class="keyword">where</span></span> q2_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> succ <span class="free">M</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">q1</span>"</span></span> <span class="quoted"><span class="quoted">"atc_reaction <span class="free">M</span> <span class="skolem">q2</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">io_tl</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons io_hd_def atc_reaction_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr_tl</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr_tl_def <span class="main">:</span>  <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="skolem">io_tl</span> <span class="main">||</span> <span class="skolem">tr_tl</span><span class="main">)</span> <span class="skolem">q2</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">io_tl</span> <span class="main">=</span> length <span class="skolem">tr_tl</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q2</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="skolem">io_hd</span> <span class="main">#</span> <span class="skolem">io_tl</span> <span class="main">||</span> <span class="skolem">q2</span> <span class="main">#</span> <span class="skolem">tr_tl</span><span class="main">)</span> <span class="skolem">q1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons q2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FSM.path.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> io_hd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> tr_tl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>   
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ATC-atc_reaction_path"><span class="command">lemma</span></span> atc_reaction_path<span class="main">[</span><span class="operator">elim</span><span class="main">]</span> <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"atc_reaction <span class="free">M</span> <span class="free">q1</span> <span class="free">t</span> <span class="free">io</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">tr</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="free">q1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms atc_reaction_path_ex<span class="main">)</span> 



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Applicability ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ 
An ATC can be applied to an FSM if each node-label is contained in the input alphabet of the FSM.
›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">subtest</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∈</span> range <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟹</span> <span class="free">subtest</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ATC-accp_subtest"><span class="command">lemma</span></span> accp_subtest <span class="main">:</span> <span class="quoted"><span class="quoted">"Wellfounded.accp subtest <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Leaf
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ATC.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> accp.simps subtest.cases<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">x</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"Wellfounded.accp subtest <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> range <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="quoted">"<span class="skolem">t</span>"</span>
    <span class="keyword1"><span class="command">using</span></span> Node<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> accpI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> IH <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> subtest.cases<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subtest_rel</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">subtest_rel</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> Node <span class="bound">x</span> <span class="bound">f</span><span class="main">)</span> <span class="main">|</span><span class="bound">f</span> <span class="bound">x</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="bound">f</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="ATC-subtest_rel_altdef"><span class="command">lemma</span></span> subtest_rel_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"subtest_rel <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">|</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> subtest <span class="bound">s</span> <span class="bound">t</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subtest_rel_def subtest.simps<span class="main">)</span>

<span class="keyword1" id="ATC-subtest_relI"><span class="command">lemma</span></span> subtest_relI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> range <span class="free">f</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> Node <span class="free">x</span> <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> subtest_rel"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subtest_rel_def<span class="main">)</span>

<span class="keyword1" id="ATC-subtest_relI'"><span class="command">lemma</span></span> subtest_relI' <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">f</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> Node <span class="free">x</span> <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> subtest_rel"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subtest_rel_def ran_def<span class="main">)</span>

<span class="keyword1" id="ATC-wf_subtest_rel"><span class="command">lemma</span></span> wf_subtest_rel <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wf subtest_rel"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> accp_subtest <span class="keyword1"><span class="command">unfolding</span></span> subtest_rel_altdef accp_eq_acc wf_acc_iff
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>



<span class="keyword1"><span class="command">function</span></span> <span class="entity">inputs_atc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> ATC <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inputs_atc</span> Leaf <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">inputs_atc</span> <span class="main">(</span>Node <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> insert <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="free">inputs_atc</span> <span class="main">(</span>range <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted">subtest_rel</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">applicable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">applicable</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span>inputs_atc <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⊆</span> inputs <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">applicable_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">applicable_set</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">.</span> applicable <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ATC-applicable_subtest"><span class="command">lemma</span></span> applicable_subtest <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"applicable <span class="free">M</span> <span class="main">(</span>Node <span class="free">x</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"applicable <span class="free">M</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms inputs_atc.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_le_iff<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Application function IO ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">IO</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> collects all ATC-reactions of some FSM to some ATC.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">IO</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">IO</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound">tr</span> <span class="main">.</span> atc_reaction <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">tr</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">IO_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list set"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">IO_set</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span>IO <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">t</span> <span class="main">|</span> <span class="bound">t</span> <span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="ATC-IO_language"><span class="command">lemma</span></span> IO_language <span class="main">:</span> <span class="quoted"><span class="quoted">"IO <span class="free">M</span> <span class="free">q</span> <span class="free">t</span> <span class="main">⊆</span> language_state <span class="free">M</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atc_reaction_path IO.elims language_state mem_Collect_eq subsetI<span class="main">)</span> 

<span class="keyword1" id="ATC-IO_leaf"><span class="command">lemma</span></span> IO_leaf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"IO <span class="free">M</span> <span class="free">q</span> Leaf <span class="main">=</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>   
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"IO <span class="free">M</span> <span class="free">q</span> Leaf <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> IO <span class="free">M</span> <span class="free">q</span> Leaf <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io_hd</span></span> <span class="skolem"><span class="skolem">io_tl</span></span> <span class="keyword2"><span class="keyword">where</span></span> elem_ex <span class="main">:</span> <span class="quoted"><span class="quoted">"Cons <span class="skolem">io_hd</span> <span class="skolem">io_tl</span> <span class="main">∈</span> IO <span class="free">M</span> <span class="free">q</span> Leaf"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> insertI1 neq_Nil_conv subset_eq<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> atc_reaction_nonempty_no_leaf assm <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IO.simps mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">[]</span><span class="main">}</span> <span class="main">⊆</span> IO <span class="free">M</span> <span class="free">q</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ATC-IO_applicable_nonempty"><span class="command">lemma</span></span> IO_applicable_nonempty <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"applicable <span class="free">M</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"completely_specified <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IO <span class="free">M</span> <span class="free">q1</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">q1</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Leaf
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">x</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> inputs <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">q2</span></span>  <span class="keyword2"><span class="keyword">where</span></span> x_appl <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> succ <span class="free">M</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">q1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Node <span class="keyword1"><span class="command">unfolding</span></span> completely_specified.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"applicable <span class="free">M</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> applicable_subtest Node <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Node<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q2</span> <span class="main">∈</span> succ <span class="free">M</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">q1</span>›</span></span> FSM.nodes.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q1</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="skolem">q2</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IO <span class="free">M</span> <span class="skolem">q2</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Node <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> IO.simps 
    <span class="keyword1"><span class="command">using</span></span> x_appl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ATC-IO_in_language"><span class="command">lemma</span></span> IO_in_language <span class="main">:</span>
  <span class="quoted"><span class="quoted">"IO <span class="free">M</span> <span class="free">q</span> <span class="free">t</span> <span class="main">⊆</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> IO.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="ATC-IO_set_in_language"><span class="command">lemma</span></span> IO_set_in_language <span class="main">:</span>
  <span class="quoted"><span class="quoted">"IO_set <span class="free">M</span> <span class="free">q</span> <span class="free">Ω</span> <span class="main">⊆</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> IO_in_language<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> IO_set.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ R-distinguishability ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A non-empty ATC r-distinguishes two states of some FSM if there exists no shared ATC-reaction.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">r_dist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">r_dist</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≠</span> Leaf <span class="main">∧</span> IO <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∩</span> IO <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">r_dist_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">r_dist_set</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">.</span> r_dist <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1" id="ATC-r_dist_dist"><span class="command">lemma</span></span> r_dist_dist <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"applicable <span class="free">M</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"completely_specified <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"r_dist <span class="free">M</span> <span class="free">t</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">≠</span> <span class="free">q2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">q1</span> <span class="main">≠</span> <span class="free">q2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">=</span> <span class="free">q2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IO <span class="free">M</span> <span class="free">q1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IO <span class="free">M</span> <span class="free">q1</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms IO_applicable_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ATC-r_dist_set_dist"><span class="command">lemma</span></span> r_dist_set_dist <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"applicable_set <span class="free">M</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"completely_specified <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"r_dist_set <span class="free">M</span> <span class="free">Ω</span> <span class="free">q1</span> <span class="free">q2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">≠</span> <span class="free">q2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms r_dist_dist <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> applicable_set.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> r_dist_set.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>  

<span class="keyword1" id="ATC-r_dist_set_dist_disjoint"><span class="command">lemma</span></span> r_dist_set_dist_disjoint <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"applicable_set <span class="free">M</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"completely_specified <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t1</span> <span class="main">∈</span> <span class="free">T1</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">t2</span> <span class="main">∈</span> <span class="free">T2</span> <span class="main">.</span> r_dist_set <span class="free">M</span> <span class="free">Ω</span> <span class="bound">t1</span> <span class="bound">t2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">T1</span> <span class="main">⊆</span> nodes <span class="free">M</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">T1</span> <span class="main">∩</span> <span class="free">T2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms disjoint_iff_not_equal r_dist_set_dist subsetCE<span class="main">)</span>
  




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Response sets ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following functions calculate the sets of all ATC-reactions observed by applying some set of 
ATCs on every state reached in some FSM using a given set of IO-sequences.
›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">*</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set 
          <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">*</span> <span class="tfree">'out</span><span class="main">)</span> list set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">io</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> IO_set <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">io</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'in</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set
          <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">*</span> <span class="tfree">'out</span><span class="main">)</span> list set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">ISeqs</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">=</span> image <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> B <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">io</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ISeqs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">append_io_B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">*</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set 
                    <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">*</span> <span class="tfree">'out</span><span class="main">)</span> list set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">append_io_B</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">io</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="free"><span class="bound"><span class="entity">io</span></span></span><span class="main">@</span><span class="bound">res</span> <span class="main">|</span> <span class="bound">res</span> <span class="main">.</span> <span class="bound">res</span> <span class="main">∈</span> B <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">io</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">}</span>"</span></span>




<span class="keyword1" id="ATC-B_dist'"><span class="command">lemma</span></span> B_dist' <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> df<span class="main">:</span> <span class="quoted"><span class="quoted">"B <span class="free">M</span> <span class="free">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M</span> <span class="free">io2</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>io_targets <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">io1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>io_targets <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">io2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 

<span class="keyword1" id="ATC-B_dist"><span class="command">lemma</span></span> B_dist <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">io1</span> <span class="main">=</span> <span class="main">{</span><span class="free">q1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">io2</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"B <span class="free">M</span> <span class="free">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M</span> <span class="free">io2</span> <span class="free">Ω</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">≠</span> <span class="free">q2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


<span class="keyword1" id="ATC-D_bound"><span class="command">lemma</span></span> D_bound <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob<span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     fi<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">ISeqs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>D <span class="free">M</span> <span class="free">ISeqs</span> <span class="free">Ω</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>D <span class="free">M</span> <span class="free">ISeqs</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"D <span class="free">M</span> <span class="free">ISeqs</span> <span class="free">Ω</span> <span class="main">⊆</span> image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> IO_set <span class="free">M</span> <span class="bound">s</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">RS</span> <span class="keyword3"><span class="command">assume</span></span> RS_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">∈</span> D <span class="free">M</span> <span class="free">ISeqs</span> <span class="free">Ω</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> RS_tr <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> B <span class="free">M</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span> <span class="free">Ω</span>"</span></span> 
                                    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">∈</span> <span class="free">ISeqs</span> <span class="main">∧</span> length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">ys</span> 
                                        <span class="main">∧</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">∈</span> language_state <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qx</span></span> <span class="keyword2"><span class="keyword">where</span></span> qx_def <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">||</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="skolem">qx</span> <span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> io_targets_observable_singleton_ex ob<span class="main">)</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> IO_set <span class="free">M</span> <span class="skolem">qx</span> <span class="free">Ω</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> RS_tr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qx</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial io_targets_nodes qx_def singletonI<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">∈</span> image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> IO_set <span class="free">M</span> <span class="bound">s</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>D <span class="free">M</span> <span class="free">ISeqs</span> <span class="free">Ω</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>D <span class="free">M</span> <span class="free">ISeqs</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span>  finite_imageI infinite_super surj_card_le<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ATC-append_io_B_in_language"><span class="command">lemma</span></span> append_io_B_in_language <span class="main">:</span>
  <span class="quoted"><span class="quoted">"append_io_B <span class="free">M</span> <span class="free">io</span> <span class="free">Ω</span> <span class="main">⊆</span> L <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> append_io_B <span class="free">M</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">res</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">io</span><span class="main">@</span><span class="skolem">res</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">res</span> <span class="main">∈</span> B <span class="free">M</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> append_io_B.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">io</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">res</span> <span class="main">∈</span> IO_set <span class="free">M</span> <span class="skolem">q</span> <span class="free">Ω</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">res</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="skolem">q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> IO_set_in_language<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="free">Ω</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pIO</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">pIO</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>"</span></span> 
                   <span class="quoted"><span class="quoted">"length <span class="skolem">pIO</span> <span class="main">=</span> length <span class="free">io</span>"</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">pIO</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">io</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pRes</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="skolem">res</span> <span class="main">||</span> <span class="skolem">pRes</span><span class="main">)</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">pRes</span> <span class="main">=</span> length <span class="skolem">res</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">res</span> <span class="main">∈</span> <span class="keyword1">LS</span> <span class="free">M</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span><span class="main">@</span><span class="skolem">res</span> <span class="main">∈</span> L <span class="free">M</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> FSM.path_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span><span class="main">||</span><span class="skolem">pIO</span>"</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">res</span><span class="main">||</span><span class="skolem">pRes</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> language_state length_append zip_append<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> L <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="free">io</span><span class="main">@</span><span class="skolem">res</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ATC-append_io_B_nonempty"><span class="command">lemma</span></span> append_io_B_nonempty <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"applicable_set <span class="free">M</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"completely_specified <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> language_state <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">Ω</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"append_io_B <span class="free">M</span> <span class="free">io</span> <span class="free">Ω</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"applicable <span class="free">M</span> <span class="skolem">t</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">tr</span> <span class="main">=</span> length <span class="free">io</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IO <span class="free">M</span> <span class="main">(</span>target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> IO_applicable_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io'</span> <span class="main">∈</span> IO <span class="free">M</span> <span class="main">(</span>target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io'</span> <span class="main">∈</span> IO_set <span class="free">M</span> <span class="main">(</span>target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="free">Ω</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> IO_set.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">io</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">tr</span> <span class="main">=</span> length <span class="free">io</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io'</span> <span class="main">∈</span> B <span class="free">M</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> B.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span><span class="main">@</span><span class="skolem">io'</span> <span class="main">∈</span> append_io_B <span class="free">M</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> append_io_B.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword1" id="ATC-append_io_B_prefix_in_language"><span class="command">lemma</span></span> append_io_B_prefix_in_language <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"append_io_B <span class="free">M</span> <span class="free">io</span> <span class="free">Ω</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> L <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">res</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">@</span> <span class="skolem">res</span> <span class="main">∈</span> append_io_B <span class="free">M</span> <span class="free">io</span> <span class="free">Ω</span> <span class="main">∧</span> <span class="skolem">res</span> <span class="main">∈</span> B <span class="free">M</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">io</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> io_targets <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">io</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">∧</span> path <span class="free">M</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> 
                          <span class="main">∧</span> length <span class="skolem">tr</span> <span class="main">=</span> length <span class="free">io</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>





<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Characterizing sets ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A set of ATCs is a characterizing set for some FSM if for every pair of r-distinguishable states it
contains an ATC that r-distinguishes them.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">characterizing_atc_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">characterizing_atc_set</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">=</span> <span class="main">(</span>applicable_set <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="main">(</span>nodes <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="main">(</span>nodes <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">.</span> 
    <span class="main">(</span><span class="main">∃</span> <span class="bound">td</span> <span class="main">.</span> r_dist <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">td</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">tt</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">.</span> r_dist <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">tt</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Reduction over ATCs ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Some state is a an ATC-reduction of another over some set of ATCs if for every contained ATC every 
ATC-reaction to it of the former state is also an ATC-reaction of the latter state.
›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">atc_reduction</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'state</span> 
                      <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">atc_reduction</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">.</span> IO <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="bound">t</span> <span class="main">⊆</span> IO <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="bound">t</span><span class="main">)</span>"</span></span>



<span class="comment1">― ‹r-distinguishability holds for atc-reductions›</span>
<span class="keyword1" id="ATC-atc_rdist_dist"><span class="command">lemma</span></span> atc_rdist_dist<span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf2   <span class="main">:</span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     cs2   <span class="main">:</span> <span class="quoted"><span class="quoted">"completely_specified <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ap2   <span class="main">:</span> <span class="quoted"><span class="quoted">"applicable_set <span class="free">M2</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     el_t1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     red1  <span class="main">:</span> <span class="quoted"><span class="quoted">"atc_reduction <span class="free">M2</span> <span class="free">t1</span> <span class="free">M1</span> <span class="free">s1</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     red2  <span class="main">:</span> <span class="quoted"><span class="quoted">"atc_reduction <span class="free">M2</span> <span class="free">t2</span> <span class="free">M1</span> <span class="free">s2</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     rdist <span class="main">:</span> <span class="quoted"><span class="quoted">"r_dist_set <span class="free">M1</span> <span class="free">Ω</span> <span class="free">s1</span> <span class="free">s2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>             <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"r_dist_set <span class="free">M2</span> <span class="free">Ω</span> <span class="free">t1</span> <span class="free">t2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">td</span></span> <span class="keyword2"><span class="keyword">where</span></span> td_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">td</span> <span class="main">∈</span> <span class="free">Ω</span> <span class="main">∧</span> r_dist <span class="free">M1</span> <span class="skolem">td</span> <span class="free">s1</span> <span class="free">s2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> rdist <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IO <span class="free">M1</span> <span class="free">s1</span> <span class="skolem">td</span> <span class="main">∩</span> IO <span class="free">M1</span> <span class="free">s2</span> <span class="skolem">td</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> td_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IO <span class="free">M2</span> <span class="free">t1</span> <span class="skolem">td</span> <span class="main">⊆</span> IO <span class="free">M1</span> <span class="free">s1</span> <span class="skolem">td</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> red1 td_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IO <span class="free">M2</span> <span class="free">t2</span> <span class="skolem">td</span> <span class="main">⊆</span> IO <span class="free">M1</span> <span class="free">s2</span> <span class="skolem">td</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> red2 td_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> no_inter <span class="main">:</span> <span class="quoted"><span class="quoted">"IO <span class="free">M2</span> <span class="free">t1</span> <span class="skolem">td</span> <span class="main">∩</span> IO <span class="free">M2</span> <span class="free">t2</span> <span class="skolem">td</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">td</span> <span class="main">≠</span> Leaf"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IO <span class="free">M2</span> <span class="free">t1</span> <span class="skolem">td</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ap2 IO_applicable_nonempty applicable_set.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cs2 td_def assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IO <span class="free">M2</span> <span class="free">t1</span> <span class="skolem">td</span> <span class="main">≠</span> IO <span class="free">M2</span> <span class="free">t2</span> <span class="skolem">td</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> no_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> no_inter td_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Reduction over ATCs applied after input sequences ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following functions check whether some FSM is a reduction of another over a given set of input
sequences while furthermore the response sets obtained by applying a set of ATCs after every input
sequence to the first FSM are subsets of the analogously constructed response sets of the second
FSM.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">atc_io_reduction_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'in</span> list 
                            <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">atc_io_reduction_on</span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">iseq</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">=</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">iseq</span></span></span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">iseq</span></span></span><span class="main">}</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">iseq</span></span></span><span class="main">}</span> <span class="main">.</span> B <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="bound">io</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">⊆</span> B <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="bound">io</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">atc_io_reduction_on_sets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'in</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set 
                                  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> FSM <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">atc_io_reduction_on_sets</span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">TS</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">iseq</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">TS</span></span></span> <span class="main">.</span> atc_io_reduction_on <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="bound">iseq</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span> 
  atc_io_reduction_on_sets <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">≼⟦</span>_<span class="keyword1">.</span>_<span class="keyword1">⟧</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">]</span><span class="main">)</span>



<span class="keyword1" id="ATC-io_reduction_from_atc_io_reduction"><span class="command">lemma</span></span> io_reduction_from_atc_io_reduction <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="free">T</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"finite <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"io_reduction_on <span class="free">M1</span> <span class="free">T</span> <span class="free">M2</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">T</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">t</span> <span class="free">Ω</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> atc_io_reduction_on.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="skolem">T</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="skolem">T</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> insert.IH
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="skolem">T</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> contra_subsetD insert.prems atc_io_reduction_on_sets.simps subset_insertI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="skolem">T</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> insert_iff language_state_for_inputs_in_language_state 
        language_state_for_inputs_map_fst language_state_for_inputs_map_fst_contained 
        subsetCE subsetI<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pps</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v2</span><span class="main">.</span> <span class="bound">v2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="bound">v2</span> <span class="main">∉</span> <span class="bound">x0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pps</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="skolem">pps</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∉</span> <span class="bound">x0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span> <span class="bound">Pa</span><span class="main">.</span> <span class="skolem">pps</span> <span class="bound">Pa</span> <span class="bound">P</span> <span class="main">∈</span> <span class="bound">P</span> <span class="main">∧</span> <span class="skolem">pps</span> <span class="bound">Pa</span> <span class="bound">P</span> <span class="main">∉</span> <span class="bound">Pa</span> <span class="main">∨</span> <span class="bound">P</span> <span class="main">⊆</span> <span class="bound">Pa</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span><span class="skolem">pps</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> insert <span class="skolem">t</span> <span class="skolem">T</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pps</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∉</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span> 
                      <span class="main">∨</span> <span class="skolem">pps</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> insertI1 language_state_for_inputs_map_fst_contained singletonD<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>›</span></span> language_state_for_inputs_in_language_state 
          language_state_for_inputs_map_fst set_rev_mp<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
        
     
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">P</span> <span class="bound">Pa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ps</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list<span class="main">)</span> <span class="main">∉</span> <span class="bound">P</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">P</span> <span class="main">⊆</span> <span class="bound">Pa</span> <span class="main">∨</span> <span class="bound">ps</span> <span class="main">∈</span> <span class="bound">Pa</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pps</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v2</span><span class="main">.</span> <span class="bound">v2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="bound">v2</span> <span class="main">∉</span> <span class="bound">x0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pps</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">∧</span> <span class="skolem">pps</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="main">∉</span> <span class="bound">x0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pps</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">∉</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span><span class="skolem">pps</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">∉</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span><span class="skolem">pps</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pps</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">∉</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span> 
                    <span class="main">∨</span> <span class="skolem">pps</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="skolem">T</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span>›</span></span> 
                       insertE language_state_for_inputs_in_language_state 
                       language_state_for_inputs_map_fst 
                       language_state_for_inputs_map_fst_contained<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_reduction_on <span class="free">M1</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span> <span class="free">M2</span> 
                        <span class="main">∨</span> <span class="skolem">pps</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">∉</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span> 
                        <span class="main">∨</span> <span class="skolem">pps</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> language_state_for_inputs_in_language_state 
                     language_state_for_inputs_map_fst<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span>insert <span class="skolem">t</span> <span class="skolem">T</span><span class="main">)</span>›</span></span> subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="ATC-atc_io_reduction_on_subset"><span class="command">lemma</span></span> atc_io_reduction_on_subset <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="free">T</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">T'</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="free">T'</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> atc_io_reduction_on_sets.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="ATC-atc_reaction_reduction"><span class="command">lemma</span></span> atc_reaction_reduction<span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ls <span class="main">:</span> <span class="quoted"><span class="quoted">"language_state <span class="free">M1</span> <span class="free">q1</span> <span class="main">⊆</span> language_state <span class="free">M2</span> <span class="free">q2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     el1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     el2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     rct <span class="main">:</span> <span class="quoted"><span class="quoted">"atc_reaction <span class="free">M1</span> <span class="free">q1</span> <span class="free">t</span> <span class="free">io</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob2 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob1 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"atc_reaction <span class="free">M2</span> <span class="free">q2</span> <span class="free">t</span> <span class="free">io</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">io</span></span> <span class="quoted"><span class="free">q1</span></span> <span class="quoted"><span class="free">q2</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Leaf
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atc_reaction_nonempty_no_leaf list.exhaust<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> leaf<span class="main">)</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Node <span class="skolem">x</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io_hd</span></span> <span class="skolem"><span class="skolem">io_tl</span></span> <span class="keyword2"><span class="keyword">where</span></span> io_split <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">=</span> <span class="skolem">io_hd</span> <span class="main">#</span> <span class="skolem">io_tl</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ATC.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> atc_reaction_empty list.exhaust<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io_hd</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Node calculation <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ATC.inject atc_reaction_nonempty surj_pair<span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span>  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q1x</span></span> <span class="keyword2"><span class="keyword">where</span></span> q1x_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1x</span> <span class="main">∈</span> succ <span class="free">M1</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">q1</span>"</span></span> <span class="quoted"><span class="quoted">"atc_reaction <span class="free">M1</span> <span class="skolem">q1x</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">io_tl</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Node.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pt1 <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">q1x</span><span class="main">]</span><span class="main">)</span> <span class="skolem">q1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ls1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">∈</span> language_state <span class="free">M1</span> <span class="skolem">q1</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> language_state_def path_def <span class="keyword1"><span class="command">using</span></span> list.simps<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1x</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="skolem">q1</span> <span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> io_targets.simps
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> length <span class="main">[</span><span class="skolem">q1x</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1x</span> <span class="main">=</span> target <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">q1x</span><span class="main">]</span><span class="main">)</span> <span class="skolem">q1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1x</span> <span class="main">∈</span> <span class="main">{</span>target <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">||</span> <span class="bound">cs</span><span class="main">)</span> <span class="skolem">q1</span> <span class="main">|</span><span class="bound">cs</span><span class="main">.</span> path <span class="free">M1</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">||</span> <span class="bound">cs</span><span class="main">)</span> <span class="skolem">q1</span> 
                                                      <span class="main">∧</span> length <span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> length <span class="bound">cs</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 pt1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> tgt1 <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="skolem">q1</span> <span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q1x</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Node.prems io_targets_observable_singleton_ex q1x_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> singletonD<span class="main">)</span> 

  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ls2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="skolem">q2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Node.prems<span class="main">(</span>1<span class="main">)</span> ls1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2x</span></span> <span class="keyword2"><span class="keyword">where</span></span> q2x_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2x</span> <span class="main">∈</span> succ <span class="free">M2</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">q2</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> language_state_def path_def 
    <span class="keyword1"><span class="command">using</span></span> transition_system.path.cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pt2 <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">q2x</span><span class="main">]</span><span class="main">)</span> <span class="skolem">q2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2x</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="skolem">q2</span> <span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ls2 <span class="keyword1"><span class="command">unfolding</span></span> io_targets.simps 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> length <span class="main">[</span><span class="skolem">q2x</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2x</span> <span class="main">=</span> target <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="skolem">q2x</span><span class="main">]</span><span class="main">)</span> <span class="skolem">q2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2x</span> <span class="main">∈</span> <span class="main">{</span>target <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">||</span> <span class="bound">cs</span><span class="main">)</span> <span class="skolem">q2</span> <span class="main">|</span><span class="bound">cs</span><span class="main">.</span> path <span class="free">M2</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">||</span> <span class="bound">cs</span><span class="main">)</span> <span class="skolem">q2</span> 
                                                        <span class="main">∧</span> length <span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> length <span class="bound">cs</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 pt2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tgt2 <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="skolem">q2</span> <span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q2x</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Node.prems io_targets_observable_singleton_ex ls2 q2x_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> singletonD<span class="main">)</span> 


  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"language_state <span class="free">M1</span> <span class="skolem">q1x</span> <span class="main">⊆</span> language_state <span class="free">M2</span> <span class="skolem">q2x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> language_state_inclusion_of_state_reached_by_same_sequence
          <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="skolem">q1</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="skolem">q2</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">q1x</span></span> <span class="quoted"><span class="skolem">q2x</span></span><span class="main">]</span> 
          tgt1 tgt2 Node.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1x</span> <span class="main">∈</span> nodes <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> q1x_def<span class="main">(</span>1<span class="main">)</span> Node.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insertI1 io_targets_nodes tgt1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2x</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> q2x_def<span class="main">(</span>1<span class="main">)</span> Node.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insertI1 io_targets_nodes tgt2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2x</span> <span class="main">∈</span> succ <span class="free">M2</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="skolem">q2</span> <span class="main">∧</span> atc_reaction <span class="free">M2</span> <span class="skolem">q2x</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">io_tl</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Node.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="skolem">q1x</span></span> <span class="quoted"><span class="skolem">q2x</span></span> <span class="quoted"><span class="skolem">io_tl</span></span><span class="main">]</span> ob1 ob2 q1x_def<span class="main">(</span>2<span class="main">)</span> q2x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
 

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"atc_reaction <span class="free">M2</span> <span class="skolem">q2</span> <span class="main">(</span>Node <span class="skolem">x</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">io</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> io_split y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ATC-IO_reduction"><span class="command">lemma</span></span> IO_reduction <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ls <span class="main">:</span> <span class="quoted"><span class="quoted">"language_state <span class="free">M1</span> <span class="free">q1</span> <span class="main">⊆</span> language_state <span class="free">M2</span> <span class="free">q2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     el1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     el2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob1 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob2 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IO <span class="free">M1</span> <span class="free">q1</span> <span class="free">t</span> <span class="main">⊆</span> IO <span class="free">M2</span> <span class="free">q2</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms atc_reaction_reduction <span class="keyword1"><span class="command">unfolding</span></span> IO.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="ATC-IO_set_reduction"><span class="command">lemma</span></span> IO_set_reduction <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ls <span class="main">:</span> <span class="quoted"><span class="quoted">"language_state <span class="free">M1</span> <span class="free">q1</span> <span class="main">⊆</span> language_state <span class="free">M2</span> <span class="free">q2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     el1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     el2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob1 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob2 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"IO_set <span class="free">M1</span> <span class="free">q1</span> <span class="free">Ω</span> <span class="main">⊆</span> IO_set <span class="free">M2</span> <span class="free">q2</span> <span class="free">Ω</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">Ω</span> <span class="main">.</span> IO <span class="free">M1</span> <span class="free">q1</span> <span class="bound">t</span> <span class="main">⊆</span> IO <span class="free">M2</span> <span class="free">q2</span> <span class="bound">t</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms IO_reduction <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> IO_set.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ATC-B_reduction"><span class="command">lemma</span></span> B_reduction <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> red <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob1 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob2 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"B <span class="free">M1</span> <span class="free">io</span> <span class="free">Ω</span> <span class="main">⊆</span> B <span class="free">M2</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xy</span> <span class="keyword3"><span class="command">assume</span></span> xy_assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xy</span> <span class="main">∈</span> B <span class="free">M1</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q1x</span></span> <span class="keyword2"><span class="keyword">where</span></span> q1x_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q1x</span> <span class="main">∈</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">io</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">xy</span> <span class="main">∈</span> IO_set <span class="free">M1</span> <span class="skolem">q1x</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> B.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr1_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">tr1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> q1x_ob <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q1x</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> io_targets_observable_singleton_ex language_state q1x_def singleton_iff<span class="main">)</span> 
  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ls1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> language_state <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ls2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> red <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr2</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr2_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">tr2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2x</span></span> <span class="keyword2"><span class="keyword">where</span></span> q2x_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q2x</span> <span class="main">∈</span> <span class="main">(</span>io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">io</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> q2x_ob <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q2x</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> tr2_def assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> io_targets_observable_singleton_ex language_state singleton_iff<span class="main">)</span> 

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"language_state <span class="free">M1</span> <span class="skolem">q1x</span> <span class="main">⊆</span> language_state <span class="free">M2</span> <span class="skolem">q2x</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> q1x_ob assms <span class="keyword1"><span class="command">unfolding</span></span> io_reduction.simps 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> language_state_inclusion_of_state_reached_by_same_sequence<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IO_set <span class="free">M1</span> <span class="skolem">q1x</span> <span class="free">Ω</span> <span class="main">⊆</span> IO_set <span class="free">M2</span> <span class="skolem">q2x</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms IO_set_reduction <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial io_targets_nodes q1x_def q2x_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"B <span class="free">M1</span> <span class="free">io</span> <span class="free">Ω</span> <span class="main">=</span> IO_set <span class="free">M1</span> <span class="skolem">q1x</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> q1x_ob <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"B <span class="free">M2</span> <span class="free">io</span> <span class="free">Ω</span> <span class="main">=</span> IO_set <span class="free">M2</span> <span class="skolem">q2x</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> q2x_ob <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"B <span class="free">M1</span> <span class="free">io</span> <span class="free">Ω</span> <span class="main">⊆</span> B <span class="free">M2</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xy</span> <span class="main">∈</span> B <span class="free">M2</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xy_assm 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ATC-append_io_B_reduction"><span class="command">lemma</span></span> append_io_B_reduction <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> red <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob1 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob2 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"append_io_B <span class="free">M1</span> <span class="free">io</span> <span class="free">Ω</span> <span class="main">⊆</span> append_io_B <span class="free">M2</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ioR</span> <span class="keyword3"><span class="command">assume</span></span> ioR_assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ioR</span> <span class="main">∈</span> append_io_B <span class="free">M1</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">res</span></span> <span class="keyword2"><span class="keyword">where</span></span> res_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ioR</span> <span class="main">=</span> <span class="free">io</span> <span class="main">@</span> <span class="skolem">res</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">res</span> <span class="main">∈</span> B <span class="free">M1</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">res</span> <span class="main">∈</span> B <span class="free">M2</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms B_reduction <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ioR</span> <span class="main">∈</span> append_io_B <span class="free">M2</span> <span class="free">io</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ioR_assm res_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 



<span class="keyword1" id="ATC-atc_io_reduction_on_reduction"><span class="command">lemma</span></span> atc_io_reduction_on_reduction<span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> red <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob1 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob2 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on <span class="free">M1</span> <span class="free">M2</span> <span class="free">iseq</span> <span class="free">Ω</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> atc_io_reduction_on.simps <span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="free">iseq</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="free">iseq</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> red <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="free">iseq</span><span class="main">}</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span> <span class="main">⊆</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span>  B_reduction assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
    

<span class="keyword1" id="ATC-atc_io_reduction_on_sets_reduction"><span class="command">lemma</span></span> atc_io_reduction_on_sets_reduction<span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> red <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob1 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     ob2 <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="free">TS</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms atc_io_reduction_on_reduction <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atc_io_reduction_on_sets.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 

<span class="keyword1" id="ATC-atc_io_reduction_on_sets_via_LS"><span class="command">lemma</span></span> atc_io_reduction_on_sets_via_LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="free">TS</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">TS</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">TS</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">⊆</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">TS</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">TS</span><span class="main">.</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">iseq</span> <span class="main">∈</span> <span class="free">TS</span> <span class="main">.</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span> 
                        <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span> <span class="main">.</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span> <span class="main">⊆</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">iseq</span> <span class="main">∈</span> <span class="free">TS</span> <span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> 
                            <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span><span class="main">.</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">iseq</span> <span class="main">∈</span> <span class="free">TS</span> <span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span><span class="main">.</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> 
                                <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">TS</span><span class="main">.</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> language_state_for_inputs.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> elem_subset <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">iseq</span> <span class="main">∈</span> <span class="free">TS</span> <span class="main">.</span> 
                                  <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> 
                                    <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">TS</span><span class="main">.</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">TS</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">TS</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">TS</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">TS</span><span class="main">.</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">TS</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">iseq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">iseq</span> <span class="main">∈</span> <span class="free">TS</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> language_state_for_inputs.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">iseq</span> <span class="free">Ω</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">TS</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> UN_I 
            <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">iseq</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">iseq</span> <span class="main">∈</span> <span class="free">TS</span><span class="main">;</span> <span class="skolem">x</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">iseq</span><span class="main">∈</span><span class="free">TS</span><span class="main">.</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span> <span class="main">⊆</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>›</span></span> 
            language_state_for_input_alt_def language_state_for_inputs_alt_def set_rev_mp<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">TS</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">TS</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">TS</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">TS</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> B <span class="free">M1</span> <span class="skolem">io</span> <span class="free">Ω</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">iseq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">iseq</span> <span class="main">∈</span> <span class="free">TS</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> language_state_for_inputs.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> B <span class="free">M1</span> <span class="skolem">io</span> <span class="free">Ω</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">TS</span><span class="main">.</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iseq</span> <span class="main">∈</span> <span class="free">TS</span>›</span></span> elem_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ASC_LB">
<div class="head">
<h1>Theory ASC_LB</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ASC_LB
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="ATC.html">../ATC/ATC</a>"</span> <span class="quoted">"<a href="FSM_Product.html">../FSM/FSM_Product</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ The lower bound function ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory defines the lower bound function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">LB</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and its properties.

Function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">LB</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> calculates a lower bound on the number of states of some FSM in order for
some sequence to not contain certain repetitions.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Permutation function Perm ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">Perm</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> calculates all possible reactions of an FSM to a set of inputs sequences
such that every set in the calculated set of reactions contains exactly one reaction for each input
sequence.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Perm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'in</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Perm</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">{</span>image <span class="bound">f</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">|</span> <span class="bound">f</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">.</span> <span class="bound">f</span> <span class="bound">v</span> <span class="main">∈</span> language_state_for_input <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="bound">v</span> <span class="main">}</span>"</span></span>

<span class="keyword1" id="ASC_LB-perm_empty"><span class="command">lemma</span></span> perm_empty <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">V''</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> init_seq <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> det_state_cover_empty assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">=</span> image <span class="skolem">f</span> <span class="free">V</span>
                                <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> init_seq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> language_state_for_input_empty singleton_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> init_seq f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_LB-perm_elem_finite"><span class="command">lemma</span></span> perm_elem_finite <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V''</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover_ass <span class="free">M2</span> <span class="skolem">f</span> <span class="main">∧</span> <span class="free">V</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">`</span> d_reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>d_reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">M2</span> <span class="main">=</span> reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">⊆</span> reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> infinite_super <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">=</span> image <span class="skolem">f''</span> <span class="free">V</span>
                              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">.</span> <span class="skolem">f''</span> <span class="bound">v</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_LB-perm_inputs"><span class="command">lemma</span></span> perm_inputs <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> <span class="free">V''</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">vs</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">=</span> image <span class="skolem">f</span> <span class="free">V</span>
                          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">∈</span> language_state_for_input <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">vs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> language_state_for_input <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> v_def <span class="keyword1"><span class="command">unfolding</span></span> language_state_for_input.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_LB-perm_inputs_diff"><span class="command">lemma</span></span> perm_inputs_diff <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">vs1</span> <span class="main">∈</span> <span class="free">V''</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">vs2</span> <span class="main">∈</span> <span class="free">V''</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">vs1</span> <span class="main">≠</span> <span class="free">vs2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">vs1</span> <span class="main">≠</span> map fst <span class="free">vs2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">=</span> image <span class="skolem">f</span> <span class="free">V</span>
                          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">∈</span> language_state_for_input <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> v_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="skolem">v1</span> <span class="main">=</span> <span class="free">vs1</span> <span class="main">∧</span> <span class="skolem">v2</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="skolem">v2</span> <span class="main">=</span> <span class="free">vs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs1</span> <span class="main">∈</span> language_state_for_input <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="skolem">v1</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="free">vs2</span> <span class="main">∈</span> language_state_for_input <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="skolem">v2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">≠</span> <span class="skolem">v2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> v_def assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_LB-perm_language"><span class="command">lemma</span></span> perm_language <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> <span class="free">V''</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> L <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def <span class="main">:</span> <span class="quoted"><span class="quoted">"image <span class="skolem">f</span> <span class="free">V</span> <span class="main">=</span> <span class="free">V''</span>
                          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">∈</span> language_state_for_input <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">v</span> <span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">vs</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">∈</span> language_state_for_input <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Helper predicates ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following predicates are used to combine often repeated assumption.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">asc_fault_domain</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≡</span> <span class="main">(</span>inputs <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">=</span> inputs <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">∧</span> card <span class="main">(</span>nodes <span class="free"><span class="bound"><span class="entity">M1</span></span></span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">)</span>"</span></span>

<span class="keyword1" id="ASC_LB-asc_fault_domain_props"><span class="command">lemma</span></span> asc_fault_domain_props<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inputs <span class="free">M2</span> <span class="main">=</span> inputs <span class="free">M1</span>"</span></span>
        <span class="quoted"><span class="quoted">"card <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span><span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">test_tools</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">FAIL</span></span></span> <span class="free"><span class="bound"><span class="entity">PM</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">≡</span> <span class="main">(</span>
      productF <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">FAIL</span></span></span> <span class="free"><span class="bound"><span class="entity">PM</span></span></span>
    <span class="main">∧</span> is_det_state_cover <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>
    <span class="main">∧</span> applicable_set <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span>
   <span class="main">)</span>"</span></span>

<span class="keyword1" id="ASC_LB-test_tools_props"><span class="command">lemma</span></span> test_tools_props<span class="main">[</span><span class="operator">elim</span><span class="main">]</span> <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
        <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
        <span class="quoted"><span class="quoted">"applicable_set <span class="free">M2</span> <span class="free">Ω</span>"</span></span>
        <span class="quoted"><span class="quoted">"applicable_set <span class="free">M1</span> <span class="free">Ω</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"applicable_set <span class="free">M2</span> <span class="free">Ω</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"applicable_set <span class="free">M1</span> <span class="free">Ω</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> applicable_set.simps applicable.simps
    <span class="keyword1"><span class="command">using</span></span> asc_fault_domain_props<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1" id="ASC_LB-perm_nonempty"><span class="command">lemma</span></span> perm_nonempty <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"inputs <span class="free">M1</span> <span class="main">=</span> inputs <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Perm <span class="free">V</span> <span class="free">M1</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> det_state_cover_card<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finite_imageI infinite_super is_det_state_cover.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> det_state_cover_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">VS</span> <span class="main">.</span> <span class="bound">VS</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">∧</span> <span class="bound">VS</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> Perm <span class="bound">VS</span> <span class="free">M1</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">VS</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">VS</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">∧</span> <span class="skolem">VS</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">VS</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">V</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> infinite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Perm <span class="skolem">VS</span> <span class="free">M1</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">VS</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">∧</span> <span class="skolem">VS</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">VS</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">VS</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> empty
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">vs</span> <span class="skolem">F</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"d_reaches <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">vs</span> <span class="skolem">q2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> det_state_cover_d_reachable<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">∈</span> <span class="free">V</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">vsP</span></span> <span class="keyword2"><span class="keyword">where</span></span> io_path <span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">vs</span> <span class="main">=</span> length <span class="skolem">vs'</span>
                                            <span class="main">∧</span> length <span class="skolem">vs</span> <span class="main">=</span> length <span class="skolem">vsP</span>
                                            <span class="main">∧</span> <span class="main">(</span>path <span class="free">M2</span> <span class="main">(</span><span class="main">(</span><span class="skolem">vs</span> <span class="main">||</span> <span class="skolem">vs'</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">vsP</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
                                            <span class="main">∧</span> target <span class="main">(</span><span class="main">(</span><span class="skolem">vs</span> <span class="main">||</span> <span class="skolem">vs'</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">vsP</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">q2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span>map fst <span class="main">(</span><span class="main">(</span><span class="skolem">vs</span> <span class="main">||</span> <span class="skolem">vs'</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">vsP</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">vs</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">vs</span> <span class="main">||</span> <span class="skolem">vs'</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">vsP</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> io_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> io_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map fst <span class="main">(</span>map fst <span class="main">(</span><span class="main">(</span><span class="skolem">vs</span> <span class="main">||</span> <span class="skolem">vs'</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">vsP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> inputs <span class="free">M2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> path_input_containment<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M2</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">vs</span> <span class="main">||</span> <span class="skolem">vs'</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">vsP</span>"</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span><span class="main">]</span>
              io_path
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">⊆</span> inputs <span class="free">M2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">vs</span> <span class="main">⊆</span> inputs <span class="free">M1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">vs</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> language_state_for_inputs_nonempty
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">vs</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">vs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">vs</span> <span class="main">=</span> <span class="skolem">vs'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image <span class="skolem">f</span> <span class="main">(</span>insert <span class="skolem">vs</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∈</span> Perm <span class="main">(</span>insert <span class="skolem">vs</span> <span class="skolem">F</span><span class="main">)</span> <span class="free">M1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Perm.simps <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">vs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F''</span> <span class="main">∈</span> Perm <span class="skolem">F</span> <span class="free">M1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> insert.IH insert.hyps<span class="main">(</span>1<span class="main">)</span> insert.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F''</span> <span class="main">=</span> image <span class="skolem">f</span> <span class="skolem">F</span>"</span></span>
                            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">(</span><span class="skolem">vs</span> <span class="main">:=</span> <span class="skolem">vs'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">vs</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">.</span> <span class="var">?f</span> <span class="bound">v</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">v</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> insert <span class="skolem">vs</span> <span class="skolem">F</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">v</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">vs</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">vs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> insert <span class="skolem">vs</span> <span class="skolem">F</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image <span class="var">?f</span> <span class="main">(</span>insert <span class="skolem">vs</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∈</span> Perm <span class="main">(</span>insert <span class="skolem">vs</span> <span class="skolem">F</span><span class="main">)</span> <span class="free">M1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Perm.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="ASC_LB-perm_elem"><span class="command">lemma</span></span> perm_elem <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"inputs <span class="free">M1</span> <span class="main">=</span> inputs <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs'</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">vs</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">V''</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs'</span> <span class="main">∈</span> <span class="free">V''</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> perm_nonempty<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> <span class="main">=</span> image <span class="skolem">f</span> <span class="free">V</span>"</span></span>
                      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">(</span><span class="free">vs</span> <span class="main">:=</span> <span class="free">vs'</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">.</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>image <span class="var">?f</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Perm.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs'</span> <span class="main">∈</span> image <span class="var">?f</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> fun_upd_same imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Function R ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">R</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> calculates the set of suffixes of a sequence that reach a given state if
applied after a given other sequence.
›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list
          <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">@</span><span class="bound">xs'</span> <span class="main">|</span> <span class="bound">xs'</span> <span class="main">.</span> <span class="bound">xs'</span> <span class="main">≠</span> <span class="main">[]</span>
                                <span class="main">∧</span> prefix <span class="bound">xs'</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>
                                <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∈</span> io_targets <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">@</span><span class="bound">xs'</span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1" id="ASC_LB-finite_R"><span class="command">lemma</span></span> finite_R <span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>R <span class="free">M</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="free">M</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">⊆</span> <span class="main">{</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xs'</span> <span class="main">|</span> <span class="bound">xs'</span> <span class="main">.</span>prefix <span class="bound">xs'</span> <span class="free">xs</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="free">M</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">⊆</span> image <span class="main">(</span><span class="main">λ</span> <span class="bound">xs'</span> <span class="main">.</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xs'</span><span class="main">)</span> <span class="main">{</span><span class="bound">xs'</span> <span class="main">.</span> prefix <span class="bound">xs'</span> <span class="free">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">xs'</span> <span class="main">.</span> prefix <span class="bound">xs'</span> <span class="free">xs</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>take <span class="bound">n</span> <span class="free">xs</span> <span class="main">|</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> length <span class="free">xs</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">xs'</span><span class="main">.</span> prefix <span class="bound">xs'</span> <span class="free">xs</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span>take <span class="bound">n</span> <span class="free">xs</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> length <span class="free">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">.</span> prefix <span class="bound">xs'</span> <span class="free">xs</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">@</span> <span class="skolem">zs'</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> mem_Collect_eq prefixE<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">i</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> append_eq_conv_conj le_cases take_all<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">∈</span> <span class="main">{</span>take <span class="bound">n</span> <span class="free">xs</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> length <span class="free">xs</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>take <span class="bound">n</span> <span class="free">xs</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> length <span class="free">xs</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">.</span> prefix <span class="bound">xs'</span> <span class="free">xs</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> take_is_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span>take <span class="bound">n</span> <span class="free">xs</span> <span class="main">|</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> length <span class="free">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="ASC_LB-card_union_of_singletons"><span class="command">lemma</span></span> card_union_of_singletons <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">SS</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">t</span> <span class="main">.</span> <span class="bound">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="free">SS</span><span class="main">)</span> <span class="main">=</span> card <span class="free">SS</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?f</span> <span class="main">(</span><span class="main">⋃</span> <span class="free">SS</span><span class="main">)</span> <span class="free">SS</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bij_betw_def inj_on_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_betw_same_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_LB-card_union_of_distinct"><span class="command">lemma</span></span> card_union_of_distinct <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">S1</span> <span class="main">∈</span> <span class="free">SS</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">S2</span> <span class="main">∈</span> <span class="free">SS</span> <span class="main">.</span> <span class="bound">S1</span> <span class="main">=</span> <span class="bound">S2</span> <span class="main">∨</span> <span class="free">f</span> <span class="bound">S1</span> <span class="main">∩</span> <span class="free">f</span> <span class="bound">S2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"finite <span class="free">SS</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">SS</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>image <span class="free">f</span> <span class="free">SS</span><span class="main">)</span> <span class="main">=</span> card <span class="free">SS</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">S1</span> <span class="main">∈</span> <span class="free">SS</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">S2</span> <span class="main">∈</span> <span class="free">SS</span> <span class="main">.</span> <span class="bound">S1</span> <span class="main">=</span> <span class="bound">S2</span> <span class="main">∨</span> <span class="free">f</span> <span class="bound">S1</span> <span class="main">∩</span> <span class="free">f</span> <span class="bound">S2</span> <span class="main">=</span> <span class="main">{}</span>
                      <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">SS</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">S</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">SS</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∉</span> image <span class="free">f</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>image <span class="free">f</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span>image <span class="free">f</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> card <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="skolem">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_LB-R_count"><span class="command">lemma</span></span> R_count <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹each sequence in the set calculated by R reaches a different state in M1›</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="comment1">― ‹Proof sketch:
       - states of PM reached by the sequences calculated by R can differ only in their second value
       - the sequences in the set calculated by R reach different states in PM due to distinctness›</span>

  <span class="keyword1"><span class="command">have</span></span> obs_PM <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">PM</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> observable_productF assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> state_component_2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">.</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="bound">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">io</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> io_targets_observable_singleton_ex <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> singletonD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">.</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io</span>
                    <span class="main">=</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="bound">io</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">io</span> <span class="keyword3"><span class="command">assume</span></span> io_assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> io_prefix <span class="main">:</span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">io</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> io_lang_subs <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∧</span> <span class="skolem">io</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> prefix_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntE language_state language_state_split<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> io_lang_inter <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> io_lang_pm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> L <span class="free">PM</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> productF_language assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">p1</span><span class="main">)</span> <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> calculation insert_absorb insert_ident insert_not_empty
          io_targets_observable_singleton_ob observable_productF singleton_insert_inj_eq subrelI<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> targets_pm <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">p1</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms io_targets_observable_singleton_ex singletonD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> observable_productF<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trP</span></span> <span class="keyword2"><span class="keyword">where</span></span> trP_def <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="skolem">trP</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">p1</span><span class="main">)</span>
                                      <span class="main">∧</span> path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="skolem">trP</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>
                                      <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="skolem">trP</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">trP</span><span class="main">.</span> target <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="bound">trP</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span> <span class="skolem">p1</span><span class="main">)</span>
                            <span class="main">∧</span> path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="bound">trP</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>
                            <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="bound">trP</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> target <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span> <span class="skolem">p1</span><span class="main">)</span>
                    <span class="main">∧</span> path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="bound">ps</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">p2</span><span class="main">,</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> trP_unique <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">tr</span> <span class="main">.</span> path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="bound">tr</span> <span class="main">}</span>
                              <span class="main">=</span> <span class="main">{</span> <span class="skolem">trP</span> <span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> observable_productF observable_path_unique_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="skolem">io</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">PM</span>"</span></span><span class="main">]</span>
              io_lang_pm assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>7<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pps</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'c</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">ps</span><span class="main">.</span> path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="bound">ps</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">pps</span><span class="main">}</span>
                <span class="main">∨</span> <span class="main">¬</span> observable <span class="free">PM</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">⟦</span>observable <span class="free">PM</span><span class="main">;</span> <span class="skolem">io</span> <span class="main">∈</span> L <span class="free">PM</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">tr</span><span class="main">.</span>
                                          <span class="main">{</span><span class="bound">t</span><span class="main">.</span> path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>
                                          <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="bound">t</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">tr</span><span class="main">}</span> <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span>
              io_lang_pm<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">PM</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹observable <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹observable <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> observable_productF<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trP</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">pps</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f1 trP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>


    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trIO2</span></span> <span class="keyword2"><span class="keyword">where</span></span> trIO2_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">tr</span> <span class="main">.</span> path <span class="free">M2</span> <span class="main">(</span><span class="skolem">io</span><span class="main">||</span><span class="bound">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="bound">tr</span><span class="main">}</span>
                                    <span class="main">=</span> <span class="main">{</span> <span class="skolem">trIO2</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> observable_path_unique_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="skolem">io</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span><span class="main">]</span> io_lang_subs assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trIO1</span></span> <span class="keyword2"><span class="keyword">where</span></span> trIO1_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">tr</span> <span class="main">.</span> path <span class="free">M1</span> <span class="main">(</span><span class="skolem">io</span><span class="main">||</span><span class="bound">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="bound">tr</span><span class="main">}</span>
                                    <span class="main">=</span> <span class="main">{</span> <span class="skolem">trIO1</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> observable_path_unique_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="skolem">io</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M1</span>"</span></span><span class="main">]</span> io_lang_subs assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="skolem">trIO2</span> <span class="main">||</span> <span class="skolem">trIO1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>
          <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="skolem">trIO2</span>
          <span class="main">∧</span> length <span class="skolem">trIO2</span> <span class="main">=</span> length <span class="skolem">trIO1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="skolem">trIO2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="skolem">trIO2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> trIO2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="skolem">trIO1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="skolem">trIO1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> trIO1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">trIO2</span> <span class="main">=</span> length <span class="skolem">trIO1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f2 f1 assms<span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> trP_split <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="skolem">trIO2</span> <span class="main">||</span> <span class="skolem">trIO1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>
                            <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="skolem">trIO2</span>
                            <span class="main">∧</span> length <span class="skolem">trIO2</span> <span class="main">=</span> length <span class="skolem">trIO1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> trP_zip <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trIO2</span> <span class="main">||</span> <span class="skolem">trIO1</span> <span class="main">=</span> <span class="skolem">trP</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trP_def trP_unique <span class="keyword1"><span class="command">using</span></span> length_zip <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="skolem">trIO2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p2</span>
          <span class="main">∧</span> path <span class="free">M2</span> <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="skolem">trIO2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>
          <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="skolem">trIO2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trP_zip trP_split assms<span class="main">(</span>7<span class="main">)</span> trP_def trIO2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> targets_2 <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> state_component_2 io_assm singletonD<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="skolem">trIO1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p1</span>
            <span class="main">∧</span> path <span class="free">M1</span> <span class="main">(</span><span class="skolem">io</span> <span class="main">||</span> <span class="skolem">trIO1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>
            <span class="main">∧</span> length <span class="skolem">io</span> <span class="main">=</span> length <span class="skolem">trIO1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trP_zip trP_split assms<span class="main">(</span>7<span class="main">)</span> trP_def trIO1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> targets_1 <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> io_lang_subs assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> io_targets_observable_singleton_ex singletonD<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">p1</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> targets_2 targets_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io</span>
                <span class="main">=</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> targets_pm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> state_components <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">.</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io</span>
                                      <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">×</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> card_cartesian_product_singleton<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> assm <span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">`</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">)</span> <span class="main">≠</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">.</span> <span class="bound">io</span> <span class="main">∈</span> L <span class="free">PM</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">io</span> <span class="keyword3"><span class="command">assume</span></span> io_assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">io</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∧</span> <span class="skolem">io</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> prefix_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntE language_state language_state_split<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> L <span class="free">PM</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> productF_language assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> singletons <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">t</span> <span class="main">.</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> io_targets_observable_singleton_ex observable_productF assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> card_targets <span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">`</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">=</span> card <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_R card_union_of_singletons
            <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_R <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_image_le<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> card_le <span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">`</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">&lt;</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">io1</span> <span class="main">∈</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">io2</span> <span class="main">∈</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">.</span> <span class="bound">io1</span> <span class="main">≠</span> <span class="bound">io2</span>
            <span class="main">∧</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io1</span> <span class="main">∩</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">io1</span><span class="main">∈</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">.</span> <span class="main">∃</span><span class="bound">io2</span><span class="main">∈</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">.</span> <span class="bound">io1</span> <span class="main">≠</span> <span class="bound">io2</span>
                  <span class="main">∧</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io1</span> <span class="main">∩</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io2</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">.</span> <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">.</span> <span class="bound">io1</span> <span class="main">=</span> <span class="bound">io2</span>
                  <span class="main">∨</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io1</span> <span class="main">∩</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">.</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_not_empty singletons<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">=</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> finite_R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> card_union_of_distinct
              <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
        <span class="keyword1"><span class="command">using</span></span> card_le card_targets <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">io1</span> <span class="bound">io2</span> <span class="main">.</span> <span class="bound">io1</span> <span class="main">∈</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>
                            <span class="main">∧</span> <span class="bound">io2</span> <span class="main">∈</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>
                            <span class="main">∧</span> <span class="bound">io1</span> <span class="main">≠</span> <span class="bound">io2</span>
                            <span class="main">∧</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io1</span> <span class="main">∩</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">io1</span> <span class="bound">io2</span> <span class="main">.</span> <span class="main">(</span><span class="bound">io1</span> <span class="main">∈</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">io2</span> <span class="main">∈</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">io1</span> <span class="main">≠</span> <span class="bound">io2</span><span class="main">)</span>
                                <span class="main">⟶</span> length <span class="bound">io1</span> <span class="main">≠</span> length <span class="bound">io2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span> <span class="bound">io2</span><span class="main">.</span> <span class="bound">io1</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">io2</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">io1</span> <span class="main">≠</span> <span class="bound">io2</span>
                  <span class="main">⟶</span> length <span class="bound">io1</span> <span class="main">≠</span> length <span class="bound">io2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io1</span></span> <span class="skolem"><span class="skolem">io2</span></span> <span class="keyword2"><span class="keyword">where</span></span> io_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io1</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                                          <span class="main">∧</span> <span class="skolem">io2</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                                          <span class="main">∧</span> <span class="skolem">io1</span> <span class="main">≠</span> <span class="skolem">io2</span>
                                          <span class="main">∧</span> length <span class="skolem">io1</span> <span class="main">=</span> length <span class="skolem">io2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">io1</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> prefix <span class="skolem">io2</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io1</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">io2</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_conv_conj prefixE<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
        <span class="keyword1"><span class="command">using</span></span> io_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io1</span></span> <span class="skolem"><span class="skolem">io2</span></span> <span class="keyword2"><span class="keyword">where</span></span> rep_ios_def <span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">io1</span> <span class="main">∈</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>
        <span class="main">∧</span> <span class="skolem">io2</span> <span class="main">∈</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>
        <span class="main">∧</span> length <span class="skolem">io1</span> <span class="main">&lt;</span> length <span class="skolem">io2</span>
        <span class="main">∧</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io1</span> <span class="main">∩</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_aci<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> linorder_neqE_nat<span class="main">)</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rep</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">rep</span><span class="main">)</span> <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io1</span> <span class="main">∩</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">rep</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="bound">rep</span><span class="main">)</span> <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io1</span> <span class="main">∩</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io2</span>
                        <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> Sigma <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="bound">f</span> <span class="main">∩</span> <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io1</span> <span class="main">∩</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io2</span><span class="main">)</span>
                 <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> inf.left_idem rep_ios_def state_components<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rep_state <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io1</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">rep</span><span class="main">)</span><span class="main">}</span>
                            <span class="main">∧</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io2</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">rep</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff rep_ios_def singletonD singletons<span class="main">)</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io1X</span></span> <span class="skolem"><span class="skolem">io2X</span></span> <span class="keyword2"><span class="keyword">where</span></span> rep_ios_split <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io1</span> <span class="main">=</span> <span class="free">vs</span> <span class="main">@</span> <span class="skolem">io1X</span>
                                            <span class="main">∧</span> prefix <span class="skolem">io1X</span> <span class="free">xs</span>
                                            <span class="main">∧</span> <span class="skolem">io2</span> <span class="main">=</span> <span class="free">vs</span> <span class="main">@</span> <span class="skolem">io2X</span>
                                            <span class="main">∧</span> prefix <span class="skolem">io2X</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rep_ios_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">io1</span> <span class="main">&gt;</span> length <span class="free">vs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rep_ios_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


    <span class="comment1">― ‹get a path from (initial PM) to (q2,q1)›</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">PM</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> inf_commute productF_language<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> L <span class="free">PM</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> language_state_prefix<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trV</span></span> <span class="keyword2"><span class="keyword">where</span></span> trV_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">tr</span> <span class="main">.</span> path <span class="free">PM</span> <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">vs</span> <span class="main">=</span> length <span class="bound">tr</span><span class="main">}</span>
                                      <span class="main">=</span> <span class="main">{</span> <span class="skolem">trV</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> observable_path_unique_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">PM</span>"</span></span><span class="main">]</span>
            assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>7<span class="main">)</span> observable_productF
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qv</span> <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">vs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trV_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> qv_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?qv</span> <span class="main">=</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> singletons assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?qv</span> <span class="main">∈</span> nodes <span class="free">PM</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trV_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


    <span class="comment1">― ‹get a path using io1X from the state reached by vs in PM›</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1X_all</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr1X_all_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">io1X</span> <span class="main">||</span> <span class="skolem">tr1X_all</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>
                                          <span class="main">∧</span> length <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">io1X</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr1X_all</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rep_ios_def rep_ios_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tr1X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr1X_all</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr1X_all</span> <span class="main">=</span> <span class="skolem">trV</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr1X_all</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>
            <span class="main">∧</span> length <span class="free">vs</span> <span class="main">=</span> length <span class="main">(</span>take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr1X_all</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tr1X_all_def trV_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> FSM.path_append_elim append_eq_conv_conj
            length_take zip_append1<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr1X_all</span> <span class="main">=</span> <span class="skolem">trV</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> trV_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tr1X_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io1X</span> <span class="main">||</span> <span class="var">?tr1X</span><span class="main">)</span> <span class="var">?qv</span> <span class="main">∧</span> length <span class="skolem">io1X</span> <span class="main">=</span> length <span class="var">?tr1X</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tr1X_all</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">+</span> length <span class="skolem">io1X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tr1X_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">io1X</span> <span class="main">=</span> length <span class="skolem">tr1X_all</span> <span class="main">-</span> length <span class="free">vs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> FSM.path_append_elim <span class="quoted"><span class="quoted">‹take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr1X_all</span> <span class="main">=</span> <span class="skolem">trV</span>›</span></span>
            length_drop tr1X_all_def zip_append1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> io1X_lang <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io1X</span> <span class="main">∈</span> language_state <span class="free">PM</span> <span class="var">?qv</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1X'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr1X'_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">tr</span> <span class="main">.</span> path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io1X</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="var">?qv</span> <span class="main">∧</span> length <span class="skolem">io1X</span> <span class="main">=</span> length <span class="bound">tr</span><span class="main">}</span>
                                          <span class="main">=</span> <span class="main">{</span> <span class="skolem">tr1X'</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> observable_path_unique_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="skolem">io1X</span></span> <span class="var"><span class="quoted"><span class="var">?qv</span></span></span><span class="main">]</span>
            assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>7<span class="main">)</span> observable_productF
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?tr1X</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">tr</span> <span class="main">.</span> path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io1X</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="var">?qv</span> <span class="main">∧</span> length <span class="skolem">io1X</span> <span class="main">=</span> length <span class="bound">tr</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tr1X_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> tr1x_unique <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tr1X'</span> <span class="main">=</span> <span class="var">?tr1X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">― ‹get a path using io2X from the state reached by vs in PM›</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr2X_all</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr2X_all_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">io2X</span> <span class="main">||</span> <span class="skolem">tr2X_all</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>
                                          <span class="main">∧</span> length <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">io2X</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr2X_all</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rep_ios_def rep_ios_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tr2X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr2X_all</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr2X_all</span> <span class="main">=</span> <span class="skolem">trV</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr2X_all</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>
            <span class="main">∧</span> length <span class="free">vs</span> <span class="main">=</span> length <span class="main">(</span>take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr2X_all</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tr2X_all_def trV_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> FSM.path_append_elim append_eq_conv_conj
            length_take zip_append1<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr2X_all</span> <span class="main">=</span> <span class="skolem">trV</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> trV_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tr2X_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io2X</span> <span class="main">||</span> <span class="var">?tr2X</span><span class="main">)</span> <span class="var">?qv</span> <span class="main">∧</span> length <span class="skolem">io2X</span> <span class="main">=</span> length <span class="var">?tr2X</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tr2X_all</span> <span class="main">=</span> length <span class="free">vs</span> <span class="main">+</span> length <span class="skolem">io2X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> tr2X_all_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">io2X</span> <span class="main">=</span> length <span class="skolem">tr2X_all</span> <span class="main">-</span> length <span class="free">vs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> FSM.path_append_elim <span class="quoted"><span class="quoted">‹take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr2X_all</span> <span class="main">=</span> <span class="skolem">trV</span>›</span></span>
            length_drop tr2X_all_def zip_append1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> io2X_lang <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io2X</span> <span class="main">∈</span> language_state <span class="free">PM</span> <span class="var">?qv</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr2X'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr2X'_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">tr</span> <span class="main">.</span> path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io2X</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="var">?qv</span> <span class="main">∧</span> length <span class="skolem">io2X</span> <span class="main">=</span> length <span class="bound">tr</span><span class="main">}</span>
                                          <span class="main">=</span> <span class="main">{</span> <span class="skolem">tr2X'</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> observable_path_unique_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="skolem">io2X</span></span> <span class="var"><span class="quoted"><span class="var">?qv</span></span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>7<span class="main">)</span> observable_productF
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?tr2X</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">tr</span> <span class="main">.</span> path <span class="free">PM</span> <span class="main">(</span><span class="skolem">io2X</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="var">?qv</span> <span class="main">∧</span> length <span class="skolem">io2X</span> <span class="main">=</span> length <span class="bound">tr</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tr2X_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> tr2x_unique <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tr2X'</span> <span class="main">=</span> <span class="var">?tr2X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="comment1">― ‹both paths reach the same state›</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">io1X</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">rep</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rep_state rep_ios_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="var">?qv</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> rep_via_1 <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="var">?qv</span> <span class="skolem">io1X</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">rep</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> obs_PM observable_io_targets_split<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rep_tgt_1 <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">io1X</span> <span class="main">||</span> <span class="skolem">tr1X'</span><span class="main">)</span> <span class="var">?qv</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">rep</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> obs_PM observable_io_target_unique_target<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">PM</span></span> <span class="var"><span class="quoted"><span class="var">?qv</span></span></span> <span class="quoted"><span class="skolem">io1X</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">rep</span><span class="main">)</span>"</span></span><span class="main">]</span> tr1X'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> length_1 <span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">io1X</span> <span class="main">||</span> <span class="skolem">tr1X'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="free">vs</span> <span class="main">&lt;</span> length <span class="skolem">io1</span>›</span></span> rep_ios_split tr1X_def tr1x_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> tr1X_alt_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tr1X'</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io1X</span><span class="main">)</span> <span class="free">tr</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> obs_PM observable_path_prefix qv_simp
          rep_ios_split tr1X_def tr1x_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io1X</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io1X</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rep_ios_split <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_conv_conj prefixE<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">io1X</span> <span class="main">||</span> <span class="skolem">tr1X'</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io1X</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> take_zip<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">io1X</span> <span class="main">||</span> <span class="skolem">tr1X'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io1X</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io1X</span><span class="main">)</span> <span class="free">xs</span>›</span></span> assms<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> length_take length_zip
          nat_le_linear take_all tr1X_def tr1x_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> rep_idx_1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="var">?qv</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="main">(</span>length <span class="skolem">io1X</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">rep</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def Suc_less_eq Suc_pred rep_tgt_1 length_1
          less_Suc_eq_le map_snd_zip scan_length scan_nth states_alt_def tr1X_def tr1x_unique<span class="main">)</span>


    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">io2X</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">rep</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rep_state rep_ios_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="var">?qv</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> rep_via_2 <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="var">?qv</span> <span class="skolem">io2X</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">rep</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> obs_PM observable_io_targets_split<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rep_tgt_2 <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">io2X</span> <span class="main">||</span> <span class="skolem">tr2X'</span><span class="main">)</span> <span class="var">?qv</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">rep</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> obs_PM observable_io_target_unique_target<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">PM</span></span> <span class="var"><span class="quoted"><span class="var">?qv</span></span></span> <span class="quoted"><span class="skolem">io2X</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">rep</span><span class="main">)</span>"</span></span><span class="main">]</span> tr2X'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> length_2 <span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">io2X</span> <span class="main">||</span> <span class="skolem">tr2X'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹length <span class="free">vs</span> <span class="main">&lt;</span> length <span class="skolem">io1</span>›</span></span> append.right_neutral length_0_conv length_zip less_asym min.idem neq0_conv rep_ios_def rep_ios_split tr2X_def tr2x_unique<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> tr2X_alt_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tr2X'</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io2X</span><span class="main">)</span> <span class="free">tr</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> obs_PM observable_path_prefix qv_simp rep_ios_split tr2X_def tr2x_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io2X</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io2X</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rep_ios_split <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_conv_conj prefixE<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">io2X</span> <span class="main">||</span> <span class="skolem">tr2X'</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io2X</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> take_zip<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">io2X</span> <span class="main">||</span> <span class="skolem">tr2X'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> rep_idx_2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="var">?qv</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="main">(</span>length <span class="skolem">io2X</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">rep</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def Suc_less_eq Suc_pred rep_tgt_2 length_2
          less_Suc_eq_le map_snd_zip scan_length scan_nth states_alt_def tr2X_def tr2x_unique<span class="main">)</span>


    <span class="comment1">― ‹thus the distinctness assumption is violated›</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">io1X</span> <span class="main">≠</span> length <span class="skolem">io2X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">io1X</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io1X</span><span class="main">)</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io2X</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io2X</span><span class="main">)</span> <span class="free">xs</span>›</span></span> less_irrefl
          rep_ios_def rep_ios_split<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="var">?qv</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="main">(</span>length <span class="skolem">io1X</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>
                    <span class="main">=</span> <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="var">?qv</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="main">(</span>length <span class="skolem">io2X</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rep_idx_1 rep_idx_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>distinct <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="var">?qv</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_less_eq <span class="quoted"><span class="quoted">‹<span class="skolem">io1X</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io1X</span><span class="main">)</span> <span class="free">xs</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">io1X</span> <span class="main">||</span> <span class="skolem">tr1X'</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io1X</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io2X</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io2X</span><span class="main">)</span> <span class="free">xs</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">io2X</span> <span class="main">||</span> <span class="skolem">tr2X'</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">io2X</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹length <span class="main">(</span><span class="skolem">io1X</span> <span class="main">||</span> <span class="skolem">tr1X'</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span><span class="skolem">io2X</span> <span class="main">||</span> <span class="skolem">tr2X'</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span>›</span></span>
          assms<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> diff_Suc_1 distinct_conv_nth gr0_conv_Suc le_imp_less_Suc length_1 length_2
          length_take map_snd_zip scan_length states_alt_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> states_alt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="ASC_LB-R_state_component_2"><span class="command">lemma</span></span> R_state_component_2 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">io</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> io_targets_observable_singleton_ex <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> singletonD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ASC_LB-R_union_card_is_suffix_length"><span class="command">lemma</span></span> R_union_card_is_suffix_length <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">io</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.neutral<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> R_update <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span> <span class="main">.</span> R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">q</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">io</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                                    <span class="keyword1">then</span> insert <span class="main">(</span><span class="free">io</span><span class="main">@</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span>
                                    <span class="keyword1">else</span> R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">io</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> io_targets_observable_singleton_ex snoc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="free">M2</span> <span class="skolem">q</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span><span class="free">io</span><span class="main">@</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R_update <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">io</span><span class="main">@</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_insert_disjoint finite_R<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> FSM.nodes.initial <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">io</span><span class="main">@</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span>›</span></span>
        insertI1 io_targets_nodes<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q'</span> <span class="main">.</span> <span class="bound">q'</span> <span class="main">≠</span> <span class="skolem">q</span> <span class="main">⟶</span> R <span class="free">M2</span> <span class="bound">q'</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> R <span class="free">M2</span> <span class="bound">q'</span> <span class="free">io</span> <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">io</span><span class="main">@</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span>›</span></span> R_update
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q'</span> <span class="main">.</span> <span class="bound">q'</span> <span class="main">≠</span> <span class="skolem">q</span> <span class="main">⟶</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q'</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q'</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="main">(</span>nodes <span class="free">M2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="main">(</span>nodes <span class="free">M2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="main">(</span>nodes <span class="free">M2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>card <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="main">(</span>nodes <span class="free">M2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>card <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="bound">c</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span>infinite <span class="bound">C</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">c</span><span class="main">::</span><span class="tfree">'c</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">C</span><span class="main">)</span> <span class="main">∨</span> sum <span class="bound">f</span> <span class="bound">C</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">c</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> sum <span class="bound">f</span> <span class="main">(</span><span class="bound">C</span> <span class="main">-</span> <span class="main">{</span><span class="bound">c</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> sum.remove<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="main">(</span>nodes <span class="free">M2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>card <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>
                <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="main">(</span>nodes <span class="free">M2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>card <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> nodes <span class="free">M2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">=</span> Suc <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> snoc.IH snoc.prems language_state_prefix<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">io</span><span class="main">@</span><span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">io</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">⟹</span> <span class="free">io</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M2</span>›</span></span>
          <span class="quoted"><span class="quoted">‹OFSM <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">io</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> L <span class="free">M2</span>›</span></span> append.assoc snoc.IH<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">xs</span>›</span></span> length_append_singleton<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_LB-R_state_repetition_via_long_sequence"><span class="command">lemma</span></span> R_state_repetition_via_long_sequence <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"card <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">m</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">M</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span> <span class="main">∈</span> nodes <span class="free">M</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>R <span class="free">M</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> nodes <span class="free">M</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span> <span class="main">≤</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> sum_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">m</span><span class="main">)</span> <span class="main">≤</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R_union_card_is_suffix_length<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> assms<span class="main">(</span>4<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_LB-R_state_repetition_distribution"><span class="command">lemma</span></span> R_state_repetition_distribution <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">M</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span> <span class="main">∈</span> nodes <span class="free">M</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>R <span class="free">M</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> nodes <span class="free">M</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span> <span class="main">≤</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> sum_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span><span class="main">*</span><span class="free">m</span><span class="main">)</span> <span class="main">≤</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R_union_card_is_suffix_length<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Function RP ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">RP</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> extends function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">MR</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> by adding all elements from a set of
IO-sequences that also reach the given state.
›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">RP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list
            <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list set
            <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">RP</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">V''</span></span></span> <span class="main">=</span> R <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>
                      <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">vs'</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V''</span></span></span> <span class="main">.</span> io_targets <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="bound">vs'</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="ASC_LB-RP_from_R"><span class="command">lemma</span></span> RP_from_R<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
        <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">vs'</span> <span class="main">∈</span> <span class="free">V''</span> <span class="main">.</span> <span class="bound">vs'</span> <span class="main">∉</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">∧</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> insert <span class="bound">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">vs'</span><span class="main">∈</span><span class="free">V''</span><span class="main">.</span> <span class="bound">vs'</span> <span class="main">∉</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">∧</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> insert <span class="bound">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">⊆</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">⊆</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">∪</span> <span class="free">V''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs1</span></span> <span class="skolem"><span class="skolem">vs2</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs_def <span class="main">:</span>
       <span class="quoted"><span class="quoted">"<span class="skolem">vs1</span> <span class="main">≠</span> <span class="skolem">vs2</span> <span class="main">∧</span> <span class="skolem">vs1</span> <span class="main">∈</span> <span class="free">V''</span> <span class="main">∧</span> <span class="skolem">vs2</span> <span class="main">∈</span> <span class="free">V''</span>
        <span class="main">∧</span> <span class="skolem">vs1</span> <span class="main">∉</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">vs2</span> <span class="main">∉</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
        <span class="main">∧</span> <span class="skolem">vs1</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">∧</span> <span class="skolem">vs2</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">vs1</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">∧</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">vs2</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> RP.simps Un_iff mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">vs1</span> <span class="main">=</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">vs2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def <span class="main">:</span> <span class="quoted"><span class="quoted">"is_det_state_cover_ass <span class="free">M2</span> <span class="skolem">f</span> <span class="main">∧</span> <span class="free">V</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">`</span> d_reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> image <span class="skolem">f</span> <span class="main">(</span>d_reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">vs1</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">∧</span> map fst <span class="skolem">vs2</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> perm_inputs vs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="keyword2"><span class="keyword">where</span></span> r_def <span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">r1</span> <span class="main">=</span> map fst <span class="skolem">vs1</span> <span class="main">∧</span> <span class="skolem">r1</span> <span class="main">∈</span> d_reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">r2</span> <span class="main">=</span> map fst <span class="skolem">vs2</span> <span class="main">∧</span> <span class="skolem">r2</span> <span class="main">∈</span> d_reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reaches <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">vs1</span><span class="main">)</span> <span class="skolem">r1</span>"</span></span>
            <span class="quoted"><span class="quoted">"d_reaches <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">vs2</span><span class="main">)</span> <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f_def is_det_state_cover_ass.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">vs1</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">r1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_reaches_io_target<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">vs1</span>"</span></span> <span class="quoted"><span class="skolem">r1</span></span> <span class="quoted"><span class="quoted">"map snd <span class="skolem">vs1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">vs2</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">r2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> d_reaches_io_target<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">vs2</span>"</span></span> <span class="quoted"><span class="skolem">r2</span></span> <span class="quoted"><span class="quoted">"map snd <span class="skolem">vs2</span>"</span></span><span class="main">]</span>
          <span class="quoted"><span class="quoted">‹d_reaches <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">vs2</span><span class="main">)</span> <span class="skolem">r2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">=</span> <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">vs1</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">∧</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">vs2</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">vs1</span> <span class="main">≠</span> map fst <span class="skolem">vs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> perm_inputs_diff vs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">≠</span> <span class="skolem">r2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r_def<span class="main">(</span>1<span class="main">)</span> r_def<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r1</span> <span class="main">=</span> <span class="skolem">r2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_LB-finite_RP"><span class="command">lemma</span></span> finite_RP <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms RP_from_R finite_R <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_insert<span class="main">)</span>




<span class="keyword1" id="ASC_LB-RP_count"><span class="command">lemma</span></span> RP_count <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s'</span> <span class="main">∈</span> set <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> map fst <span class="free">tr</span><span class="main">)</span> <span class="free">q2</span><span class="main">)</span> <span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">.</span> d_reaches <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="bound">v</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹each sequence in the set calculated by RP reaches a different state in M1›</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="comment1">― ‹Proof sketch:
     - RP calculates either the same set as R or the set of R and an additional element
     - in the first case, the result for R applies
     - in the second case, the additional element is not contained in the set calcualted by R due to
       the assumption that no state reached by a non-empty prefix of xs after vs is also reached by
       some sequence in V (see the last two assumptions)›</span>


  <span class="keyword1"><span class="command">have</span></span> RP_cases <span class="main">:</span> <span class="quoted"><span class="quoted">"RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                    <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">vs'</span> <span class="main">∈</span> <span class="free">V''</span> <span class="main">.</span> <span class="bound">vs'</span> <span class="main">∉</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                                      <span class="main">∧</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> insert <span class="bound">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RP_from_R assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> R_count assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs'_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">∈</span> <span class="free">V''</span>
                                      <span class="main">∧</span> <span class="skolem">vs'</span> <span class="main">∉</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                                      <span class="main">∧</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> insert <span class="skolem">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RP_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> obs_PM <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">PM</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> observable_productF assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> state_component_2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">.</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="bound">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">io</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> io_targets_observable_singleton_ex <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> singletonD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>13<span class="main">)</span> perm_language vs'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> s'_def <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">vs'</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s'</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> io_targets_observable_singleton_ob<span class="main">)</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">s'</span> <span class="main">∉</span> <span class="main">⋃</span><span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">`</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs'_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs'</span><span class="main">.</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xs'</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="bound">xs'</span><span class="main">)</span>
                          <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pps</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'c</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list"</span></span>
          <span class="keyword2"><span class="keyword">where</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v3</span><span class="main">.</span> <span class="bound">v3</span> <span class="main">∈</span> <span class="bound">x0</span> <span class="main">∧</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="bound">v3</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pps</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x0</span> <span class="main">∧</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">(</span><span class="skolem">pps</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pps</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s'</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                        <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pps</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>
                                              <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">s'</span> <span class="main">∉</span> <span class="main">⋃</span><span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">`</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> <span class="skolem">pps</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">ps</span>
                        <span class="main">∧</span> <span class="bound">ps</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> prefix <span class="bound">ps</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="bound">ps</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> f2 a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr'_def <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">||</span> <span class="skolem">tr'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>
                                        <span class="main">∧</span> length <span class="skolem">tr'</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trV'</span></span> <span class="skolem"><span class="skolem">trX'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr'_split <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trV'</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr'</span>"</span></span>
                                              <span class="quoted"><span class="quoted">"<span class="skolem">trX'</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr'</span>"</span></span>
                                              <span class="quoted"><span class="quoted">"<span class="skolem">tr'</span> <span class="main">=</span> <span class="skolem">trV'</span> <span class="main">@</span> <span class="skolem">trX'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">trV'</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> FSM.path_append_elim <span class="quoted"><span class="quoted">‹<span class="skolem">trV'</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="skolem">tr'</span>›</span></span>
            append_eq_conv_conj length_take tr'_def zip_append1<span class="main">)</span>




      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">PM</span> <span class="main">=</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> language_state_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q1</span><span class="main">}</span>"</span></span>
                      <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> productF_path_io_targets<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">FAIL</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">PM</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"initial <span class="free"><span class="free">M2</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"initial <span class="free"><span class="free">M1</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">vs</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">q2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">q1</span></span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span>
            io_targets_observable_singleton_ex singletonD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="free">q2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">trV'</span> <span class="main">=</span> length <span class="free">vs</span>›</span></span> io_target_target
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> path_xs' <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">||</span> <span class="skolem">trX'</span><span class="main">)</span> <span class="free">q2</span> <span class="main">∧</span> length <span class="skolem">trX'</span> <span class="main">=</span> length <span class="skolem">xs'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> FSM.path_append_elim
            <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">trV'</span> <span class="main">=</span> length <span class="free">vs</span>›</span></span>
            <span class="quoted"><span class="quoted">‹target <span class="main">(</span><span class="free">vs</span> <span class="main">||</span> <span class="skolem">trV'</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="free">q2</span>›</span></span> append_eq_conv_conj length_drop tr'_def
            tr'_split<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tr'_split<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zip_append2<span class="main">)</span>


      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> state_component_2 xs'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="free">q2</span> <span class="skolem">xs'</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> observable_io_targets_split <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> target_xs' <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">xs'</span> <span class="main">||</span> <span class="skolem">trX'</span><span class="main">)</span> <span class="free">q2</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> io_target_target path_xs' <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xs'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>states <span class="main">(</span><span class="skolem">xs'</span> <span class="main">||</span> <span class="skolem">trX'</span><span class="main">)</span> <span class="free">q2</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> path_xs' target_in_states <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>states <span class="main">(</span><span class="skolem">xs'</span> <span class="main">||</span> <span class="skolem">trX'</span><span class="main">)</span> <span class="free">q2</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">xs'</span>›</span></span> path_xs' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> states_xs' <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> set <span class="main">(</span>states <span class="main">(</span><span class="skolem">xs'</span> <span class="main">||</span> <span class="skolem">trX'</span><span class="main">)</span> <span class="free">q2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> last_in_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q'</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> io_targets_observable_singleton_ob<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="free">q2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>›</span></span>
              observable_io_targets_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="skolem">q'</span></span> <span class="quoted"><span class="free">q2</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> map fst <span class="free">tr</span> <span class="main">||</span> map snd <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>
                      <span class="main">∧</span> length <span class="free">xs</span> <span class="main">=</span> length <span class="main">(</span>map fst <span class="free">tr</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>7<span class="main">)</span> assms<span class="main">(</span>9<span class="main">)</span> assms<span class="main">(</span>10<span class="main">)</span> productF_path_unzip <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> language_state <span class="free">PM</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>9<span class="main">)</span> assms<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>›</span></span> io_targets_nodes
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial insertI1<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">M1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q1</span><span class="main">}</span>›</span></span> io_targets_nodes
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial insertI1<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> path_xs <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> map fst <span class="free">tr</span><span class="main">)</span> <span class="free">q2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> productF_path_reverse_ob_2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">tr</span>"</span></span> <span class="quoted"><span class="quoted">"map snd <span class="free">tr</span>"</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="free">q2</span></span> <span class="quoted"><span class="free">q1</span></span><span class="main">]</span>
              assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">xs'</span> <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xs'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trX'</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">tr</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">PM</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> map fst <span class="free">tr</span> <span class="main">||</span> map snd <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">xs</span> <span class="main">=</span> length <span class="main">(</span>map fst <span class="free">tr</span><span class="main">)</span>›</span></span>
              assms<span class="main">(</span>3<span class="main">)</span> path_xs'
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> observable_path_prefix<span class="main">)</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> states_xs <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> set <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> map fst <span class="free">tr</span><span class="main">)</span> <span class="free">q2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> in_set_takeD length_map map_snd_zip path_xs' states_alt_def states_xs'<span class="main">)</span>



      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reaches <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">vs'</span><span class="main">)</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fV</span></span> <span class="keyword2"><span class="keyword">where</span></span> fV_def <span class="main">:</span> <span class="quoted"><span class="quoted">"is_det_state_cover_ass <span class="free">M2</span> <span class="skolem">fV</span>
                                  <span class="main">∧</span> <span class="free">V</span> <span class="main">=</span> <span class="skolem">fV</span> <span class="main">`</span> d_reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>12<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> image <span class="skolem">fV</span> <span class="main">(</span>d_reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> fV_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">vs'</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> perm_inputs vs'_def assms<span class="main">(</span>13<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qv</span></span> <span class="keyword2"><span class="keyword">where</span></span> qv_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">fV</span> <span class="skolem">qv</span> <span class="main">=</span> map fst <span class="skolem">vs'</span> <span class="main">∧</span> <span class="skolem">qv</span><span class="main">∈</span> d_reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reaches <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">vs'</span><span class="main">)</span> <span class="skolem">qv</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fV_def is_det_state_cover_ass.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">vs'</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">qv</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> d_reaches_io_target<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">vs'</span>"</span></span> <span class="quoted"><span class="skolem">qv</span></span> <span class="quoted"><span class="quoted">"map snd <span class="skolem">vs'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">vs'</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vs'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> RP.simps Un_iff insertI1 mem_Collect_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qv</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹d_reaches <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">vs'</span><span class="main">)</span> <span class="skolem">qv</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> perm_inputs states_xs vs'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">=</span> insert <span class="skolem">s'</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> finite_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">⟹</span> finite <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">a</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> language_state_prefix <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntD1 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prefix_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> io_targets_observable_singleton_ob <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> card_insert_disjoint<span class="main">)</span>


    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vs'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> R_count<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="free">q2</span></span> <span class="quoted"><span class="free">q1</span></span> <span class="quoted"><span class="free">tr</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>2-9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vs'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_insert_if finite_R<span class="main">)</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ASC_LB-RP_state_component_2"><span class="command">lemma</span></span> RP_state_component_2 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> RP.simps R_state_component_2 Un_iff assms mem_Collect_eq<span class="main">)</span>


<span class="keyword1" id="ASC_LB-RP_io_targets_split"><span class="command">lemma</span></span> RP_io_targets_split <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span>
        <span class="main">=</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">io</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">io</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> RP_cases <span class="main">:</span> <span class="quoted"><span class="quoted">"RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                    <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">vs'</span> <span class="main">∈</span> <span class="free">V''</span> <span class="main">.</span> <span class="bound">vs'</span> <span class="main">∉</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                                      <span class="main">∧</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> insert <span class="bound">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RP_from_R assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> io_prefix <span class="main">:</span> <span class="quoted"><span class="quoted">"prefix <span class="free">io</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> io_lang_subs <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∧</span> <span class="free">io</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> prefix_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntE language_state language_state_split<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> io_lang_inter <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> io_lang_pm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> L <span class="free">PM</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> productF_language assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">p1</span><span class="main">)</span> <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> calculation insert_absorb insert_ident insert_not_empty
          io_targets_observable_singleton_ob observable_productF singleton_insert_inj_eq subrelI<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> targets_pm <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">p1</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms io_targets_observable_singleton_ex singletonD
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> observable_productF<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trP</span></span> <span class="keyword2"><span class="keyword">where</span></span> trP_def <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">trP</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">p1</span><span class="main">)</span>
                                      <span class="main">∧</span> path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">trP</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">trP</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">trP</span><span class="main">.</span> target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">trP</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span> <span class="skolem">p1</span><span class="main">)</span>
                          <span class="main">∧</span> path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">trP</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="bound">trP</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p2</span><span class="main">,</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">∧</span> path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>
                                                           <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="bound">ps</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">p2</span><span class="main">,</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> trP_unique <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">tr</span> <span class="main">.</span> path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="bound">tr</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">trP</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> observable_productF observable_path_unique_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="free">io</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">PM</span>"</span></span><span class="main">]</span>
            io_lang_pm assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>7<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pps</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span> <span class="main">×</span> <span class="tfree">'c</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">ps</span><span class="main">.</span> path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">ps</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="bound">ps</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">pps</span><span class="main">}</span>
              <span class="main">∨</span> <span class="main">¬</span> observable <span class="free">PM</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">⟦</span>observable <span class="free">PM</span><span class="main">;</span> <span class="free">io</span> <span class="main">∈</span> L <span class="free">PM</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">tr</span><span class="main">.</span>
                              <span class="main">{</span><span class="bound">t</span><span class="main">.</span> path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="bound">t</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">tr</span><span class="main">}</span>
                               <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span>
            io_lang_pm<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">PM</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹observable <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹observable <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> observable_productF<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">trP</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">pps</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 trP_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>


    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trIO2</span></span> <span class="keyword2"><span class="keyword">where</span></span> trIO2_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">tr</span> <span class="main">.</span> path <span class="free">M2</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="bound">tr</span><span class="main">}</span>
                                    <span class="main">=</span> <span class="main">{</span> <span class="skolem">trIO2</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> observable_path_unique_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">io</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span><span class="main">]</span> io_lang_subs assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">trIO1</span></span> <span class="keyword2"><span class="keyword">where</span></span> trIO1_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">tr</span> <span class="main">.</span> path <span class="free">M1</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="bound">tr</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="bound">tr</span><span class="main">}</span>
                                    <span class="main">=</span> <span class="main">{</span> <span class="skolem">trIO1</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> observable_path_unique_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">io</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M1</span>"</span></span><span class="main">]</span> io_lang_subs assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">trIO2</span> <span class="main">||</span> <span class="skolem">trIO1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>
          <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">trIO2</span> <span class="main">∧</span> length <span class="skolem">trIO2</span> <span class="main">=</span> length <span class="skolem">trIO1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">trIO2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">trIO2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> trIO2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">trIO1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">trIO1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> trIO1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">trIO2</span> <span class="main">=</span> length <span class="skolem">trIO1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f2 f1 assms<span class="main">(</span>4<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> trP_split <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">trIO2</span> <span class="main">||</span> <span class="skolem">trIO1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span>
                           <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">trIO2</span> <span class="main">∧</span> length <span class="skolem">trIO2</span> <span class="main">=</span> length <span class="skolem">trIO1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> trP_zip <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">trIO2</span> <span class="main">||</span> <span class="skolem">trIO1</span> <span class="main">=</span> <span class="skolem">trP</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trP_def trP_unique length_zip <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">trIO2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p2</span>
            <span class="main">∧</span> path <span class="free">M2</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">trIO2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>
            <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">trIO2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trP_zip trP_split assms<span class="main">(</span>6<span class="main">)</span> trP_def trIO2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> targets_2 <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> observable_io_target_is_singleton<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">trIO1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p1</span>
          <span class="main">∧</span> path <span class="free">M1</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">trIO1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>
          <span class="main">∧</span> length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">trIO1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> trP_zip trP_split assms<span class="main">(</span>6<span class="main">)</span> trP_def trIO1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> targets_1 <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> io_lang_subs assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> io_targets_observable_singleton_ex singletonD<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">io</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">p2</span><span class="main">,</span><span class="skolem">p1</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> targets_2 targets_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span>
                <span class="main">=</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">io</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">io</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> targets_pm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∉</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">∧</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> insert <span class="free">io</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RP_cases assms<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insertE<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>8<span class="main">)</span> perm_language assms<span class="main">(</span>9<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> s'_def <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s'</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> io_targets_observable_singleton_ob<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr1_def <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s'</span>
                                      <span class="main">∧</span> path <span class="free">M1</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">tr1</span> <span class="main">=</span> length <span class="free">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> io_targets_elim singletonI<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>9<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> RP_state_component_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr2</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr2_def <span class="main">:</span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>
                                      <span class="main">∧</span> path <span class="free">M2</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">tr2</span> <span class="main">=</span> length <span class="free">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> io_targets_elim singletonI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> paths <span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">∧</span> path <span class="free">M1</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tr1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">io</span> <span class="main">=</span> length <span class="skolem">tr2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tr2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tr2</span> <span class="main">=</span> length <span class="skolem">tr1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tr1_def tr2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr2</span> <span class="main">||</span> <span class="skolem">tr1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> paths
            productF_path_forward<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">io</span></span> <span class="quoted"><span class="skolem">tr2</span></span> <span class="quoted"><span class="skolem">tr1</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M1</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">io</span> <span class="main">||</span> <span class="skolem">tr2</span> <span class="main">||</span> <span class="skolem">tr1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tr1_def tr2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">tr2</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">=</span> length <span class="free">io</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tr1_def tr2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> initial <span class="free">PM</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> io_target_from_path length_zip tr1_def tr2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">PM</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>6<span class="main">)</span> observable_productF <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> calculation observable_io_target_is_singleton<span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">io</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s'</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>





<span class="keyword1" id="ASC_LB-RP_io_targets_finite_M1"><span class="command">lemma</span></span> RP_io_targets_finite_M1 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_RP assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">⟹</span> finite <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> RP_cases <span class="main">:</span> <span class="quoted"><span class="quoted">"RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                      <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">vs'</span> <span class="main">∈</span> <span class="free">V''</span> <span class="main">.</span> <span class="bound">vs'</span> <span class="main">∉</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                                        <span class="main">∧</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> insert <span class="bound">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RP_from_R assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">a</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> language_state_prefix <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntD1 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prefix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">V''</span> <span class="main">∧</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> insert <span class="skolem">a</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> RP_cases <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insertE<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> perm_language<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> io_targets_observable_singleton_ob <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_LB-RP_io_targets_finite_PM"><span class="command">lemma</span></span> RP_io_targets_finite_PM <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">.</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io</span>
                                    <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">io</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io</span>
                <span class="main">=</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms RP_io_targets_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">V''</span></span> <span class="quoted"><span class="skolem">io</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> RP_state_component_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">io</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">V''</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">×</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">×</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="free">s</span><span class="main">}</span> <span class="main">×</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>7<span class="main">,</span>8<span class="main">)</span> RP_io_targets_finite_M1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">V''</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="ASC_LB-RP_union_card_is_suffix_length"><span class="command">lemma</span></span> RP_union_card_is_suffix_length <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">io</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span> <span class="main">≥</span> length <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> R_union_card_is_suffix_length<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> RP_from_R assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> card_insert_le eq_iff finite_R<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span> <span class="main">≥</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>›</span></span>
        <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">q</span> <span class="free">io</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>›</span></span> sum_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_LB-RP_state_repetition_distribution_productF"><span class="command">lemma</span></span> RP_state_repetition_distribution_productF <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">(</span>card <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"card <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span> <span class="main">∈</span> nodes <span class="free">M2</span> <span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card<span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_cartesian_product <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> product_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nodes <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span> <span class="main">*</span> card <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="main">|</span><span class="free">M1</span><span class="main">|</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>›</span></span>
        <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹nodes <span class="main">(</span>product <span class="free">M2</span> <span class="free">M1</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">×</span> nodes <span class="free">M1</span>›</span></span>
        card_mono finite_cartesian_product<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> nodes <span class="free">M2</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">q</span> <span class="main">∈</span> nodes <span class="free">M2</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> nodes <span class="free">M2</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span><span class="main">∈</span>nodes <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q'</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
            nat_neq_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>
          <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q'</span><span class="main">}</span><span class="main">)</span>
            <span class="main">+</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">q'</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span><span class="main">∈</span>nodes <span class="free">M2</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>›</span></span> empty_subsetI insert_subset sum.subset_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q'</span><span class="main">}</span><span class="main">)</span>
                    <span class="main">≤</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q'</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> nodes <span class="free">M2</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> sum_mono DiffD1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">q'</span><span class="main">}</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q'</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span> <span class="main">&lt;</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="bound">c</span> <span class="bound">f</span><span class="main">.</span> infinite <span class="bound">C</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">c</span><span class="main">::</span><span class="tfree">'c</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">C</span> <span class="main">∨</span> sum <span class="bound">f</span> <span class="bound">C</span> <span class="main">=</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">c</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> sum <span class="bound">f</span> <span class="main">(</span><span class="bound">C</span> <span class="main">-</span> <span class="main">{</span><span class="bound">c</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> sum.remove<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">c</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">c</span><span class="main">∈</span>nodes <span class="free">M2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q'</span><span class="main">}</span><span class="main">.</span> <span class="free">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="main">∈</span> nodes <span class="free">M2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q'</span><span class="main">}</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q'</span><span class="main">}</span><span class="main">.</span> <span class="free">m</span><span class="main">)</span>›</span></span>
              <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q'</span><span class="main">}</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>
                <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="main">{</span><span class="skolem">q'</span><span class="main">}</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>›</span></span>
              <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span><span class="main">{</span><span class="skolem">q'</span><span class="main">}</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">m</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>


    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="free">m</span><span class="main">)</span> <span class="main">≤</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> R_union_card_is_suffix_length<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> assms<span class="main">(</span>5<span class="main">,</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∑</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span> <span class="main">≤</span> length <span class="free">xs</span>›</span></span> calculation less_eq_Suc_le not_less_eq_eq<span class="main">)</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span>

    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>R <span class="free">M2</span> <span class="var">?q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">V''</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> perm_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="var">?q</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∉</span> R <span class="free">M2</span> <span class="var">?q</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>RP <span class="free">M2</span> <span class="var">?q</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">≥</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="var">?q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> finite_RP<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span><span class="main">,</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> RP.simps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>RP <span class="free">M2</span> <span class="var">?q</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">&gt;</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="var">?q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="bound">na</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="bound">na</span> <span class="main">∨</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">na</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">na</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_neq_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"RP <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">≠</span> R <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">∉</span> R <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="free">xs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> RP_from_R
                     <span class="quoted"><span class="quoted">‹card <span class="main">(</span>R <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>›</span></span>
                     assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> card_insert_disjoint finite_R le_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>R <span class="free">M2</span> <span class="var">?q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">m</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>nodes <span class="free">M2</span><span class="main">.</span> <span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="bound">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">∈</span>nodes <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">q</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">≥</span> card <span class="main">(</span>R <span class="free">M2</span> <span class="skolem">q</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_R<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> finite_RP<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span><span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> RP.simps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">q</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> nodes <span class="free">M2</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">q</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Conditions for the result of LB to be a valid lower bound ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following predicates describe the assumptions necessary to show that the value calculated by
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">LB</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a lower bound on the number of states of a given FSM.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Prereq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list
              <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'in</span> list set <span class="main">⇒</span> <span class="tfree">'state1</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set
              <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Prereq</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V''</span></span></span> <span class="main">=</span> <span class="main">(</span>
    <span class="main">(</span>finite <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">∈</span> L <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">∩</span> L <span class="free"><span class="bound"><span class="entity">M1</span></span></span>
    <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊆</span> nodes <span class="free"><span class="bound"><span class="entity">M2</span></span></span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">.</span> <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span>
        <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">io1</span> <span class="main">∈</span> RP <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="bound">s1</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">V''</span></span></span> <span class="main">.</span>
               <span class="main">∀</span> <span class="bound">io2</span> <span class="main">∈</span> RP <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="bound">s2</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">V''</span></span></span> <span class="main">.</span>
                 B <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="bound">io1</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">≠</span> B <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="bound">io2</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Rep_Pre</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list
                <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Rep_Pre</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">xs1</span> <span class="bound">xs2</span> <span class="main">.</span> prefix <span class="bound">xs1</span> <span class="bound">xs2</span> <span class="main">∧</span> prefix <span class="bound">xs2</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∧</span> <span class="bound">xs1</span> <span class="main">≠</span> <span class="bound">xs2</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s2</span> <span class="main">.</span> io_targets <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="bound">xs1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s2</span><span class="main">}</span>
              <span class="main">∧</span> io_targets <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="bound">xs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s2</span><span class="main">}</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s1</span> <span class="main">.</span> io_targets <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="bound">xs1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s1</span><span class="main">}</span>
              <span class="main">∧</span> io_targets <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="bound">xs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Rep_Cov</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list set
                <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Rep_Cov</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">V''</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">xs'</span> <span class="bound">vs'</span> <span class="main">.</span> <span class="bound">xs'</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> prefix <span class="bound">xs'</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∧</span> <span class="bound">vs'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V''</span></span></span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s2</span> <span class="main">.</span> io_targets <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="bound">xs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s2</span><span class="main">}</span>
              <span class="main">∧</span> io_targets <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">vs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s2</span><span class="main">}</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s1</span> <span class="main">.</span> io_targets <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">@</span> <span class="bound">xs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s1</span><span class="main">}</span>
              <span class="main">∧</span> io_targets <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">(</span>initial <span class="free"><span class="bound"><span class="entity">M1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">vs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s1</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1" id="ASC_LB-distinctness_via_Rep_Pre"><span class="command">lemma</span></span> distinctness_via_Rep_Pre <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> assm <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> distinct <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> index_def <span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="main">0</span>
      <span class="main">∧</span> <span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>
      <span class="main">∧</span> <span class="skolem">i1</span> <span class="main">&lt;</span> length <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="skolem">i2</span> <span class="main">&lt;</span> length <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i1</span> <span class="main">=</span> <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="skolem">i1</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="skolem">i2</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tr1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="skolem">i1</span><span class="main">)</span> <span class="free">tr</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tr2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="skolem">i2</span><span class="main">)</span> <span class="free">tr</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?st</span></span></span>  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i1</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> obs_PM <span class="main">:</span> <span class="quoted"><span class="quoted">"observable <span class="free">PM</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> observable_productF assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">PM</span> <span class="main">=</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>8<span class="main">)</span> language_state_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> productF_path_io_targets<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">FAIL</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">PM</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"initial <span class="free"><span class="free">M2</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"initial <span class="free"><span class="free">M1</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">vs</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">q2</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">q1</span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span>
        io_targets_observable_singleton_ex singletonD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="comment1">― ‹paths for ?xs1›</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i1</span> <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span> <span class="var">?xs1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> index_def map_snd_zip states_alt_def
        states_index_io_target<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span> <span class="var">?xs1</span> <span class="main">=</span> <span class="main">{</span><span class="var">?st</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> obs_PM <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> observable_io_target_is_singleton<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> <span class="var">?tr1</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append_elim append_take_drop_id assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> length_take zip_append<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map fst <span class="var">?tr1</span> <span class="main">||</span> map snd <span class="var">?tr1</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="var">?xs1</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> IntD2 append_assoc append_take_drop_id assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> language_state_prefix<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="var">?xs1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q2'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> io_targets_observable_singleton_ob<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="var">?xs1</span>"</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2'</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="free">q2</span> <span class="var">?xs1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>›</span></span>
          observable_io_targets_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="var"><span class="quoted"><span class="var">?xs1</span></span></span> <span class="quoted"><span class="skolem">q2'</span></span> <span class="quoted"><span class="free">q2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs1</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="free">q2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?xs1</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="var">?tr1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>map fst <span class="var">?tr1</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="var">?tr1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>›</span></span> io_targets_nodes
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial insertI1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q1</span><span class="main">}</span>›</span></span> io_targets_nodes
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial insertI1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map snd <span class="var">?tr1</span><span class="main">)</span> <span class="free">q1</span>"</span></span>
     <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map fst <span class="var">?tr1</span><span class="main">)</span> <span class="free">q2</span>"</span></span>
     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map snd <span class="var">?tr1</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> snd <span class="main">(</span>target <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map fst <span class="var">?tr1</span> <span class="main">||</span> map snd <span class="var">?tr1</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map fst <span class="var">?tr1</span><span class="main">)</span> <span class="free">q2</span> <span class="main">=</span> fst <span class="main">(</span>target <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map fst <span class="var">?tr1</span> <span class="main">||</span> map snd <span class="var">?tr1</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>9<span class="main">)</span> assms<span class="main">(</span>10<span class="main">)</span> <span class="quoted"><span class="quoted">‹path <span class="free">PM</span> <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map fst <span class="var">?tr1</span> <span class="main">||</span> map snd <span class="var">?tr1</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>›</span></span>
          assms<span class="main">(</span>4<span class="main">)</span>
          productF_path_reverse_ob_2<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?xs1</span></span></span></span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map fst <span class="var"><span class="var"><span class="var"><span class="var">?tr1</span></span></span></span>"</span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map snd <span class="var"><span class="var"><span class="var"><span class="var">?tr1</span></span></span></span>"</span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">M2</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">M1</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">FAIL</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">PM</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">q2</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">q1</span></span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map fst <span class="var">?tr1</span> <span class="main">||</span> map snd <span class="var">?tr1</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?st</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> index_def scan_nth take_zip zip_map_fst_snd<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map snd <span class="var">?tr1</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> snd <span class="var">?st</span>"</span></span>
     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map fst <span class="var">?tr1</span><span class="main">)</span> <span class="free">q2</span> <span class="main">=</span> fst <span class="var">?st</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

  <span class="comment1">― ‹paths for ?xs2›</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i2</span> <span class="main">∈</span> io_targets <span class="free">PM</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span> <span class="var">?xs2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> index_def map_snd_zip states_alt_def states_index_io_target<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span> <span class="free">q1</span><span class="main">)</span> <span class="var">?xs2</span> <span class="main">=</span> <span class="main">{</span><span class="var">?st</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> obs_PM <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> index_def observable_io_target_is_singleton<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> <span class="var">?tr2</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.path_append_elim append_take_drop_id assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> length_take zip_append<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map fst <span class="var">?tr2</span> <span class="main">||</span> map snd <span class="var">?tr2</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="var">?xs2</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> IntD2 append_assoc append_take_drop_id assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> language_state_prefix<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="var">?xs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q2''</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> io_targets_observable_singleton_ob<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="var">?xs2</span>"</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2''</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="free">q2</span> <span class="var">?xs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>›</span></span>
          observable_io_targets_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="var"><span class="quoted"><span class="var">?xs2</span></span></span> <span class="quoted"><span class="skolem">q2''</span></span> <span class="quoted"><span class="free">q2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs2</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="free">q2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?xs2</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="var">?tr2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>7<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>map fst <span class="var">?tr2</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="var">?tr2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>›</span></span> io_targets_nodes
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial insertI1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q1</span> <span class="main">∈</span> nodes <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q1</span><span class="main">}</span>›</span></span> io_targets_nodes
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial insertI1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map snd <span class="var">?tr2</span><span class="main">)</span> <span class="free">q1</span>"</span></span>
     <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map fst <span class="var">?tr2</span><span class="main">)</span> <span class="free">q2</span>"</span></span>
     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map snd <span class="var">?tr2</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> snd<span class="main">(</span>target <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map fst <span class="var">?tr2</span> <span class="main">||</span> map snd <span class="var">?tr2</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map fst <span class="var">?tr2</span><span class="main">)</span> <span class="free">q2</span> <span class="main">=</span> fst<span class="main">(</span>target <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map fst <span class="var">?tr2</span> <span class="main">||</span> map snd <span class="var">?tr2</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>9<span class="main">)</span> assms<span class="main">(</span>10<span class="main">)</span> <span class="quoted"><span class="quoted">‹path <span class="free">PM</span> <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map fst <span class="var">?tr2</span> <span class="main">||</span> map snd <span class="var">?tr2</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>›</span></span>
          assms<span class="main">(</span>4<span class="main">)</span>
          productF_path_reverse_ob_2<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?xs2</span></span></span></span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map fst <span class="var"><span class="var"><span class="var"><span class="var">?tr2</span></span></span></span>"</span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"map snd <span class="var"><span class="var"><span class="var"><span class="var">?tr2</span></span></span></span>"</span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">M2</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">M1</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">FAIL</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">PM</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">q2</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">q1</span></span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map fst <span class="var">?tr2</span> <span class="main">||</span> map snd <span class="var">?tr2</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span> <span class="main">=</span> <span class="var">?st</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> index_def scan_nth take_zip zip_map_fst_snd<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map snd <span class="var">?tr2</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> snd <span class="var">?st</span>"</span></span>
     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map fst <span class="var">?tr2</span><span class="main">)</span> <span class="free">q2</span> <span class="main">=</span> fst <span class="var">?st</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>



  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="free">q1</span> <span class="var">?xs1</span> <span class="main">=</span> <span class="main">{</span>snd <span class="var">?st</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M1</span> <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map snd <span class="var">?tr1</span><span class="main">)</span> <span class="free">q1</span>›</span></span> <span class="quoted"><span class="quoted">‹target <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map snd <span class="var">?tr1</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> snd <span class="var">?st</span>›</span></span>
          <span class="quoted"><span class="quoted">‹length <span class="var">?xs1</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="var">?tr1</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> obs_target_is_io_targets<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M1</span></span> <span class="var"><span class="quoted"><span class="var">?xs1</span></span></span>
          <span class="quoted"><span class="quoted">"map snd <span class="var">?tr1</span>"</span></span> <span class="quoted"><span class="free">q1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tgt_1_1 <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="var">?xs1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>snd <span class="var">?st</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q1</span><span class="main">}</span>›</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> observable_io_targets_append<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="free">q2</span> <span class="var">?xs1</span> <span class="main">=</span> <span class="main">{</span>fst <span class="var">?st</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map fst <span class="var">?tr1</span><span class="main">)</span> <span class="free">q2</span>›</span></span> <span class="quoted"><span class="quoted">‹target <span class="main">(</span><span class="var">?xs1</span> <span class="main">||</span> map fst <span class="var">?tr1</span><span class="main">)</span> <span class="free">q2</span> <span class="main">=</span> fst <span class="var">?st</span>›</span></span>
          <span class="quoted"><span class="quoted">‹length <span class="var">?xs1</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="var">?tr1</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span>
          obs_target_is_io_targets<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="var"><span class="quoted"><span class="var">?xs1</span></span></span> <span class="quoted"><span class="quoted">"map fst <span class="var">?tr1</span>"</span></span> <span class="quoted"><span class="free">q2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tgt_1_2 <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="var">?xs1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>fst <span class="var">?st</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>›</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> observable_io_targets_append<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="free">q1</span> <span class="var">?xs2</span> <span class="main">=</span> <span class="main">{</span>snd <span class="var">?st</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M1</span> <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map snd <span class="var">?tr2</span><span class="main">)</span> <span class="free">q1</span>›</span></span> <span class="quoted"><span class="quoted">‹target <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map snd <span class="var">?tr2</span><span class="main">)</span> <span class="free">q1</span> <span class="main">=</span> snd <span class="var">?st</span>›</span></span>
          <span class="quoted"><span class="quoted">‹length <span class="var">?xs2</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="var">?tr2</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span>
          obs_target_is_io_targets<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M1</span></span> <span class="var"><span class="quoted"><span class="var">?xs2</span></span></span> <span class="quoted"><span class="quoted">"map snd <span class="var">?tr2</span>"</span></span> <span class="quoted"><span class="free">q1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tgt_2_1 <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="var">?xs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>snd <span class="var">?st</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q1</span><span class="main">}</span>›</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> observable_io_targets_append<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="free">q2</span> <span class="var">?xs2</span> <span class="main">=</span> <span class="main">{</span>fst <span class="var">?st</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="free">M2</span> <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map fst <span class="var">?tr2</span><span class="main">)</span> <span class="free">q2</span>›</span></span> <span class="quoted"><span class="quoted">‹target <span class="main">(</span><span class="var">?xs2</span> <span class="main">||</span> map fst <span class="var">?tr2</span><span class="main">)</span> <span class="free">q2</span> <span class="main">=</span> fst <span class="var">?st</span>›</span></span>
          <span class="quoted"><span class="quoted">‹length <span class="var">?xs2</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="var">?tr2</span><span class="main">)</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span>
          obs_target_is_io_targets<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="var"><span class="quoted"><span class="var">?xs2</span></span></span> <span class="quoted"><span class="quoted">"map fst <span class="var">?tr2</span>"</span></span> <span class="quoted"><span class="free">q2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tgt_2_2 <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="var">?xs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>fst <span class="var">?st</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="free">q2</span><span class="main">}</span>›</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> observable_io_targets_append<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="var">?xs1</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> take_is_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="var">?xs2</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> take_is_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs1</span> <span class="main">≠</span> <span class="var">?xs2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="bound">na</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">na</span> <span class="main">∨</span> Suc <span class="bound">n</span> <span class="main">≤</span> <span class="bound">na</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i1</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> index_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i2</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> index_def length_take map_snd_zip_take min_less_iff_conj states_alt_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> index_def length_take min.absorb2 nat.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="var">?xs1</span> <span class="main">&lt;</span> length <span class="var">?xs2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="var">?xs1</span> <span class="var">?xs2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i1</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="free">xs</span>›</span></span> leD prefix_length_le
          prefix_same_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Rep_Pre.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i1</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹take <span class="main">(</span>Suc <span class="skolem">i1</span><span class="main">)</span> <span class="free">xs</span> <span class="main">≠</span> take <span class="main">(</span>Suc <span class="skolem">i2</span><span class="main">)</span> <span class="free">xs</span>›</span></span>
          tgt_1_1 tgt_1_2 tgt_2_1 tgt_2_2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?xs1</span> <span class="main">≠</span> length <span class="var">?xs2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹take <span class="main">(</span>Suc <span class="skolem">i1</span><span class="main">)</span> <span class="free">xs</span> <span class="main">≠</span> take <span class="main">(</span>Suc <span class="skolem">i2</span><span class="main">)</span> <span class="free">xs</span>›</span></span> append_eq_conv_conj
          append_take_drop_id<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?xs2</span> <span class="main">&lt;</span> length <span class="var">?xs1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="var">?xs2</span> <span class="var">?xs1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i1</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="free">xs</span>›</span></span> less_imp_le_nat
            prefix_length_prefix
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_Pre.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i1</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="free">xs</span>›</span></span>
          <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i1</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹take <span class="main">(</span>Suc <span class="skolem">i1</span><span class="main">)</span> <span class="free">xs</span> <span class="main">≠</span> take <span class="main">(</span>Suc <span class="skolem">i2</span><span class="main">)</span> <span class="free">xs</span>›</span></span>
          tgt_1_1 tgt_1_2 tgt_2_1 tgt_2_2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>





<span class="keyword1" id="ASC_LB-RP_count_via_Rep_Cov"><span class="command">lemma</span></span> RP_count_via_Rep_Cov <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="free">V''</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> RP_cases <span class="main">:</span> <span class="quoted"><span class="quoted">"RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                    <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">vs'</span> <span class="main">∈</span> <span class="free">V''</span> <span class="main">.</span> <span class="bound">vs'</span> <span class="main">∉</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                                      <span class="main">∧</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> insert <span class="bound">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RP_from_R assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> R_count assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> vs'_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">∈</span> <span class="free">V''</span>
                                      <span class="main">∧</span> <span class="skolem">vs'</span> <span class="main">∉</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                                      <span class="main">∧</span> RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> insert <span class="skolem">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RP_cases <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> state_component_2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">.</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="bound">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">io</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> language_state <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> io_targets_observable_singleton_ex <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> singletonD<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>13<span class="main">)</span> perm_language vs'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> s'_def <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">vs'</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s'</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> io_targets_observable_singleton_ob<span class="main">)</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∉</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">s'</span> <span class="main">∉</span> <span class="main">⋃</span><span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">`</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs'_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                                        <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xs'</span><span class="main">.</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xs'</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                          <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="bound">xs'</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pps</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'c</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list"</span></span>
          <span class="keyword2"><span class="keyword">where</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v3</span><span class="main">.</span> <span class="bound">v3</span> <span class="main">∈</span> <span class="bound">x0</span> <span class="main">∧</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="bound">v3</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pps</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x0</span> <span class="main">∧</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">(</span><span class="skolem">pps</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pps</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s'</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>
                        <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>
                                              <span class="main">(</span><span class="skolem">pps</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">s'</span> <span class="main">∉</span> <span class="main">⋃</span><span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">`</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps</span><span class="main">.</span> <span class="skolem">pps</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">ps</span> <span class="main">∧</span> <span class="bound">ps</span> <span class="main">≠</span> <span class="main">[]</span>
                        <span class="main">∧</span> prefix <span class="bound">ps</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="bound">ps</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> f2 a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xs'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s'</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> io_targets_observable_singleton_ob singletonD xs'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s'</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> s'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> state_component_2 xs'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> RP.simps Un_iff insertI1 mem_Collect_eq vs'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xs'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">xs'</span> <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xs'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">∈</span> <span class="free">V''</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> vs'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="free">V''</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">=</span> insert <span class="skolem">s'</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> finite_R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="main">⟹</span> finite <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">a</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> language_state_prefix <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntD1 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prefix_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> io_targets_observable_singleton_ob <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> card_insert_disjoint<span class="main">)</span>


    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">vs'</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vs'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> R_count<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="free">q2</span></span> <span class="quoted"><span class="free">q1</span></span> <span class="quoted"><span class="free">tr</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>2-9<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span>R <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> vs'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_insert_if finite_R<span class="main">)</span>

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ASC_LB-RP_count_alt_def"><span class="command">lemma</span></span> RP_count_alt_def <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="free">V''</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>states <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distinctness_via_Rep_Pre<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="free">q2</span></span> <span class="quoted"><span class="free">q1</span></span> <span class="quoted"><span class="free">tr</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> RP_count_via_Rep_Cov<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="free">q2</span></span> <span class="quoted"><span class="free">q1</span></span> <span class="quoted"><span class="free">tr</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">V''</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>10<span class="main">,</span>12-14<span class="main">,</span>2-9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Function LB ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">LB</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> adds together the number of elements in sets calculated via RP for a given set of
states and the number of ATC-reaction known to exist but not produced by a state reached by any of
the above elements.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">LB</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> FSM
          <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'in</span> list set
          <span class="main">⇒</span> <span class="tfree">'state1</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set
          <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list set <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">LB</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V''</span></span></span> <span class="main">=</span>
    <span class="main">(</span>sum <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> card <span class="main">(</span>RP <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">V''</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>
    <span class="main">+</span> card <span class="main">(</span><span class="main">(</span>D <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span><span class="main">)</span> <span class="main">-</span>
            <span class="main">{</span>B <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="bound">xs'</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">|</span> <span class="bound">xs'</span> <span class="bound">s'</span> <span class="main">.</span> <span class="bound">s'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="bound">xs'</span> <span class="main">∈</span> RP <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="bound">s'</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">V''</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>



<span class="keyword1" id="ASC_LB-LB_count_helper_RP_disjoint_and_cards"><span class="command">lemma</span></span> LB_count_helper_RP_disjoint_and_cards <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">≠</span> <span class="free">s2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">.</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io</span>
                                      <span class="main">=</span> <span class="main">{</span><span class="free">s1</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">io</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io</span>
                <span class="main">=</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms RP_io_targets_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">V''</span></span> <span class="quoted"><span class="skolem">io</span></span> <span class="quoted"><span class="free">s1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> RP_state_component_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">io</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">s1</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">V''</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s1</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> <span class="main">{</span><span class="free">s1</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> <span class="main">{</span><span class="free">s1</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> <span class="main">{</span><span class="free">s1</span><span class="main">}</span> <span class="main">×</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> image_split_1 <span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">)</span>
      <span class="main">=</span> <span class="main">{</span><span class="free">s1</span><span class="main">}</span> <span class="main">×</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span>  card_cartesian_product_singleton<span class="main">)</span>




  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">.</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="bound">io</span>
                                      <span class="main">=</span> <span class="main">{</span><span class="free">s2</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">io</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io</span>
                  <span class="main">=</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms RP_io_targets_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">FAIL</span></span> <span class="quoted"><span class="free">PM</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">V''</span></span> <span class="quoted"><span class="skolem">io</span></span> <span class="quoted"><span class="free">s2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> RP_state_component_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">io</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">s2</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">V''</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="skolem">io</span> <span class="main">=</span> <span class="main">{</span><span class="free">s2</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> <span class="main">{</span><span class="free">s2</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> <span class="main">{</span><span class="free">s2</span><span class="main">}</span> <span class="main">×</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> <span class="main">{</span><span class="free">s2</span><span class="main">}</span> <span class="main">×</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">io</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> image_split_2 <span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">{</span><span class="free">s2</span><span class="main">}</span> <span class="main">×</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span>  card_cartesian_product_singleton<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">{</span><span class="free">s1</span><span class="main">}</span> <span class="main">×</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∩</span> <span class="main">{</span><span class="free">s2</span><span class="main">}</span> <span class="main">×</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image_split_1 image_split_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">s1</span><span class="main">}</span> <span class="main">×</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∩</span> <span class="main">{</span><span class="free">s2</span><span class="main">}</span> <span class="main">×</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ASC_LB-LB_count_helper_RP_disjoint_card_M1"><span class="command">lemma</span></span> LB_count_helper_RP_disjoint_card_M1 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">≠</span> <span class="free">s2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∪</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">+</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RP_io_targets_finite_PM<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-8<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RP_io_targets_finite_PM<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-8<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> LB_count_helper_RP_disjoint_and_cards<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> card_Un_disjoint<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_LB-LB_count_helper_RP_disjoint_M1_pair"><span class="command">lemma</span></span> LB_count_helper_RP_disjoint_M1_pair <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="free">tr</span><span class="main">)</span> <span class="main">(</span><span class="free">q2</span><span class="main">,</span><span class="free">q1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="free">tr</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="free">V''</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Prereq <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">T</span> <span class="free">S</span> <span class="free">Ω</span> <span class="free">V''</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">≠</span> <span class="free">s2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s2</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"applicable_set <span class="free">M1</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"completely_specified <span class="free">M1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>
        <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">+</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>14<span class="main">,</span>16<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Prereq.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s2</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>14<span class="main">,</span>17<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Prereq.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>
          <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RP_count_alt_def<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-5<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s1</span> <span class="main">∈</span> nodes <span class="free">M2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>6-13<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>
                  <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> RP_count_alt_def<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-5<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s2</span> <span class="main">∈</span> nodes <span class="free">M2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>6-13<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io1</span></span> <span class="skolem"><span class="skolem">io2</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> shared_elem_def <span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="skolem">io1</span> <span class="main">∈</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">io2</span> <span class="main">∈</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io1</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


    <span class="keyword1"><span class="command">have</span></span> dist_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">.</span> <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span>
            <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">io1</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">.</span>
                       <span class="main">∀</span> <span class="bound">io2</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">.</span>
                         B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span> <span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io1</span> <span class="main">∩</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io1</span> <span class="main">∩</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io1</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io1</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io1</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s1</span><span class="main">}</span>"</span></span>
                <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io2</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s2</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> observable_io_target_is_singleton<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">=</span> <span class="skolem">s2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io1</span> <span class="main">∩</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io2</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"B <span class="free">M1</span> <span class="skolem">io1</span> <span class="free">Ω</span> <span class="main">=</span> B <span class="free">M1</span> <span class="skolem">io2</span> <span class="free">Ω</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io1</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s1</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">io2</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s2</span><span class="main">}</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>15-17<span class="main">)</span> dist_prop shared_elem_def<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> shared_elem_def<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>
       <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">+</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>






<span class="keyword1" id="ASC_LB-LB_count_helper_RP_card_union"><span class="command">lemma</span></span> LB_count_helper_RP_card_union <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">≠</span> <span class="free">s2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">∩</span> RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">∩</span> RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span> <span class="main">∧</span> <span class="skolem">io</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="free">s2</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="free">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">=</span> <span class="free">s2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> observable_io_target_is_singleton singletonD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="ASC_LB-LB_count_helper_RP_inj"><span class="command">lemma</span></span> LB_count_helper_RP_inj <span class="main">:</span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">.</span>
          <span class="free">f</span> <span class="bound">q</span> <span class="main">∈</span> nodes <span class="free">M1</span>"</span></span>
      <span class="quoted"><span class="quoted">"inj_on <span class="free">f</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">q</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">q</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">then</span> <span class="bound">q</span>
      <span class="keyword1">else</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">.</span>
              <span class="var">?f</span> <span class="bound">q</span> <span class="main">∈</span> nodes <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_iff  sup.order_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?f</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>
                                                      <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?f</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">UNION</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">UNION</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">⋃</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1" id="ASC_LB-LB_count_helper_RP_card_union_sum"><span class="command">lemma</span></span> LB_count_helper_RP_card_union_sum <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"Prereq <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">T</span> <span class="free">S</span> <span class="free">Ω</span> <span class="free">V''</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="free">V''</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>
        <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> nodes <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> infinite_super <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>
              <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">S</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Prereq <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">T</span> <span class="skolem">S</span> <span class="free">Ω</span> <span class="free">V''</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Prereq <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">T</span> <span class="main">(</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">V''</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">s</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
                <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">s</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> card <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.IH<span class="main">[</span><span class="operator">OF</span> insert.prems<span class="main"><span class="main">(</span></span>1-6<span class="main"><span class="main">)</span></span> _ assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">s'</span><span class="main">∈</span><span class="main">(</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">s'</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute insert.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insert.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> S_prop <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">s'</span><span class="main">∈</span><span class="main">(</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">s</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> card <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">+</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="skolem"><span class="skolem">q1</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> suffix_path <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">q2</span><span class="main">,</span><span class="skolem">q1</span><span class="main">)</span><span class="main">}</span>"</span></span>
                          <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q2</span><span class="main">,</span><span class="skolem">q1</span><span class="main">)</span>"</span></span>
                          <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="skolem">tr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> productF_language_state_intermediate<span class="main">[</span><span class="operator">OF</span> insert.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
            test_tools_props<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert.prems<span class="main"><span class="main"><span class="main">(</span></span></span>5<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> OFSM_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span>
                                    OFSM_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>



    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>
            <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> OFSM_props<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> insert.prems<span class="main"><span class="main"><span class="main">(</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> OFSM_props<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> insert.prems<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span>
            RP_count_alt_def<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>›</span></span> _ _ _ _
                                <span class="quoted"><span class="quoted">‹<span class="skolem">s</span><span class="main">∈</span>nodes <span class="free">M2</span>›</span></span> test_tools_props<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert.prems<span class="main"><span class="main"><span class="main">(</span></span></span>5<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span>
                                suffix_path insert.prems<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span>
                                test_tools_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert.prems<span class="main"><span class="main"><span class="main">(</span></span></span>5<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> insert.prems<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">s</span><span class="main">∈</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                  <span class="main">(</span><span class="main">∑</span><span class="bound">s</span><span class="main">∈</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">.</span> card <span class="main">(</span>UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">c</span><span class="main">∈</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">.</span> card <span class="main">(</span>UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">c</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">=</span> card <span class="main">(</span>UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">c</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> card <span class="main">(</span>UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">c</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> insert.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insert.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sum.insert<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∑</span><span class="bound">s'</span><span class="main">∈</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
                <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">s</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> card <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">+</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>›</span></span>
              <span class="quoted"><span class="quoted">‹card <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>
                <span class="main">=</span> card <span class="main">(</span>UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ASC_LB-finite_insert_card"><span class="command">lemma</span></span> finite_insert_card <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="free">SS</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="free">SS</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>insert <span class="free">S</span> <span class="free">SS</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span><span class="free">SS</span><span class="main">)</span> <span class="main">+</span> card <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> card_Un_disjoint<span class="main">)</span>

<span class="keyword1" id="ASC_LB-LB_count_helper_RP_disjoint_M1_union"><span class="command">lemma</span></span> LB_count_helper_RP_disjoint_M1_union <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"Prereq <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">T</span> <span class="free">S</span> <span class="free">Ω</span> <span class="free">V''</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="free">V''</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>
        <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> nodes <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> infinite_super <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>
              <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">S</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Prereq <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">T</span> <span class="skolem">S</span> <span class="free">Ω</span> <span class="free">V''</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Prereq <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">T</span> <span class="main">(</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">V''</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> applied_IH <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">s</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.IH<span class="main">[</span><span class="operator">OF</span> insert.prems<span class="main"><span class="main">(</span></span>1-6<span class="main"><span class="main">)</span></span> _ insert.prems<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="skolem"><span class="skolem">q1</span></span> <span class="skolem"><span class="skolem">tr</span></span> <span class="keyword2"><span class="keyword">where</span></span> suffix_path <span class="main">:</span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="free">vs</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">q2</span><span class="main">,</span><span class="skolem">q1</span><span class="main">)</span><span class="main">}</span>"</span></span>
                              <span class="quoted"><span class="quoted">"path <span class="free">PM</span> <span class="main">(</span><span class="free">xs</span> <span class="main">||</span> <span class="skolem">tr</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q2</span><span class="main">,</span><span class="skolem">q1</span><span class="main">)</span>"</span></span>
                              <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">=</span> length <span class="skolem">tr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> productF_language_state_intermediate
            <span class="main">[</span><span class="operator">OF</span> insert.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> test_tools_props<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert.prems<span class="main"><span class="main"><span class="main">(</span></span></span>5<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span>
                OFSM_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> OFSM_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> insert <span class="skolem">s</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s'</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>
                        <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">s'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.hyps<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> insert <span class="skolem">s</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>
              <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="skolem">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> OFSM_props<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">]</span> OFSM_props<span class="main">(</span>2<span class="main">,</span>1<span class="main">,</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span>
              LB_count_helper_RP_disjoint_M1_pair<span class="main">(</span>2<span class="main">)</span>
                <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>›</span></span> _ _ _ _ test_tools_props<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert.prems<span class="main"><span class="main"><span class="main">(</span></span></span>5<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span>
                    suffix_path insert.prems<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> test_tools_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert.prems<span class="main"><span class="main"><span class="main">(</span></span></span>5<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span>
                    insert.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="skolem">s'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> insert <span class="skolem">s</span> <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">∈</span> insert <span class="skolem">s</span> <span class="skolem">S</span>›</span></span>
                    test_tools_props<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert.prems<span class="main"><span class="main"><span class="main">(</span></span></span>5<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disj_insert <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">s</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>
                                <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> finite_S <span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RP_io_targets_finite_M1<span class="main">[</span><span class="operator">OF</span> insert.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> RP_io_targets_finite_M1 <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> insert.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> finite_s <span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> RP_io_targets_finite_M1 <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span>
          finite_UN_I insert.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insert.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>


    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span><span class="main">∈</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>
          <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>
            <span class="main">+</span> card <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">c</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span>
                <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">c</span><span class="main">.</span> UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">c</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> insert <span class="skolem">s</span> <span class="skolem">S</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟶</span> UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">∩</span> UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">c</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">s'</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>
                              <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∩</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">c</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">c</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_S finite_insert_card finite_s<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>
          <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span>
            RP_count_alt_def<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">∩</span> L <span class="free">M2</span>›</span></span> _ _ _ _ <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> nodes <span class="free">M2</span>›</span></span>
                                test_tools_props<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert.prems<span class="main"><span class="main"><span class="main">(</span></span></span>5<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> suffix_path
                                insert.prems<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> test_tools_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> insert.prems<span class="main"><span class="main"><span class="main">(</span></span></span>5<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span>
                                insert.prems<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">c</span><span class="main">∈</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">c</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
              <span class="main">=</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">c</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">c</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> insert.hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insert.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sum.insert<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span>
                <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>›</span></span>
              <span class="quoted"><span class="quoted">‹card <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span><span class="main">∈</span>insert <span class="skolem">s</span> <span class="skolem">S</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>
                <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>
                  <span class="main">+</span> card <span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="skolem">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>›</span></span> applied_IH
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>





<span class="keyword1" id="ASC_LB-LB_count_helper_LB1"><span class="command">lemma</span></span> LB_count_helper_LB1 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"Prereq <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">T</span> <span class="free">S</span> <span class="free">Ω</span> <span class="free">V''</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="free">V''</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sum <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">s</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> OFSM_props<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> well_formed.simps finite_FSM.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> card_mono<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">s</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LB_count_helper_RP_disjoint_M1_union<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1" id="ASC_LB-LB_count_helper_D_states"><span class="command">lemma</span></span> LB_count_helper_D_states <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">RS</span> <span class="main">∈</span> <span class="main">(</span>D <span class="free">M</span> <span class="free">T</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> nodes <span class="free">M</span> <span class="main">∧</span> <span class="free">RS</span> <span class="main">=</span> IO_set <span class="free">M</span> <span class="free">q</span> <span class="free">Ω</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">RS</span> <span class="main">∈</span> image <span class="main">(</span><span class="main">λ</span> <span class="bound">io</span> <span class="main">.</span> B <span class="free">M</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">RS</span> <span class="main">=</span> B <span class="free">M</span> <span class="skolem">io</span> <span class="free">Ω</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> <span class="keyword1">LS<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub></span> <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> language_state <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> language_state_for_inputs_in_language_state<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M</span>"</span></span> <span class="quoted"><span class="free">T</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">=</span> io_targets <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="skolem">io</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> io_targets_observable_singleton_ob<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"B <span class="free">M</span> <span class="skolem">io</span> <span class="free">Ω</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> IO_set <span class="free">M</span> <span class="bound">s</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"B <span class="free">M</span> <span class="skolem">io</span> <span class="free">Ω</span> <span class="main">=</span> IO_set <span class="free">M</span> <span class="skolem">q</span> <span class="free">Ω</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">RS</span> <span class="main">=</span> IO_set <span class="free">M</span> <span class="skolem">q</span> <span class="free">Ω</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">RS</span> <span class="main">=</span> B <span class="free">M</span> <span class="skolem">io</span> <span class="free">Ω</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> nodes <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">=</span> io_targets <span class="free">M</span> <span class="main">(</span>initial <span class="free">M</span><span class="main">)</span> <span class="skolem">io</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial insertI1 io_targets_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ASC_LB-LB_count_helper_LB2"><span class="command">lemma</span></span> LB_count_helper_LB2 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"IO_set <span class="free">M1</span> <span class="free">q</span> <span class="free">Ω</span> <span class="main">∈</span> <span class="main">(</span>D <span class="free">M1</span> <span class="free">T</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span>B <span class="free">M1</span> <span class="bound">xs'</span> <span class="free">Ω</span> <span class="main">|</span> <span class="bound">xs'</span> <span class="bound">s'</span> <span class="main">.</span> <span class="bound">s'</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">xs'</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∉</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">s</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> UNION <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span>io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">xs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="skolem">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">q</span><span class="main">}</span> <span class="main">=</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">xs'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> observable_io_target_is_singleton<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"B <span class="free">M1</span> <span class="skolem">xs'</span> <span class="free">Ω</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span>image <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> IO_set <span class="free">M1</span> <span class="bound">s</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">{</span><span class="free">q</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"B <span class="free">M1</span> <span class="skolem">xs'</span> <span class="free">Ω</span> <span class="main">=</span> IO_set <span class="free">M1</span> <span class="free">q</span> <span class="free">Ω</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"B <span class="free">M1</span> <span class="skolem">xs'</span> <span class="free">Ω</span> <span class="main">∈</span> <span class="main">{</span>B <span class="free">M1</span> <span class="bound">xs'</span> <span class="free">Ω</span> <span class="main">|</span> <span class="bound">xs'</span> <span class="bound">s'</span> <span class="main">.</span> <span class="bound">s'</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">xs'</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs'</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="skolem">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IO_set <span class="free">M1</span> <span class="free">q</span> <span class="free">Ω</span> <span class="main">∈</span> <span class="main">{</span>B <span class="free">M1</span> <span class="bound">xs'</span> <span class="free">Ω</span> <span class="main">|</span> <span class="bound">xs'</span> <span class="bound">s'</span> <span class="main">.</span> <span class="bound">s'</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">xs'</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IO_set <span class="free">M1</span> <span class="free">q</span> <span class="free">Ω</span> <span class="main">∉</span> <span class="main">{</span>B <span class="free">M1</span> <span class="bound">xs'</span> <span class="free">Ω</span> <span class="main">|</span> <span class="bound">xs'</span> <span class="bound">s'</span> <span class="main">.</span> <span class="bound">s'</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">xs'</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Validity of the result of LB constituting a lower bound ›</span></span>


<span class="keyword1" id="ASC_LB-LB_count"><span class="command">lemma</span></span> LB_count <span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"Prereq <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">T</span> <span class="free">S</span> <span class="free">Ω</span> <span class="free">V''</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="free">V''</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"LB <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">T</span> <span class="free">S</span> <span class="free">Ω</span> <span class="free">V''</span> <span class="main">≤</span> <span class="main">|</span><span class="free">M1</span><span class="main">|</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"D <span class="free">M1</span> <span class="free">T</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>B <span class="free">M1</span> <span class="bound">xs'</span> <span class="free">Ω</span> <span class="main">|</span> <span class="bound">xs'</span> <span class="bound">s'</span> <span class="main">.</span> <span class="bound">s'</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">xs'</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s'</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?DB</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">-</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RP</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="bound">s</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">.</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">a</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> OFSM_props<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> well_formed.simps finite_FSM.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> OFSM_props<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span> assms<span class="main">(</span>7<span class="main">)</span> D_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">T</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Ω</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> Prereq.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?DB</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="comment1">― ‹Proof sketch:
      Construct a function f (via induction) that maps each response set in ?DB to some state
      that produces that response set.
      This is then used to show that each response sets in ?DB indicates the existence of
      a distinct state in M1 not reached via the RP-sequences.›</span>

  <span class="keyword1"><span class="command">have</span></span> states_f <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">DB'</span> <span class="main">.</span> <span class="bound">DB'</span> <span class="main">⊆</span> <span class="var">?DB</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">f</span> <span class="main">.</span> inj_on <span class="bound">f</span> <span class="bound">DB'</span>
                                                <span class="main">∧</span> image <span class="bound">f</span> <span class="bound">DB'</span> <span class="main">⊆</span> <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RP</span>
                                                <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">RS</span> <span class="main">∈</span> <span class="bound">DB'</span> <span class="main">.</span> IO_set <span class="free">M1</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">RS</span><span class="main">)</span> <span class="free">Ω</span> <span class="main">=</span> <span class="bound">RS</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">DB'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DB'</span> <span class="main">⊆</span> <span class="var">?DB</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">DB'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">DB'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="var">?DB</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> infinite_super<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">DB'</span> <span class="main">⊆</span> <span class="var">?DB</span>›</span></span> <span class="quoted"><span class="quoted">‹infinite <span class="skolem">DB'</span>›</span></span> <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?DB</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">f</span> <span class="main">.</span> inj_on <span class="bound">f</span> <span class="skolem">DB'</span> <span class="main">∧</span> image <span class="bound">f</span> <span class="skolem">DB'</span> <span class="main">⊆</span> <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RP</span>
                                  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">RS</span> <span class="main">∈</span> <span class="skolem">DB'</span> <span class="main">.</span> IO_set <span class="free">M1</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">RS</span><span class="main">)</span> <span class="free">Ω</span> <span class="main">=</span> <span class="bound">RS</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">DB'</span> <span class="main">⊆</span> <span class="var">?DB</span>›</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">DB'</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> empty
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">RS</span> <span class="skolem">DB'</span><span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">DB'</span> <span class="main">⊆</span> <span class="var">?DB</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f'</span> <span class="skolem">DB'</span>"</span></span>
                      <span class="quoted"><span class="quoted">"image <span class="skolem">f'</span> <span class="skolem">DB'</span> <span class="main">⊆</span> <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RP</span>"</span></span>
                      <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">RS</span> <span class="main">∈</span> <span class="skolem">DB'</span> <span class="main">.</span> IO_set <span class="free">M1</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">RS</span><span class="main">)</span> <span class="free">Ω</span> <span class="main">=</span> <span class="bound">RS</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.IH<span class="main">[</span><span class="operator">OF</span> insert.prems<span class="main"><span class="main">(</span></span>1-9<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">DB'</span> <span class="main">⊆</span> <span class="var">?DB</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">∈</span> D <span class="free">M1</span> <span class="free">T</span> <span class="free">Ω</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> nodes <span class="free">M1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">=</span> IO_set <span class="free">M1</span> <span class="skolem">q</span> <span class="free">Ω</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>2<span class="main">)</span>  LB_count_helper_D_states<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">RS</span> <span class="main">∈</span> D <span class="free">M1</span> <span class="free">T</span> <span class="free">Ω</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IO_set <span class="free">M1</span> <span class="skolem">q</span> <span class="free">Ω</span> <span class="main">∈</span> <span class="var">?DB</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∉</span> <span class="var">?RP</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>2<span class="main">)</span> LB_count_helper_LB2<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹IO_set <span class="free">M1</span> <span class="skolem">q</span> <span class="free">Ω</span> <span class="main">∈</span> <span class="var">?DB</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span><span class="main">(</span><span class="skolem">RS</span> <span class="main">:=</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?f</span> <span class="main">(</span>insert <span class="skolem">RS</span> <span class="skolem">DB'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">RS</span> <span class="main">∉</span> <span class="var">?f</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">DB'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">RS</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="skolem">RS</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">DB'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">RS</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">DB'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">RS</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RS</span> <span class="main">∈</span> <span class="skolem">DB'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span> <span class="bound">c</span> <span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">Pa</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">c</span><span class="main">::</span><span class="tfree">'c</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">f</span> <span class="main">`</span> <span class="bound">P</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">Pa</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list set<span class="main">)</span> <span class="main">∈</span> <span class="bound">P</span><span class="main">)</span>
                                <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span> <span class="main">∉</span> <span class="bound">f</span> <span class="main">`</span> <span class="bound">P</span> <span class="main">∨</span> <span class="bound">f</span> <span class="bound">Pa</span> <span class="main">=</span> <span class="bound">c</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∉</span> <span class="skolem">f'</span> <span class="main">`</span> <span class="skolem">DB'</span>"</span></span>
              <span class="keyword1"><span class="command">moreover</span></span>
              <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∉</span> <span class="skolem">f'</span><span class="main">(</span><span class="skolem">RS</span> <span class="main">:=</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">DB'</span>"</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">f'</span><span class="main">(</span><span class="skolem">RS</span> <span class="main">:=</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">DB'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">RS</span><span class="main">}</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fun_upd_image<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">RS</span> <span class="main">=</span> IO_set <span class="free">M1</span> <span class="skolem">q</span> <span class="free">Ω</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">RS</span><span class="main">∈</span><span class="skolem">DB'</span><span class="main">.</span> IO_set <span class="free">M1</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">RS</span><span class="main">)</span> <span class="free">Ω</span> <span class="main">=</span> <span class="bound">RS</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> insert.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?f</span> <span class="skolem">DB'</span> <span class="main">∧</span> <span class="var">?f</span> <span class="skolem">RS</span> <span class="main">∉</span> <span class="var">?f</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">DB'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">RS</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj_on <span class="skolem">f'</span> <span class="skolem">DB'</span>›</span></span> inj_on_fun_updI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image <span class="var">?f</span> <span class="main">(</span>insert <span class="skolem">RS</span> <span class="skolem">DB'</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RP</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image <span class="var">?f</span> <span class="main">{</span><span class="skolem">RS</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image <span class="var">?f</span> <span class="main">{</span><span class="skolem">RS</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RP</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> nodes <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∉</span> <span class="var">?RP</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"image <span class="var">?f</span> <span class="main">(</span>insert <span class="skolem">RS</span> <span class="skolem">DB'</span><span class="main">)</span> <span class="main">=</span> image <span class="var">?f</span> <span class="main">{</span><span class="skolem">RS</span><span class="main">}</span> <span class="main">∪</span> image <span class="var">?f</span> <span class="skolem">DB'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹image <span class="skolem">f'</span> <span class="skolem">DB'</span> <span class="main">⊆</span> <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RP</span>›</span></span> fun_upd_other image_cong
              image_insert insert.hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> insert_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">RS</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="skolem">RS</span> <span class="skolem">DB'</span><span class="main">)</span> <span class="main">.</span> IO_set <span class="free">M1</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">RS</span><span class="main">)</span> <span class="free">Ω</span> <span class="main">=</span> <span class="bound">RS</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">RS</span> <span class="main">=</span> IO_set <span class="free">M1</span> <span class="skolem">q</span> <span class="free">Ω</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">RS</span><span class="main">∈</span><span class="skolem">DB'</span><span class="main">.</span> IO_set <span class="free">M1</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">RS</span><span class="main">)</span> <span class="free">Ω</span> <span class="main">=</span> <span class="bound">RS</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?DB</span> <span class="main">⊆</span> <span class="var">?DB</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="var">?DB</span>"</span></span> <span class="quoted"><span class="quoted">"image <span class="skolem">f</span> <span class="var">?DB</span> <span class="main">⊆</span> <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RP</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> states_f<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?DB</span> <span class="main">⊆</span> <span class="var">?DB</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M1</span> <span class="main">-</span> <span class="var">?RP</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?DB</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M1</span> <span class="main">-</span> <span class="var">?RP</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_inj_on_le<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹inj_on <span class="skolem">f</span> <span class="var">?DB</span>›</span></span> <span class="quoted"><span class="quoted">‹image <span class="skolem">f</span> <span class="var">?DB</span> <span class="main">⊆</span> <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RP</span>›</span></span>
                            <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="free">M1</span> <span class="main">-</span> <span class="var">?RP</span><span class="main">)</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?RP</span> <span class="main">⊆</span> nodes <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nodes <span class="free">M1</span> <span class="main">-</span> <span class="var">?RP</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">-</span> card <span class="var">?RP</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>›</span></span> card_Diff_subset infinite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?DB</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">-</span> card <span class="var">?RP</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="var">?DB</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M1</span> <span class="main">-</span> <span class="var">?RP</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sum <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">V''</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> card <span class="var">?RP</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LB_count_helper_RP_disjoint_M1_union<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2-9<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?RP</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_mono<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?RP</span> <span class="main">⊆</span> nodes <span class="free">M1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> LB.simps <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹card <span class="var">?DB</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">-</span> card <span class="var">?RP</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="ASC_LB-contradiction_via_LB"><span class="command">lemma</span></span> contradiction_via_LB <span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"Prereq <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">T</span> <span class="free">S</span> <span class="free">Ω</span> <span class="free">V''</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="free">V''</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"LB <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">T</span> <span class="free">S</span> <span class="free">Ω</span> <span class="free">V''</span> <span class="main">&gt;</span> <span class="free">m</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"LB <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs</span> <span class="free">T</span> <span class="free">S</span> <span class="free">Ω</span> <span class="free">V''</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> LB_count<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-9<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="ASC_Suite">
<div class="head">
<h1>Theory ASC_Suite</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ASC_Suite
<span class="keyword2"><span class="keyword">imports</span></span> <a href="ASC_LB.html">ASC_LB</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Test suite generated by the Adaptive State Counting Algorithm ›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Maximum length contained prefix ›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mcp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list set <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mcp</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>prefix <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">∧</span> 
                 <span class="main">(</span><span class="main">∀</span> <span class="bound">p'</span> <span class="main">.</span> <span class="main">(</span>prefix <span class="bound">p'</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="bound">p'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span><span class="main">)</span> <span class="main">⟶</span> length <span class="bound">p'</span> <span class="main">≤</span> length <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ASC_Suite-mcp_ex"><span class="command">lemma</span></span> mcp_ex <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"finite <span class="free">W</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mcp <span class="free">z</span> <span class="free">W</span> <span class="free">p</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span> <span class="main">.</span> prefix <span class="bound">p</span> <span class="free">z</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">W</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?maxP</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"arg_max length <span class="main">(</span><span class="main">λ</span> <span class="bound">p</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="var">?P</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span> <span class="main">.</span> prefix <span class="bound">p</span> <span class="free">z</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span> <span class="main">.</span> prefix <span class="bound">p</span> <span class="free">z</span><span class="main">}</span> <span class="main">⊆</span> image <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="main">.</span> take <span class="bound">i</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span>set <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="main">(</span>length <span class="free">z</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span> <span class="main">.</span> prefix <span class="bound">p</span> <span class="free">z</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> length <span class="free">z</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_conv_conj mem_Collect_eq prefix_def prefix_length_le<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">z</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="free">z</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> image <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span> <span class="main">.</span> take <span class="bound">i</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span>set <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> Suc <span class="main">(</span>length <span class="free">z</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> atLeast_upt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> finite_surj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?P</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Nil_prefix assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">maxP</span> <span class="main">∈</span> <span class="var">?P</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">p</span> <span class="main">∈</span> <span class="var">?P</span> <span class="main">.</span> length <span class="bound">p</span> <span class="main">≤</span> length <span class="bound">maxP</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">maxP</span> <span class="main">∈</span> <span class="var">?P</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">p</span> <span class="main">∈</span> <span class="var">?P</span> <span class="main">.</span> length <span class="bound">p</span> <span class="main">≤</span> length <span class="bound">maxP</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="main">∈</span> <span class="var">?P</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">p'</span> <span class="main">∈</span> <span class="var">?P</span> <span class="main">.</span> length <span class="bound">p</span> <span class="main">&lt;</span> length <span class="bound">p'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> not_less<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">l</span> <span class="main">∈</span> <span class="main">(</span>image length <span class="var">?P</span><span class="main">)</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">l'</span> <span class="main">∈</span> <span class="main">(</span>image length <span class="var">?P</span><span class="main">)</span> <span class="main">.</span> <span class="bound">l</span> <span class="main">&lt;</span> <span class="bound">l'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>image length <span class="var">?P</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> image_is_empty infinite_growing<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="var">?P</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> 

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">maxP</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">maxP</span> <span class="main">∈</span> <span class="var">?P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="main">∈</span> <span class="var">?P</span> <span class="main">.</span> length <span class="bound">p</span> <span class="main">≤</span> length <span class="skolem">maxP</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp <span class="free">z</span> <span class="free">W</span> <span class="skolem">maxP</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> mcp.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ASC_Suite-mcp_unique"><span class="command">lemma</span></span> mcp_unique <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mcp <span class="free">z</span> <span class="free">W</span> <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"mcp <span class="free">z</span> <span class="free">W</span> <span class="free">p'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">p'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p'</span> <span class="main">≤</span> length <span class="free">p</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p</span> <span class="main">≤</span> length <span class="free">p'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p'</span> <span class="main">=</span> length <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">p</span> <span class="free">z</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">p'</span> <span class="free">z</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_conv_conj prefixE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mcp'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list set <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mcp'</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span> <span class="main">.</span> mcp <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ASC_Suite-mcp'_intro"><span class="command">lemma</span></span> mcp'_intro <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mcp <span class="free">z</span> <span class="free">W</span> <span class="free">p</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mcp' <span class="free">z</span> <span class="free">W</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mcp_unique <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mcp'.elims theI_unique<span class="main">)</span> 

<span class="keyword1" id="ASC_Suite-mcp_prefix_of_suffix"><span class="command">lemma</span></span> mcp_prefix_of_suffix <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"prefix <span class="free">xs'</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs'</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> mcp <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs'</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>prefix <span class="free">vs</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">∧</span> 
                 <span class="main">(</span><span class="main">∀</span> <span class="bound">p'</span> <span class="main">.</span> <span class="main">(</span>prefix <span class="bound">p'</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">p'</span> <span class="main">∈</span> <span class="free">V</span><span class="main">)</span> <span class="main">⟶</span> length <span class="bound">p'</span> <span class="main">≤</span> length <span class="free">vs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p'</span> <span class="main">.</span> <span class="main">(</span>prefix <span class="bound">p'</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">p'</span> <span class="main">∈</span> <span class="free">V</span><span class="main">)</span> <span class="main">⟶</span> length <span class="bound">p'</span> <span class="main">≤</span> length <span class="free">vs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">∧</span> prefix <span class="skolem">vs'</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> length <span class="free">vs</span> <span class="main">&lt;</span> length <span class="skolem">vs'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> leI prefix_append prefix_order.dual_order.trans<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>mcp <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_Suite-minimal_sequence_to_failure_extending_mcp"><span class="command">lemma</span></span> minimal_sequence_to_failure_extending_mcp <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"minimal_sequence_to_failure_extending <span class="free">V</span> <span class="free">M1</span> <span class="free">M2</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span>map fst <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span>map fst <span class="free">vs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> mcp <span class="main">(</span>map fst <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span>map fst <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>map fst <span class="free">vs</span><span class="main">)</span> <span class="main">(</span>map fst <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map fst <span class="free">vs</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mstfe_prefix_input_in_V assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">v'</span> <span class="main">(</span>map fst <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                             <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> 
                             <span class="quoted"><span class="quoted">"length <span class="skolem">v'</span> <span class="main">&gt;</span> length <span class="main">(</span>map fst <span class="free">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> leI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map fst <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v'</span><span class="main">@</span><span class="skolem">x'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prefixE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> minimal_sequence_to_failure_extending.simps sequence_to_failure.simps 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span>map fst <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> DiffE insertI1 language_state_for_inputs_map_fst<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">v'</span><span class="main">@</span><span class="skolem">x'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹map fst <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v'</span> <span class="main">@</span> <span class="skolem">x'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span>map fst <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">}</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
   
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?vs'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="skolem">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"drop <span class="main">(</span>length <span class="skolem">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">=</span> <span class="var">?vs'</span><span class="main">@</span><span class="var">?xs'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_take_drop_id<span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?vs'</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> DiffE <span class="quoted"><span class="quoted">‹map fst <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v'</span> <span class="main">@</span> <span class="skolem">x'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>›</span></span> 
        append_eq_conv_conj append_take_drop_id language_state_for_inputs_map_fst 
        language_state_prefix take_map<span class="main">)</span> 
    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="var">?vs'</span> <span class="main">@</span> <span class="var">?xs'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> drop <span class="main">(</span>length <span class="skolem">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>›</span></span> 
        assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> minimal_sequence_to_failure_extending.simps<span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?xs'</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>map fst <span class="free">vs</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">v'</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">v'</span> <span class="main">(</span>map fst <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> drop <span class="main">(</span>length <span class="skolem">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>›</span></span> prefix_length_le 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> drop <span class="main">(</span>length <span class="skolem">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹take <span class="main">(</span>length <span class="skolem">v'</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span>›</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 
        minimal_sequence_to_failure_extending.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 

<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Function N ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">N</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> narrows the sets of reaction to the determinisitc state cover considered by 
the adaptive state counting algorithm to contain only relevant sequences.
It is the main refinement of the original formulation of the algorithm as given in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "hierons"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
An example for the necessity for this refinement is given in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "refinement"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">N</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="tfree">'in</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> list set set"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="free"><span class="bound"><span class="entity">io</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> <span class="main">{</span> <span class="bound"><span class="bound">V''</span></span> <span class="main">∈</span> Perm <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">.</span> <span class="main">(</span>map fst <span class="main">(</span>mcp' <span class="free"><span class="bound"><span class="entity">io</span></span></span> <span class="bound">V''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>mcp' <span class="main">(</span>map fst <span class="free"><span class="bound"><span class="entity">io</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">}</span>"</span></span>


<span class="keyword1" id="ASC_Suite-N_nonempty"><span class="command">lemma</span></span> N_nonempty <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">io</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"N <span class="free">io</span> <span class="free">M1</span> <span class="free">V</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> det_state_cover_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inputs <span class="free">M1</span> <span class="main">=</span> inputs <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> det_state_cover_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_if_finite_subsets_card_bdd infinite_subset is_det_state_cover.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
        surj_card_le<span class="main">)</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ioV</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span> <span class="free">V</span> <span class="skolem">ioV</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mcp_ex<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">V</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ioV</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">― ‹Proof sketch:
     - ioV uses only inputs of M2 
     - ioV uses only inputs of M1  
     - as M1 completely spec.: ex. reaction of M1 to ioV
     - this reaction is in some V''›</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"d_reaches <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="skolem">ioV</span> <span class="skolem">q2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> det_state_cover_d_reachable<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ioV</span> <span class="main">∈</span> <span class="free">V</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ioV'</span></span> <span class="skolem"><span class="skolem">ioP</span></span> <span class="keyword2"><span class="keyword">where</span></span> io_path <span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ioV</span> <span class="main">=</span> length <span class="skolem">ioV'</span> 
                                        <span class="main">∧</span> length <span class="skolem">ioV</span> <span class="main">=</span> length <span class="skolem">ioP</span> 
                                        <span class="main">∧</span> <span class="main">(</span>path <span class="free">M2</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ioV</span> <span class="main">||</span> <span class="skolem">ioV'</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">ioP</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">∧</span> target <span class="main">(</span><span class="main">(</span><span class="skolem">ioV</span> <span class="main">||</span> <span class="skolem">ioV'</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">ioP</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">q2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span>map fst <span class="main">(</span><span class="main">(</span><span class="skolem">ioV</span> <span class="main">||</span> <span class="skolem">ioV'</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">ioP</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ioV</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ioV</span> <span class="main">||</span> <span class="skolem">ioV'</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">ioP</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> io_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> io_path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map fst <span class="main">(</span>map fst <span class="main">(</span><span class="main">(</span><span class="skolem">ioV</span> <span class="main">||</span> <span class="skolem">ioV'</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">ioP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> inputs <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> path_input_containment<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M2</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ioV</span> <span class="main">||</span> <span class="skolem">ioV'</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">ioP</span>"</span></span> <span class="quoted"><span class="quoted">"initial <span class="free">M2</span>"</span></span> <span class="main">]</span> 
          io_path
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ioV</span> <span class="main">⊆</span> inputs <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ioV</span> <span class="main">⊆</span> inputs <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">ioV</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> language_state_for_inputs_nonempty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FSM.nodes.initial<span class="main">)</span> 


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">ioV</span> <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span> <span class="free">V</span> <span class="skolem">ioV</span>›</span></span> mcp.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ioV</span> <span class="main">≤</span> length <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prefix_length_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ioV</span> <span class="main">≤</span> length <span class="free">io</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map fst <span class="free">io</span> <span class="main">||</span> map snd <span class="free">io</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>map snd <span class="free">io</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map fst <span class="free">io</span> <span class="main">||</span> map snd <span class="free">io</span><span class="main">)</span> 
                      <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> language_state_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹map fst <span class="free">io</span> <span class="main">||</span> map snd <span class="free">io</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> 
        language_state_for_input.simps mem_Collect_eq<span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ioV</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">ioV</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">ioV</span> <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span>›</span></span> append_eq_conv_conj prefixE<span class="main">)</span>  

  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="skolem">ioV</span><span class="main">)</span> <span class="free">io</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">ioV</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> language_state_for_input_take
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹map fst <span class="free">io</span> <span class="main">||</span> map snd <span class="free">io</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span>›</span></span> 
        zip_map_fst_snd<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="skolem">ioV</span><span class="main">)</span> <span class="free">io</span> <span class="main">∈</span> <span class="skolem">V''</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> perm_elem<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹inputs <span class="free">M1</span> <span class="main">=</span> inputs <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ioV</span> <span class="main">∈</span> <span class="free">V</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ioV</span> <span class="main">=</span> mcp' <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span> <span class="free">V</span> <span class="skolem">ioV</span>›</span></span> mcp'_intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">ioV</span><span class="main">)</span> <span class="free">io</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ioV</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ioV</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">ioV</span><span class="main">)</span> <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span>›</span></span> take_map<span class="main">)</span> 

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">mcpV''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mcp <span class="free">io</span> <span class="skolem">V''</span> <span class="skolem">mcpV''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mcp_ex perm_elem_finite perm_empty<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">mcpV''</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> perm_inputs
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="free">io</span> <span class="skolem">V''</span> <span class="skolem">mcpV''</span>›</span></span> mcp.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">mcpV''</span> <span class="main">=</span> <span class="skolem">ioV</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹map fst <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">ioV</span><span class="main">)</span> <span class="free">io</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ioV</span>›</span></span> <span class="quoted"><span class="quoted">‹map fst <span class="skolem">mcpV''</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span> <span class="free">V</span> <span class="skolem">ioV</span>›</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="free">io</span> <span class="skolem">V''</span> <span class="skolem">mcpV''</span>›</span></span> <span class="quoted"><span class="quoted">‹take <span class="main">(</span>length <span class="skolem">ioV</span><span class="main">)</span> <span class="free">io</span> <span class="main">∈</span> <span class="skolem">V''</span>›</span></span> 
        map_mono_prefix mcp.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prefix_length_prefix prefix_order.dual_order.antisym 
        take_is_prefix<span class="main">)</span>  

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span>mcp' <span class="free">io</span> <span class="skolem">V''</span><span class="main">)</span> <span class="main">=</span> mcp' <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ioV</span> <span class="main">=</span> mcp' <span class="main">(</span>map fst <span class="free">io</span><span class="main">)</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹map fst <span class="skolem">mcpV''</span> <span class="main">=</span> <span class="skolem">ioV</span>›</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="free">io</span> <span class="skolem">V''</span> <span class="skolem">mcpV''</span>›</span></span> mcp'_intro 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ASC_Suite-N_mcp_prefix"><span class="command">lemma</span></span> N_mcp_prefix <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"map fst <span class="free">vs</span> <span class="main">=</span> mcp' <span class="main">(</span>map fst <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> N <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">M1</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> <span class="free">V''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> mcp' <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V''</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span>mcp' <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V''</span><span class="main">)</span> <span class="main">=</span> mcp' <span class="main">(</span>map fst <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span>mcp' <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V''</span><span class="main">)</span> <span class="main">=</span> map fst <span class="free">vs</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>mcp' <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V''</span><span class="main">)</span> <span class="main">=</span> length <span class="free">vs</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_map<span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">V''</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> perm_empty<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> N.simps assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V''</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> perm_elem_finite<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> N.simps assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V''</span> <span class="skolem">p</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mcp_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp' <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V''</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> mcp'_intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>mcp' <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V''</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> mcp'.simps mcp.simps
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="free">V''</span> <span class="skolem">p</span>›</span></span> mcp.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">=</span> mcp' <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>mcp' <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="free">V''</span><span class="main">)</span> <span class="main">=</span> length <span class="free">vs</span>›</span></span> append_eq_append_conv prefix_def<span class="main">)</span> 

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> <span class="free">V''</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="free">V''</span> <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹mcp' <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="free">V''</span> <span class="main">=</span> <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">=</span> mcp' <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="free">V''</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Functions TS, C, RM ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Function T<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">TS</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> defines the calculation of the test suite used by the adaptive state 
counting algorithm in an iterative way.
It is defined using the three functions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">TS</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">C</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">RM</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> where
   <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">TS</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> represents the test suite calculated up to some iteration,
   <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">C</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> contains the sequences considered for extension in some iteration, and
   <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">RM</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> contains the sequences of the corresponding <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">C</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> result that are not to
                  be extended, which we also call removed sequences.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">append_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> list set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">append_set</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">xs</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">|</span> <span class="bound">xs</span> <span class="bound">x</span> <span class="main">.</span> <span class="bound">xs</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">append_sets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list set <span class="main">⇒</span> <span class="tfree">'a</span> list set <span class="main">⇒</span> <span class="tfree">'a</span> list set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">append_sets</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">xs</span> <span class="main">@</span> <span class="bound">xs'</span> <span class="main">|</span> <span class="bound">xs</span> <span class="bound">xs'</span> <span class="main">.</span> <span class="bound">xs</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">∧</span> <span class="bound">xs'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">TS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> FSM 
            <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set <span class="main">⇒</span> <span class="tfree">'in</span> list set <span class="main">⇒</span> nat <span class="main">⇒</span> nat 
            <span class="main">⇒</span> <span class="tfree">'in</span> list set"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity">C</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> FSM 
            <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set <span class="main">⇒</span> <span class="tfree">'in</span> list set <span class="main">⇒</span> nat <span class="main">⇒</span> nat 
            <span class="main">⇒</span> <span class="tfree">'in</span> list set"</span></span>   
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity">RM</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state1</span><span class="main">)</span> FSM <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state2</span><span class="main">)</span> FSM 
            <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">)</span> ATC set <span class="main">⇒</span> <span class="tfree">'in</span> list set <span class="main">⇒</span> nat <span class="main">⇒</span> nat 
            <span class="main">⇒</span> <span class="tfree">'in</span> list set"</span></span>   
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">RM</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">RM</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="free">C</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">.</span>
      <span class="main">(</span><span class="main">¬</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">.</span>
          <span class="main">∃</span> <span class="bound">V''</span> <span class="main">∈</span> N <span class="bound">io</span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">.</span>  
            <span class="main">∃</span> <span class="bound">S1</span> <span class="main">.</span> 
              <span class="main">∃</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">.</span>
                <span class="bound">io</span> <span class="main">=</span> <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span>
                <span class="main">∧</span> mcp <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span>
                <span class="main">∧</span> <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free"><span class="bound"><span class="entity">M2</span></span></span>
                <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span>
                  <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span> 
                    <span class="main">(</span><span class="main">∀</span> <span class="bound">io1</span> <span class="main">∈</span> RP <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                       <span class="main">∀</span> <span class="bound">io2</span> <span class="main">∈</span> RP <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                         B <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="bound">io1</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">≠</span> B <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="bound">io2</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="main">)</span><span class="main">)</span>
                <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">&lt;</span> LB <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="free">TS</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="bound">S1</span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span>append_set <span class="main">(</span><span class="main">(</span><span class="free">C</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">RM</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free"><span class="bound"><span class="entity">M2</span></span></span><span class="main">)</span><span class="main">)</span> 
    <span class="main">-</span> <span class="main">(</span><span class="free">TS</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">TS</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="free">TS</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">C</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 
    
    

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">lists_of_length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">lists_of_length</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">xs</span> <span class="main">.</span> length <span class="bound">xs</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="ASC_Suite-append_lists_of_length_alt_def"><span class="command">lemma</span></span> append_lists_of_length_alt_def <span class="main">:</span>
  <span class="quoted"><span class="quoted">"append_sets <span class="free">T</span> <span class="main">(</span>lists_of_length <span class="free">X</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> append_set <span class="main">(</span>append_sets <span class="free">T</span> <span class="main">(</span>lists_of_length <span class="free">X</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"append_sets <span class="free">T</span> <span class="main">(</span>lists_of_length <span class="free">X</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">⊆</span> append_set <span class="main">(</span>append_sets <span class="free">T</span> <span class="main">(</span>lists_of_length <span class="free">X</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tx</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">∈</span> append_sets <span class="free">T</span> <span class="main">(</span>lists_of_length <span class="free">X</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">@</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">tx</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">x</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">x</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans prefixeq_butlast set_mono_prefix<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">x</span> <span class="main">∈</span> lists_of_length <span class="free">X</span> <span class="free">n</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">@</span><span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> append_sets <span class="free">T</span> <span class="main">(</span>lists_of_length <span class="free">X</span> <span class="free">n</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="free">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">x</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">@</span><span class="main">(</span>butlast <span class="skolem">x</span><span class="main">)</span><span class="main">@</span><span class="main">[</span>last <span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> append_set <span class="main">(</span>append_sets <span class="free">T</span> <span class="main">(</span>lists_of_length <span class="free">X</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">X</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">∈</span> append_set <span class="main">(</span>append_sets <span class="free">T</span> <span class="main">(</span>lists_of_length <span class="free">X</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">X</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span><span class="main">@</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">tx</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"append_set <span class="main">(</span>append_sets <span class="free">T</span> <span class="main">(</span>lists_of_length <span class="free">X</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">X</span> 
          <span class="main">⊆</span> append_sets <span class="free">T</span> <span class="main">(</span>lists_of_length <span class="free">X</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tx</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">∈</span> append_set <span class="main">(</span>append_sets <span class="free">T</span> <span class="main">(</span>lists_of_length <span class="free">X</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tx'</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">=</span> <span class="skolem">tx'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tx'</span> <span class="main">∈</span> append_sets <span class="free">T</span> <span class="main">(</span>lists_of_length <span class="free">X</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tx''</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tx''</span><span class="main">@</span><span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">tx'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tx''</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">x'</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">x'</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tx''</span><span class="main">@</span><span class="skolem">x'</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">tx</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tx</span> <span class="main">=</span> <span class="skolem">tx'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tx''</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">tx''</span> <span class="main">∈</span> <span class="free">T</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">x'</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Suc <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">x'</span> <span class="main">=</span> <span class="free">n</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">x'</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">x'</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tx</span> <span class="main">∈</span> append_sets <span class="free">T</span> <span class="main">(</span>lists_of_length <span class="free">X</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Basic properties of the test suite calculation functions ›</span></span>

<span class="keyword1" id="ASC_Suite-C_step"><span class="command">lemma</span></span> C_step <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>append_set <span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms not0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>append_set <span class="main">(</span><span class="var">?C</span> <span class="free">n</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="var">?TS</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> n_def C.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="free">n</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> TS.elims UnCI assms neq0_conv subsetI<span class="main">)</span>  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span> <span class="var">?C</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ASC_Suite-C_extension"><span class="command">lemma</span></span> C_extension <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> append_sets <span class="free">V</span> <span class="main">(</span>lists_of_length <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>append_set <span class="main">(</span><span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> C_step<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"append_set <span class="main">(</span><span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> 
                  <span class="main">⊆</span> append_set <span class="main">(</span>append_sets <span class="free">V</span> <span class="main">(</span>lists_of_length <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> I_Step <span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> append_set <span class="main">(</span>append_sets <span class="free">V</span> <span class="main">(</span>lists_of_length <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> order_trans<span class="main">)</span> 

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> append_lists_of_length_alt_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"inputs <span class="free">M2</span>"</span></span><span class="main">]</span> I_Step 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_Suite-TS_union"><span class="command">lemma</span></span> TS_union <span class="main">:</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">j</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?TS</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?TS</span> <span class="skolem">i</span> <span class="main">∪</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> C.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> TS.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> TS.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> TS.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> not0_implies_Suc 
        sup_bot.right_neutral sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?TS</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">j</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">i</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> <span class="var">?C</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∪</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1" id="ASC_Suite-C_disj_le_gz"><span class="command">lemma</span></span> C_disj_le_gz <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">∩</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> Suc <span class="free">j</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">j</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> not0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>append_set <span class="main">(</span><span class="var">?C</span> <span class="free">j</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span><span class="main">)</span>  <span class="main">-</span> <span class="var">?TS</span> <span class="free">j</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> C.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="main">∩</span> <span class="var">?TS</span> <span class="free">j</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="free">i</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="free">j</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> TS_union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_Suite-C_disj_lt"><span class="command">lemma</span></span> C_disj_lt <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">∩</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">j</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> C_disj_le_gz
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms gr_implies_not0 less_Suc_eq_le old.nat.exhaust zero_less_Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="ASC_Suite-C_disj"><span class="command">lemma</span></span> C_disj <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">∩</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">j</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C_disj_lt Int_commute antisym_conv3 assms<span class="main">)</span>
  



<span class="keyword1" id="ASC_Suite-RM_subset"><span class="command">lemma</span></span> RM_subset <span class="main">:</span> <span class="quoted"><span class="quoted">"RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">⊆</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> RM.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ASC_Suite-RM_disj"><span class="command">lemma</span></span> RM_disj <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">∩</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?RM</span> <span class="free">i</span> <span class="main">⊆</span> <span class="var">?C</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?RM</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> RM_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="free">i</span> <span class="main">∩</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> C_disj_le_gz<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="ASC_Suite-T_extension"><span class="command">lemma</span></span> T_extension <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">-</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">n</span> 
          <span class="main">⊆</span> <span class="main">(</span>append_set <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> n_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms not0_implies_Suc 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>append_set <span class="main">(</span><span class="var">?C</span> <span class="free">n</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="var">?TS</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> n_def <span class="keyword1"><span class="command">using</span></span> C.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span> <span class="var">?TS</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="free">n</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TS_union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> append_set <span class="main">(</span><span class="var">?TS</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span> <span class="var">?TS</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?TS</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="var">?TS</span> <span class="free">n</span> <span class="main">⊆</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> TS.simps<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ASC_Suite-append_set_prefix"><span class="command">lemma</span></span> append_set_prefix <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> append_set <span class="free">T</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"butlast <span class="free">xs</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 


<span class="keyword1" id="ASC_Suite-C_subset"><span class="command">lemma</span></span> C_subset <span class="main">:</span> <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">⊆</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TS_union<span class="main">)</span> 
  

<span class="keyword1" id="ASC_Suite-TS_subset"><span class="command">lemma</span></span> TS_subset <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">⊆</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">k</span><span class="main">)</span>"</span></span> 
       <span class="quoted"><span class="quoted">"TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">k</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">j</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">k</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> TS_union <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span> <span class="main">⊆</span> set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">j</span><span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1" id="ASC_Suite-C_immediate_prefix_containment"><span class="command">lemma</span></span> C_immediate_prefix_containment <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> butlast <span class="free">xs</span> <span class="main">∉</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RM</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RM</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∉</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RM</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">as</span> <span class="bound">a</span><span class="main">.</span> <span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">≠</span> <span class="bound">as</span> <span class="main">@</span> <span class="main">[</span><span class="bound">a</span><span class="main">]</span> 
                  <span class="main">∨</span> <span class="bound">as</span> <span class="main">∉</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> 
                  <span class="main">∨</span> <span class="bound">a</span> <span class="main">∉</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> butlast <span class="free">xs</span> <span class="main">∉</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>›</span></span> 
          assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> butlast_append butlast_snoc<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∉</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="ASC_Suite-TS_immediate_prefix_containment"><span class="command">lemma</span></span> TS_immediate_prefix_containment <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="skolem">j</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>  TS_union<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">i</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nn</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> list set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v3</span><span class="main">.</span> <span class="bound">v3</span> <span class="main">∈</span> <span class="bound">x0</span> <span class="main">∧</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="bound">v3</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">nn</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x0</span> <span class="main">∧</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">(</span><span class="skolem">nn</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> UNION <span class="main">(</span>set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">Ω</span> <span class="bound">V</span> <span class="bound">T</span> <span class="bound">S</span> <span class="bound">M2</span> <span class="bound">M1</span><span class="main">.</span> TS <span class="bound">M2</span> <span class="bound">M1</span> <span class="bound">Ω</span> <span class="bound">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span><span class="main">∈</span>set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">.</span> C <span class="bound">M2</span> <span class="bound">M1</span> <span class="bound">Ω</span> <span class="bound">V</span> <span class="free">m</span> <span class="bound">j</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nn</span> <span class="main">(</span>set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span> 
                  <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">nn</span> <span class="main">(</span>set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="free">i</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> atLeastLessThan_iff leD not_less_eq_eq set_upt<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> <span class="main">{}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> j_def 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">V</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">=</span> <span class="free">vs</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> mcp_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">vs</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> j_assms <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> 
                       <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RM</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span> <span class="var">?TS</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> C.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> j_assms j_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>›</span></span> append_set_prefix subsetCE<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">k</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> j_assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="skolem">j</span> <span class="main">∩</span> <span class="var">?C</span> <span class="main">1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> C_disj_le_gz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> j_assms<span class="main">(</span>1<span class="main">)</span> less_numeral_extra<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="skolem">j</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∉</span> <span class="free">V</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> butlast_append<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> j_assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="skolem">j</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TS_union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UN_upper atLeast_upt lessThan_iff<span class="main">)</span>
      

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> butlast <span class="free">xs</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="skolem">j</span>›</span></span> j_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> j_def TS_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">j</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="ASC_Suite-TS_prefix_containment"><span class="command">lemma</span></span> TS_prefix_containment <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"prefix <span class="free">xs'</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs'</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
<span class="comment1">― ‹ Proof sketch:
       Perform induction on length difference, as from each prefix it is possible to deduce the 
       desired property for the prefix one element smaller than it via above results›</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">-</span> length <span class="free">xs'</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">xs'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 append_eq_conv_conj gr_implies_not0 length_drop length_greater_0_conv prefixE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>2<span class="main">)</span> append_eq_append_conv assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>›</span></span> TS.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> TS_subset append_Nil2 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          contra_subsetD leD mcp.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_less_eq_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">xs'</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">xs'</span><span class="main">@</span><span class="skolem">xs''</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span> prefixE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs''</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> length <span class="free">xs</span> <span class="main">-</span> length <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">xs</span> <span class="main">=</span> <span class="skolem">xs'</span><span class="main">@</span><span class="skolem">xs''</span>›</span></span> Suc.hyps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> <span class="free">xs</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">xs</span> <span class="main">=</span> <span class="skolem">xs'</span><span class="main">@</span><span class="skolem">xs''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs''</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_prefix_Cons list.exhaust_sel prefix_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> same_prefix_prefix<span class="main">)</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Suc.hyps<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ Suc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      
      
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">xs</span> <span class="main">=</span> <span class="skolem">xs'</span><span class="main">@</span><span class="skolem">xs''</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs''</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aas</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list set <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v3</span><span class="main">.</span> <span class="main">(</span>prefix <span class="bound">v3</span> <span class="bound">x2</span> <span class="main">∧</span> <span class="bound">v3</span> <span class="main">∈</span> <span class="bound">x1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> length <span class="bound">v3</span> <span class="main">≤</span> length <span class="bound">x0</span><span class="main">)</span> 
                       <span class="main">=</span> <span class="main">(</span><span class="main">(</span>prefix <span class="main">(</span><span class="skolem">aas</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span> <span class="bound">x2</span> <span class="main">∧</span> <span class="skolem">aas</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x1</span><span class="main">)</span> 
                           <span class="main">∧</span> <span class="main">¬</span> length <span class="main">(</span><span class="skolem">aas</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">≤</span> length <span class="bound">x0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">as</span> <span class="bound">A</span> <span class="bound">asa</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> mcp <span class="bound">as</span> <span class="bound">A</span> <span class="bound">asa</span> 
                                    <span class="main">∨</span> prefix <span class="bound">asa</span> <span class="bound">as</span> <span class="main">∧</span> <span class="bound">asa</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">asb</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> prefix <span class="bound">asb</span> <span class="bound">as</span> <span class="main">∨</span> <span class="bound">asb</span> <span class="main">∉</span> <span class="bound">A</span><span class="main">)</span> 
                                                                        <span class="main">∨</span> length <span class="bound">asb</span> <span class="main">≤</span> length <span class="bound">asa</span><span class="main">)</span><span class="main">)</span> 
                                  <span class="main">∧</span> <span class="main">(</span>mcp <span class="bound">as</span> <span class="bound">A</span> <span class="bound">asa</span> 
                                    <span class="main">∨</span> <span class="main">¬</span> prefix <span class="bound">asa</span> <span class="bound">as</span> 
                                    <span class="main">∨</span> <span class="bound">asa</span> <span class="main">∉</span> <span class="bound">A</span> 
                                    <span class="main">∨</span> <span class="main">(</span>prefix <span class="main">(</span><span class="skolem">aas</span> <span class="bound">asa</span> <span class="bound">A</span> <span class="bound">as</span><span class="main">)</span> <span class="bound">as</span> <span class="main">∧</span> <span class="skolem">aas</span> <span class="bound">asa</span> <span class="bound">A</span> <span class="bound">as</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">)</span> 
                                        <span class="main">∧</span> <span class="main">¬</span> length <span class="main">(</span><span class="skolem">aas</span> <span class="bound">asa</span> <span class="bound">A</span> <span class="bound">as</span><span class="main">)</span> <span class="main">≤</span> length <span class="bound">asa</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aasa</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v2</span><span class="main">.</span> <span class="bound">x0</span> <span class="main">=</span> <span class="bound">x1</span> <span class="main">@</span> <span class="bound">v2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x0</span> <span class="main">=</span> <span class="bound">x1</span> <span class="main">@</span> <span class="skolem">aasa</span> <span class="bound">x0</span> <span class="bound">x1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">aasa</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="skolem">xs''</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> 
                        <span class="main">=</span> <span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">aasa</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> 
                            <span class="main">@</span> <span class="skolem">aasa</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="skolem">xs''</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> prefixE prefixI<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">@</span> <span class="skolem">xs''</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">aasa</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="skolem">xs''</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">xs</span> <span class="main">=</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="skolem">xs''</span>›</span></span> prefixE<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">aasa</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> 
                      <span class="main">@</span> <span class="skolem">aasa</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="skolem">xs''</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> 
                    <span class="main">=</span> <span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">xs</span> <span class="main">=</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="skolem">xs''</span>›</span></span> local.Cons<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> prefix <span class="main">(</span><span class="skolem">aas</span> <span class="free">vs</span> <span class="free">V</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> 
                    <span class="main">∨</span> <span class="skolem">aas</span> <span class="free">vs</span> <span class="free">V</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> <span class="main">∉</span> <span class="free">V</span> 
                    <span class="main">∨</span> length <span class="main">(</span><span class="skolem">aas</span> <span class="free">vs</span> <span class="free">V</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">vs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>›</span></span> local.Cons prefix_append<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>›</span></span> prefixI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> 
      
      
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> butlast <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> TS_immediate_prefix_containment
              <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>›</span></span> _ <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>›</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">=</span> butlast <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span>hd <span class="skolem">xs''</span><span class="main">]</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs''</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>







<span class="keyword1" id="ASC_Suite-C_index"><span class="command">lemma</span></span> C_index <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="main">[]</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="main">[]</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="main">[]</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="main">[]</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">i</span> <span class="main">∩</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Nil.prems<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="main">[]</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="main">[]</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> C_disj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs'</span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> <span class="var">?C</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> <span class="var">?C</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> snoc.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_one linorder_neqE_nat<span class="main">)</span> 

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> butlast <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main">-</span> Suc <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc_diff_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> One_nat_def Suc_lessD <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">i</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C_immediate_prefix_containment DiffD1 One_nat_def Suc_pred' snoc.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                    snoc_eq_iff_butlast<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> butlast <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mcp_prefix_of_suffix prefixeq_butlast snoc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">-</span><span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> snoc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_Suite-TS_index"><span class="command">lemma</span></span> TS_index <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TS_union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> UN_iff assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> atLeastLessThan_iff set_upt<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> C_index assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ASC_Suite-C_extension_options"><span class="command">lemma</span></span> C_extension_options <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> inputs <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">∨</span> <span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> gr0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> C.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∈</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∉</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∉</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∈</span> <span class="var">?C</span> <span class="skolem">j</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> TS_union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> C_index assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="free">i</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> C_index
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mcp_prefix_of_suffix prefixI<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?C</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span> <span class="var">?TS</span> <span class="free">i</span>›</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

  




<span class="keyword1" id="ASC_Suite-TS_non_containment_causes"><span class="command">lemma</span></span> TS_non_containment_causes <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∉</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> inputs <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">xr</span> <span class="bound">j</span> <span class="main">.</span> <span class="bound">xr</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">@</span><span class="bound">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span><span class="main">)</span>
       <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">xc</span> <span class="main">.</span> <span class="bound">xc</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xc</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">@</span><span class="bound">xc</span> <span class="main">∈</span> <span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?PrefPreviouslyRemoved</span> <span class="main">∨</span> <span class="var">?PrefJustContained</span>"</span></span><span class="main">)</span>
      <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">xr</span> <span class="bound">j</span> <span class="main">.</span> <span class="bound">xr</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">@</span><span class="bound">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span><span class="main">)</span>
         <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">xc</span> <span class="main">.</span> <span class="bound">xc</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xc</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">@</span><span class="bound">xc</span> <span class="main">∈</span> <span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹If a sequence is not contained in TS up to (incl.) iteration i, then either a prefix of it has 
      been removed or a prefix of it is contained in the C set for iteration i›</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?PrefPreviouslyRemoved</span> <span class="main">∨</span> <span class="var">?PrefJustContained</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="var">?PrefPreviouslyRemoved</span> <span class="main">∨</span> <span class="var">?PrefJustContained</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?PrefPreviouslyRemoved</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?PrefJustContained</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">xr</span> <span class="bound">j</span><span class="main">.</span> prefix <span class="bound">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xr</span> <span class="main">∈</span> <span class="var">?RM</span> <span class="bound">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xr</span> <span class="bound">j</span><span class="main">.</span> prefix <span class="bound">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xr</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">xr</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?RM</span> <span class="skolem">j</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xr</span> <span class="main">=</span> <span class="free">xs</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?RM</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?RM</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?TS</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> C_subset RM_subset <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?RM</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> TS_subset <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?PrefPreviouslyRemoved</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xr</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?RM</span> <span class="skolem">j</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
      

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">k</span> <span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">≤</span> Suc <span class="bound">k</span> <span class="main">∧</span> Suc <span class="bound">k</span> <span class="main">≤</span> <span class="free">i</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">vs</span> <span class="main">@</span> <span class="main">(</span>take <span class="bound">k</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RM</span> <span class="main">(</span>Suc <span class="bound">k</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> Suc <span class="skolem">k</span> <span class="main">∧</span> Suc <span class="skolem">k</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="main">(</span>take <span class="skolem">k</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RM</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">1</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"0.prems"</span> DiffI One_nat_def 
              <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">xr</span> <span class="bound">j</span><span class="main">.</span> prefix <span class="bound">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span><span class="main">)</span>›</span></span> 
              append_Nil2 take_0 take_is_prefix<span class="main">)</span>  
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> Suc <span class="skolem">k</span> <span class="main">∧</span> Suc <span class="skolem">k</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> take <span class="skolem">k</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> take <span class="skolem">k</span> <span class="free">xs</span> <span class="main">∉</span> <span class="var">?RM</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> Suc <span class="skolem">k</span> <span class="main">∧</span> Suc <span class="skolem">k</span> <span class="main">≤</span> <span class="free">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?PrefPreviouslyRemoved</span>›</span></span> take_is_prefix Suc.IH 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> take <span class="skolem">k</span> <span class="free">xs</span> <span class="main">∈</span> <span class="main">(</span><span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="var">?RM</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> take <span class="skolem">k</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>›</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C_subset TS_subset <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">≤</span> Suc <span class="skolem">k</span> <span class="main">∧</span> Suc <span class="skolem">k</span> <span class="main">≤</span> <span class="free">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>›</span></span> 
                contra_subsetD<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> inputs <span class="free">M2</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> inputs <span class="free">M2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_eq take_Suc_conv_app_nth<span class="main">)</span>  

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> take <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∈</span> append_set <span class="main">(</span><span class="main">(</span><span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="var">?RM</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="skolem">k</span> <span class="main">∈</span> inputs <span class="free">M2</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">xs</span> <span class="main">⊆</span> inputs <span class="free">M2</span>›</span></span> nth_mem subset_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> take <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> take <span class="skolem">k</span> <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">xs</span> <span class="main">!</span> <span class="skolem">k</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span> take_Suc_conv_app_nth<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> f1 <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> take <span class="skolem">k</span> <span class="free">xs</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span> 

        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> take <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∉</span> <span class="var">?TS</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> take <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?TS</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="skolem">k</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> TS_index<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> mcp_prefix_of_suffix take_is_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="main">(</span>take <span class="skolem">k</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_index <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> take <span class="skolem">k</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mcp_prefix_of_suffix take_is_prefix<span class="main">)</span> 
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">qed</span></span>
        
        
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> take <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RM</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> C.simps<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> DiffI Suc.prems 
              <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">xr</span> <span class="bound">j</span><span class="main">.</span> prefix <span class="bound">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span><span class="main">)</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> take <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∉</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>›</span></span> calculation take_is_prefix<span class="main">)</span>          
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> take <span class="main">(</span><span class="free">i</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_diff_1 Suc_leI le_less<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?PrefJustContained</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C_subset DiffD1 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subsetCE take_is_prefix<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?PrefJustContained</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>



  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="var">?PrefPreviouslyRemoved</span> <span class="main">∧</span> <span class="var">?PrefJustContained</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?PrefPreviouslyRemoved</span> <span class="main">∧</span> <span class="var">?PrefJustContained</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?PrefPreviouslyRemoved</span>"</span></span> 
              <span class="quoted"><span class="quoted">"<span class="var">?PrefJustContained</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xr</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">xr</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?RM</span> <span class="skolem">j</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?PrefPreviouslyRemoved</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">xc</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xc</span> <span class="main">∈</span> <span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?PrefJustContained</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xc</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> C_index
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mcp_prefix_of_suffix<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xc</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xc</span> <span class="free">xs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_length_le<span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xc</span> <span class="main">≠</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xc</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> <span class="var">?C</span> <span class="free">i</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="skolem">xc</span> <span class="main">∈</span> <span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∈</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> C_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xc</span> <span class="free">xs</span>›</span></span> not_less_eq_eq prefix_length_prefix prefix_order.antisym 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 



    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main">&lt;</span> <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="bound">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>    
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> take <span class="skolem">n</span> <span class="free">xs</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> length <span class="skolem">xc</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">i</span>›</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>length <span class="skolem">xc</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>›</span></span> less_Suc_eq_le 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="main">(</span>take <span class="skolem">n</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">xc</span> <span class="main">≤</span> length <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> length <span class="skolem">xc</span>›</span></span> order_trans 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>take <span class="skolem">n</span> <span class="free">xs</span><span class="main">)</span> <span class="skolem">xc</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> length <span class="skolem">xc</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xc</span> <span class="free">xs</span>›</span></span> length_take min.absorb2 
                prefix_length_prefix take_is_prefix<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> take <span class="skolem">n</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> C_subset DiffD1 TS_prefix_containment <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xc</span> <span class="free">xs</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> contra_subsetD 
              mcp_prefix_of_suffix same_prefix_prefix<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">jn</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">jn</span> <span class="main">&lt;</span> Suc <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="skolem">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="skolem">jn</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TS_union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UN_iff atLeast_upt lessThan_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> take <span class="skolem">n</span> <span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mcp_prefix_of_suffix take_is_prefix<span class="main">)</span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">jn</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="main">(</span>take <span class="skolem">n</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> C_index<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">n</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">jn</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">jn</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">xc</span> <span class="main">≤</span> length <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> length <span class="skolem">xc</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="skolem">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="skolem">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="skolem">jn</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>


    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main">&lt;</span> <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="bound">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?RM</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>    
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> take <span class="skolem">n</span> <span class="free">xs</span> <span class="main">∉</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> length <span class="skolem">xc</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="skolem">xc</span> <span class="main">∈</span> <span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD2 <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>length <span class="skolem">xc</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xc</span> <span class="free">xs</span>›</span></span> append_eq_conv_conj prefixE<span class="main">)</span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">xc</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">i</span>›</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>length <span class="skolem">xc</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 

        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">xc</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>length <span class="skolem">xc</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">xc</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main">&lt;</span> <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="bound">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> butlast <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RM</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> True C_immediate_prefix_containment<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_neq_Zero <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xc</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xc</span> <span class="main">≠</span> <span class="free">xs</span>›</span></span> prefix_Nil take_eq_Nil<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD2 Suc_lessD True <span class="quoted"><span class="quoted">‹length <span class="skolem">xc</span> <span class="main">≤</span> length <span class="free">xs</span>›</span></span> butlast_snoc less_le_trans 
                take_Suc_conv_app_nth<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span> <span class="main">=</span> length <span class="skolem">xc</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Suc_lessI <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="skolem">xc</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>length <span class="skolem">xc</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">⟹</span> <span class="free">vs</span> <span class="main">@</span> take <span class="bound">n</span> <span class="free">xs</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>›</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> butlast <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="var">?RM</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> False C_immediate_prefix_containment<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_neq_Zero <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xc</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xc</span> <span class="main">≠</span> <span class="free">xs</span>›</span></span> prefix_Nil take_eq_Nil<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">=</span> length <span class="skolem">xc</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">xc</span> <span class="main">≤</span> length <span class="free">xs</span>›</span></span> butlast_take diff_Suc_1<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>


    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xr</span> <span class="main">=</span> take <span class="skolem">j</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?C</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?RM</span> <span class="skolem">j</span>›</span></span> RM_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> C_index
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_le_lessD <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">⟹</span> <span class="free">vs</span> <span class="main">@</span> take <span class="bound">n</span> <span class="free">xs</span> <span class="main">∉</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xr</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span>›</span></span> append_eq_conv_conj assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
            mcp_prefix_of_suffix prefix_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>
 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∉</span> <span class="var">?RM</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> C_index RM_subset <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">≤</span> length <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xr</span> <span class="free">xs</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="skolem">xr</span> <span class="main">=</span> take <span class="skolem">j</span> <span class="free">xs</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> contra_subsetD dual_order.trans length_take lessI less_irrefl 
          mcp_prefix_of_suffix min.absorb2<span class="main">)</span> 
    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?RM</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>    
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

  


<span class="keyword1" id="ASC_Suite-TS_non_containment_causes_rev"><span class="command">lemma</span></span> TS_non_containment_causes_rev <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">xr</span> <span class="bound">j</span> <span class="main">.</span> <span class="bound">xr</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">@</span><span class="bound">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span><span class="main">)</span>
       <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">xc</span> <span class="main">.</span> <span class="bound">xc</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xc</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">@</span><span class="bound">xc</span> <span class="main">∈</span> <span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?PrefPreviouslyRemoved</span> <span class="main">∨</span> <span class="var">?PrefJustContained</span>"</span></span><span class="main">)</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∉</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?PrefPreviouslyRemoved</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?PrefPreviouslyRemoved</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xr</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xr</span> <span class="main">≠</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">xr</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?RM</span> <span class="skolem">j</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∉</span> <span class="var">?C</span> <span class="skolem">j</span> <span class="main">-</span> <span class="var">?RM</span> <span class="skolem">j</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

     
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?C</span> <span class="skolem">j</span> <span class="main">-</span> <span class="var">?RM</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xr</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xr</span> <span class="main">∉</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span>›</span></span> 
            append_eq_conv_conj prefix_def<span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> RM.simps<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j'</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">⊆</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="skolem">j</span> <span class="main">-</span> <span class="var">?RM</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> C.simps<span class="main">(</span>3<span class="main">)</span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xr</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xr</span> <span class="main">≠</span> <span class="free">xs</span>›</span></span> append_eq_conv_conj not_le prefix_def 
              take_Suc_conv_app_nth take_all<span class="main">)</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="skolem">j</span> <span class="main">-</span> <span class="var">?RM</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?C</span> <span class="skolem">j</span> <span class="main">-</span> <span class="var">?RM</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">⊆</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="skolem">j</span> <span class="main">-</span> <span class="var">?RM</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_is_prefix<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> TS_prefix_containment<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span> <span class="main">&lt;</span> Suc <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="skolem">j'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> TS_union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> C_index<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> length <span class="free">xs</span> <span class="main">≤</span> length <span class="skolem">xr</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xr</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xr</span> <span class="main">≠</span> <span class="free">xs</span>›</span></span> append_Nil2 append_eq_conv_conj leD 
            nat_less_le prefix_def prefix_length_le<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">i</span> <span class="bound">Ω</span> <span class="bound">V</span> <span class="bound">T</span> <span class="bound">S</span> <span class="bound">M2</span> <span class="bound">M1</span><span class="main">.</span> <span class="main">⟦</span><span class="free">vs</span> <span class="main">@</span> take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∈</span> C <span class="bound">M2</span> <span class="bound">M1</span> <span class="bound">Ω</span> <span class="bound">V</span> <span class="free">m</span> <span class="bound">i</span><span class="main">;</span> 
                                                    mcp <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="bound">V</span> <span class="free">vs</span><span class="main">⟧</span> 
                                                  <span class="main">⟹</span> Suc <span class="main">(</span>length <span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">i</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹<span class="skolem">j'</span> <span class="main">&lt;</span> Suc <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j'</span>›</span></span> 
            append_eq_conv_conj assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> length_take mcp_prefix_of_suffix min.absorb2 
            not_less_eq_eq prefix_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?RM</span> <span class="skolem">j</span>›</span></span> RM_subset C_index
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xr</span> <span class="free">xs</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mcp_prefix_of_suffix subsetCE<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j'</span> <span class="main">=</span> Suc <span class="skolem">j</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j'</span> <span class="main">&lt;</span> Suc <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="skolem">j'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span><span class="main">@</span><span class="main">(</span>take <span class="main">(</span>Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

    
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?PrefJustContained</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?PrefJustContained</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xc</span> <span class="main">≠</span> <span class="free">xs</span>"</span></span> 
                         <span class="quoted"><span class="quoted">"prefix <span class="skolem">xc</span> <span class="free">xs</span>"</span></span> 
                         <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">∈</span> <span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
    <span class="comment1">― ‹ only possible if xc = xs ›</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C_index DiffD1 Suc_less_eq TS_index<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">∈</span> <span class="var">?TS</span> <span class="free">i</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> leD le_neq_trans 
          mcp_prefix_of_suffix prefix_length_le prefix_length_prefix 
          prefix_order.dual_order.antisym prefix_order.order_refl<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1" id="ASC_Suite-TS_finite"><span class="command">lemma</span></span> TS_finite <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"finite <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?TS</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">V</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?TS</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="var">?TS</span> <span class="skolem">n</span> <span class="main">∪</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> TS.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> gr0_implies_Suc neq0_conv<span class="main">)</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?TS</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Suc.IH<span class="main">[</span><span class="operator">OF</span> Suc.prems<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> C_step False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="skolem">n</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_subset<span class="main">)</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">⊆</span> append_set <span class="main">(</span><span class="var">?TS</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>append_set <span class="main">(</span><span class="var">?TS</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">n</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> finite_image_set2<span class="main">)</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> infinite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_Suite-C_finite"><span class="command">lemma</span></span> C_finite <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"finite <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">n</span> <span class="main">⊆</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_subset<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> TS_finite<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> Finite_Set.finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Final iteration ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The result of calculating <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">TS</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for some iteration is final if the result does not change 
for the next iteration.

Such a final iteration exists and is at most equal to the number of states of FSM <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
multiplied by an upper bound on the number of states of FSM <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

Furthermore, for any sequence not contained in the final iteration of the test suite, a prefix of
this sequence must be contained in the latter.
›</span></span>

                                                  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">final_iteration</span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> TS <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> TS <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">Ω</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ASC_Suite-final_iteration_ex"><span class="command">lemma</span></span> final_iteration_ex <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"final_iteration <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span> <span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span> <span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reachable <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> det_state_cover_card<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_if_finite_subsets_card_bdd infinite_subset is_det_state_cover.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
        surj_card_le<span class="main">)</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">seq</span> <span class="main">∈</span> <span class="var">?C</span> <span class="var">?i</span> <span class="main">.</span> <span class="bound">seq</span> <span class="main">∈</span> <span class="var">?RM</span> <span class="var">?i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>  
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">seq</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="main">∈</span> <span class="var">?C</span> <span class="var">?i</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="main">∈</span> <span class="var">?RM</span> <span class="var">?i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_det_state_cover <span class="free">M2</span> <span class="free">V</span>›</span></span> det_state_cover_empty 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mcp <span class="skolem">seq</span> <span class="free">V</span> <span class="skolem">vs</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> mcp_ex<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹finite <span class="free">V</span>›</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="main">=</span> <span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prefixE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  
      
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="var">?i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_index
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="skolem">seq</span> <span class="free">V</span> <span class="skolem">vs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">seq</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> <span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
      <span class="keyword1"><span class="command">have</span></span> RM_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?RM</span> <span class="var">?i</span> <span class="main">=</span>  <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="var">?i</span> <span class="main">.</span>
                          <span class="main">(</span><span class="main">¬</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">.</span>
                              <span class="main">(</span><span class="main">∃</span> <span class="bound">V''</span> <span class="main">∈</span> N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span> <span class="main">.</span>  
                                <span class="main">(</span><span class="main">∃</span> <span class="bound">S1</span> <span class="main">.</span> 
                                  <span class="main">(</span><span class="main">∃</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">.</span>
                                    <span class="bound">io</span> <span class="main">=</span> <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span>
                                    <span class="main">∧</span> mcp <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span>
                                    <span class="main">∧</span> <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span>
                                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span>
                                      <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span> 
                                        <span class="main">(</span><span class="main">∀</span> <span class="bound">io1</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                                           <span class="main">∀</span> <span class="bound">io2</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                                             B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span> <span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="var">?TS</span> <span class="main">(</span><span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RM.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>card <span class="main">(</span>nodes <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">m</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">seq</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="skolem">seq</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">seq</span><span class="main">}</span> <span class="main">.</span>
              <span class="main">(</span><span class="main">∃</span> <span class="bound">V''</span> <span class="main">∈</span> N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span> <span class="main">.</span>  
                <span class="main">(</span><span class="main">∃</span> <span class="bound">S1</span> <span class="main">.</span> 
                  <span class="main">(</span><span class="main">∃</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">.</span>
                    <span class="bound">io</span> <span class="main">=</span> <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span>
                    <span class="main">∧</span> mcp <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span>
                    <span class="main">∧</span> <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span>
                      <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span> 
                        <span class="main">(</span><span class="main">∀</span> <span class="bound">io1</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                           <span class="main">∀</span> <span class="bound">io2</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                             B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span> <span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="var">?TS</span> <span class="main">(</span><span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">seq</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="skolem">seq</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> RM_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">seq</span><span class="main">}</span> <span class="main">.</span>
              <span class="main">(</span><span class="main">∃</span> <span class="bound">V''</span> <span class="main">∈</span> N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span> <span class="main">.</span>  
                <span class="main">(</span><span class="main">∃</span> <span class="bound">S1</span> <span class="main">.</span> 
                  <span class="main">(</span><span class="main">∃</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">.</span>
                    <span class="bound">io</span> <span class="main">=</span> <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span>
                    <span class="main">∧</span> mcp <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span>
                    <span class="main">∧</span> <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span>
                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span>
                      <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span> 
                        <span class="main">(</span><span class="main">∀</span> <span class="bound">io1</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                           <span class="main">∀</span> <span class="bound">io2</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                             B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span> <span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="var">?TS</span> <span class="main">(</span><span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> 
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">io</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">seq</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> <span class="main">∈</span> N <span class="skolem">io</span> <span class="free">M1</span> <span class="free">V</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> N_nonempty<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="skolem">io</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">seq</span><span class="main">}</span>›</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

          
  
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V''</span> <span class="main">∈</span> N <span class="skolem">io</span> <span class="free">M1</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="skolem">V''</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> perm_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">V''</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> perm_elem_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"mcp <span class="skolem">io</span> <span class="skolem">V''</span> <span class="skolem">vs</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> mcp_ex<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">[]</span> <span class="main">∈</span> <span class="skolem">V''</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">V''</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="skolem">io</span> <span class="skolem">V''</span> <span class="skolem">vs</span>›</span></span> prefixE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span> <span class="main">∈</span> L <span class="free">M2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">io</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">seq</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">seq</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">io</span> <span class="main">=</span> <span class="skolem">seq</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">io</span> <span class="main">∈</span> <span class="var">?C</span> <span class="var">?i</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">seq</span> <span class="main">∈</span> <span class="var">?C</span> <span class="var">?i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map fst <span class="skolem">vs</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="var">?i</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> map_append<span class="main">)</span> 

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp' <span class="skolem">io</span> <span class="skolem">V''</span> <span class="main">=</span> <span class="skolem">vs</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="skolem">io</span> <span class="skolem">V''</span> <span class="skolem">vs</span>›</span></span> mcp'_intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp' <span class="main">(</span>map fst <span class="skolem">io</span><span class="main">)</span> <span class="free">V</span> <span class="main">=</span> <span class="main">(</span>map fst <span class="skolem">vs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V''</span> <span class="main">∈</span> N <span class="skolem">io</span> <span class="free">M1</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹mcp' <span class="skolem">io</span> <span class="skolem">V''</span> <span class="main">=</span> <span class="skolem">vs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span>map fst <span class="skolem">io</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span>map fst <span class="skolem">vs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">vs</span><span class="main">.</span> mcp <span class="skolem">seq</span> <span class="free">V</span> <span class="bound">vs</span> <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span> 
                <span class="quoted"><span class="quoted">‹map fst <span class="skolem">io</span> <span class="main">=</span> <span class="skolem">seq</span>›</span></span> mcp'_intro<span class="main">)</span> 
          
          
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span>map fst <span class="skolem">vs</span> <span class="main">@</span> map fst <span class="skolem">xs</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span>map fst <span class="skolem">vs</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span> <span class="main">=</span> <span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span>›</span></span><span class="main">)</span> 
          
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="var">?i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_index<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>map fst <span class="skolem">vs</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C</span> <span class="var">?i</span>›</span></span><span class="main">]</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">≤</span> length <span class="skolem">xs</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">M1</span><span class="main">|</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> nodes <span class="free">M2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">q</span> <span class="skolem">vs</span> <span class="skolem">xs</span> <span class="skolem">V''</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> RP_state_repetition_distribution_productF
                  <span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span> <span class="main">≤</span> length <span class="skolem">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">|</span><span class="free">M1</span><span class="main">|</span> <span class="main">≤</span> <span class="free">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>›</span></span> 
                      <span class="quoted"><span class="quoted">‹is_det_state_cover <span class="free">M2</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>›</span></span><span class="main">]</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>          

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">vs</span> <span class="skolem">xs</span> <span class="main">(</span><span class="var">?TS</span> <span class="main">(</span><span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="free">Ω</span> <span class="skolem">V''</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="main">(</span>sum <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="skolem">vs</span> <span class="skolem">xs</span> <span class="skolem">V''</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&lt;</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="skolem">q</span> <span class="skolem">vs</span> <span class="skolem">xs</span> <span class="skolem">V''</span><span class="main">)</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sum <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="main">.</span> card <span class="main">(</span>RP <span class="free">M2</span> <span class="bound">s</span> <span class="skolem">vs</span> <span class="skolem">xs</span> <span class="skolem">V''</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span><span class="main">)</span> 
                              <span class="main">≤</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">vs</span> <span class="skolem">xs</span> <span class="main">(</span><span class="var">?TS</span> <span class="main">(</span><span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="free">Ω</span> <span class="skolem">V''</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 
          <span class="keyword1"><span class="command">qed</span></span>


          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="skolem">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                 <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                    <span class="skolem">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                    mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                    <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                        <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                           <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                           <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> 
                                                                      B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="var">?TS</span> <span class="main">(</span><span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">=</span> <span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span> <span class="main">=</span> <span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span><span class="main">)</span> <span class="skolem">V''</span> <span class="skolem">vs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span> <span class="main">=</span> <span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="skolem">io</span> <span class="skolem">V''</span> <span class="skolem">vs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">⊆</span> nodes <span class="free">M2</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> nodes <span class="free">M2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">.</span>
                        <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span> 
                          <span class="main">(</span><span class="main">∀</span> <span class="bound">io1</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s1</span> <span class="skolem">vs</span> <span class="skolem">xs</span> <span class="skolem">V''</span> <span class="main">.</span>
                             <span class="main">∀</span> <span class="bound">io2</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s2</span> <span class="skolem">vs</span> <span class="skolem">xs</span> <span class="skolem">V''</span> <span class="main">.</span>
                               B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span> <span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
            <span class="keyword1"><span class="command">qed</span></span>
            
            
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> RM_body <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span><span class="main">)</span>
                      <span class="main">∧</span> mcp <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span><span class="main">)</span> <span class="skolem">V''</span> <span class="skolem">vs</span>
                      <span class="main">∧</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">⊆</span> nodes <span class="free">M2</span>
                      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="main">.</span>
                        <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span> 
                          <span class="main">(</span><span class="main">∀</span> <span class="bound">io1</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s1</span> <span class="skolem">vs</span> <span class="skolem">xs</span> <span class="skolem">V''</span> <span class="main">.</span>
                             <span class="main">∀</span> <span class="bound">io2</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s2</span> <span class="skolem">vs</span> <span class="skolem">xs</span> <span class="skolem">V''</span> <span class="main">.</span>
                               B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span> <span class="main">)</span><span class="main">)</span>
                      <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">vs</span> <span class="skolem">xs</span> <span class="main">(</span><span class="var">?TS</span> <span class="main">(</span><span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="free">Ω</span> <span class="skolem">V''</span> "</span></span> 
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">vs</span> <span class="skolem">xs</span> <span class="main">(</span><span class="var">?TS</span> <span class="main">(</span><span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="main">{</span><span class="skolem">q</span><span class="main">}</span> <span class="free">Ω</span> <span class="skolem">V''</span>›</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span> 

            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V''</span><span class="main">∈</span>N <span class="skolem">io</span> <span class="free">M1</span> <span class="free">V</span>›</span></span> RM_body
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="main">(</span>Suc <span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
                         <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
                         <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                             <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                                <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                                   <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                                   mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                                   <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                                   <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                       <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                          <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                                          <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> 
                                                                      B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                                   <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="var">?TS</span> <span class="main">(</span><span class="main">(</span> <span class="main">|</span><span class="free">M2</span><span class="main">|</span> <span class="main">*</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">seq</span> <span class="main">∈</span> <span class="var">?C</span> <span class="var">?i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> RM_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="var">?i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="var">?i</span><span class="main">)</span> <span class="main">=</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="var">?i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="var">?i</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span> <span class="var">?TS</span> <span class="var">?i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

      
        

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="var">?i</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?C</span> <span class="var">?i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="var">?i</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?TS</span> <span class="main">(</span>Suc <span class="var">?i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?TS</span> <span class="var">?i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TS.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"final_iteration <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="var">?i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>
        


<span class="keyword1" id="ASC_Suite-TS_non_containment_causes_final"><span class="command">lemma</span></span> TS_non_containment_causes_final <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∉</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> inputs <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"final_iteration <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">xr</span> <span class="bound">j</span> <span class="main">.</span> <span class="bound">xr</span> <span class="main">≠</span> <span class="free">xs</span> 
                  <span class="main">∧</span> prefix <span class="bound">xr</span> <span class="free">xs</span> 
                  <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> 
                  <span class="main">∧</span> <span class="free">vs</span><span class="main">@</span><span class="bound">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">≠</span> <span class="free">V</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?TS</span> <span class="main">0</span> <span class="main">≠</span> <span class="var">?TS</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">have</span></span> ncc1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">xr</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">xr</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∨</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">xc</span><span class="main">.</span> <span class="bound">xc</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xc</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xc</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> TS_non_containment_causes<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">have</span></span> ncc2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">xr</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">xr</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">xc</span><span class="main">.</span> <span class="bound">xc</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xc</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xc</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TS_non_containment_causes<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
    
  <span class="keyword1"><span class="command">from</span></span> ncc1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xr</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">xr</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span> <span class="main">⟹</span>
          <span class="main">∃</span><span class="bound">xr</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">xr</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xc</span><span class="main">.</span> <span class="bound">xc</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xc</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xc</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">⟹</span>
          <span class="main">∃</span><span class="bound">xr</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">xr</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xc</span><span class="main">.</span> <span class="bound">xc</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="bound">xc</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">vs</span> <span class="main">@</span> <span class="bound">xc</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xc</span> <span class="main">≠</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">xc</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">∈</span> <span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">∈</span> <span class="var">?C</span> <span class="free">i</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xc</span> <span class="free">xs</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> mcp_prefix_of_suffix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xc</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C_index<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">∈</span> <span class="var">?C</span> <span class="free">i</span>›</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xc</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xc</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xc</span> <span class="main">≠</span> <span class="free">xs</span>›</span></span> append_eq_conv_conj nat_less_le prefix_def prefix_length_le take_all<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xc</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xc</span> <span class="free">xs</span>›</span></span> append_one_prefix same_prefix_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      

      <span class="comment1">― ‹Proof sketch:
           vs-xs-x must not be in TS (i+1), else not final iteration
           vs-xs-x can not be in TS i due to its length
           vs-xs-x must therefore not be contained in (append-set (C i - R i) (inputs M2))
           vs-xs must therefore not be contained in (C i - R i)
           contradiction ›</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?TS</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xc</span><span class="main">@</span><span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> C.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> DiffE <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>length <span class="skolem">xc</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>›</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?TS</span> <span class="free">i</span> <span class="main">≠</span> <span class="var">?TS</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> C_subset <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> C.simps<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>length <span class="skolem">xc</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> <span class="var">?TS</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_n_not_le_n TS_index<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>length <span class="skolem">xc</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> length_append_singleton 
            mcp_prefix_of_suffix same_prefix_prefix<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span> 

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> append_set <span class="main">(</span><span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> append_set <span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> 
                                <span class="main">-</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
      
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">∉</span> <span class="main">(</span><span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">A</span> <span class="bound">Aa</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">A</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∉</span> <span class="bound">Aa</span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">Aa</span> <span class="main">∪</span> <span class="bound">A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UnCI<span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aas</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v2</span><span class="main">.</span> <span class="bound">x0</span> <span class="main">=</span> <span class="bound">x1</span> <span class="main">@</span> <span class="bound">v2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x0</span> <span class="main">=</span> <span class="bound">x1</span> <span class="main">@</span> <span class="skolem">aas</span> <span class="bound">x0</span> <span class="bound">x1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">aas</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>›</span></span> prefixE<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">aas</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> inputs <span class="free">M2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> contra_subsetD insert_iff list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_append<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span> <span class="main">∉</span> append_set <span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span> 

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xc</span> <span class="main">∈</span> <span class="var">?C</span> <span class="free">i</span> <span class="main">-</span> <span class="var">?RM</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="ASC_Suite-TS_non_containment_causes_final_suc"><span class="command">lemma</span></span> TS_non_containment_causes_final_suc <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xs</span> <span class="main">∉</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="free">V</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> inputs <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"final_iteration <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">xr</span> <span class="free">j</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xr</span> <span class="main">≠</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"prefix <span class="free">xr</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="free">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xr</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xr</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="skolem">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TS_non_containment_causes_final<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">jp</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">jp</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xr</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="skolem">xr</span> <span class="free">xs</span> <span class="main">∧</span> Suc <span class="skolem">jp</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">jp</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xr</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">∧</span> prefix <span class="skolem">xr</span> <span class="free">xs</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">vs</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
    

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="ASC_Sufficiency">
<div class="head">
<h1>Theory ASC_Sufficiency</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ASC_Sufficiency
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="ASC_Suite.html">ASC_Suite</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Sufficiency of the test suite to test for reduction ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This section provides a proof that the test suite generated by the adaptive state counting algorithm
is sufficient to test for reduction.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Properties of minimal sequences to failures extending the deterministic state cover ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following two lemmata show that minimal sequences to failures extending the deterministic state
cover do not with their extending suffix visit any state twice or visit a state also reached by a
sequence in the chosen permutation of reactions to the deterministic state cover.
›</span></span>

<span class="keyword1" id="ASC_Sufficiency-minimal_sequence_to_failure_extending_implies_Rep_Pre"><span class="command">lemma</span></span> minimal_sequence_to_failure_extending_implies_Rep_Pre <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"minimal_sequence_to_failure_extending <span class="free">V</span> <span class="free">M1</span> <span class="free">M2</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> N <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs'</span><span class="main">)</span> <span class="free">M1</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"prefix <span class="free">xs'</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs'</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs1</span></span> <span class="skolem"><span class="skolem">xs2</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"prefix <span class="skolem">xs1</span> <span class="skolem">xs2</span>"</span></span>   
                                   <span class="quoted"><span class="quoted">"prefix <span class="skolem">xs2</span> <span class="free">xs'</span>"</span></span>
                                   <span class="quoted"><span class="quoted">"<span class="skolem">xs1</span> <span class="main">≠</span> <span class="skolem">xs2</span>"</span></span>
                                   <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s2</span><span class="main">}</span>"</span></span> 
                                   <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s2</span><span class="main">}</span>"</span></span>
                                   <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s1</span><span class="main">}</span>"</span></span>
                                   <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span>"</span></span>            
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> io_target_implies_L<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xs2</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> io_target_implies_L<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> io_target_implies_L<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xs2</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> io_target_implies_L<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1_1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span> <span class="main">||</span> <span class="skolem">tr1_1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
                     <span class="quoted"><span class="quoted">"length <span class="skolem">tr1_1</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span><span class="main">)</span>"</span></span> 
                     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span> <span class="main">||</span> <span class="skolem">tr1_1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1_2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs2</span> <span class="main">||</span> <span class="skolem">tr1_2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span> 
                     <span class="quoted"><span class="quoted">"length <span class="skolem">tr1_2</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs2</span><span class="main">)</span>"</span></span> 
                     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs2</span> <span class="main">||</span> <span class="skolem">tr1_2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr2_1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span> <span class="main">||</span> <span class="skolem">tr2_1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span> 
                     <span class="quoted"><span class="quoted">"length <span class="skolem">tr2_1</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span><span class="main">)</span>"</span></span> 
                     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span> <span class="main">||</span> <span class="skolem">tr2_1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr2_2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs2</span> <span class="main">||</span> <span class="skolem">tr2_2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
                     <span class="quoted"><span class="quoted">"length <span class="skolem">tr2_2</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs2</span><span class="main">)</span>"</span></span>
                     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs2</span> <span class="main">||</span> <span class="skolem">tr2_2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">PM</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> observable_productF<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr2_1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr2_1</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tr2_1</span> <span class="main">=</span> length <span class="skolem">tr1_1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr1_1</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span> <span class="main">∈</span> L <span class="free">PM</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_path_inclusion<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr2_1</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr2_1</span> <span class="main">=</span> length <span class="skolem">tr1_1</span>›</span></span> 
                                     <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M1</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_iff <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span> <span class="main">∈</span> L <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M1</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹well_formed <span class="free">M2</span>›</span></span> productF_language<span class="main">)</span>
    

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs2</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr2_2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr2_2</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tr2_2</span> <span class="main">=</span> length <span class="skolem">tr1_2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr1_2</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xs2</span> <span class="main">∈</span> L <span class="free">PM</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_path_inclusion<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs2</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr2_2</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr2_2</span> <span class="main">=</span> length <span class="skolem">tr1_2</span>›</span></span> 
                                     <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M1</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_iff <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span> <span class="main">∈</span> L <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M1</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹well_formed <span class="free">M2</span>›</span></span> productF_language<span class="main">)</span>


  

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_path_io_targets_reverse
          <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span> <span class="main">∈</span> L <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> <span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> initial <span class="main">(</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> FSM<span class="main">)</span> <span class="main">∨</span> <span class="bound">c</span> <span class="main">∈</span> nodes <span class="bound">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span>observable <span class="free">M2</span><span class="main">;</span> observable <span class="free">M1</span><span class="main">;</span> well_formed <span class="free">M2</span><span class="main">;</span> well_formed <span class="free">M1</span><span class="main">;</span> 
                             initial <span class="free">M2</span> <span class="main">∈</span> nodes <span class="free">M2</span><span class="main">;</span> initial <span class="free">M1</span> <span class="main">∈</span> nodes <span class="free">M1</span><span class="main">⟧</span> 
                            <span class="main">⟹</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>›</span></span> 
          assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_path_io_targets_reverse
          <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span> <span class="main">∈</span> L <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> <span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> initial <span class="main">(</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> FSM<span class="main">)</span> <span class="main">∨</span> <span class="bound">c</span> <span class="main">∈</span> nodes <span class="bound">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span>observable <span class="free">M2</span><span class="main">;</span> observable <span class="free">M1</span><span class="main">;</span> well_formed <span class="free">M2</span><span class="main">;</span> well_formed <span class="free">M1</span><span class="main">;</span> 
                             initial <span class="free">M2</span> <span class="main">∈</span> nodes <span class="free">M2</span><span class="main">;</span> initial <span class="free">M1</span> <span class="main">∈</span> nodes <span class="free">M1</span><span class="main">⟧</span> 
                            <span class="main">⟹</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>›</span></span> 
          assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xs1</span> <span class="skolem">xs2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>



  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xs1</span> <span class="skolem">xs2</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xs2</span> <span class="free">xs'</span>›</span></span> prefix_order.dual_order.trans same_prefix_prefix 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xs2</span> <span class="free">xs'</span>›</span></span> prefix_order.dual_order.trans same_prefix_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

   

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">vs</span><span class="main">@</span><span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xs2</span> <span class="free">xs'</span>›</span></span>  append_eq_appendI append_eq_conv_conj assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prefixE<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> sequence_to_failure_reaches_FAIL_ob<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> 
                                                 <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span><span class="skolem">s2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> observable_io_targets_split
          <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹observable <span class="free">PM</span>›</span></span>
              <span class="quoted"><span class="quoted">‹io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>›</span></span>
              <span class="quoted"><span class="quoted">‹io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span><span class="main">@</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> observable_io_targets_append
          <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹observable <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹io_targets <span class="free">PM</span> <span class="main">(</span><span class="skolem">s2</span><span class="main">,</span><span class="skolem">s1</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span><span class="main">@</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sequence_to_failure_alt_def
          <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs1</span><span class="main">@</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
          assms<span class="main">(</span>4<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs1</span> <span class="main">&lt;</span> length <span class="skolem">xs2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xs1</span> <span class="skolem">xs2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs1</span> <span class="main">≠</span> <span class="skolem">xs2</span>›</span></span> prefix_length_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>     
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xs1</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs1</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs2</span><span class="main">)</span> <span class="main">@</span> drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xs1</span> <span class="skolem">xs2</span>›</span></span> 
        append_assoc append_eq_conv_conj prefixE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs1</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xs1</span> <span class="skolem">xs2</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xs2</span> <span class="free">xs'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">xs</span> <span class="main">=</span> <span class="skolem">xs1</span> <span class="main">@</span> drop <span class="main">(</span>length <span class="skolem">xs1</span><span class="main">)</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs1</span> <span class="main">≠</span> <span class="skolem">xs2</span>›</span></span> 
          assms<span class="main">(</span>6<span class="main">)</span> leI 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">xs1</span><span class="main">@</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">xs1</span> <span class="main">&lt;</span> length <span class="skolem">xs2</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">xs1</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span> 
        <span class="main">∧</span> sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span><span class="main">@</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">∧</span> length <span class="main">(</span><span class="skolem">xs1</span><span class="main">@</span><span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span><span class="skolem">xs1</span> <span class="main">@</span> drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs1</span> <span class="main">@</span> drop <span class="main">(</span>length <span class="skolem">xs2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>›</span></span> 
          assms<span class="main">(</span>1<span class="main">)</span> minimal_sequence_to_failure_extending.simps 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> minimal_sequence_to_failure_extending <span class="free">V</span> <span class="free">M1</span> <span class="free">M2</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> minimal_sequence_to_failure_extending.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
   

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>
  



<span class="keyword1" id="ASC_Sufficiency-minimal_sequence_to_failure_extending_implies_Rep_Cov"><span class="command">lemma</span></span> minimal_sequence_to_failure_extending_implies_Rep_Cov <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"minimal_sequence_to_failure_extending <span class="free">V</span> <span class="free">M1</span> <span class="free">M2</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> N <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xsR</span><span class="main">)</span> <span class="free">M1</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"prefix <span class="free">xsR</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="free">V''</span> <span class="free">vs</span> <span class="free">xsR</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="free">V''</span> <span class="free">vs</span> <span class="free">xsR</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
                                  <span class="quoted"><span class="quoted">"prefix <span class="skolem">xs'</span> <span class="free">xsR</span>"</span></span> 
                                  <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">∈</span> <span class="free">V''</span>"</span></span>
                                  <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s2</span><span class="main">}</span>"</span></span> 
                                  <span class="quoted"><span class="quoted">"io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s2</span><span class="main">}</span>"</span></span>
                                  <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s1</span><span class="main">}</span>"</span></span> 
                                  <span class="quoted"><span class="quoted">"io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">s1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span>"</span></span>            
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> io_target_implies_L<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> io_target_implies_L<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> io_target_implies_L<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">∈</span> L <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> io_target_implies_L<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1_1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span> <span class="main">||</span> <span class="skolem">tr1_1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span>
                     <span class="quoted"><span class="quoted">"length <span class="skolem">tr1_1</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span><span class="main">)</span>"</span></span>
                     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span> <span class="main">||</span> <span class="skolem">tr1_1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr1_2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M1</span> <span class="main">(</span><span class="skolem">vs'</span> <span class="main">||</span> <span class="skolem">tr1_2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span>"</span></span>
                     <span class="quoted"><span class="quoted">"length <span class="skolem">tr1_2</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span>"</span></span>
                     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">vs'</span> <span class="main">||</span> <span class="skolem">tr1_2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr2_1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span> <span class="main">||</span> <span class="skolem">tr2_1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
                     <span class="quoted"><span class="quoted">"length <span class="skolem">tr2_1</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span><span class="main">)</span>"</span></span>
                     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span> <span class="main">||</span> <span class="skolem">tr2_1</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tr2_2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path <span class="free">M2</span> <span class="main">(</span><span class="skolem">vs'</span> <span class="main">||</span> <span class="skolem">tr2_2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span>"</span></span>
                     <span class="quoted"><span class="quoted">"length <span class="skolem">tr2_2</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span>"</span></span>
                     <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="skolem">vs'</span> <span class="main">||</span> <span class="skolem">tr2_2</span><span class="main">)</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"observable <span class="free">PM</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> observable_productF<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr2_1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr2_1</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tr2_1</span> <span class="main">=</span> length <span class="skolem">tr1_1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr1_1</span> <span class="main">=</span> length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span> <span class="main">∈</span> L <span class="free">PM</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_path_inclusion<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr2_1</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr2_1</span> <span class="main">=</span> length <span class="skolem">tr1_1</span>›</span></span> 
                                     <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M1</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_iff <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">∈</span> L <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M1</span>›</span></span>
        <span class="quoted"><span class="quoted">‹well_formed <span class="free">M2</span>›</span></span> productF_language<span class="main">)</span>
    

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr2_2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr2_2</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tr2_2</span> <span class="main">=</span> length <span class="skolem">tr1_2</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr1_2</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">∈</span> L <span class="free">PM</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_path_inclusion<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">tr2_2</span>›</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr2_2</span> <span class="main">=</span> length <span class="skolem">tr1_2</span>›</span></span> 
                                     <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M1</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_iff <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">∈</span> L <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹well_formed <span class="free">M1</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹well_formed <span class="free">M2</span>›</span></span> productF_language<span class="main">)</span>


  

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_path_io_targets_reverse
          <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">∈</span> L <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> <span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> initial <span class="main">(</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> FSM<span class="main">)</span> <span class="main">∨</span> <span class="bound">c</span> <span class="main">∈</span> nodes <span class="bound">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span>observable <span class="free">M2</span><span class="main">;</span> observable <span class="free">M1</span><span class="main">;</span> well_formed <span class="free">M2</span><span class="main">;</span> well_formed <span class="free">M1</span><span class="main">;</span> 
                              initial <span class="free">M2</span> <span class="main">∈</span> nodes <span class="free">M2</span><span class="main">;</span> initial <span class="free">M1</span> <span class="main">∈</span> nodes <span class="free">M1</span><span class="main">⟧</span> 
                            <span class="main">⟹</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>›</span></span> 
          assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> productF_path_io_targets_reverse
          <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">∈</span> io_targets <span class="free">M2</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> io_targets <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">∈</span> L <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> <span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> initial <span class="main">(</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> FSM<span class="main">)</span> <span class="main">∨</span> <span class="bound">c</span> <span class="main">∈</span> nodes <span class="bound">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⟦</span>observable <span class="free">M2</span><span class="main">;</span> observable <span class="free">M1</span><span class="main">;</span> well_formed <span class="free">M2</span><span class="main">;</span> well_formed <span class="free">M1</span><span class="main">;</span> 
                              initial <span class="free">M2</span> <span class="main">∈</span> nodes <span class="free">M2</span><span class="main">;</span> initial <span class="free">M1</span> <span class="main">∈</span> nodes <span class="free">M1</span><span class="main">⟧</span> 
                            <span class="main">⟹</span> io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>›</span></span> 
          assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">vs'</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> productF_simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
   

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xs'</span> <span class="free">xsR</span>›</span></span> append_assoc append_eq_conv_conj assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> prefixE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹productF <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
        productF_simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> sequence_to_failure_reaches_FAIL_ob<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span>    
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> observable_io_targets_split
          <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹observable <span class="free">PM</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span>initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">M2</span><span class="main">,</span> initial <span class="free">M1</span><span class="main">)</span> <span class="main">(</span><span class="free">vs</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> observable_io_targets_append
          <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹observable <span class="free">PM</span>›</span></span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span><span class="main">}</span>›</span></span>
              <span class="quoted"><span class="quoted">‹io_targets <span class="free">PM</span> <span class="main">(</span><span class="skolem">s2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>›</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>   
    <span class="keyword1"><span class="command">using</span></span> sequence_to_failure_alt_def
          <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹io_targets <span class="free">PM</span> <span class="main">(</span>initial <span class="free">PM</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">FAIL</span><span class="main">}</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> 
          assms<span class="main">(</span>4<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">xs</span> <span class="main">=</span> <span class="skolem">xs'</span> <span class="main">@</span> drop <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="free">xs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs'</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> length_append 
        length_greater_0_conv less_add_same_cancel2<span class="main">)</span>   

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> N.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">=</span> image <span class="skolem">f</span> <span class="free">V</span> 
                                  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">.</span> <span class="skolem">f</span> <span class="bound">v</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Perm.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">∈</span> <span class="free">V''</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">v</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> language_state_for_inputs.simps language_state_for_input.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span><span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">∈</span> language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> minimal_sequence_to_failure_extending <span class="free">V</span> <span class="free">M1</span> <span class="free">M2</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span>›</span></span>
          <span class="quoted"><span class="quoted">‹sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹length <span class="main">(</span>drop <span class="main">(</span>length <span class="skolem">xs'</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> minimal_sequence_to_failure_extending.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1" id="ASC_Sufficiency-mstfe_no_repetition"><span class="command">lemma</span></span> mstfe_no_repetition <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"minimal_sequence_to_failure_extending <span class="free">V</span> <span class="free">M1</span> <span class="free">M2</span> <span class="free">vs</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"<span class="free">V''</span> <span class="main">∈</span> N <span class="main">(</span><span class="free">vs</span><span class="main">@</span><span class="free">xs'</span><span class="main">)</span> <span class="free">M1</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"prefix <span class="free">xs'</span> <span class="free">xs</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="free">vs</span> <span class="free">xs'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="free">V''</span> <span class="free">vs</span> <span class="free">xs'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> minimal_sequence_to_failure_extending_implies_Rep_Pre<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
        minimal_sequence_to_failure_extending_implies_Rep_Cov<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Sufficiency of the test suite to test for reduction ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemma proves that set of input sequences generated in the final iteration of the
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">TS</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> function constitutes a test suite sufficient to test for reduction the FSMs it has 
been generated for.

This proof is performed by contradiction: If the test suite is not sufficient, then some minimal
sequence to a failure extending the deterministic state cover must exist. Due to the test suite
being assumed insufficient, this sequence cannot be contained in it and hence a prefix of it must
have been contained in one of the sets calculated by the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">R</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> function. This is only 
possible if the prefix is not a minimal sequence to a failure extending the deterministic state 
cover or if the test suite observes a failure, both of which violates the assumptions.
›</span></span>


<span class="keyword1" id="ASC_Sufficiency-asc_sufficiency"><span class="command">lemma</span></span> asc_sufficiency <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"final_iteration <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>  
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼⟦</span><span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="main">.</span> <span class="free">Ω</span><span class="main">⟧</span> <span class="free">M2</span> <span class="main">⟶</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?TS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">n</span> <span class="main">.</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">n</span>"</span></span>
  
  
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">vs</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"minimal_sequence_to_failure_extending <span class="free">V</span> <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">vs</span> <span class="skolem">xs</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span>  assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> 
             minimal_sequence_to_failure_extending_det_state_cover_ob<span class="main">[</span><span class="operator">OF</span> _ _ _ _ <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">V</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span>"</span></span> 
              <span class="quoted"><span class="quoted">"sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> 
              <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">io'</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">w'</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span> <span class="main">.</span> sequence_to_failure <span class="free">M1</span> <span class="free">M2</span> <span class="main">(</span><span class="bound">w'</span> <span class="main">@</span> <span class="bound">io'</span><span class="main">)</span> 
                                                          <span class="main">∧</span> length <span class="bound">io'</span> <span class="main">&lt;</span> length <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span>map fst <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Diff_iff <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>›</span></span> insertI1 
          language_state_for_inputs_map_fst<span class="main">)</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span> <span class="main">∉</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span>map fst <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Diff_iff <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>›</span></span> language_state_for_inputs_in_language_state 
          subsetCE<span class="main">)</span> 
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> det_state_cover_finite assms<span class="main">(</span>4<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?TS</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TS_finite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">M2</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"io_reduction_on <span class="free">M1</span> <span class="main">(</span><span class="var">?TS</span> <span class="free">i</span><span class="main">)</span> <span class="free">M2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> io_reduction_from_atc_io_reduction
            <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>›</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">P</span> <span class="bound">Pa</span><span class="main">.</span> <span class="main">(</span><span class="bound">ps</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list<span class="main">)</span> <span class="main">∉</span> <span class="bound">P</span> <span class="main">-</span> <span class="bound">Pa</span> <span class="main">∨</span> <span class="bound">ps</span> <span class="main">∈</span> <span class="bound">P</span> <span class="main">∧</span> <span class="bound">ps</span> <span class="main">∉</span> <span class="bound">Pa</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span> <span class="bound">Pa</span> <span class="bound">ps</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">P</span> <span class="main">⊆</span> <span class="bound">Pa</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">ps</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list<span class="main">)</span> <span class="main">∈</span> <span class="bound">Pa</span> <span class="main">∨</span> <span class="bound">ps</span> <span class="main">∉</span> <span class="bound">P</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹io_reduction_on <span class="free">M1</span> <span class="main">(</span><span class="var">?TS</span> <span class="free">i</span><span class="main">)</span> <span class="free">M2</span>›</span></span> 
                     language_state_for_inputs_in_language_state language_state_for_inputs_map_fst<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">vs</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?stf</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?stfV</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">vs</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?stfX</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?stf</span> <span class="main">=</span> <span class="var">?stfV</span> <span class="main">@</span> <span class="var">?stfX</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?stfV</span> <span class="main">@</span> <span class="var">?stfX</span> <span class="main">∉</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?stf</span> <span class="main">∉</span> <span class="var">?TS</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="var">?stfV</span> <span class="main">@</span> <span class="var">?stfX</span><span class="main">)</span> <span class="free">V</span> <span class="var">?stfV</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹map fst <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> map fst <span class="skolem">vs</span> <span class="main">@</span> map fst <span class="skolem">xs</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹minimal_sequence_to_failure_extending <span class="free">V</span> <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">vs</span> <span class="skolem">xs</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 
          minimal_sequence_to_failure_extending_mcp<span class="main">)</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?stf</span> <span class="main">⊆</span> inputs <span class="free">M1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> DiffD1 <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> language_state_inputs<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?stf</span> <span class="main">⊆</span> inputs <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?stf</span> <span class="main">=</span> set <span class="var">?stfV</span> <span class="main">∪</span> set <span class="var">?stfX</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?stfX</span> <span class="main">⊆</span> inputs <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  
  
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xr</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xr</span> <span class="main">≠</span> <span class="var">?stfX</span>"</span></span> 
                      <span class="quoted"><span class="quoted">"prefix <span class="skolem">xr</span> <span class="var">?stfX</span>"</span></span> 
                      <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> 
                      <span class="quoted"><span class="quoted">"<span class="var">?stfV</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TS_non_containment_causes_final_suc<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?stfV</span> <span class="main">@</span> <span class="var">?stfX</span> <span class="main">∉</span> <span class="var">?TS</span> <span class="free">i</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span><span class="var">?stfV</span> <span class="main">@</span> <span class="var">?stfX</span><span class="main">)</span> <span class="free">V</span> <span class="var">?stfV</span>›</span></span> <span class="quoted"><span class="quoted">‹set <span class="var">?stfX</span> <span class="main">⊆</span> inputs <span class="free">M2</span>›</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?yr</span> <span class="main">=</span> length <span class="skolem">xr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xr</span> <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span>›</span></span> prefix_length_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xr</span> <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span>›</span></span> append_eq_conv_conj prefixE take_zip
          zip_map_fst_snd<span class="main">)</span> 
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="skolem">xs</span>›</span></span> take_is_prefix<span class="main">)</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xr</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">xr</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="skolem">xs</span>›</span></span> map_fst_zip take_map<span class="main">)</span> 
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span><span class="main">@</span><span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffD1 <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">∈</span> L <span class="free">M1</span> <span class="main">-</span> L <span class="free">M2</span>›</span></span> language_state_prefix prefixE<span class="main">)</span> 
  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span><span class="main">@</span><span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="var">?stfV</span> <span class="main">@</span> <span class="skolem">xr</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">xr</span>›</span></span> insertI1 
          language_state_for_inputs_map_fst map_append map_fst_zip<span class="main">)</span> 
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xr</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">xr</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xr</span> <span class="main">≠</span> map fst <span class="skolem">xs</span>›</span></span> not_le_imp_less take_all 
          take_map<span class="main">)</span>
  
  
  
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?stfV</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?stfV</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">.</span>
        <span class="main">(</span><span class="main">¬</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">.</span>
            <span class="main">(</span><span class="main">∃</span> <span class="bound">V''</span> <span class="main">∈</span> N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span> <span class="main">.</span>  
              <span class="main">(</span><span class="main">∃</span> <span class="bound">S1</span> <span class="main">.</span> 
                <span class="main">(</span><span class="main">∃</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">.</span>
                  <span class="bound">io</span> <span class="main">=</span> <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span>
                  <span class="main">∧</span> mcp <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span>
                  <span class="main">∧</span> <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span>
                  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span>
                    <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span> 
                      <span class="main">(</span><span class="main">∀</span> <span class="bound">io1</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                         <span class="main">∀</span> <span class="bound">io2</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                           B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span> <span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> RM.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">xs'</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">.</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> C_subset TS_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">xs'</span><span class="main">}</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs'</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="skolem">xs'</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> io_reduction_on_subset<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹io_reduction_on <span class="free">M1</span> <span class="main">(</span><span class="var">?TS</span> <span class="free">i</span><span class="main">)</span> <span class="free">M2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">xs'</span><span class="main">}</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="free">i</span>›</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="var">?stfV</span><span class="main">@</span><span class="skolem">xr</span><span class="main">}</span> <span class="main">.</span>
            <span class="main">(</span><span class="main">∃</span> <span class="bound">V''</span> <span class="main">∈</span> N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span> <span class="main">.</span>  
              <span class="main">(</span><span class="main">∃</span> <span class="bound">S1</span> <span class="main">.</span> 
                <span class="main">(</span><span class="main">∃</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">.</span>
                  <span class="bound">io</span> <span class="main">=</span> <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span>
                  <span class="main">∧</span> mcp <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span>
                  <span class="main">∧</span> <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span>
                  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span>
                    <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span> 
                      <span class="main">(</span><span class="main">∀</span> <span class="bound">io1</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                         <span class="main">∀</span> <span class="bound">io2</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                           B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span> <span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"
            <span class="main">(</span><span class="main">∃</span> <span class="bound">V''</span> <span class="main">∈</span> N <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span><span class="main">)</span> <span class="free">M1</span> <span class="free">V</span> <span class="main">.</span>  
              <span class="main">(</span><span class="main">∃</span> <span class="bound">S1</span> <span class="main">.</span> 
                <span class="main">(</span><span class="main">∃</span> <span class="bound">vs'</span> <span class="bound">xs'</span> <span class="main">.</span>
                  <span class="skolem">vs</span><span class="main">@</span><span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">vs'</span><span class="main">@</span><span class="bound">xs'</span><span class="main">)</span>
                  <span class="main">∧</span> mcp <span class="main">(</span><span class="bound">vs'</span><span class="main">@</span><span class="bound">xs'</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs'</span>
                  <span class="main">∧</span> <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span>
                  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span>
                    <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span> 
                      <span class="main">(</span><span class="main">∀</span> <span class="bound">io1</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs'</span> <span class="bound">xs'</span> <span class="bound">V''</span> <span class="main">.</span>
                         <span class="main">∀</span> <span class="bound">io2</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs'</span> <span class="bound">xs'</span> <span class="bound">V''</span> <span class="main">.</span>
                           B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span> <span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs'</span> <span class="bound">xs'</span> <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span><span class="main">@</span><span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="var">?stfV</span> <span class="main">@</span> <span class="skolem">xr</span><span class="main">}</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V''</span></span> <span class="skolem"><span class="skolem">S1</span></span> <span class="skolem"><span class="skolem">vs'</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> RM_impl <span class="main">:</span>  
                                     <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> <span class="main">∈</span> N <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span><span class="main">)</span> <span class="free">M1</span> <span class="free">V</span>"</span></span>
                                     <span class="quoted"><span class="quoted">"<span class="skolem">vs</span><span class="main">@</span><span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">vs'</span><span class="main">@</span><span class="skolem">xs'</span><span class="main">)</span>"</span></span>
                                     <span class="quoted"><span class="quoted">"mcp <span class="main">(</span><span class="skolem">vs'</span><span class="main">@</span><span class="skolem">xs'</span><span class="main">)</span> <span class="skolem">V''</span> <span class="skolem">vs'</span>"</span></span>
                                     <span class="quoted"><span class="quoted">"<span class="skolem">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span>"</span></span>
                                     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="skolem">S1</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="skolem">S1</span> <span class="main">.</span>
                                       <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span> 
                                          <span class="main">(</span><span class="main">∀</span> <span class="bound">io1</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s1</span> <span class="skolem">vs'</span> <span class="skolem">xs'</span> <span class="skolem">V''</span> <span class="main">.</span>
                                             <span class="main">∀</span> <span class="bound">io2</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s2</span> <span class="skolem">vs'</span> <span class="skolem">xs'</span> <span class="skolem">V''</span> <span class="main">.</span>
                                               B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span> <span class="main">)</span><span class="main">)</span>"</span></span>
                                     <span class="quoted"><span class="quoted">" <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">vs'</span> <span class="skolem">xs'</span> <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">S1</span> <span class="free">Ω</span> <span class="skolem">V''</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
   
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?stfV</span> <span class="main">=</span> mcp' <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">xr</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span>map fst <span class="skolem">vs</span> <span class="main">@</span> map fst <span class="skolem">xs</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span>map fst <span class="skolem">vs</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xr</span> <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span>›</span></span> map_append 
          map_fst_zip mcp'_intro mcp_prefix_of_suffix<span class="main">)</span> 
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="free">M2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> det_state_cover_finite assms<span class="main">(</span>4<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">∈</span> <span class="skolem">V''</span>"</span></span>  
                    <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> mcp' <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">V''</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> N_mcp_prefix<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="var"><span class="var">?stfV</span></span> <span class="main"><span class="main">=</span></span> mcp' <span class="main"><span class="main">(</span></span>map fst <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">vs</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">xr</span></span> <span class="main"><span class="main">||</span></span> take <span class="main"><span class="main">(</span></span>length <span class="skolem"><span class="skolem">xr</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>map snd <span class="skolem"><span class="skolem">xs</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">V</span></span>›</span></span></span> 
            <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">V''</span></span> <span class="main"><span class="main">∈</span></span> N <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">vs</span></span><span class="main"><span class="main">@</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">xr</span></span> <span class="main"><span class="main">||</span></span> <span class="var"><span class="var">?yr</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">M1</span></span> <span class="free"><span class="free">V</span></span>›</span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M2</span></span></span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">=</span> <span class="skolem">vs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="skolem">V''</span> <span class="skolem">vs'</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">=</span> mcp' <span class="main">(</span><span class="skolem">vs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">V''</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">vs'</span> <span class="main">@</span> <span class="skolem">xs'</span>›</span></span> mcp'_intro<span class="main">)</span>
     
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">vs'</span> <span class="main">@</span> <span class="skolem">xs'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?TS</span> <span class="main">1</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> TS_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?stfV</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?stfV</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> RM.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  
  
    <span class="comment1">― ‹show that the prerequisites (<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">verbatim</span> <span class="raw_text">Prereq</span><span class="antiquote">}</span></span>) for <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">verbatim</span> <span class="raw_text">LB</span><span class="antiquote">}</span></span> are met by construction›</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">vs'a</span><span class="main">∈</span><span class="skolem">V''</span><span class="main">.</span> prefix <span class="bound">vs'a</span> <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">⟶</span> length <span class="bound">vs'a</span> <span class="main">≤</span> length <span class="skolem">vs'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="skolem">V''</span> <span class="skolem">vs'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span><span class="var">?TS</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>   
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">j</span> <span class="main">≤</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?TS</span> <span class="skolem">j</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="free">i</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TS_subset<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> atc_io_reduction_on_subset
              <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?TS</span> <span class="skolem">j</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Un_subset_iff <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="free">i</span>›</span></span> <span class="quoted"><span class="quoted">‹atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>›</span></span>
            atc_io_reduction_on_subset<span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?TS</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?TS</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> TS_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="free">V</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="var">?TS</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">p</span> <span class="main">.</span> <span class="main">(</span>prefix <span class="bound">p</span> <span class="skolem">xs'</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≠</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">⟶</span> map fst <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?TS</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">p</span> <span class="skolem">xs'</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">xs'</span> <span class="main">⟶</span> map fst <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prefix <span class="skolem">p</span> <span class="skolem">xs'</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">xs'</span>"</span></span>
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">p</span> <span class="skolem">xs'</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">xs'</span>›</span></span> map_mono_prefix<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?stfV</span> <span class="main">@</span> <span class="skolem">xr</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="main">(</span>take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">xr</span>›</span></span> 
                <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map fst <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="skolem">xs'</span><span class="main">)</span><span class="main">)</span>›</span></span> 
                <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">=</span> <span class="skolem">vs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs'</span> <span class="main">=</span> <span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>map fst <span class="skolem">vs'</span> <span class="main">@</span> map fst <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="var">?stfV</span> <span class="main">@</span> <span class="skolem">xr</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prefix <span class="main">(</span>map fst <span class="skolem">p</span><span class="main">)</span> <span class="skolem">xr</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">=</span> <span class="skolem">vs</span>›</span></span><span class="main">)</span>
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?stfV</span> <span class="main">@</span> <span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?TS</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 0
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹map fst <span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xr</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> TS.simps<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹map fst <span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xr</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">qed</span></span>
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span>map fst <span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xr</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span>map fst <span class="skolem">vs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span>map fst <span class="skolem">vs</span> <span class="main">@</span> map fst <span class="skolem">xs</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span>map fst <span class="skolem">vs</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">xr</span> <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span>›</span></span> 
                mcp_prefix_of_suffix 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">vs</span> <span class="main">@</span> map fst <span class="skolem">p</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> TS_prefix_containment<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?stfV</span> <span class="main">@</span> <span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?TS</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>›</span></span> 
                                         <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span>map fst <span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xr</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span>map fst <span class="skolem">vs</span><span class="main">)</span>›</span></span> 
                                         <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span>map fst <span class="skolem">p</span><span class="main">)</span> <span class="skolem">xr</span>›</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
   
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> C_index<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?stfV</span><span class="main">@</span><span class="skolem">xr</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span>map fst <span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xr</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span>map fst <span class="skolem">vs</span><span class="main">)</span>›</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
        
        <span class="keyword1"><span class="command">have</span></span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">xs'</span> <span class="main">=</span> <span class="skolem">xr</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">xr</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span>›</span></span> 
                <span class="quoted"><span class="quoted">‹<span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="skolem">xs</span>›</span></span> 
                <span class="quoted"><span class="quoted">‹<span class="skolem">xs'</span> <span class="main">=</span> <span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span>›</span></span> take_map<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Suc_less_eq <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="skolem">p</span> <span class="skolem">xs'</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="skolem">xs'</span>›</span></span> 
                append_eq_conv_conj length_map nat_less_le prefixE prefix_length_le take_all<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mcp <span class="main">(</span>map fst <span class="skolem">vs</span> <span class="main">@</span> map fst <span class="skolem">p</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span>map fst <span class="skolem">vs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹mcp <span class="main">(</span>map fst <span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xr</span><span class="main">)</span> <span class="free">V</span> <span class="main">(</span>map fst <span class="skolem">vs</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span>map fst <span class="skolem">p</span><span class="main">)</span> <span class="skolem">xr</span>›</span></span> mcp_prefix_of_suffix 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">vs</span> <span class="main">@</span> map fst <span class="skolem">p</span> <span class="main">∈</span> <span class="var">?C</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="main">(</span>map fst <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> TS_index<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹map fst <span class="skolem">vs</span> <span class="main">@</span> map fst <span class="skolem">p</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">vs</span> <span class="main">@</span> map fst <span class="skolem">p</span> <span class="main">∈</span> <span class="var">?TS</span> <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> TS_union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">j</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">j</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="main">(</span>length <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UN_I <span class="quoted"><span class="quoted">‹TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span><span class="main">∈</span>set <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">j</span><span class="main">]</span><span class="main">.</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">j</span><span class="main">)</span>›</span></span> 
                <span class="quoted"><span class="quoted">‹map fst <span class="skolem">vs</span> <span class="main">@</span> map fst <span class="skolem">p</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span>length <span class="main">(</span>map fst <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>›</span></span> 
                length_map set_upt<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> 
  
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span><span class="skolem">vs'</span> <span class="main">@</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">=</span> <span class="skolem">vs</span>›</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  
    
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span> <span class="main">@</span> <span class="skolem">xs'</span> <span class="main">∈</span> L <span class="free">M2</span> <span class="main">∩</span> L <span class="free">M1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> IntI RM_impl<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">xs'</span><span class="main">∈</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">.</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹map fst <span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xr</span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span>map fst <span class="skolem">vs</span> <span class="main">@</span> <span class="skolem">xr</span><span class="main">}</span>›</span></span> 
          language_state_for_inputs_in_language_state subsetCE<span class="main">)</span>
      
          
    
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Prereq <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">vs'</span> <span class="skolem">xs'</span> <span class="main">(</span><span class="var">?TS</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">S1</span> <span class="free">Ω</span> <span class="skolem">V''</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RM_impl<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Prereq.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V''</span> <span class="main">∈</span> N <span class="main">(</span><span class="skolem">vs</span><span class="main">@</span><span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span><span class="main">)</span> <span class="free">M1</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> N.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span> <span class="skolem">xs</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="skolem">xs</span>›</span></span> take_is_prefix<span class="main">)</span>
  
  
    <span class="comment1">― ‹ show that furthermore neither <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">verbatim</span> <span class="raw_text">Rep_Pre</span><span class="antiquote">}</span></span> nor <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">verbatim</span> <span class="raw_text">Rep_Cov</span><span class="antiquote">}</span></span> holds ›</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">vs</span> <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> minimal_sequence_to_failure_extending_implies_Rep_Pre
            <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹minimal_sequence_to_failure_extending <span class="free">V</span> <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">vs</span> <span class="skolem">xs</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> 
                <span class="quoted"><span class="quoted">‹test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>›</span></span> RM_impl<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xs</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">vs'</span> <span class="skolem">xs'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">=</span> <span class="skolem">vs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs'</span> <span class="main">=</span> <span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">V''</span> <span class="skolem">vs</span> <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> minimal_sequence_to_failure_extending_implies_Rep_Cov
            <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹minimal_sequence_to_failure_extending <span class="free">V</span> <span class="free">M1</span> <span class="free">M2</span> <span class="skolem">vs</span> <span class="skolem">xs</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> 
                <span class="quoted"><span class="quoted">‹test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>›</span></span> RM_impl<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                <span class="quoted"><span class="quoted">‹prefix <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">xs</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">V''</span> <span class="skolem">vs'</span> <span class="skolem">xs'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">=</span> <span class="skolem">vs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs'</span> <span class="main">=</span> <span class="skolem">xr</span> <span class="main">||</span> <span class="var">?yr</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs'</span><span class="main">@</span><span class="skolem">xs'</span> <span class="main">∈</span> L <span class="free">M1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> 
            <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span> <span class="main">=</span> <span class="skolem">vs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs'</span> <span class="main">=</span> <span class="skolem">xr</span> <span class="main">||</span> take <span class="main">(</span>length <span class="skolem">xr</span><span class="main">)</span> <span class="main">(</span>map snd <span class="skolem">xs</span><span class="main">)</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    
  
    <span class="comment1">― ‹ therefore it is impossible to remove the prefix of the minimal sequence to a failure,
         as this would require <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">verbatim</span> <span class="raw_text">M1</span><span class="antiquote">}</span></span> to have more than m states ›</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"LB <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">vs'</span> <span class="skolem">xs'</span> <span class="main">(</span><span class="var">?TS</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">S1</span> <span class="free">Ω</span> <span class="skolem">V''</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">M1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> LB_count<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs'</span><span class="main">@</span><span class="skolem">xs'</span> <span class="main">∈</span> L <span class="free">M1</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>›</span></span> 
                        <span class="quoted"><span class="quoted">‹<span class="skolem">V''</span> <span class="main">∈</span> Perm <span class="free">V</span> <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹Prereq <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">vs'</span> <span class="skolem">xs'</span> <span class="main">(</span><span class="var">?TS</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">S1</span> <span class="free">Ω</span> <span class="skolem">V''</span>›</span></span> 
                        <span class="quoted"><span class="quoted">‹<span class="main">¬</span> Rep_Pre <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">vs'</span> <span class="skolem">xs'</span>›</span></span> <span class="quoted"><span class="quoted">‹ <span class="main">¬</span> Rep_Cov <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">V''</span> <span class="skolem">vs'</span> <span class="skolem">xs'</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"LB <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">vs'</span> <span class="skolem">xs'</span> <span class="main">(</span><span class="var">?TS</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">S1</span> <span class="free">Ω</span> <span class="skolem">V''</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="skolem">vs'</span> <span class="skolem">xs'</span> <span class="main">(</span><span class="var">?TS</span> <span class="skolem">j</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">S1</span> <span class="free">Ω</span> <span class="skolem">V''</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Main result ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemmata add to the previous result to show that some FSM <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a reduction 
of FSM <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if and only if it is a reduction on the test suite generated by the adaptive 
state counting algorithm for these FSMs.
›</span></span>

<span class="keyword1" id="ASC_Sufficiency-asc_soundness"><span class="command">lemma</span></span> asc_soundness <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>         <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span> <span class="main">⟶</span> atc_io_reduction_on_sets <span class="free">M1</span> <span class="free">T</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> atc_io_reduction_on_sets_reduction assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>



<span class="keyword1" id="ASC_Sufficiency-asc_main_theorem"><span class="command">lemma</span></span> asc_main_theorem <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"final_iteration <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span> <span class="main">⟷</span> atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="free">i</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> asc_sufficiency assms<span class="main"><span class="main">(</span></span>1-5<span class="main"><span class="main">)</span></span> atc_io_reduction_on_sets_reduction<span class="main">)</span>




<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="ASC_Hoare">
<div class="head">
<h1>Theory ASC_Hoare</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ASC_Hoare
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="ASC_Sufficiency.html">ASC_Sufficiency</a> <span class="quoted">"<a href="../../HOL/HOL-Hoare/Hoare_Logic.html">HOL-Hoare.Hoare_Logic</a>"</span> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Correctness of the Adaptive State Counting Algorithm in Hoare-Logic ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section we give an example implementation of the adaptive state counting algorithm in a
simple WHILE-language and prove that this implementation produces a certain output if and only if
input FSM <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M1</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a reduction of input FSM <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">M2</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>



<span class="keyword1" id="ASC_Hoare-atc_io_reduction_on_sets_from_obs"><span class="command">lemma</span></span> atc_io_reduction_on_sets_from_obs <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">T</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="free">T</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> atc_io_reduction_on_sets.simps atc_io_reduction_on.simps
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">iseq</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">iseq</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">iseq</span> <span class="main">∈</span> <span class="free">T</span>›</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bot.extremum insert_mono io_reduction_on_subset 
        mk_disjoint_insert<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span> <span class="main">⊆</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">io</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"B <span class="free">M1</span> <span class="skolem">io</span> <span class="free">Ω</span> <span class="main">⊆</span> B <span class="free">M2</span> <span class="skolem">io</span> <span class="free">Ω</span> "</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> B <span class="free">M1</span> <span class="skolem">io</span> <span class="free">Ω</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iseq</span> <span class="main">∈</span> <span class="free">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">io</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="skolem">io</span> <span class="free">Ω</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> B <span class="free">M1</span> <span class="skolem">io</span> <span class="free">Ω</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">io</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">io</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">io</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="skolem">io</span> <span class="free">Ω</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> B <span class="free">M2</span> <span class="skolem">io</span> <span class="free">Ω</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span> 
                    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="skolem">iseq</span><span class="main">}</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span> <span class="main">⊆</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="ASC_Hoare-atc_io_reduction_on_sets_to_obs"><span class="command">lemma</span></span> atc_io_reduction_on_sets_to_obs <span class="main">:</span>   
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="free">T</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">T</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> atc_io_reduction_on_sets.simps atc_io_reduction_on.simps
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">iseq</span><span class="main">∈</span><span class="free">T</span><span class="main">.</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span> 
                  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">iseq</span><span class="main">}</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span> <span class="main">⊆</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> UNION <span class="free">T</span> <span class="main">(</span>language_state_for_input <span class="free">M1</span> <span class="main">(</span>initial <span class="free">M1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span>›</span></span> language_state_for_inputs_alt_def<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aas</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v3</span><span class="main">.</span> <span class="bound">v3</span> <span class="main">∈</span> <span class="bound">x0</span> <span class="main">∧</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="bound">v3</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">aas</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x0</span> <span class="main">∧</span> <span class="bound">x2</span> <span class="main">∈</span> <span class="bound">x1</span> <span class="main">(</span><span class="skolem">aas</span> <span class="bound">x0</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">f</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">ps</span> <span class="main">∉</span> UNION <span class="bound">A</span> <span class="bound">f</span> <span class="main">∨</span> <span class="skolem">aas</span> <span class="bound">A</span> <span class="bound">f</span> <span class="bound">ps</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">∧</span> <span class="bound">ps</span> <span class="main">∈</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">aas</span> <span class="bound">A</span> <span class="bound">f</span> <span class="bound">ps</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">∧</span> <span class="main">(</span><span class="bound">ps</span> <span class="main">∈</span> UNION <span class="bound">A</span> <span class="bound">f</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">as</span><span class="main">.</span> <span class="bound">as</span> <span class="main">∉</span> <span class="bound">A</span> <span class="main">∨</span> <span class="bound">ps</span> <span class="main">∉</span> <span class="bound">f</span> <span class="bound">as</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> f2 a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> contra_subsetD language_state_for_input_alt_def 
                      language_state_for_inputs_alt_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">iox</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">iox</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">io</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">iox</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">io</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iox</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">io</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iox</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">io</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="skolem">io</span> <span class="free">Ω</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iox</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">io</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iox</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> B <span class="free">M1</span> <span class="skolem">io</span> <span class="free">Ω</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> B <span class="free">M2</span> <span class="skolem">io</span> <span class="free">Ω</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> atc_io_reduction_on_sets.simps atc_io_reduction_on.simps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> UN_E <span class="quoted"><span class="quoted">‹<span class="skolem">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span>›</span></span> language_state_for_input_alt_def 
          language_state_for_inputs_alt_def subsetCE<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">io</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">io</span><span class="main">}</span> <span class="main">×</span>B <span class="free">M2</span> <span class="skolem">io</span> <span class="free">Ω</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">io</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">iox</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iox</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">io</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="ASC_Hoare-atc_io_reduction_on_sets_alt_def"><span class="command">lemma</span></span> atc_io_reduction_on_sets_alt_def <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="free">T</span> <span class="free">Ω</span> <span class="free">M2</span> <span class="main">=</span> 
           <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">T</span> 
            <span class="main">∧</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> 
                <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">T</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> atc_io_reduction_on_sets_to_obs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M1</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">T</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Ω</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M2</span></span></span></span><span class="main">]</span> 
  <span class="keyword2"><span class="keyword">and</span></span>   atc_io_reduction_on_sets_from_obs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">Ω</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


        


<span class="keyword1" id="ASC_Hoare-asc_algorithm_correctness"><span class="command">lemma</span></span> asc_algorithm_correctness<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">tsN</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">cN</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">rmN</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">obs</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">obsI</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">obs<span class="hidden">⇩</span><sub>Ω</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">obsI<span class="hidden">⇩</span><sub>Ω</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">iter</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">isReduction</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
  <span class="main">{</span>
    OFSM <span class="free">M1</span> <span class="main">∧</span> OFSM <span class="free">M2</span> <span class="main">∧</span> asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span> <span class="main">∧</span> test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>
  <span class="main">}</span>
  tsN <span class="main">:=</span> <span class="main">{}</span><span class="main">;</span>
  cN  <span class="main">:=</span> <span class="free">V</span><span class="main">;</span>
  rmN <span class="main">:=</span> <span class="main">{}</span><span class="main">;</span>
  obs <span class="main">:=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="bound">cN</span><span class="main">;</span>
  obsI <span class="main">:=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="bound">cN</span><span class="main">;</span>
  obs<span class="hidden">⇩</span><sub>Ω</sub> <span class="main">:=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="bound">cN</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span><span class="main">;</span>
  obsI<span class="hidden">⇩</span><sub>Ω</sub> <span class="main">:=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="bound">cN</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span><span class="main">;</span>
  iter <span class="main">:=</span> <span class="main">1</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="main">(</span><span class="bound">cN</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">obsI</span> <span class="main">⊆</span> <span class="bound">obs</span> <span class="main">∧</span> <span class="bound">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="bound">obs<span class="hidden">⇩</span><sub>Ω</sub></span><span class="main">)</span>
  <span class="keyword1">INV</span> <span class="main">{</span>
    <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">iter</span>
    <span class="main">∧</span> <span class="bound">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="bound">iter</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>
    <span class="main">∧</span> <span class="bound">cN</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="bound">iter</span>
    <span class="main">∧</span> <span class="bound">rmN</span> <span class="main">=</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="bound">iter</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>
    <span class="main">∧</span> <span class="bound">obs</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="bound">tsN</span> <span class="main">∪</span> <span class="bound">cN</span><span class="main">)</span>
    <span class="main">∧</span> <span class="bound">obsI</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="bound">tsN</span> <span class="main">∪</span> <span class="bound">cN</span><span class="main">)</span>
    <span class="main">∧</span> <span class="bound">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="bound">tsN</span> <span class="main">∪</span> <span class="bound">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>
    <span class="main">∧</span> <span class="bound">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="bound">tsN</span> <span class="main">∪</span> <span class="bound">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>
    <span class="main">∧</span> OFSM <span class="free">M1</span> <span class="main">∧</span> OFSM <span class="free">M2</span> <span class="main">∧</span> asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span> <span class="main">∧</span> test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>
  <span class="main">}</span>
  <span class="keyword1">DO</span> 
    iter <span class="main">:=</span> <span class="bound">iter</span> <span class="main">+</span> <span class="main">1</span><span class="main">;</span>
    rmN <span class="main">:=</span> <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="bound">cN</span> <span class="main">.</span>
      <span class="main">(</span><span class="main">¬</span> <span class="main">(</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">io</span> <span class="main">∈</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">.</span>
          <span class="main">(</span><span class="main">∃</span> <span class="bound">V''</span> <span class="main">∈</span> N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span> <span class="main">.</span>  
            <span class="main">(</span><span class="main">∃</span> <span class="bound">S1</span> <span class="main">.</span> 
              <span class="main">(</span><span class="main">∃</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">.</span>
                <span class="bound">io</span> <span class="main">=</span> <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span>
                <span class="main">∧</span> mcp <span class="main">(</span><span class="bound">vs</span><span class="main">@</span><span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span>
                <span class="main">∧</span> <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span>
                <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">s2</span> <span class="main">∈</span> <span class="bound">S1</span> <span class="main">.</span>
                  <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span> 
                    <span class="main">(</span><span class="main">∀</span> <span class="bound">io1</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                       <span class="main">∀</span> <span class="bound">io2</span> <span class="main">∈</span> RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span> <span class="main">.</span>
                         B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span> <span class="main">)</span><span class="main">)</span>
                <span class="main">∧</span> <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="bound">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">;</span>
    tsN <span class="main">:=</span> <span class="bound">tsN</span> <span class="main">∪</span> <span class="bound">cN</span><span class="main">;</span>
    cN <span class="main">:=</span> append_set <span class="main">(</span><span class="bound">cN</span> <span class="main">-</span> <span class="bound">rmN</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span> <span class="bound">tsN</span><span class="main">;</span>
    obs <span class="main">:=</span> <span class="bound">obs</span> <span class="main">∪</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="bound">cN</span><span class="main">;</span>
    obsI <span class="main">:=</span> <span class="bound">obsI</span> <span class="main">∪</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="bound">cN</span><span class="main">;</span>
    obs<span class="hidden">⇩</span><sub>Ω</sub> <span class="main">:=</span> <span class="bound">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="bound">cN</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span><span class="main">;</span>
    obsI<span class="hidden">⇩</span><sub>Ω</sub> <span class="main">:=</span> <span class="bound">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="bound">cN</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>
  <span class="keyword1">OD</span><span class="main">;</span>
  isReduction <span class="main">:=</span> <span class="main">(</span><span class="main">(</span><span class="bound">obsI</span> <span class="main">⊆</span> <span class="bound">obs</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="bound">obs<span class="hidden">⇩</span><sub>Ω</sub></span><span class="main">)</span><span class="main">)</span>
  <span class="main">{</span>
    <span class="bound">isReduction</span> <span class="main">=</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>   <span class="comment1">―‹variable isReduction is used only as a return value, 
                               it is true if and only if M1 is a reduction of M2›</span> 
  <span class="main">}</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">vcg</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> precond <span class="main">:</span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span> <span class="main">∧</span> OFSM <span class="free">M2</span> <span class="main">∧</span> asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span> <span class="main">∧</span> test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">1</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">=</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> 
       <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">V</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="main">{}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="main">{}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">V</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> 
          <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="main">{}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> 
          <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="main">{}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> precond <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span> <span class="main">∧</span> OFSM <span class="free">M2</span> <span class="main">∧</span> asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span> <span class="main">∧</span> test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> precond <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∧</span>
                   <span class="main">{}</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
                   <span class="free">V</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">1</span> <span class="main">∧</span>
                   <span class="main">{}</span> <span class="main">=</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
                   L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">V</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="main">{}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="main">∧</span>
                   L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="main">{}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="free">V</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="main">{}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="main">{}</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">∧</span>
                   OFSM <span class="free">M1</span> <span class="main">∧</span> OFSM <span class="free">M2</span> <span class="main">∧</span> asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span> <span class="main">∧</span> test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tsN</span> <span class="skolem">cN</span> <span class="skolem">rmN</span> <span class="skolem">obs</span> <span class="skolem">obsI</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="skolem">iter</span> <span class="skolem">isReduction</span>
  <span class="keyword3"><span class="command">assume</span></span> precond <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span> <span class="main">∧</span>
                      <span class="skolem">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="skolem">cN</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span> <span class="main">∧</span>
                      <span class="skolem">rmN</span> <span class="main">=</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="skolem">obs</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="skolem">obsI</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">∧</span>
                      OFSM <span class="free">M1</span> <span class="main">∧</span> OFSM <span class="free">M2</span> <span class="main">∧</span> asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span> <span class="main">∧</span> test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span><span class="main">)</span> 
                    <span class="main">∧</span> <span class="skolem">cN</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">∧</span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span>"</span></span>
            <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span> 
            <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
            <span class="quoted"><span class="quoted">"asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>"</span></span>
            <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">cN</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">cN</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">rmN</span> <span class="main">=</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">obs</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">obsI</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>


  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">iter</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> gr0_implies_Suc<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cN</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">k</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cN</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
           <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
           <span class="quoted"><span class="quoted">"RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span> <span class="main">=</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iter</span> <span class="main">=</span> Suc <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span>
        
  
  <span class="keyword1"><span class="command">have</span></span> rmN_calc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
        <span class="main">¬</span> io_reduction_on <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="free">M2</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
            <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
               <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                  <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                  mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                  <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                      <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                         <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                         <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> 
                            B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
       RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>


    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
          <span class="main">¬</span> io_reduction_on <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="free">M2</span> <span class="main">∨</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
              <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                 <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                    <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                    mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                    <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                        <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                           <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                           <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> 
                              B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
          <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">.</span>
          <span class="main">¬</span> io_reduction_on <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="free">M2</span> <span class="main">∨</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
              <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                 <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                    <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                    mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                    <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                        <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                           <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                           <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> 
                              B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cN</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">.</span>
                    <span class="main">¬</span> io_reduction_on <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="free">M2</span> <span class="main">∨</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                        <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                           <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                              <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                              mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                              <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                              <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                  <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                     <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                                     <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> 
                                        B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                              <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> 
                    RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> RM.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
                      <span class="main">¬</span> io_reduction_on <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="free">M2</span> <span class="main">∨</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                          <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                             <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                                <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                                mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                                <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                                <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                    <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                       <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                                       <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> 
                                          B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                                <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
                      RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iter</span> <span class="main">=</span> Suc <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span> <span class="main">=</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> rmN_calc' <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
        <span class="main">¬</span> io_reduction_on <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="free">M2</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
            <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
               <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                  <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                  mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                  <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                      <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                         <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                         <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> 
                            B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
       RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cN</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">k</span> <span class="main">∪</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> TS.simps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">k</span> <span class="main">∪</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cN</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tsN_calc <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iter</span> <span class="main">=</span> Suc <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
 
  
  <span class="keyword1"><span class="command">have</span></span> cN_calc <span class="main">:</span> <span class="quoted"><span class="quoted">"append_set
        <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
         <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
          <span class="main">¬</span> io_reduction_on <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="free">M2</span> <span class="main">∨</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
              <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                 <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                    <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                    mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                    <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                        <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                           <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                           <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                               <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
        <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
       <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="main">=</span>
       C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"append_set
          <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
           <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
            <span class="main">¬</span> io_reduction_on <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="free">M2</span> <span class="main">∨</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                   <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                      <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                      mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                      <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                          <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                             <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                             <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                 <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
          <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
         <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="main">=</span> 
         append_set
          <span class="main">(</span><span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span><span class="main">)</span> <span class="main">-</span>
           <span class="main">(</span>RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
         <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cN</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span>›</span></span> rmN_calc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"append_set
          <span class="main">(</span><span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span><span class="main">)</span> <span class="main">-</span>
           <span class="main">(</span>RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
         <span class="main">(</span>TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span><span class="main">)</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iter</span> <span class="main">=</span> Suc <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">=</span> append_set <span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> 
                <span class="main">-</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> C.simps<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Suc_eq_plus1 
              <span class="quoted"><span class="quoted">‹C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">=</span> append_set <span class="main">(</span>C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> 
                  <span class="main">-</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="skolem">iter</span> <span class="main">=</span> Suc <span class="skolem">k</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">qed</span></span>  

    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">have</span></span> obs_calc <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">obs</span> <span class="main">∪</span>
       L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span>
        <span class="main">(</span>append_set
          <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
           <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
            <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                   <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                      <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                      mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                      <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                          <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                             <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                             <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                 <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
          <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
         <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span>
        <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">∪</span>
         <span class="main">(</span>append_set
           <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
            <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
             <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                 <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                    <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                       <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                       mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                       <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                       <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                           <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                              <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                              <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                  <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                       <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
           <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
          <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">∪</span> <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">obs</span> <span class="main">∪</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="bound">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> language_state_for_inputs_union precond<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">have</span></span> obsI_calc <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">obsI</span> <span class="main">∪</span>
       L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span>
        <span class="main">(</span>append_set
          <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
           <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
            <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                   <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                      <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                      mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                      <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                          <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                             <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                             <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                 <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
          <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
         <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span>
        <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">∪</span>
         <span class="main">(</span>append_set
           <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
            <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
             <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                 <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                    <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                       <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                       mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                       <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                       <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                           <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                              <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                              <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                  <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                       <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
           <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
          <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">∪</span> <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">obsI</span> <span class="main">∪</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="bound">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> language_state_for_inputs_union precond<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> obs<span class="hidden">⇩</span><sub>Ω</sub>_calc <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">∪</span>
       <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span>
              <span class="main">(</span>append_set
                <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
                 <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
                  <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                      <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                         <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                            <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                            mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                            <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                   <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                                   <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                       <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
                <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
               <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
           <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span>
              <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">∪</span>
               <span class="main">(</span>append_set
                 <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
                  <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
                   <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
                   <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                       <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                          <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                             <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                             mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                             <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                             <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                 <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                    <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                                    <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                        <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                             <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
                 <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
                <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
           <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">obs</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>›</span></span> 
          obs_calc 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> obsI<span class="hidden">⇩</span><sub>Ω</sub>_calc <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">∪</span>
       <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span>
              <span class="main">(</span>append_set
                <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
                 <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
                  <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                      <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                         <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                            <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                            mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                            <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                   <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                                   <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                       <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
                <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
               <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
           <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span>
              <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">∪</span>
               <span class="main">(</span>append_set
                 <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
                  <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
                   <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
                   <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                       <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                          <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                             <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                             mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                             <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                             <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                 <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                    <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                                    <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                        <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                             <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
                 <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
                <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
           <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">obsI</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span>›</span></span> 
          <span class="quoted"><span class="quoted">‹<span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>›</span></span> 
          obsI_calc 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>



  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tsN_calc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span>›</span></span>
       <span class="quoted"><span class="quoted">‹<span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span>
       cN_calc
       rmN_calc'
       obs_calc
       obsI_calc
       obs<span class="hidden">⇩</span><sub>Ω</sub>_calc
       obsI<span class="hidden">⇩</span><sub>Ω</sub>_calc
       <span class="quoted"><span class="quoted">‹OFSM <span class="free">M1</span>›</span></span>
       <span class="quoted"><span class="quoted">‹OFSM <span class="free">M2</span>›</span></span>
       <span class="quoted"><span class="quoted">‹asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>›</span></span>
       <span class="quoted"><span class="quoted">‹test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span>
       <span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
       append_set
        <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
         <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
          <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
              <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                 <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                    <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                    mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                    <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                    <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                        <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                           <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                           <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                               <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
        <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
       <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="main">=</span>
       C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
        <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
            <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
               <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                  <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                  mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                  <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                      <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                         <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                         <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> 
                            B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span>
       RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
       <span class="skolem">obs</span> <span class="main">∪</span>
       L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span>
        <span class="main">(</span>append_set
          <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
           <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
            <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                   <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                      <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                      mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                      <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                          <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                             <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                             <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                 <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
          <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
         <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span>
        <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">∪</span>
         <span class="main">(</span>append_set
           <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
            <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
             <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                 <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                    <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                       <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                       mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                       <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                       <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                           <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                              <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                              <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                  <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                       <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
           <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
          <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
       <span class="skolem">obsI</span> <span class="main">∪</span>
       L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span>
        <span class="main">(</span>append_set
          <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
           <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
            <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                   <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                      <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                      mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                      <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                          <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                             <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                             <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                 <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
          <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
         <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span>
        <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">∪</span>
         <span class="main">(</span>append_set
           <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
            <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
             <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                 <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                    <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                       <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                       mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                       <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                       <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                           <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                              <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                              <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                  <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                       <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
           <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
          <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
       <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">∪</span>
       <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span>
              <span class="main">(</span>append_set
                <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
                 <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
                  <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                      <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                         <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                            <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                            mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                            <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                   <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                                   <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                       <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
                <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
               <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
           <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span>
              <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">∪</span>
               <span class="main">(</span>append_set
                 <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
                  <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
                   <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
                   <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                       <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                          <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                             <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                             mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                             <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                             <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                 <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                    <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                                    <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                        <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                             <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
                 <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
                <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
           <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">∧</span>
       <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">∪</span>
       <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span>
              <span class="main">(</span>append_set
                <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
                 <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
                  <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                      <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                         <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                            <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                            mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                            <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                   <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                                   <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                       <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
                <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
               <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
           <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span>
              <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">∪</span>
               <span class="main">(</span>append_set
                 <span class="main">(</span><span class="skolem">cN</span> <span class="main">-</span>
                  <span class="main">{</span><span class="bound"><span class="bound">xs'</span></span> <span class="main">∈</span> <span class="skolem">cN</span><span class="main">.</span>
                   <span class="main">¬</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span> <span class="main">∨</span>
                   <span class="main">(</span><span class="main">∀</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">{</span><span class="bound">xs'</span><span class="main">}</span><span class="main">.</span>
                       <span class="main">∃</span><span class="bound">V''</span><span class="main">∈</span>N <span class="bound">io</span> <span class="free">M1</span> <span class="free">V</span><span class="main">.</span>
                          <span class="main">∃</span><span class="bound">S1</span> <span class="bound">vs</span> <span class="bound">xs</span><span class="main">.</span>
                             <span class="bound">io</span> <span class="main">=</span> <span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span> <span class="main">∧</span>
                             mcp <span class="main">(</span><span class="bound">vs</span> <span class="main">@</span> <span class="bound">xs</span><span class="main">)</span> <span class="bound">V''</span> <span class="bound">vs</span> <span class="main">∧</span>
                             <span class="bound">S1</span> <span class="main">⊆</span> nodes <span class="free">M2</span> <span class="main">∧</span>
                             <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                 <span class="main">∀</span><span class="bound">s2</span><span class="main">∈</span><span class="bound">S1</span><span class="main">.</span>
                                    <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">⟶</span>
                                    <span class="main">(</span><span class="main">∀</span><span class="bound">io1</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span>
                                        <span class="main">∀</span><span class="bound">io2</span><span class="main">∈</span>RP <span class="free">M2</span> <span class="bound">s2</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="bound">V''</span><span class="main">.</span> B <span class="free">M1</span> <span class="bound">io1</span> <span class="free">Ω</span> <span class="main">≠</span> B <span class="free">M1</span> <span class="bound">io2</span> <span class="free">Ω</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                             <span class="free">m</span> <span class="main">&lt;</span> LB <span class="free">M2</span> <span class="free">M1</span> <span class="bound">vs</span> <span class="bound">xs</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="free">V</span><span class="main">)</span> <span class="bound">S1</span> <span class="free">Ω</span> <span class="bound">V''</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
                 <span class="main">(</span>inputs <span class="free">M2</span><span class="main">)</span> <span class="main">-</span>
                <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
           <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">∧</span>
       OFSM <span class="free">M1</span> <span class="main">∧</span> OFSM <span class="free">M2</span> <span class="main">∧</span> asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span> <span class="main">∧</span> test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tsN</span> <span class="skolem">cN</span> <span class="skolem">rmN</span> <span class="skolem">obs</span> <span class="skolem">obsI</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="skolem">iter</span> <span class="skolem">isReduction</span>
  <span class="keyword3"><span class="command">assume</span></span> precond <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span> <span class="main">∧</span>
                    <span class="skolem">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="skolem">cN</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span> <span class="main">∧</span>
                    <span class="skolem">rmN</span> <span class="main">=</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="skolem">obs</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="skolem">obsI</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">∧</span>
                    OFSM <span class="free">M1</span> <span class="main">∧</span> OFSM <span class="free">M2</span> <span class="main">∧</span> asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span> <span class="main">∧</span> test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span><span class="main">)</span> <span class="main">∧</span>
                   <span class="main">¬</span> <span class="main">(</span><span class="skolem">cN</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">∧</span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span>"</span></span>
            <span class="quoted"><span class="quoted">"OFSM <span class="free">M1</span>"</span></span> 
            <span class="quoted"><span class="quoted">"OFSM <span class="free">M2</span>"</span></span>
            <span class="quoted"><span class="quoted">"asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>"</span></span>
            <span class="quoted"><span class="quoted">"test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">cN</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">¬</span> <span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">∨</span> <span class="main">¬</span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">cN</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">rmN</span> <span class="main">=</span> RM <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">obs</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">obsI</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>

  

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">∧</span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span><span class="main">)</span> <span class="main">=</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">cN</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cN</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover <span class="free">M2</span> <span class="free">V</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> det_state_cover_initial<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">iter</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">V</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span><span class="quoted"><span class="quoted">"False"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">iter</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> gr0_implies_Suc<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> Suc <span class="skolem">k'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> gr0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">iter</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iter</span> <span class="main">=</span> Suc <span class="skolem">k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">=</span> Suc <span class="skolem">k'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span> <span class="main">∪</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> TS.simps<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="free">Ω</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="skolem">k'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True <span class="quoted"><span class="quoted">‹<span class="skolem">cN</span> <span class="main">=</span> C <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iter</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">k'</span> <span class="main">=</span> <span class="skolem">iter</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">iter</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="skolem">k'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
    <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="skolem">iter</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"final_iteration <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">iter</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span> <span class="main">=</span> atc_io_reduction_on_sets <span class="free">M1</span> <span class="skolem">tsN</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> asc_main_theorem<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹OFSM <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹OFSM <span class="free">M2</span>›</span></span> 
                                <span class="quoted"><span class="quoted">‹asc_fault_domain <span class="free">M2</span> <span class="free">M1</span> <span class="free">m</span>›</span></span> 
                                <span class="quoted"><span class="quoted">‹test_tools <span class="free">M2</span> <span class="free">M1</span> <span class="free">FAIL</span> <span class="free">PM</span> <span class="free">V</span> <span class="free">Ω</span>›</span></span> 
                                <span class="quoted"><span class="quoted">‹final_iteration <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tsN</span> <span class="main">=</span> TS <span class="free">M2</span> <span class="free">M1</span> <span class="free">Ω</span> <span class="free">V</span> <span class="free">m</span> <span class="main">(</span><span class="skolem">iter</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span> <span class="main">=</span> <span class="skolem">tsN</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cN</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span> <span class="main">=</span> atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">≡</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">obs</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">obsI</span> <span class="main">=</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span>›</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">≡</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> 
                            <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>›</span></span> 
                    <span class="quoted"><span class="quoted">‹<span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>›</span></span><span class="main">)</span>
    

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">∧</span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span><span class="main">)</span> <span class="main">=</span> atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">∧</span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> atc_io_reduction_on_sets_from_obs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M1</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span>"</span></span> <span class="quoted"><span class="free">M2</span></span> <span class="quoted"><span class="free">Ω</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">∧</span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">≡</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">≡</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> 
                                <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">∧</span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> atc_io_reduction_on_sets_to_obs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M1</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">tsN</span></span> <span class="main"><span class="main">∪</span></span> <span class="skolem"><span class="skolem">cN</span></span>›</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Ω</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M2</span></span></span></span><span class="main">]</span>
              <span class="quoted"><span class="quoted">‹atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">≡</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="main">⊆</span> L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span>›</span></span> 
              <span class="quoted"><span class="quoted">‹<span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">≡</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M1</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span> 
                                <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">io</span><span class="main">∈</span>L<span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>n</sub> <span class="free">M2</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="bound">io</span><span class="main">}</span> <span class="main">×</span> B <span class="free">M2</span> <span class="bound">io</span> <span class="free">Ω</span><span class="main">)</span>›</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span> <span class="main">=</span> atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False


    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">∨</span> <span class="main">¬</span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cN</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="main">¬</span> <span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">∨</span> <span class="main">¬</span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> atc_io_reduction_on_sets_to_obs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M1</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">tsN</span></span> <span class="main"><span class="main">∪</span></span> <span class="skolem"><span class="skolem">cN</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Ω</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M2</span></span></span></span><span class="main">]</span>
            <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">∨</span> <span class="main">¬</span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span>›</span></span> precond 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> asc_soundness<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹OFSM <span class="free">M1</span>›</span></span> <span class="quoted"><span class="quoted">‹OFSM <span class="free">M2</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">M1</span> <span class="main">≼</span> <span class="free">M2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> atc_io_reduction_on_sets <span class="free">M1</span> <span class="main">(</span><span class="skolem">tsN</span> <span class="main">∪</span> <span class="skolem">cN</span><span class="main">)</span> <span class="free">Ω</span> <span class="free">M2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">obsI</span> <span class="main">⊆</span> <span class="skolem">obs</span> <span class="main">∨</span> <span class="main">¬</span> <span class="skolem">obsI<span class="hidden">⇩</span><sub>Ω</sub></span> <span class="main">⊆</span> <span class="skolem">obs<span class="hidden">⇩</span><sub>Ω</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="ASC_Example">
<div class="head">
<h1>Theory ASC_Example</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ASC_Example
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="ASC_Hoare.html">ASC_Hoare</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Example product machines and properties ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This section provides example FSMs and shows that the assumptions on the inputs of the adaptive
state counting algorithm are not vacuous.
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Constructing FSMs from transition relations ›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This subsection provides a function to more easily create FSMs, only requiring a set of
transition-tuples and an initial state.
›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">from_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'state</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'in</span><span class="main">,</span> <span class="tfree">'out</span><span class="main">,</span> <span class="tfree">'state</span><span class="main">)</span> FSM"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">from_rel</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="free"><span class="bound"><span class="entity">q0</span></span></span> <span class="main">=</span> <span class="main">⦇</span> succ <span class="main">=</span> <span class="main">λ</span> <span class="bound">io</span> <span class="bound">p</span> <span class="main">.</span> <span class="main">{</span> <span class="bound">q</span> <span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">io</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">}</span><span class="main">,</span>
                    inputs <span class="main">=</span> image <span class="main">(</span>fst <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span><span class="main">,</span>
                    outputs <span class="main">=</span> image <span class="main">(</span>snd <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span><span class="main">,</span>
                    initial <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q0</span></span></span> <span class="main">⦈</span>"</span></span>



<span class="keyword1" id="ASC_Example-nodes_from_rel"><span class="command">lemma</span></span> nodes_from_rel <span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>from_rel <span class="free">rel</span> <span class="free">q0</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="free">q0</span> <span class="main">(</span>image <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="free">rel</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"nodes <span class="var">?M</span> <span class="main">⊆</span> insert <span class="free">q0</span> <span class="main">(</span>image <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="free">rel</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span> <span class="bound">io</span> <span class="bound">p</span> <span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> succ <span class="var">?M</span> <span class="bound">io</span> <span class="bound">p</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">∈</span> image <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">q</span> <span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> nodes <span class="var">?M</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">=</span> <span class="free">q0</span> <span class="main">∨</span> <span class="bound">q</span> <span class="main">∈</span> image <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="free">rel</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> nodes <span class="var">?M</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">q0</span> <span class="main">∨</span> <span class="skolem">q</span> <span class="main">∈</span> image <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="free">rel</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> FSM.nodes.cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> initial
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>execute <span class="skolem">p</span> <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span> <span class="bound">q</span> <span class="bound">io</span> <span class="bound">p</span> <span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> succ <span class="var">?M</span> <span class="bound">io</span> <span class="bound">p</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">∈</span> image <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="free">rel</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nodes <span class="var">?M</span> <span class="main">⊆</span> insert <span class="free">q0</span> <span class="main">(</span>image <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="free">rel</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">fun</span></span> <span class="entity">well_formed_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'state</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">well_formed_rel</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">=</span> <span class="main">(</span>finite <span class="free"><span class="bound"><span class="entity">rel</span></span></span>
                          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∉</span> image <span class="main">(</span>fst <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span>
                                            <span class="main">∨</span> <span class="bound">y</span> <span class="main">∉</span> image <span class="main">(</span>snd <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span><span class="main">)</span>
                                        <span class="main">⟶</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">s2</span> <span class="main">.</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">,</span><span class="bound">s2</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span><span class="main">)</span><span class="main">)</span>
                          <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ASC_Example-well_formed_from_rel"><span class="command">lemma</span></span> well_formed_from_rel <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"well_formed_rel <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="main">(</span>from_rel <span class="free">rel</span> <span class="free">q0</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"well_formed <span class="var">?M</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes <span class="var">?M</span> <span class="main">⊆</span> insert <span class="free">q0</span> <span class="main">(</span>image <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="free">rel</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nodes_from_rel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">rel</span></span> <span class="quoted"><span class="free">q0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="free">q0</span> <span class="main">(</span>image <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="free">rel</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="var">?M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Finite_Set.finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>inputs <span class="var">?M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>outputs <span class="var">?M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite_FSM <span class="var">?M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inputs <span class="var">?M</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"outputs <span class="var">?M</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s1</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∉</span> inputs <span class="var">?M</span> <span class="main">∨</span> <span class="bound">y</span> <span class="main">∉</span> outputs <span class="var">?M</span><span class="main">)</span> <span class="main">⟶</span> succ <span class="var">?M</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="bound">s1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">fun</span></span> <span class="entity">completely_specified_rel_over</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'state</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'state</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">completely_specified_rel_over</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="free"><span class="bound"><span class="entity">nods</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">nods</span></span></span> <span class="main">.</span>
                                                <span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> image <span class="main">(</span>fst <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">.</span>
                                                  <span class="main">∃</span> <span class="bound">y</span> <span class="main">∈</span> image <span class="main">(</span>snd <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">.</span>
                                                    <span class="main">∃</span> <span class="bound">s2</span> <span class="main">.</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">,</span><span class="bound">s2</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ASC_Example-completely_specified_from_rel"><span class="command">lemma</span></span> completely_specified_from_rel <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"completely_specified_rel_over <span class="free">rel</span> <span class="main">(</span>nodes <span class="main">(</span><span class="main">(</span>from_rel <span class="free">rel</span> <span class="free">q0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"completely_specified <span class="main">(</span>from_rel <span class="free">rel</span> <span class="free">q0</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"completely_specified <span class="var">?M</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> completely_specified.simps
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> nodes <span class="main">(</span>from_rel <span class="free">rel</span> <span class="free">q0</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>inputs <span class="var">?M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>outputs <span class="var">?M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">s2</span><span class="main">.</span> <span class="bound">s2</span> <span class="main">∈</span> succ <span class="var">?M</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="skolem">s1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> inputs <span class="main">(</span>from_rel <span class="free">rel</span> <span class="free">q0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span>  image <span class="main">(</span>fst <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span> <span class="free">rel</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> image <span class="main">(</span>snd <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span> <span class="free">rel</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s1</span><span class="main">,</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">,</span><span class="skolem">s2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> nodes <span class="main">(</span>from_rel <span class="free">rel</span> <span class="free">q0</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span>  image <span class="main">(</span>fst <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span> <span class="free">rel</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> completely_specified_rel_over.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> outputs <span class="main">(</span>from_rel <span class="free">rel</span> <span class="free">q0</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> succ <span class="main">(</span>from_rel <span class="free">rel</span> <span class="free">q0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">s1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>outputs <span class="main">(</span>from_rel <span class="free">rel</span> <span class="free">q0</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">s2</span><span class="main">.</span> <span class="bound">s2</span> <span class="main">∈</span> succ <span class="main">(</span>from_rel <span class="free">rel</span> <span class="free">q0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="skolem">s1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>





<span class="keyword1"><span class="command">fun</span></span> <span class="entity">observable_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'state</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'in</span> <span class="main">×</span> <span class="tfree">'out</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'state</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">observable_rel</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">io</span> <span class="bound">s1</span> <span class="main">.</span> <span class="main">{</span> <span class="bound">s2</span> <span class="main">.</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span><span class="bound">io</span><span class="main">,</span><span class="bound">s2</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>
                                    <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s2</span> <span class="main">.</span> <span class="main">{</span> <span class="bound">s2'</span> <span class="main">.</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span><span class="bound">io</span><span class="main">,</span><span class="bound">s2'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s2</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="ASC_Example-observable_from_rel"><span class="command">lemma</span></span> observable_from_rel <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"observable_rel <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"observable <span class="main">(</span>from_rel <span class="free">rel</span> <span class="free">q0</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"observable <span class="var">?M</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">io</span> <span class="bound">s1</span> <span class="main">.</span> <span class="main">{</span> <span class="bound">s2</span> <span class="main">.</span> <span class="main">(</span><span class="bound">s1</span><span class="main">,</span><span class="bound">io</span><span class="main">,</span><span class="bound">s2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">rel</span> <span class="main">}</span> <span class="main">=</span> succ <span class="var">?M</span> <span class="bound">io</span> <span class="bound">s1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>





<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">OFSM_rel</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="free"><span class="bound"><span class="entity">q0</span></span></span> <span class="main">≡</span> well_formed_rel <span class="free"><span class="bound"><span class="entity">rel</span></span></span>
                                <span class="main">∧</span> completely_specified_rel_over <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">(</span>nodes <span class="main">(</span>from_rel <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="free"><span class="bound"><span class="entity">q0</span></span></span><span class="main">)</span><span class="main">)</span>
                                <span class="main">∧</span> observable_rel <span class="free"><span class="bound"><span class="entity">rel</span></span></span>"</span></span>

<span class="keyword1" id="ASC_Example-OFMS_from_rel"><span class="command">lemma</span></span> OFMS_from_rel <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"OFSM_rel <span class="free">rel</span> <span class="free">q0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"OFSM <span class="main">(</span>from_rel <span class="free">rel</span> <span class="free">q0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms completely_specified_from_rel observable_from_rel well_formed_from_rel<span class="main">)</span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Example FSMs and properties ›</span></span>



<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">M<span class="hidden">⇩</span><sub>S</sub>_rel</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">×</span><span class="main">(</span>nat<span class="main">×</span>nat<span class="main">)</span><span class="main">×</span>nat<span class="main">)</span> set <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">M<span class="hidden">⇩</span><sub>S</sub></span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">)</span> FSM <span class="main">≡</span> from_rel M<span class="hidden">⇩</span><sub>S</sub>_rel <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">M<span class="hidden">⇩</span><sub>I</sub>_rel</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">×</span><span class="main">(</span>nat<span class="main">×</span>nat<span class="main">)</span><span class="main">×</span>nat<span class="main">)</span> set <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">M<span class="hidden">⇩</span><sub>I</sub></span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">)</span> FSM <span class="main">≡</span> from_rel M<span class="hidden">⇩</span><sub>I</sub>_rel <span class="main">0</span>"</span></span>

<span class="keyword1" id="ASC_Example-example_nodes"><span class="command">lemma</span></span> example_nodes <span class="main">:</span>
  <span class="quoted"><span class="quoted">"nodes M<span class="hidden">⇩</span><sub>S</sub> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"nodes M<span class="hidden">⇩</span><sub>I</sub> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>S</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> succ M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>S</sub>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>S</sub>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">∈</span> succ M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span>›</span></span> succ_nodes<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> nodes M<span class="hidden">⇩</span><sub>S</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>S</sub>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>S</sub>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes M<span class="hidden">⇩</span><sub>S</sub> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nodes_from_rel<span class="main">[</span><span class="operator">of</span> <span class="quoted">M<span class="hidden">⇩</span><sub>S</sub>_rel</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nodes M<span class="hidden">⇩</span><sub>S</sub> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>I</sub>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> succ M<span class="hidden">⇩</span><sub>I</sub> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>I</sub>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>I</sub>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">∈</span> succ M<span class="hidden">⇩</span><sub>I</sub> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span>›</span></span> succ_nodes<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> nodes M<span class="hidden">⇩</span><sub>I</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>I</sub>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>I</sub>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes M<span class="hidden">⇩</span><sub>I</sub> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nodes_from_rel<span class="main">[</span><span class="operator">of</span> <span class="quoted">M<span class="hidden">⇩</span><sub>I</sub>_rel</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nodes M<span class="hidden">⇩</span><sub>I</sub> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="ASC_Example-example_OFSM"><span class="command">lemma</span></span> example_OFSM <span class="main">:</span>
  <span class="quoted"><span class="quoted">"OFSM M<span class="hidden">⇩</span><sub>S</sub>"</span></span> <span class="quoted"><span class="quoted">"OFSM M<span class="hidden">⇩</span><sub>I</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_formed_rel M<span class="hidden">⇩</span><sub>S</sub>_rel"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> well_formed_rel.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"completely_specified_rel_over M<span class="hidden">⇩</span><sub>S</sub>_rel <span class="main">(</span>nodes <span class="main">(</span>from_rel M<span class="hidden">⇩</span><sub>S</sub>_rel <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> completely_specified_rel_over.simps
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> nodes <span class="main">(</span>from_rel M<span class="hidden">⇩</span><sub>S</sub>_rel <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>image <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> M<span class="hidden">⇩</span><sub>S</sub>_rel<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nodes_from_rel<span class="main">[</span><span class="operator">of</span> <span class="quoted">M<span class="hidden">⇩</span><sub>S</sub>_rel</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"completely_specified_rel_over M<span class="hidden">⇩</span><sub>S</sub>_rel <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>image <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> M<span class="hidden">⇩</span><sub>S</sub>_rel<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> completely_specified_rel_over.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span>fst <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span> <span class="main">`</span> M<span class="hidden">⇩</span><sub>S</sub>_rel<span class="main">.</span>
                      <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="main">(</span>snd <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span> <span class="main">`</span> M<span class="hidden">⇩</span><sub>S</sub>_rel<span class="main">.</span> <span class="main">∃</span><span class="bound">s2</span><span class="main">.</span> <span class="main">(</span><span class="skolem">s1</span><span class="main">,</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">,</span> <span class="bound">s2</span><span class="main">)</span> <span class="main">∈</span> M<span class="hidden">⇩</span><sub>S</sub>_rel"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"observable_rel M<span class="hidden">⇩</span><sub>S</sub>_rel"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"OFSM_rel M<span class="hidden">⇩</span><sub>S</sub>_rel <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"OFSM M<span class="hidden">⇩</span><sub>S</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> OFMS_from_rel<span class="main">[</span><span class="operator">of</span> <span class="quoted">M<span class="hidden">⇩</span><sub>S</sub>_rel</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"well_formed_rel M<span class="hidden">⇩</span><sub>I</sub>_rel"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> well_formed_rel.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"completely_specified_rel_over M<span class="hidden">⇩</span><sub>I</sub>_rel <span class="main">(</span>nodes <span class="main">(</span>from_rel M<span class="hidden">⇩</span><sub>I</sub>_rel <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> completely_specified_rel_over.simps
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s1</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∈</span> nodes <span class="main">(</span>from_rel M<span class="hidden">⇩</span><sub>I</sub>_rel <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>image <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> M<span class="hidden">⇩</span><sub>I</sub>_rel<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> nodes_from_rel<span class="main">[</span><span class="operator">of</span> <span class="quoted">M<span class="hidden">⇩</span><sub>I</sub>_rel</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"completely_specified_rel_over M<span class="hidden">⇩</span><sub>I</sub>_rel <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>image <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> M<span class="hidden">⇩</span><sub>I</sub>_rel<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> completely_specified_rel_over.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span>fst <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span> <span class="main">`</span> M<span class="hidden">⇩</span><sub>I</sub>_rel<span class="main">.</span>
            <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="main">(</span>snd <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span> <span class="main">`</span> M<span class="hidden">⇩</span><sub>I</sub>_rel<span class="main">.</span> <span class="main">∃</span><span class="bound">s2</span><span class="main">.</span> <span class="main">(</span><span class="skolem">s1</span><span class="main">,</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">,</span> <span class="bound">s2</span><span class="main">)</span> <span class="main">∈</span> M<span class="hidden">⇩</span><sub>I</sub>_rel"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹completely_specified_rel_over M<span class="hidden">⇩</span><sub>I</sub>_rel <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span><span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="main">`</span> M<span class="hidden">⇩</span><sub>I</sub>_rel<span class="main">)</span><span class="main">)</span>›</span></span>
          <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> insert <span class="main">0</span> <span class="main">(</span><span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="main">`</span> M<span class="hidden">⇩</span><sub>I</sub>_rel<span class="main">)</span>›</span></span> completely_specified_rel_over.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"observable_rel M<span class="hidden">⇩</span><sub>I</sub>_rel"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"OFSM_rel M<span class="hidden">⇩</span><sub>I</sub>_rel <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"OFSM M<span class="hidden">⇩</span><sub>I</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> OFMS_from_rel<span class="main">[</span><span class="operator">of</span> <span class="quoted">M<span class="hidden">⇩</span><sub>I</sub>_rel</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="ASC_Example-example_fault_domain"><span class="command">lemma</span></span> example_fault_domain <span class="main">:</span> <span class="quoted"><span class="quoted">"asc_fault_domain M<span class="hidden">⇩</span><sub>S</sub> M<span class="hidden">⇩</span><sub>I</sub> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inputs M<span class="hidden">⇩</span><sub>S</sub> <span class="main">=</span> inputs M<span class="hidden">⇩</span><sub>I</sub>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>nodes M<span class="hidden">⇩</span><sub>I</sub><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> example_nodes<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"asc_fault_domain M<span class="hidden">⇩</span><sub>S</sub> M<span class="hidden">⇩</span><sub>I</sub> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAIL<span class="hidden">⇩</span><sub>I</sub></span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">×</span>nat<span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">PM<span class="hidden">⇩</span><sub>I</sub></span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span> nat<span class="main">,</span> nat<span class="main">×</span>nat<span class="main">)</span> FSM <span class="main">≡</span> <span class="main">⦇</span>
            succ <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="main">(</span><span class="bound">p1</span><span class="main">,</span><span class="bound">p2</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">p1</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>S</sub> <span class="main">∧</span> <span class="bound">p2</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>I</sub> <span class="main">∧</span> <span class="main">(</span>fst <span class="bound">a</span> <span class="main">∈</span> inputs M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>
                                        <span class="main">∧</span> <span class="main">(</span>snd <span class="bound">a</span> <span class="main">∈</span> outputs M<span class="hidden">⇩</span><sub>S</sub> <span class="main">∪</span> outputs M<span class="hidden">⇩</span><sub>I</sub><span class="main">)</span><span class="main">)</span>
                                    <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>succ M<span class="hidden">⇩</span><sub>S</sub> <span class="bound">a</span> <span class="bound">p1</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> succ M<span class="hidden">⇩</span><sub>I</sub> <span class="bound">a</span> <span class="bound">p2</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>
                                      <span class="keyword1">then</span> <span class="main">{</span>FAIL<span class="hidden">⇩</span><sub>I</sub><span class="main">}</span>
                                      <span class="keyword1">else</span> <span class="main">(</span>succ M<span class="hidden">⇩</span><sub>S</sub> <span class="bound">a</span> <span class="bound">p1</span> <span class="main">×</span> succ M<span class="hidden">⇩</span><sub>I</sub> <span class="bound">a</span> <span class="bound">p2</span><span class="main">)</span><span class="main">)</span>
                                    <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
            inputs <span class="main">=</span> inputs M<span class="hidden">⇩</span><sub>S</sub><span class="main">,</span>
            outputs <span class="main">=</span> outputs M<span class="hidden">⇩</span><sub>S</sub> <span class="main">∪</span> outputs M<span class="hidden">⇩</span><sub>I</sub><span class="main">,</span>
            initial <span class="main">=</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">,</span> initial M<span class="hidden">⇩</span><sub>I</sub><span class="main">)</span>
          <span class="main">⦈</span>"</span></span>

<span class="keyword1" id="ASC_Example-example_productF"><span class="command">lemma</span></span> example_productF <span class="main">:</span> <span class="quoted"><span class="quoted">"productF M<span class="hidden">⇩</span><sub>S</sub> M<span class="hidden">⇩</span><sub>I</sub> FAIL<span class="hidden">⇩</span><sub>I</sub> PM<span class="hidden">⇩</span><sub>I</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inputs M<span class="hidden">⇩</span><sub>S</sub> <span class="main">=</span> inputs M<span class="hidden">⇩</span><sub>I</sub>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst FAIL<span class="hidden">⇩</span><sub>I</sub> <span class="main">∉</span> nodes M<span class="hidden">⇩</span><sub>S</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> example_nodes<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd FAIL<span class="hidden">⇩</span><sub>I</sub> <span class="main">∉</span> nodes M<span class="hidden">⇩</span><sub>I</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> example_nodes<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> productF.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">V<span class="hidden">⇩</span><sub>I</sub></span> <span class="main">::</span> nat list set <span class="main">≡</span> <span class="main">{</span><span class="main">[]</span><span class="main">,</span><span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="ASC_Example-example_det_state_cover"><span class="command">lemma</span></span> example_det_state_cover <span class="main">:</span> <span class="quoted"><span class="quoted">"is_det_state_cover M<span class="hidden">⇩</span><sub>S</sub> V<span class="hidden">⇩</span><sub>I</sub>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reaches M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"initial M<span class="hidden">⇩</span><sub>S</sub> <span class="main">∈</span> d_reachable M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> d_reachable.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reached_by M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">1</span> <span class="main">[</span><span class="main">1</span><span class="main">]</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> length <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">∧</span>
    length <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> length <span class="main">[</span><span class="main">1</span><span class="main">]</span> <span class="main">∧</span> path M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">||</span> <span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>
                            <span class="main">∧</span> target <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">||</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">||</span> <span class="main">[</span><span class="main">1</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ys2</span> <span class="bound">tr2</span><span class="main">.</span>
       length <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> length <span class="bound">ys2</span>
          <span class="main">∧</span> length <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> length <span class="bound">tr2</span>
          <span class="main">∧</span> path M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">||</span> <span class="bound">ys2</span><span class="main">)</span> <span class="main">||</span> <span class="bound">tr2</span><span class="main">)</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>
            <span class="main">⟶</span> target <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">||</span> <span class="bound">ys2</span><span class="main">)</span> <span class="main">||</span> <span class="bound">tr2</span><span class="main">)</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ys2</span> <span class="skolem">tr2</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> length <span class="skolem">ys2</span> <span class="main">∧</span> length <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> length <span class="skolem">tr2</span>
                            <span class="main">∧</span> path M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">ys2</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ys2</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">tr2</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"path M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">ys2</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys2</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">y2</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">ys2</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def <span class="quoted"><span class="quoted">‹length <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> length <span class="skolem">ys2</span> <span class="main">∧</span> length <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> length <span class="skolem">tr2</span>
            <span class="main">∧</span> path M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">ys2</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>›</span></span> append.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> append_butlast_last_id
            butlast_snoc length_butlast length_greater_0_conv list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tr2</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">t2</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">tr2</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def <span class="quoted"><span class="quoted">‹length <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> length <span class="skolem">ys2</span> <span class="main">∧</span> length <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> length <span class="skolem">tr2</span>
            <span class="main">∧</span> path M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">ys2</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>›</span></span> append.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> append_butlast_last_id
            butlast_snoc length_butlast length_greater_0_conv list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path M<span class="hidden">⇩</span><sub>S</sub> <span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span><span class="main">,</span><span class="skolem">t2</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> succ M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span> <span class="main">.</span> succ M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"target <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">||</span> <span class="skolem">ys2</span><span class="main">)</span> <span class="main">||</span> <span class="skolem">tr2</span><span class="main">)</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ys2</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">y2</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">tr2</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">t2</span><span class="main">]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t2</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ys2</span> <span class="bound">tr2</span><span class="main">.</span>
       length <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> length <span class="bound">ys2</span> <span class="main">∧</span> length <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">=</span> length <span class="bound">tr2</span>
          <span class="main">∧</span> path M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">||</span> <span class="bound">ys2</span><span class="main">)</span> <span class="main">||</span> <span class="bound">tr2</span><span class="main">)</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>
            <span class="main">⟶</span> target <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">||</span> <span class="bound">ys2</span><span class="main">)</span> <span class="main">||</span> <span class="bound">tr2</span><span class="main">)</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reaches M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> d_reaches.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> d_reachable M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> d_reachable.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> d_reachable M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹initial M<span class="hidden">⇩</span><sub>S</sub> <span class="main">∈</span> d_reachable M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reachable M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">⊆</span> nodes M<span class="hidden">⇩</span><sub>S</sub>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span>d_reachable M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> reachable M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> d_reachable_reachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>S</sub>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"d_reachable M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> example_nodes<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>



  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat list"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span><span class="main">(</span> <span class="main">0</span> <span class="main">:=</span> <span class="main">[]</span><span class="main">,</span> <span class="main">1</span> <span class="main">:=</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_det_state_cover_ass M<span class="hidden">⇩</span><sub>S</sub> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_det_state_cover_ass.simps
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">∈</span>d_reachable M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span><span class="main">.</span> d_reaches M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span>d_reachable M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> reachable M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> d_reachable_reachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> nodes M<span class="hidden">⇩</span><sub>S</sub>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> example_nodes<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"d_reaches M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"d_reaches M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹d_reaches M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"d_reaches M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">(</span><span class="var">?f</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹d_reaches M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"V<span class="hidden">⇩</span><sub>I</sub> <span class="main">=</span> image <span class="var">?f</span> <span class="main">(</span>d_reachable M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹d_reachable M<span class="hidden">⇩</span><sub>S</sub> <span class="main">(</span>initial M<span class="hidden">⇩</span><sub>S</sub><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_det_state_cover.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ω<span class="hidden">⇩</span><sub>I</sub></span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span>nat<span class="main">)</span> ATC set <span class="main">≡</span> <span class="main">{</span> Node <span class="main">0</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span> <span class="main">.</span> Leaf<span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"applicable_set M<span class="hidden">⇩</span><sub>S</sub> Ω<span class="hidden">⇩</span><sub>I</sub>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="ASC_Example-example_test_tools"><span class="command">lemma</span></span> example_test_tools <span class="main">:</span> <span class="quoted"><span class="quoted">"test_tools M<span class="hidden">⇩</span><sub>S</sub> M<span class="hidden">⇩</span><sub>I</sub> FAIL<span class="hidden">⇩</span><sub>I</sub> PM<span class="hidden">⇩</span><sub>I</sub> V<span class="hidden">⇩</span><sub>I</sub> Ω<span class="hidden">⇩</span><sub>I</sub>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> example_productF example_det_state_cover <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>




<span class="keyword1" id="ASC_Example-OFSM_not_vacuous"><span class="command">lemma</span></span> OFSM_not_vacuous <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">M</span> <span class="main">::</span> <span class="main">(</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">)</span> FSM <span class="main">.</span> OFSM <span class="bound">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> example_OFSM<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="ASC_Example-fault_domain_not_vacuous"><span class="command">lemma</span></span> fault_domain_not_vacuous <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">M2</span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">)</span> FSM<span class="main">)</span> <span class="main">(</span><span class="bound">M1</span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">)</span> FSM<span class="main">)</span> <span class="bound">m</span> <span class="main">.</span> asc_fault_domain <span class="bound">M2</span> <span class="bound">M1</span> <span class="bound">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> example_fault_domain <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="ASC_Example-test_tools_not_vacuous"><span class="command">lemma</span></span> test_tools_not_vacuous <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">M2</span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">)</span> FSM<span class="main">)</span>
     <span class="main">(</span><span class="bound">M1</span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">)</span> FSM<span class="main">)</span>
     <span class="main">(</span><span class="bound">FAIL</span><span class="main">::</span><span class="main">(</span>nat<span class="main">×</span>nat<span class="main">)</span><span class="main">)</span>
     <span class="main">(</span><span class="bound">PM</span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">×</span>nat<span class="main">)</span> FSM<span class="main">)</span>
     <span class="main">(</span><span class="bound">V</span><span class="main">::</span><span class="main">(</span>nat list set<span class="main">)</span><span class="main">)</span>
     <span class="main">(</span><span class="bound">Ω</span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span>nat<span class="main">)</span> ATC set<span class="main">)</span> <span class="main">.</span> test_tools <span class="bound">M2</span> <span class="bound">M1</span> <span class="bound">FAIL</span> <span class="bound">PM</span> <span class="bound">V</span> <span class="bound">Ω</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">FAIL</span> <span class="bound">PM</span> <span class="bound">V</span> <span class="bound">Ω</span><span class="main">.</span> test_tools M<span class="hidden">⇩</span><sub>S</sub> M<span class="hidden">⇩</span><sub>I</sub> <span class="bound">FAIL</span> <span class="bound">PM</span> <span class="bound">V</span> <span class="bound">Ω</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> example_test_tools <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="ASC_Example-precondition_not_vacuous"><span class="command">lemma</span></span> precondition_not_vacuous <span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">M2</span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">)</span> FSM<span class="main">)</span>
           <span class="main">(</span><span class="bound">M1</span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">)</span> FSM<span class="main">)</span>
           <span class="main">(</span><span class="bound">FAIL</span><span class="main">::</span><span class="main">(</span>nat<span class="main">×</span>nat<span class="main">)</span><span class="main">)</span>
           <span class="main">(</span><span class="bound">PM</span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span>nat<span class="main">,</span>nat<span class="main">×</span>nat<span class="main">)</span> FSM<span class="main">)</span>
           <span class="main">(</span><span class="bound">V</span><span class="main">::</span><span class="main">(</span>nat list set<span class="main">)</span><span class="main">)</span>
           <span class="main">(</span><span class="bound">Ω</span><span class="main">::</span><span class="main">(</span>nat<span class="main">,</span>nat<span class="main">)</span> ATC set<span class="main">)</span>
           <span class="main">(</span><span class="bound">m</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">.</span>
              OFSM <span class="bound">M1</span> <span class="main">∧</span> OFSM <span class="bound">M2</span> <span class="main">∧</span> asc_fault_domain <span class="bound">M2</span> <span class="bound">M1</span> <span class="bound">m</span> <span class="main">∧</span> test_tools <span class="bound">M2</span> <span class="bound">M1</span> <span class="bound">FAIL</span> <span class="bound">PM</span> <span class="bound">V</span> <span class="bound">Ω</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"OFSM M<span class="hidden">⇩</span><sub>I</sub> <span class="main">∧</span> OFSM M<span class="hidden">⇩</span><sub>S</sub> <span class="main">∧</span> asc_fault_domain M<span class="hidden">⇩</span><sub>S</sub> M<span class="hidden">⇩</span><sub>I</sub> <span class="numeral">2</span> <span class="main">∧</span> test_tools M<span class="hidden">⇩</span><sub>S</sub> M<span class="hidden">⇩</span><sub>I</sub> FAIL<span class="hidden">⇩</span><sub>I</sub> PM<span class="hidden">⇩</span><sub>I</sub> V<span class="hidden">⇩</span><sub>I</sub> Ω<span class="hidden">⇩</span><sub>I</sub>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> example_OFSM<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span> example_fault_domain example_test_tools <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>