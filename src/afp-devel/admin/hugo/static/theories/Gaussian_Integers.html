<div id="Gaussian_Integers">
<div class="head">
<h1>Theory Gaussian_Integers</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:    Gaussian_Integers.thy
  Author:  Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Gaussian Integers›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Gaussian_Integers
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Computational_Algebra.html">HOL-Computational_Algebra.Computational_Algebra</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Number_Theory/Number_Theory.html">HOL-Number_Theory.Number_Theory</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary material›</span></span>

<span class="keyword1" id="Gaussian_Integers-coprime_iff_prime_factors_disjoint"><span class="command">lemma</span></span> coprime_iff_prime_factors_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> factorial_semiring"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> prime_factors <span class="free">x</span> <span class="main">∩</span> prime_factors <span class="free">y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">x</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> coprime_common_divisor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> that assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="free">x</span> <span class="main">∩</span> prime_factors <span class="free">y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_factors <span class="free">x</span> <span class="main">∩</span> prime_factors <span class="free">y</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprimeI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_unit <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> d assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prime_divisor_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> d <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="free">x</span> <span class="main">∩</span> prime_factors <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_dvd<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> disjoint <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-product_dvd_irreducibleD"><span class="command">lemma</span></span> product_dvd_irreducibleD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> algebraic_semidom"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> irreducibleD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_unit_mult_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-prime_elem_mult_dvdI"><span class="command">lemma</span></span> prime_elem_mult_dvdI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> prime_elem_dvd_mult_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> c <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_dvd_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-prime_elem_power_mult_dvdI"><span class="command">lemma</span></span> prime_elem_power_mult_dvdI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> algebraic_semidom"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="free">b</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">b</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prime_power_dvd_multD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms False <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> c <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_dvd_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-prime_mod_4_cases"><span class="command">lemma</span></span> prime_mod_4_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">∨</span> <span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> prime_gt_1_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="numeral">4</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms product_dvd_irreducibleD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_elem_iff_irreducible <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> prime_elem_nat_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mod_eq_0_iff_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">≠</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>›</span></span> prime_odd_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mod_mod_cancel<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-of_nat_prod_mset"><span class="command">lemma</span></span> of_nat_prod_mset<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span>prod_mset <span class="free">A</span><span class="main">)</span> <span class="main">=</span> prod_mset <span class="main">(</span>image_mset of_nat <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-multiplicity_0_left"><span class="command">lemma</span></span> multiplicity_0_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_dvd_imp_multiplicity_0<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-is_unit_power"><span class="command">lemma</span></span> is_unit_power <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="free">x</span> <span class="main">⟹</span> is_unit <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> is_unit_power_iff<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> factorial_semiring<span class="main">)</span> pow_divides_pow_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">b</span> <span class="main">^</span> <span class="free">n</span> <span class="main">⟷</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">b</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_0_left<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicity_le_imp_dvd<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> dvd <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> multiplicity <span class="skolem">p</span> <span class="main">(</span><span class="free">b</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_multiplicity_le<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="free">a</span> <span class="main">≤</span> multiplicity <span class="skolem">p</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_elem_multiplicity_power_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dvd_power_same<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> power_0_left›</span><span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-multiplicity_power_power"><span class="command">lemma</span></span> multiplicity_power_power<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>factorial_semiring<span class="main">,</span> algebraic_semidom<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multiplicity <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> is_unit <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_0_left is_unit_power_iff multiplicity_unit_left<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> antisym multiplicity_geI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">^</span> multiplicity <span class="free">p</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_power_same<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multiplicity_dvd<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">^</span> multiplicity <span class="free">p</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">^</span> multiplicity <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multiplicity_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">^</span> multiplicity <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> multiplicity <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> pow_divides_pow_iff<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> False <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> is_unit_power_iff›</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-even_square_cong_4_int"><span class="command">lemma</span></span> even_square_cong_4_int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"even <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">¦</span><span class="free">x</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mod<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mod_double_modulus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-even_square_cong_4_nat"><span class="command">lemma</span></span> even_square_cong_4_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="free">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> even_square_cong_4_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int <span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> cong_int_iff<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-odd_square_cong_4_int"><span class="command">lemma</span></span> odd_square_cong_4_int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">¦</span><span class="free">x</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mod<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mod_double_modulus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-odd_square_cong_4_nat"><span class="command">lemma</span></span> odd_square_cong_4_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="free">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⟹</span> <span class="main">[</span><span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> odd_square_cong_4_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int <span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> cong_int_iff<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Gaussian integers will require a notion of an element being a power up to a unit,
  so we introduce this here. This should go in the library eventually.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_nth_power_upto_unit</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_nth_power_upto_unit</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> is_unit <span class="bound">u</span> <span class="main">∧</span> is_nth_power <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="bound">u</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Gaussian_Integers-is_nth_power_upto_unit_base"><span class="command">lemma</span></span> is_nth_power_upto_unit_base<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nth_power <span class="free">n</span> <span class="free">x</span> <span class="main">⟹</span> is_nth_power_upto_unit <span class="free">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_nth_power_upto_unit_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-is_nth_power_upto_unitI"><span class="command">lemma</span></span> is_nth_power_upto_unitI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> normalize <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="free">n</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> associatedE1<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_nth_power_upto_unit_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-is_nth_power_upto_unit_conv_multiplicity"><span class="command">lemma</span></span> is_nth_power_upto_unit_conv_multiplicity<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> factorial_semiring"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="free">n</span> <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">⟶</span> <span class="free">n</span> <span class="keyword1">dvd</span> multiplicity <span class="bound">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="free">n</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> uy<span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_nth_power_upto_unit_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_nth_powerE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> p uy assms False <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_0_left<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> uy<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multiplicity_times_unit_right uy<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">dvd</span> multiplicity <span class="skolem">p</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword2"><span class="keyword">and</span></span> p <span class="keyword2"><span class="keyword">and</span></span> uy <span class="keyword2"><span class="keyword">and</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_elem_multiplicity_power_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> prime <span class="bound">p</span> <span class="main">⟶</span> <span class="free">n</span> <span class="keyword1">dvd</span> multiplicity <span class="bound">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">x</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="free">x</span> <span class="keyword1">div</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> 
            multiplicity <span class="skolem">p</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> that <span class="keyword2"><span class="keyword">and</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">dvd</span> multiplicity <span class="skolem">p</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> prime_factors <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_factors_multiplicity<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> that <span class="keyword2"><span class="keyword">and</span></span> * <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> prod_power_distrib power_mult <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> multiplicity_prod_prime_powers<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_imp_prime <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms False 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span><span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">x</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="free">x</span> <span class="keyword1">div</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> normalize <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> multiplicity_eq_imp_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> multiplicity_prod_prime_powers<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="free">n</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_nth_power_upto_unitI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> is_nth_power_upto_unit_def›</span><span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-is_nth_power_upto_unit_0_left"><span class="command">lemma</span></span> is_nth_power_upto_unit_0_left <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="main">0</span> <span class="free">x</span> <span class="main">⟷</span> is_unit <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="main">0</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_nth_power_upto_unit_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">1</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">div</span></span></span> <span class="free"><span class="free"><span class="free">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="main">0</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_nth_power_upto_unit_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_triv_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-is_nth_power_upto_unit_unit"><span class="command">lemma</span></span> is_nth_power_upto_unit_unit <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="free">n</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_nth_power_upto_unit_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="keyword1">div</span> <span class="free">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-is_nth_power_upto_unit_1_left"><span class="command">lemma</span></span> is_nth_power_upto_unit_1_left <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="main">1</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_nth_power_upto_unit_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-is_nth_power_upto_unit_mult_coprimeD1"><span class="command">lemma</span></span> is_nth_power_upto_unit_mult_coprimeD1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> factorial_semiring"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="free">n</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="free">n</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_unit_mult_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_nth_power_upto_unit_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> is_nth_power_upto_unit_conv_multiplicity<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">dvd</span> multiplicity <span class="skolem">p</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_dvd_imp_multiplicity_0<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">dvd</span> multiplicity <span class="skolem">p</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_nth_power_upto_unit_conv_multiplicity<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="free">x</span> <span class="main">+</span> multiplicity <span class="skolem">p</span> <span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_elem_multiplicity_mult_distrib<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">x</span> <span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">x</span>›</span></span> p not_prime_unit coprime_common_divisor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="skolem">p</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> not_dvd_imp_multiplicity_0<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-is_nth_power_upto_unit_mult_coprimeD2"><span class="command">lemma</span></span> is_nth_power_upto_unit_mult_coprimeD2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> factorial_semiring"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="free">n</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="free">n</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms is_nth_power_upto_unit_mult_coprimeD1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac coprime_commute<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Gaussian integers are the ring $\mathbb{Z}[i]$ which is formed either by formally adjoining
  an element $i$ with $i^2 = -1$ to $\mathbb{Z}$ or by taking all the complex numbers with
  integer real and imaginary part.

  We define them simply by giving an appropriate ring structure to $\mathbb{Z}^2$, with the first
  component representing the real part and the second component the imaginary part:
›</span></span>
<span class="keyword1"><span class="command">codatatype</span></span> gauss_int <span class="main">=</span> Gauss_Int <span class="main">(</span><span class="free"><span class="entity">ReZ</span></span><span class="main">:</span> <span class="quoted">int</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">ImZ</span></span><span class="main">:</span> <span class="quoted">int</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following is the imaginary unit $i$ in the Gaussian integers, which we will denote as
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>𝗂<span class="hidden">⇩</span><sub>ℤ</sub>›</span></span></span></span>:
›</span></span>
<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">gauss_i</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"ReZ <span class="free">gauss_i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"ImZ <span class="free">gauss_i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_eq_iff"><span class="command">lemma</span></span> gauss_int_eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟷</span> ReZ <span class="free">x</span> <span class="main">=</span> ReZ <span class="free">y</span> <span class="main">∧</span> ImZ <span class="free">x</span> <span class="main">=</span> ImZ <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">bundle</span></span> gauss_int_notation
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> gauss_i <span class="main">(</span><span class="quoted">"<span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">bundle</span></span> no_gauss_int_notation
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">output</span></span><span class="main">)</span> gauss_i <span class="main">(</span><span class="quoted">"<span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">bundle</span></span> gauss_int_output_notation
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">output</span></span><span class="main">)</span> gauss_i <span class="main">(</span><span class="quoted">"<span class="keyword1">𝔦</span>"</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">unbundle</span></span> gauss_int_notation
<span class="comment1">(*&gt;*)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we define the canonical injective homomorphism from the Gaussian integers into the
  complex numbers:
›</span></span>
<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">gauss2complex</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">gauss2complex</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span>ReZ <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="free">gauss2complex</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span>ImZ <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted">gauss2complex</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1" id="Gaussian_Integers-gauss2complex_eq_iff"><span class="command">lemma</span></span> gauss2complex_eq_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss2complex <span class="free">z</span> <span class="main">=</span> gauss2complex <span class="free">u</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff gauss_int_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Gaussian integers also have conjugates, just like complex numbers:
›</span></span>
<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">gauss_cnj</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"ReZ <span class="main">(</span><span class="free">gauss_cnj</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> ReZ <span class="free"><span class="bound"><span class="entity">z</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"ImZ <span class="main">(</span><span class="free">gauss_cnj</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>ImZ <span class="free"><span class="bound"><span class="entity">z</span></span></span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In the remainder of this section, we prove that Gaussian integers are a commutative ring
  of characteristic 0 and several other trivial algebraic properties.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> gauss_int <span class="main">::</span> <span class="quoted">comm_ring_1</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">zero_gauss_int</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"ReZ <span class="free">zero_gauss_int</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"ImZ <span class="free">zero_gauss_int</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">one_gauss_int</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"ReZ <span class="free">one_gauss_int</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"ImZ <span class="free">one_gauss_int</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">uminus_gauss_int</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"ReZ <span class="main">(</span><span class="free">uminus_gauss_int</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>ReZ <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"ImZ <span class="main">(</span><span class="free">uminus_gauss_int</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>ImZ <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">plus_gauss_int</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"ReZ <span class="main">(</span><span class="free">plus_gauss_int</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ReZ <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> ReZ <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"ImZ <span class="main">(</span><span class="free">plus_gauss_int</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ImZ <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> ImZ <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">minus_gauss_int</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"ReZ <span class="main">(</span><span class="free">minus_gauss_int</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ReZ <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> ReZ <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"ImZ <span class="main">(</span><span class="free">minus_gauss_int</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ImZ <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> ImZ <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">times_gauss_int</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"ReZ <span class="main">(</span><span class="free">times_gauss_int</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ReZ <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> ReZ <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">-</span> ImZ <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> ImZ <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"ImZ <span class="main">(</span><span class="free">times_gauss_int</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> ReZ <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> ImZ <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">+</span> ImZ <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> ReZ <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Gaussian_Integers-gauss_i_times_i"><span class="command">lemma</span></span> gauss_i_times_i <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_cnj_i <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">=</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss_cnj_eq_0_iff"><span class="command">lemma</span></span> gauss_cnj_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss_cnj_eq_self"><span class="command">lemma</span></span> gauss_cnj_eq_self<span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> gauss_cnj <span class="free">z</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_cnj_eq_minus_self<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> gauss_cnj <span class="free">z</span> <span class="main">=</span> <span class="main">-</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-ReZ_of_nat"><span class="command">lemma</span></span> ReZ_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ReZ <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ImZ_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ImZ <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Gaussian_Integers-ReZ_of_int"><span class="command">lemma</span></span> ReZ_of_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ReZ <span class="main">(</span>of_int <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ImZ_of_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ImZ <span class="main">(</span>of_int <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Gaussian_Integers-ReZ_numeral"><span class="command">lemma</span></span> ReZ_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ReZ <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">=</span> numeral <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ImZ_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ImZ <span class="main">(</span>numeral <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_numeral <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> ReZ_of_nat ImZ_of_nat<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Gaussian_Integers-gauss2complex_0"><span class="command">lemma</span></span> gauss2complex_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss2complex <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss2complex_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss2complex <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss2complex_i <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss2complex <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">=</span> <span class="keyword1">𝗂</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss2complex_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss2complex <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> gauss2complex <span class="free">x</span> <span class="main">+</span> gauss2complex <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss2complex_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss2complex <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> gauss2complex <span class="free">x</span> <span class="main">-</span> gauss2complex <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss2complex_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss2complex <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> gauss2complex <span class="free">x</span> <span class="main">*</span> gauss2complex <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss2complex_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss2complex <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>gauss2complex <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss2complex_cnj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss2complex <span class="main">(</span>gauss_cnj <span class="free">x</span><span class="main">)</span> <span class="main">=</span> cnj <span class="main">(</span>gauss2complex <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss2complex_of_nat"><span class="command">lemma</span></span> gauss2complex_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss2complex <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss2complex_eq_0_iff"><span class="command">lemma</span></span> gauss2complex_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss2complex <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss2complex_eq_1_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss2complex <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> zero_eq_gauss2complex_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> gauss2complex <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> one_eq_gauss2complex_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> gauss2complex <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff gauss_int_eq_iff<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss_i_times_gauss_i_times"><span class="command">lemma</span></span> gauss_i_times_gauss_i_times <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult.assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> gauss_i_times_i<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-gauss_i_neq_0"><span class="command">lemma</span></span> gauss_i_neq_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_i_neq_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≠</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_i_neq_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">≠</span> of_nat <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">n</span> <span class="main">≠</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_i_neq_of_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">≠</span> of_int <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"of_int <span class="free">n</span> <span class="main">≠</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_i_neq_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">≠</span> numeral <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"numeral <span class="free">m</span> <span class="main">≠</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss_cnj_0"><span class="command">lemma</span></span> gauss_cnj_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_cnj_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_cnj_cnj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_cnj_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="main">(</span><span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>gauss_cnj <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_cnj_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> gauss_cnj <span class="free">a</span> <span class="main">+</span> gauss_cnj <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_cnj_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> gauss_cnj <span class="free">a</span> <span class="main">-</span> gauss_cnj <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_cnj_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> gauss_cnj <span class="free">a</span> <span class="main">*</span> gauss_cnj <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_cnj_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="main">(</span>of_nat <span class="free">n1</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">n1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_cnj_of_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="main">(</span>of_int <span class="free">n2</span><span class="main">)</span> <span class="main">=</span> of_int <span class="free">n2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_cnj_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="main">(</span>numeral <span class="free">n3</span><span class="main">)</span> <span class="main">=</span> numeral <span class="free">n3</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss_cnj_power"><span class="command">lemma</span></span> gauss_cnj_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> gauss_cnj <span class="free">a</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-gauss_cnj_sum"><span class="command">lemma</span></span> gauss_cnj_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="main">(</span>sum <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> gauss_cnj <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-gauss_cnj_prod"><span class="command">lemma</span></span> gauss_cnj_prod <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="main">(</span>prod <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> gauss_cnj <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-of_nat_dvd_of_nat"><span class="command">lemma</span></span> of_nat_dvd_of_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"of_nat <span class="free">a</span> <span class="keyword1">dvd</span> <span class="main">(</span>of_nat <span class="free">b</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_semiring_1<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-of_int_dvd_imp_dvd_gauss_cnj"><span class="command">lemma</span></span> of_int_dvd_imp_dvd_gauss_cnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_int <span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"of_int <span class="free">n</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> of_int <span class="free">n</span> <span class="main">*</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">z</span> <span class="main">=</span> of_int <span class="free">n</span> <span class="main">*</span> gauss_cnj <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-of_nat_dvd_imp_dvd_gauss_cnj"><span class="command">lemma</span></span> of_nat_dvd_imp_dvd_gauss_cnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"of_nat <span class="free">n</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> of_int_dvd_imp_dvd_gauss_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int <span class="free">n</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Gaussian_Integers-of_int_dvd_of_int_gauss_int_iff"><span class="command">lemma</span></span> of_int_dvd_of_int_gauss_int_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>of_int <span class="free">m</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="keyword1">dvd</span> of_int <span class="free">n</span> <span class="main">⟷</span> <span class="free">m</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"of_int <span class="free">m</span> <span class="keyword1">dvd</span> <span class="main">(</span>of_int <span class="free">n</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="main">::</span> <span class="quoted">gauss_int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"of_int <span class="free">n</span> <span class="main">=</span> of_int <span class="free">m</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-of_nat_dvd_of_nat_gauss_int_iff"><span class="command">lemma</span></span> of_nat_dvd_of_nat_gauss_int_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>of_nat <span class="free">m</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="keyword1">dvd</span> of_nat <span class="free">n</span> <span class="main">⟷</span> <span class="free">m</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> of_int_dvd_of_int_gauss_int_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"int <span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Gaussian_Integers-gauss_cnj_dvd"><span class="command">lemma</span></span> gauss_cnj_dvd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">a</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">b</span> <span class="main">=</span> gauss_cnj <span class="free">a</span> <span class="main">*</span> gauss_cnj <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-gauss_cnj_dvd_iff"><span class="command">lemma</span></span> gauss_cnj_dvd_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">a</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> gauss_cnj_dvd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> gauss_cnj_dvd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-gauss_cnj_dvd_left_iff"><span class="command">lemma</span></span> gauss_cnj_dvd_left_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span> <span class="main">⟷</span> <span class="free">a</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> gauss_cnj_dvd_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-gauss_cnj_dvd_right_iff"><span class="command">lemma</span></span> gauss_cnj_dvd_right_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">b</span> <span class="main">⟷</span> gauss_cnj <span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gauss_cnj_dvd_left_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">instance</span></span> gauss_int <span class="main">::</span> <span class="quoted">idom</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gauss2complex <span class="skolem">z</span> <span class="main">*</span> gauss2complex <span class="skolem">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss2complex <span class="skolem">z</span> <span class="main">*</span> gauss2complex <span class="skolem">u</span> <span class="main">=</span> gauss2complex <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> gauss2complex_eq_0_iff <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> gauss_int <span class="main">::</span> <span class="quoted">ring_char_0</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> injI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Pretty-printing›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following lemma collection provides better pretty-printing of Gaussian integers so that
  e.g.\ evaluation with the `value' command produces nicer results.
›</span></span>
<span class="keyword1" id="Gaussian_Integers-gauss_int_code_post"><span class="command">lemma</span></span> gauss_int_code_post <span class="main">[</span><span class="operator">code_post</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">0</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">0</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">0</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">1</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">1</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">1</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>  
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> numeral <span class="free">b</span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span><span class="main">-</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="main">-</span>numeral <span class="free">b</span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> numeral <span class="free">b</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span><span class="main">-</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">1</span> <span class="main">=</span> <span class="main">-</span>numeral <span class="free">b</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> numeral <span class="free">b</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span><span class="main">-</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>numeral <span class="free">b</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">0</span> <span class="main">(</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">=</span> numeral <span class="free">b</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">0</span> <span class="main">(</span><span class="main">-</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>numeral <span class="free">b</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">1</span> <span class="main">(</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> numeral <span class="free">b</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">1</span> <span class="main">(</span><span class="main">-</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> numeral <span class="free">b</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">+</span> numeral <span class="free">b</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">-</span> numeral <span class="free">b</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span>numeral <span class="free">a</span><span class="main">)</span> <span class="main">(</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">=</span> numeral <span class="free">a</span> <span class="main">+</span> numeral <span class="free">b</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span>numeral <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">=</span> numeral <span class="free">a</span> <span class="main">-</span> numeral <span class="free">b</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span><span class="main">-</span>numeral <span class="free">a</span><span class="main">)</span> <span class="main">(</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>numeral <span class="free">a</span> <span class="main">+</span> numeral <span class="free">b</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="quoted"><span class="quoted">"Gauss_Int <span class="main">(</span><span class="main">-</span>numeral <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span>numeral <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>numeral <span class="free">a</span> <span class="main">-</span> numeral <span class="free">b</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">^</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Norm›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The square of the complex norm (or complex modulus) on the Gaussian integers gives us a norm
  that always returns a natural number. We will later show that this is also a Euclidean norm
  (in the sense of a Euclidean ring).
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gauss_int_norm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gauss_int <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gauss_int_norm</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> nat <span class="main">(</span>ReZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> ImZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_norm_0"><span class="command">lemma</span></span> gauss_int_norm_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_int_norm_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_int_norm_i <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_int_norm_cnj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span> <span class="main">=</span> gauss_int_norm <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_int_norm_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_int_norm_of_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span>of_int <span class="free">m</span><span class="main">)</span> <span class="main">=</span> nat <span class="main">(</span><span class="free">m</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> gauss_int_norm_of_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span>numeral <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> numeral <span class="main">(</span>Num.sqr <span class="free">n'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def nat_power_eq<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_norm_uminus"><span class="command">lemma</span></span> gauss_int_norm_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">=</span> gauss_int_norm <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_norm_eq_0_iff"><span class="command">lemma</span></span> gauss_int_norm_eq_0_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> ImZ <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> ImZ <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> ImZ <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_norm_pos_iff"><span class="command">lemma</span></span> gauss_int_norm_pos_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">z</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> gauss_int_norm_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-real_gauss_int_norm"><span class="command">lemma</span></span> real_gauss_int_norm<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span> <span class="main">=</span> norm <span class="main">(</span>gauss2complex <span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cmod_def gauss_int_norm_def<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_norm_mult"><span class="command">lemma</span></span> gauss_int_norm_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> gauss_int_norm <span class="free">z</span> <span class="main">*</span> gauss_int_norm <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>gauss_int_norm <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> real <span class="main">(</span>gauss_int_norm <span class="free">z</span> <span class="main">*</span> gauss_int_norm <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> of_nat_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_gauss_int_norm norm_power norm_mult power_mult_distrib<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_nat_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-self_mult_gauss_cnj"><span class="command">lemma</span></span> self_mult_gauss_cnj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">*</span> gauss_cnj <span class="free">z</span> <span class="main">=</span> of_nat <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def gauss_int_eq_iff <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss_cnj_mult_self"><span class="command">lemma</span></span> gauss_cnj_mult_self<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">z</span> <span class="main">*</span> <span class="free">z</span> <span class="main">=</span> of_nat <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> self_mult_gauss_cnj<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-self_plus_gauss_cnj"><span class="command">lemma</span></span> self_plus_gauss_cnj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">+</span> gauss_cnj <span class="free">z</span> <span class="main">=</span> of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> ReZ <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> self_minus_gauss_cnj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">-</span> gauss_cnj <span class="free">z</span> <span class="main">=</span> of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> ImZ <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_norm_dvd_mono"><span class="command">lemma</span></span> gauss_int_norm_dvd_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">a</span> <span class="keyword1">dvd</span> gauss_int_norm <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">b</span> <span class="main">=</span> gauss_int_norm <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_norm_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A Gaussian integer is a unit iff its norm is 1, and this is the case precisely for the four
  elements <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>±1›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>±𝗂›</span></span></span></span>:
›</span></span>
<span class="keyword1" id="Gaussian_Integers-is_unit_gauss_int_iff"><span class="command">lemma</span></span> is_unit_gauss_int_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">::</span> gauss_int<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> is_unit_gauss_int_iff'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟷</span> gauss_int_norm <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> gauss_cnj <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> * <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gauss_int_norm_dvd_mono<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ReZ <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>ImZ <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def nat_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> zero_le_power2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ImZ <span class="free">x</span>"</span></span><span class="main">]</span> zero_le_power2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ReZ <span class="free">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>ReZ <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>ImZ <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_square_le_1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">::</span> gauss_int<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>    
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">::</span> gauss_int<span class="main">}</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟷</span> gauss_int_norm <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-is_unit_gauss_i"><span class="command">lemma</span></span> is_unit_gauss_i <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>gauss_i <span class="main">::</span> gauss_int<span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_gauss_int_iff<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_norm_eq_Suc_0_iff"><span class="command">lemma</span></span> gauss_int_norm_eq_Suc_0_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">x</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_gauss_int_iff'<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-is_unit_gauss_cnj"><span class="command">lemma</span></span> is_unit_gauss_cnj <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟹</span> gauss_cnj <span class="free">z</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_gauss_int_iff'<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-is_unit_gauss_cnj_iff"><span class="command">lemma</span></span> is_unit_gauss_cnj_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">z</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">z</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_gauss_int_iff'<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Division and normalisation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define a rounding operation that takes a complex number and returns a Gaussian integer
  by rounding the real and imaginary parts separately:
›</span></span>
<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">round_complex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> gauss_int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"ReZ <span class="main">(</span><span class="free">round_complex</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> round <span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"ImZ <span class="main">(</span><span class="free">round_complex</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> round <span class="main">(</span>Im <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The distance between a rounded complex number and the original one is no more than
  $\frac{1}{2}\sqrt{2}$:
›</span></span>
<span class="keyword1" id="Gaussian_Integers-norm_round_complex_le"><span class="command">lemma</span></span> norm_round_complex_le<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">z</span> <span class="main">-</span> gauss2complex <span class="main">(</span>round_complex <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="free">z</span> <span class="main">-</span> ReZ <span class="main">(</span>round_complex <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> of_int_round_abs_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="free">z</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> abs_le_square_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_minus_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im <span class="free">z</span> <span class="main">-</span> ImZ <span class="main">(</span>round_complex <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> of_int_round_abs_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Im <span class="free">z</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> abs_le_square_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_minus_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="free">z</span> <span class="main">-</span> ReZ <span class="main">(</span>round_complex <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>Im <span class="free">z</span> <span class="main">-</span> ImZ <span class="main">(</span>round_complex <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span>
                     <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">z</span> <span class="main">-</span> gauss2complex <span class="main">(</span>round_complex <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power2_eq_square<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-dist_round_complex_le"><span class="command">lemma</span></span> dist_round_complex_le<span class="main">:</span> <span class="quoted"><span class="quoted">"dist <span class="free">z</span> <span class="main">(</span>gauss2complex <span class="main">(</span>round_complex <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> sqrt <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">z</span> <span class="main">(</span>gauss2complex <span class="main">(</span>round_complex <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span>
        norm <span class="main">(</span><span class="free">z</span> <span class="main">-</span> gauss2complex <span class="main">(</span>round_complex <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> norm_round_complex_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>sqrt <span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power2_le_imp_le<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now define division on Gaussian integers simply by performing the division in the
  complex numbers and rounding the result. This also gives us a remainder operation defined
  accordingly for which the norm of the remainder is always smaller than the norm of the divisor.

  We can also define a normalisation operation that returns a canonical representative for each
  association class. Since the four units of the Gaussian integers are <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>±1›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>±𝗂›</span></span></span></span>, each
  association class (other than <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>0›</span></span></span></span>) has four representatives, one in each quadrant. We simply
  define the on in the upper-right quadrant (i.e.\ the one with non-negative imaginary part
  and positive real part) as the canonical one.

  Thus, the Gaussian integers form a Euclidean ring. This gives us many things, most importantly
  the existence of GCDs and LCMs and unique factorisation.
›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> gauss_int <span class="main">::</span> <span class="quoted">algebraic_semidom</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">divide_gauss_int</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gauss_int <span class="main">⇒</span> gauss_int <span class="main">⇒</span> gauss_int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">divide_gauss_int</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> round_complex <span class="main">(</span>gauss2complex <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">/</span> gauss2complex <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">div</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff divide_gauss_int_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">gauss_int</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="keyword1">div</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff divide_gauss_int_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> gauss_int <span class="main">::</span> <span class="quoted">semidom_divide_unit_factor</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">unit_factor_gauss_int</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gauss_int <span class="main">⇒</span> gauss_int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unit_factor_gauss_int</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> 
      <span class="keyword1">if</span> ImZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> ReZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> ReZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> ImZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> ImZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> ReZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span>
      <span class="keyword1">else</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unit_factor <span class="main">(</span><span class="main">0</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_factor_gauss_int_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">z</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"unit_factor <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> is_unit_gauss_int_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unit_factor_gauss_int_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span>unit_factor <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> is_unit_gauss_int_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unit_factor_gauss_int_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> is_unit_gauss_int_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"unit_factor <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">*</span> unit_factor <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unit_factor_gauss_int_def gauss_int_eq_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> gauss_int <span class="main">::</span> <span class="quoted">normalization_semidom</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">normalize_gauss_int</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gauss_int <span class="main">⇒</span> gauss_int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">normalize_gauss_int</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> 
      <span class="keyword1">if</span> ImZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> ReZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> ReZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> ImZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> ImZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> ReZ <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">z</span></span></span>
      <span class="keyword1">else</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span><span class="main">0</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_gauss_int_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unit_factor <span class="skolem">z</span> <span class="main">*</span> normalize <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> normalize_gauss_int_def unit_factor_gauss_int_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Gaussian_Integers-normalize_gauss_int_of_nat"><span class="command">lemma</span></span> normalize_gauss_int_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">=</span> of_nat <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> normalize_gauss_int_of_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span>of_int <span class="free">m</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">=</span> of_int <span class="main">¦</span><span class="free">m</span><span class="main">¦</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> normalize_gauss_int_of_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span>numeral <span class="free">n'</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">=</span> numeral <span class="free">n'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> normalize_gauss_int_def<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-normalize_gauss_i"><span class="command">lemma</span></span> normalize_gauss_i <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"normalize <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_gauss_int_def<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_norm_normalize"><span class="command">lemma</span></span> gauss_int_norm_normalize <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span>normalize <span class="free">x</span><span class="main">)</span> <span class="main">=</span> gauss_int_norm <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_gauss_int_def gauss_int_norm_mult<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-normalized_gauss_int"><span class="command">lemma</span></span> normalized_gauss_int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"normalize <span class="free">z</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">z</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> int"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">cases</span> <span class="quoted"><span class="quoted">"ImZ <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> int"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_gauss_int_def gauss_int_eq_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Gaussian_Integers-normalized_gauss_int'"><span class="command">lemma</span></span> normalized_gauss_int'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"normalize <span class="free">z</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">z</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> int"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">cases</span> <span class="quoted"><span class="quoted">"ImZ <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> int"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_gauss_int_def gauss_int_eq_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Gaussian_Integers-normalized_gauss_int_iff"><span class="command">lemma</span></span> normalized_gauss_int_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"normalize <span class="free">z</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ReZ <span class="free">z</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> ImZ <span class="free">z</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> int"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">cases</span> <span class="quoted"><span class="quoted">"ImZ <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> int"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main"><span class="keyword3">;</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_gauss_int_def gauss_int_eq_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> gauss_int <span class="main">::</span> <span class="quoted">idom_modulo</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">modulo_gauss_int</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gauss_int <span class="main">⇒</span> gauss_int <span class="main">⇒</span> gauss_int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">modulo_gauss_int</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">+</span> <span class="skolem">a</span> <span class="keyword1">mod</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> modulo_gauss_int_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_norm_mod_less_aux"><span class="command">lemma</span></span> gauss_int_norm_mod_less_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> gauss_int_norm <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span> <span class="main">≤</span> gauss_int_norm <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> gauss2complex <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">=</span> gauss2complex <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> 
          norm <span class="main">(</span>gauss2complex <span class="main">(</span><span class="free">a</span> <span class="main">-</span> round_complex <span class="main">(</span><span class="skolem">a'</span> <span class="main">/</span> <span class="skolem">b'</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> modulo_gauss_int_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> real_gauss_int_norm <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_gauss_int_def a'_def b'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss2complex <span class="main">(</span><span class="free">a</span> <span class="main">-</span> round_complex <span class="main">(</span><span class="skolem">a'</span> <span class="main">/</span> <span class="skolem">b'</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
               <span class="skolem">a'</span> <span class="main">-</span> gauss2complex <span class="main">(</span>round_complex <span class="main">(</span><span class="skolem">a'</span> <span class="main">/</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a'_def b'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a'</span> <span class="main">/</span> <span class="skolem">b'</span> <span class="main">-</span> gauss2complex <span class="main">(</span>round_complex <span class="main">(</span><span class="skolem">a'</span> <span class="main">/</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">…</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> norm <span class="main">(</span><span class="skolem">a'</span> <span class="main">/</span> <span class="skolem">b'</span> <span class="main">-</span> gauss2complex <span class="main">(</span>round_complex <span class="main">(</span><span class="skolem">a'</span> <span class="main">/</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> norm <span class="skolem">b'</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult power_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">*</span> norm <span class="skolem">b'</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono norm_round_complex_le<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">b'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> gauss_int_norm <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b'_def real_gauss_int_norm<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_norm_mod_less"><span class="command">lemma</span></span> gauss_int_norm_mod_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span> <span class="main">&lt;</span> gauss_int_norm <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span> <span class="main">&lt;</span> gauss_int_norm <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gauss_int_norm_mod_less_aux<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_norm_dvd_imp_le"><span class="command">lemma</span></span> gauss_int_norm_dvd_imp_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">a</span> <span class="main">≤</span> gauss_int_norm <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_le gauss_int_norm_dvd_mono<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">instantiation</span></span> gauss_int <span class="main">::</span> <span class="quoted">euclidean_ring</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">euclidean_size_gauss_int</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gauss_int <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">euclidean_size_gauss_int</span> <span class="main">=</span> gauss_int_norm"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"euclidean_size <span class="main">(</span><span class="main">0</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">gauss_int</span> <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"euclidean_size <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">mod</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> euclidean_size <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gauss_int_norm_mod_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"euclidean_size <span class="skolem">a</span> <span class="main">≤</span> euclidean_size <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_norm_dvd_imp_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> gauss_int <span class="main">::</span> <span class="quoted">normalization_euclidean_semiring</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> gauss_int <span class="main">::</span> <span class="quoted">euclidean_ring_gcd</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">gcd_gauss_int</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gauss_int <span class="main">⇒</span> gauss_int <span class="main">⇒</span> gauss_int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gcd_gauss_int</span> <span class="main">≡</span> normalization_euclidean_semiring_class.gcd"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">lcm_gauss_int</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gauss_int <span class="main">⇒</span> gauss_int <span class="main">⇒</span> gauss_int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lcm_gauss_int</span> <span class="main">≡</span> normalization_euclidean_semiring_class.lcm"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">Gcd_gauss_int</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gauss_int set <span class="main">⇒</span> gauss_int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Gcd_gauss_int</span> <span class="main">≡</span> normalization_euclidean_semiring_class.Gcd"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">Lcm_gauss_int</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gauss_int set <span class="main">⇒</span> gauss_int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Lcm_gauss_int</span> <span class="main">≡</span> normalization_euclidean_semiring_class.Lcm"</span></span>

<span class="keyword1"><span class="command">instance</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span>
     <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd_gauss_int_def lcm_gauss_int_def Gcd_gauss_int_def Lcm_gauss_int_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Gaussian_Integers-multiplicity_gauss_cnj"><span class="command">lemma</span></span> multiplicity_gauss_cnj<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="main">(</span>gauss_cnj <span class="free">a</span><span class="main">)</span> <span class="main">(</span>gauss_cnj <span class="free">b</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> multiplicity_def gauss_cnj_power <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> gauss_cnj_dvd_iff <span class="keyword1"><span class="command">..</span></span>
    
<span class="keyword1" id="Gaussian_Integers-multiplicity_gauss_int_of_nat"><span class="command">lemma</span></span> multiplicity_gauss_int_of_nat<span class="main">:</span>
  <span class="quoted"><span class="quoted">"multiplicity <span class="main">(</span>of_nat <span class="free">a</span><span class="main">)</span> <span class="main">(</span>of_nat <span class="free">b</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">=</span> multiplicity <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> multiplicity_def of_nat_power <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> of_nat_dvd_of_nat_gauss_int_iff <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_dvd_same_norm_imp_associated"><span class="command">lemma</span></span> gauss_int_dvd_same_norm_imp_associated<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="keyword1">dvd</span> <span class="free">z2</span>"</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">z1</span> <span class="main">=</span> gauss_int_norm <span class="free">z2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"normalize <span class="free">z1</span> <span class="main">=</span> normalize <span class="free">z2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z2</span> <span class="main">=</span> <span class="free">z1</span> <span class="main">*</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">u</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_mult u<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_gauss_int_iff'<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> u <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-gcd_of_int_gauss_int"><span class="command">lemma</span></span> gcd_of_int_gauss_int<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span>of_int <span class="free">a</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">(</span>of_int <span class="free">b</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span>gcd <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="free">b</span><span class="main">¦</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">b</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span>gcd <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="main">(</span>gcd <span class="skolem">b</span> <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">mod</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> gcd_red_int<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> gcd <span class="main">(</span>of_int <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>of_int <span class="main">(</span><span class="skolem">a</span> <span class="keyword1">mod</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> less <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> abs_mod_less<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">mod</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_div_mult_eq_mod<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">…</span> <span class="main">=</span> of_int <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">a</span> <span class="keyword1">div</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> of_int <span class="skolem">b</span> <span class="main">+</span> <span class="main">(</span>of_int <span class="skolem">a</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span>of_int <span class="skolem">b</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> gcd <span class="main">(</span>of_int <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>of_int <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gcd_add_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-coprime_of_int_gauss_int"><span class="command">lemma</span></span> coprime_of_int_gauss_int<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>of_int <span class="free">a</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">(</span>of_int <span class="free">b</span><span class="main">)</span> <span class="main">=</span> coprime <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> coprime_iff_gcd_eq_1 gcd_of_int_gauss_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-gcd_of_nat_gauss_int"><span class="command">lemma</span></span> gcd_of_nat_gauss_int<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span>of_nat <span class="free">a</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">(</span>of_nat <span class="free">b</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="main">(</span>gcd <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> gcd_of_int_gauss_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"int <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"int <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Gaussian_Integers-coprime_of_nat_gauss_int"><span class="command">lemma</span></span> coprime_of_nat_gauss_int<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>of_nat <span class="free">a</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">(</span>of_nat <span class="free">b</span><span class="main">)</span> <span class="main">=</span> coprime <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> coprime_iff_gcd_eq_1 gcd_of_nat_gauss_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-gauss_cnj_dvd_self_iff"><span class="command">lemma</span></span> gauss_cnj_dvd_self_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">z</span> <span class="keyword1">dvd</span> <span class="free">z</span> <span class="main">⟷</span> ReZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ImZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¦</span>ReZ <span class="free">z</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ImZ <span class="free">z</span><span class="main">¦</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">z</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span> <span class="main">=</span> normalize <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gauss_int_dvd_same_norm_imp_associated<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="main">::</span> <span class="quoted">gauss_int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">u</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">z</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> associatedE1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_gauss_int_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ImZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¦</span>ReZ <span class="free">z</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ImZ <span class="free">z</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> insertE emptyE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">=</span> ReZ <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">z</span> <span class="main">=</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="main">…</span> <span class="main">=</span> <span class="main">-</span>ImZ <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ImZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¦</span>ReZ <span class="free">z</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ImZ <span class="free">z</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">=</span> ReZ <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">z</span> <span class="main">=</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="main">…</span> <span class="main">=</span> ImZ <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ImZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¦</span>ReZ <span class="free">z</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ImZ <span class="free">z</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">z</span> <span class="main">=</span> <span class="main">-</span>ImZ <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">z</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ImZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¦</span>ReZ <span class="free">z</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ImZ <span class="free">z</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">=</span> ReZ <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">z</span> <span class="main">=</span> <span class="main">-</span><span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="main">…</span> <span class="main">=</span> <span class="main">-</span>ReZ <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ImZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¦</span>ReZ <span class="free">z</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ImZ <span class="free">z</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ImZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¦</span>ReZ <span class="free">z</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ImZ <span class="free">z</span><span class="main">¦</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">z</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>ReZ <span class="free">z</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ImZ <span class="free">z</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"ImZ <span class="free">z</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">*</span> ReZ <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> associatedE2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">z</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_unit <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> gauss_cnj <span class="free">z</span> <span class="main">*</span> <span class="main">(</span>of_int <span class="skolem">u</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_triv_left<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_cnj_eq_self gauss_cnj_eq_minus_self<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-self_dvd_gauss_cnj_iff"><span class="command">lemma</span></span> self_dvd_gauss_cnj_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">z</span> <span class="main">⟷</span> ReZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> ImZ <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¦</span>ReZ <span class="free">z</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ImZ <span class="free">z</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> gauss_cnj_dvd_self_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> gauss_cnj_dvd_left_iff<span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Prime elements›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we analyse what the prime elements of the Gaussian integers are. First, note that
  according to the conventions of Isabelle's computational algebra library, a prime element
  is called a prime iff it is also normalised, i.e.\ in our case it lies in the upper right
  quadrant.

  As a first fact, we can show that a Gaussian integer whose norm is <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>-prime must be
  $\mathbb{Z}[i]$-prime:
›</span></span>

<span class="keyword1" id="Gaussian_Integers-prime_gauss_int_norm_imp_prime_elem"><span class="command">lemma</span></span> prime_gauss_int_norm_imp_prime_elem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>gauss_int_norm <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prime_elem <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreducible <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> irreducibleI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">q</span> <span class="main">=</span> gauss_int_norm <span class="skolem">a</span> <span class="main">*</span> gauss_int_norm <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_norm_mult<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">a</span> <span class="main">∨</span> is_unit <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prime_product <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_eq_Suc_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> is_unit_gauss_int_iff'›</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> irreducible_imp_prime_elem_gcd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Also, a conjugate is a prime element iff the original element is a prime element:
›</span></span>
<span class="keyword1" id="Gaussian_Integers-prime_elem_gauss_cnj"><span class="command">lemma</span></span> prime_elem_gauss_cnj <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">z</span> <span class="main">⟹</span> prime_elem <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_elem_def gauss_cnj_dvd_left_iff<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-prime_elem_gauss_cnj_iff"><span class="command">lemma</span></span> prime_elem_gauss_cnj_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"prime_elem <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span> <span class="main">⟷</span> prime_elem <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prime_elem_gauss_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> prime_elem_gauss_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">z</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹The factorisation of 2›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  2 factors as $-i (1 + i)^2$ in the Gaussian integers, where $-i$ is a unit and
  $1 + i$ is prime.
›</span></span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_2_eq"><span class="command">lemma</span></span> gauss_int_2_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">=</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff power2_eq_square<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-prime_elem_one_plus_i_gauss_int"><span class="command">lemma</span></span> prime_elem_one_plus_i_gauss_int<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_elem <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prime_gauss_int_norm_imp_prime_elem<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-prime_one_plus_i_gauss_int"><span class="command">lemma</span></span> prime_one_plus_i_gauss_int<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_def prime_elem_one_plus_i_gauss_int
                gauss_int_eq_iff normalize_gauss_int_def<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-prime_factorization_2_gauss_int"><span class="command">lemma</span></span> prime_factorization_2_gauss_int<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span><span class="numeral">2</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">=</span> <span class="main">{#</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">,</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">#}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span><span class="numeral">2</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span>prime_factorization <span class="main">(</span>prod_mset <span class="main">{#</span><span class="main">1</span> <span class="main">+</span> gauss_i<span class="main">,</span> <span class="main">1</span> <span class="main">+</span> gauss_i<span class="main">#}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_unique<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff normalize_gauss_int_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span>prod_mset <span class="main">{#</span><span class="main">1</span> <span class="main">+</span> gauss_i<span class="main">,</span> <span class="main">1</span> <span class="main">+</span> gauss_i<span class="main">#}</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">{#</span><span class="main">1</span> <span class="main">+</span> gauss_i<span class="main">,</span> <span class="main">1</span> <span class="main">+</span> gauss_i<span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_one_plus_i_gauss_int <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_prod_mset_primes<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Inert primes›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Any <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>-prime congruent 3 modulo 4 is also a Gaussian prime. These primes are called
  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹inert›</span></span>, because they do not decompose when moving from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span> to $\mathbb{Z}[i]$.
›</span></span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_norm_not_3_mod_4"><span class="command">lemma</span></span> gauss_int_norm_not_3_mod_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>gauss_int_norm <span class="free">z</span> <span class="main">≠</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"ReZ <span class="free">z</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">z</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="numeral">3</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span> <span class="main">::</span> int<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>ReZ <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> ImZ <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span>ReZ <span class="free">z</span> <span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>ImZ <span class="free">z</span> <span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong_add cong_pow<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>ReZ <span class="free">z</span> <span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>ImZ <span class="free">z</span> <span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">≠</span> <span class="numeral">3</span> <span class="keyword1">mod</span> <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">unfolding</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>ReZ <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> ImZ <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cong_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>int <span class="main">(</span>nat <span class="main">(</span>ReZ <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> ImZ <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> int <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="main">(</span>int <span class="numeral">4</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> gauss_int_norm_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> cong_int_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-prime_elem_gauss_int_of_nat"><span class="command">lemma</span></span> prime_elem_gauss_int_of_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> prime<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prime_elem <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> irreducible_imp_prime_elem irreducibleI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">n</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_unit <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> is_unit_gauss_int_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="free">n</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> gauss_int_norm <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">a</span> <span class="main">*</span> gauss_int_norm <span class="skolem">b</span> <span class="main">=</span> <span class="free">n</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_norm_mult power2_eq_square <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> nat_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> prime_power_mult_nat<span class="main">[</span><span class="operator">OF</span> prime this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword2"><span class="keyword">where</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">a</span> <span class="main">=</span> <span class="free">n</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">b</span> <span class="main">=</span> <span class="free">n</span> <span class="main">^</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ij * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> prime_power_inj<span class="main">[</span><span class="operator">OF</span> prime this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">a</span> <span class="main">∨</span> is_unit <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> ij <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">a</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>gauss_int_norm <span class="skolem">a</span> <span class="main">=</span> <span class="free">n</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>gauss_int_norm <span class="skolem">a</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>gauss_int_norm <span class="skolem">a</span> <span class="main">≠</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gauss_int_norm_not_3_mod_4<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> ij <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> is_unit_gauss_int_iff'›</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> prime_gauss_int_of_nat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> prime<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">n</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prime <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prime_elem_gauss_int_of_nat<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> prime_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Non-inert primes›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Any <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>-prime congruent 1 modulo 4 factors into two conjugate Gaussian primes.
›</span></span>

<span class="keyword1" id="Gaussian_Integers-minimal_QuadRes_neg1"><span class="command">lemma</span></span> minimal_QuadRes_neg1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"QuadRes <span class="free">n</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹QuadRes <span class="free">n</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="main">(</span>int <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> QuadRes_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="main">(</span>int <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong_add<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> int <span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>int <span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> int <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="main">(</span>int <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> cong_int_iff<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="keyword1">then</span> nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="free">n</span> <span class="main">-</span> <span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> x'_quadres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong_add cong_pow<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>int <span class="main">(</span><span class="skolem">x'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>int <span class="free">n</span> <span class="main">-</span> int <span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> int <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x'_def of_nat_diff add_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span>int <span class="free">n</span> <span class="main">-</span> int <span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span>
                <span class="main">(</span><span class="main">0</span> <span class="main">-</span> int <span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> int <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong_add cong_pow<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">0</span> <span class="main">-</span> int <span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> int <span class="main">(</span><span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="main">(</span>int <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> cong_int_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong_add cong_pow<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>nat <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> x'_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹odd <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> oddE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Let <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> be some prime number that is congruent 1 modulo 4.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> noninert_gauss_int_prime <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> prime_p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cong_1_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Gaussian_Integers-p_gt_2"><span class="command">lemma</span></span> p_gt_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> odd_p<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> prime_p <span class="keyword2"><span class="keyword">and</span></span> cong_1_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gt_Suc_0_nat cong_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> prime_p <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> primes_dvd_imp_eq two_is_prime_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  -1 is a quadratic residue modulo <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span>, so there exists some <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> such that
  $x^2 + 1$ is divisible by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span>. Moreover, we can choose <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> such that it is positive and
  no greater than $\frac{1}{2}(p-1)$:
›</span></span>
<span class="keyword1" id="Gaussian_Integers-minimal_QuadRes_neg1"><span class="command">lemma</span></span> minimal_QuadRes_neg1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Legendre <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>int <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="main">(</span>int <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_p p_gt_2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> euler_criterion<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p_gt_2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong_diff_nat cong_refl<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> cong_1_p <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dvd_mult_imp_div <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Legendre <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>int <span class="free">p</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p_gt_2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Legendre <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span>int <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p_gt_2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Legendre_def cong_def zmod_minus1 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"QuadRes <span class="free">p</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Legendre_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> minimal_QuadRes_neg1<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> p_gt_2 odd_p
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x p_gt_2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can show from this that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> is not prime as a Gaussian integer.
›</span></span>
<span class="keyword1" id="Gaussian_Integers-not_prime"><span class="command">lemma</span></span> not_prime<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>prime_elem <span class="main">(</span>of_nat <span class="free">p</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> prime<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_elem <span class="main">(</span>of_nat <span class="free">p</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  minimal_QuadRes_neg1 <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> of_nat_dvd_of_nat<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span><span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> gauss_int_eq_iff power2_eq_square of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> prime <span class="keyword2"><span class="keyword">and</span></span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">∨</span> of_nat <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prime_elem_dvd_multD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">p</span> <span class="keyword1">dvd</span> <span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> of_nat_dvd_imp_dvd_gauss_cnj<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="free">p</span> <span class="main">*</span> of_nat <span class="free">p</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> dvd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_dvd_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_nat <span class="main">(</span><span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eq <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_nat_dvd_of_nat_gauss_int_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_imp_le<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">&gt;</span> <span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> add_mono power_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p_gt_2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_left_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Any prime factor of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> in the Gaussian integers must have norm <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span>.
›</span></span>
<span class="keyword1" id="Gaussian_Integers-norm_prime_divisor"><span class="command">lemma</span></span> norm_prime_divisor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">q</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">dvd</span> of_nat <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> gauss_int_norm <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> gauss_int_norm <span class="free">q</span> <span class="main">*</span> gauss_int_norm <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> r gauss_int_norm_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">q</span> <span class="main">*</span> gauss_int_norm <span class="skolem">r</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> gauss_int_norm <span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">∧</span> gauss_int_norm <span class="skolem">r</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="bound">j</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_power_mult_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">r</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> ij_eq_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add ij<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> p_gt_2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> power_inject_exp<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ij <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_norm_eq_Suc_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="main">(</span>of_nat <span class="free">p</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime_elem <span class="free">q</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_elem_mult_unit_left r mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> not_prime <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> q ij <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> gauss_int_norm_eq_Suc_0_iff›</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ij <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now show two lemmas that characterise the two prime factors of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> in the
  Gaussian integers: they are two conjugates $x\pm iy$ for positive integers <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> such
  that $x^2 + y^2 = p$.
›</span></span>
<span class="keyword1" id="Gaussian_Integers-prime_divisor_exists"><span class="command">lemma</span></span> prime_divisor_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="main">(</span>gauss_cnj <span class="free">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
                  <span class="quoted"><span class="quoted">"of_nat <span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> gauss_cnj <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">::</span>gauss_int<span class="main">.</span> <span class="bound">q</span> <span class="keyword1">dvd</span> of_nat <span class="free">p</span> <span class="main">∧</span> prime <span class="bound">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prime_divisor_exists<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> prime_p <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> is_unit_gauss_int_iff'›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="main">::</span> <span class="quoted">gauss_int</span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">dvd</span> of_nat <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normalize <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> q_signs<span class="main">:</span> <span class="quoted"><span class="quoted">"ReZ <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="skolem">q</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> normalized_gauss_int_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> norm_prime_divisor<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span>gauss_cnj <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="main">(</span>gauss_cnj <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_gauss_int_norm_imp_prime_elem<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> gauss_cnj <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹gauss_int_norm <span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> self_mult_gauss_cnj<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ImZ <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> nat <span class="main">(</span>ReZ <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> of_nat <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> q_signs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff m_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_dvd_of_nat_gauss_int_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prime_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prime_nat_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> q <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> not_prime <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> q_signs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> q q_signs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> prime_factorization<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q1</span> <span class="free">q2</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">q1</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">q2</span>"</span></span> <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span><span class="free">q1</span><span class="main">,</span> <span class="free">q2</span><span class="main">#}</span>"</span></span> 
        <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">q1</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">q2</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q2</span> <span class="main">=</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> gauss_cnj <span class="free">q1</span>"</span></span>
        <span class="quoted"><span class="quoted">"ReZ <span class="free">q1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">q1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">q1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">q2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="main">(</span>gauss_cnj <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
                    <span class="quoted"><span class="quoted">"of_nat <span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> gauss_cnj <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_divisor_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> normalize <span class="main">(</span>gauss_cnj <span class="skolem">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span> <span class="main">=</span> prime_factorization <span class="main">(</span>prod_mset <span class="main">{#</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">q'</span><span class="main">#}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_unique<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q q'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{#</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">q'</span><span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_prod_mset_primes<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">q'</span><span class="main">#}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> gauss_cnj <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> normalize_gauss_int_def q'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">q'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> q
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q'</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q'_def gauss_int_norm_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In particular, a consequence of this is that any prime congruent 1 modulo 4
  can be written as a sum of squares of positive integers.
›</span></span>
<span class="keyword1" id="Gaussian_Integers-prime_cong_1_mod_4_gauss_int_norm_exists"><span class="command">lemma</span></span> prime_cong_1_mod_4_gauss_int_norm_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> gauss_int_norm <span class="bound">z</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∧</span> ReZ <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> ImZ <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">interpret</span></span> noninert_gauss_int_prime <span class="quoted"><span class="free">p</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">from</span></span> prime_divisor_exists <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> gauss_cnj <span class="skolem">q</span>"</span></span> 
             <span class="quoted"><span class="quoted">"ReZ <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> gauss_int_norm <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Full classification of Gaussian primes›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Any prime in the ring of Gaussian integers is of the form

    <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>1 + 𝗂<span class="hidden">⇩</span><sub>ℤ</sub>›</span></span></span></span>

    <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p ∈ ℕ›</span></span></span></span> is prime in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℕ›</span></span></span></span> and congruent 1 modulo 4

    <span class="antiquoted"><span class="antiquoted">▪</span></span> $x + iy$ where $x,y$ are positive integers and $x^2 + y^2$ is a prime congruent 3 modulo 4

  or an associated element of one of these.  
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> gauss_int_prime_classification<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> 
    <span class="main">(</span>one_plus_i<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
  <span class="main">|</span> <span class="main">(</span>cong_3_mod_4<span class="main">)</span> <span class="free">p</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> of_nat <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="main">(</span>cong_1_mod_4<span class="main">)</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>gauss_int_norm <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>gauss_int_norm <span class="free">x</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
                   <span class="quoted"><span class="quoted">"ReZ <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">x</span> <span class="main">≠</span> ImZ <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> gauss_int_norm <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">dvd</span> <span class="free">x</span> <span class="main">*</span> gauss_cnj <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_nat <span class="main">(</span>gauss_int_norm <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> self_mult_gauss_cnj<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> prime_factors <span class="main">(</span>of_nat <span class="skolem">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff N_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> prod_mset <span class="main">(</span>prime_factorization <span class="skolem">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_mset_prime_factorization_nat<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_nat <span class="main">…</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">=</span> 
               prod_mset <span class="main">(</span>image_mset of_nat <span class="main">(</span>prime_factorization <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_prod_mset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="skolem">N</span><span class="main">.</span> prime_factors <span class="main">(</span>of_nat <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_prod_mset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="skolem">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> prime_factors <span class="main">(</span>of_nat <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> product_dvd_irreducibleD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> prime_elem_iff_irreducible<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_0_iff in_prime_factors_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> singletonE insertE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_mod_cancel<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prime_prime_factor two_is_prime_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span>of_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">::</span> gauss_int<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_factorization_2_gauss_int<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span>of_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>of_nat <span class="skolem">p</span> <span class="main">::</span> gauss_int<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prime_gauss_int_of_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_prime<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> noninert_gauss_int_prime <span class="quoted"><span class="skolem">p</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> cong_def›</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q1</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="main">::</span> <span class="quoted">gauss_int</span> <span class="keyword2"><span class="keyword">where</span></span> q12<span class="main">:</span>
      <span class="quoted"><span class="quoted">"prime <span class="skolem">q1</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">q2</span>"</span></span> <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span>of_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{#</span><span class="skolem">q1</span><span class="main">,</span> <span class="skolem">q2</span><span class="main">#}</span>"</span></span>
      <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">q1</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">q2</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">=</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> gauss_cnj <span class="skolem">q1</span>"</span></span>
      <span class="quoted"><span class="quoted">"ReZ <span class="skolem">q1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="skolem">q1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="skolem">q1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prime_factorization <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> p q12 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">q1</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="skolem">q2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> q12 <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">x</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">x</span> <span class="main">≠</span> ImZ <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">x</span> <span class="main">=</span> ImZ <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>gauss_int_norm <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def nat_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹gauss_int_norm <span class="free">x</span> <span class="main">=</span> <span class="skolem">p</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">p</span>›</span></span> * **
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-prime_gauss_int_norm_squareD"><span class="command">lemma</span></span> prime_gauss_int_norm_squareD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">z</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prime <span class="free">p</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">=</span> of_nat <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> gauss_int_prime_classification<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> one_plus_i
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">2</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> one_plus_i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_power_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cong_3_mod_4 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> cong_1_mod_4
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_power_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-gauss_int_norm_eq_prime_squareD"><span class="command">lemma</span></span> gauss_int_norm_eq_prime_squareD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">z</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"normalize <span class="free">z</span> <span class="main">=</span> of_nat <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">::</span>gauss_int<span class="main">.</span> <span class="bound">q</span> <span class="keyword1">dvd</span> <span class="free">z</span> <span class="main">∧</span> prime <span class="bound">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prime_divisor_exists<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> is_unit_gauss_int_iff'›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="main">::</span> <span class="quoted">gauss_int</span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">q</span> <span class="keyword1">dvd</span> gauss_int_norm <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gauss_int_norm_dvd_mono<span class="main">)</span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> divides_primepow_nat<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms q <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> i assms q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_eq_Suc_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> i assms q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gauss_int_norm_not_3_mod_4<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> of_nat <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_gauss_int_norm_squareD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span> <span class="main">=</span> normalize <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> gauss_int_dvd_same_norm_imp_associated<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"normalize <span class="free">z</span> <span class="main">=</span> of_nat <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>normalize <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_gauss_int_of_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following can be used as a primality test for Gaussian integers. It effectively
  reduces checking the primality of a Gaussian integer to checking the primality of an
  integer.

  A Gaussian integer is prime if either its norm is either <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>-prime or the square of
  a <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>-prime that is congruent 3 modulo 4.
›</span></span>
<span class="keyword1" id="Gaussian_Integers-prime_elem_gauss_int_iff"><span class="command">lemma</span></span> prime_elem_gauss_int_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> gauss_int_norm <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prime_elem <span class="free">z</span> <span class="main">⟷</span> prime <span class="free">n</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free">n</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">∧</span> prime <span class="bound">p</span> <span class="main">∧</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">n</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free">n</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">∧</span> prime <span class="bound">p</span> <span class="main">∧</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> gauss_int_norm_eq_prime_squareD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
                    prime_gauss_int_norm_imp_prime_elem <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>normalize <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">n</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="free">n</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">∧</span> prime <span class="bound">p</span> <span class="main">∧</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> gauss_int_prime_classification<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> one_plus_i
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> gauss_int_norm <span class="main">(</span>normalize <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normalize <span class="free">z</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cong_3_mod_4 <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> gauss_int_norm <span class="main">(</span>normalize <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normalize <span class="free">z</span> <span class="main">=</span> of_nat <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">…</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cong_3_mod_4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> cong_1_mod_4
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Multiplicities of primes›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we will show some results connecting the multiplicity of a Gaussian prime <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span>
  in a Gaussian integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span> to the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>-multiplicity of the norm of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> in the norm of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The multiplicity of the Gaussian prime <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">1</span></span> <span class="main"><span class="main">+</span></span> <span class="keyword1"><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span></span>›</span></span></span></span> in an integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c›</span></span></span></span> is simply
  twice the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>-multiplicity of 2 in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c›</span></span></span></span>:
›</span></span>
<span class="keyword1" id="Gaussian_Integers-multiplicity_prime_1_plus_i_aux"><span class="command">lemma</span></span> multiplicity_prime_1_plus_i_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">(</span>of_nat <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> multiplicity <span class="numeral">2</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> multiplicity <span class="numeral">2</span> <span class="free">c</span> <span class="main">=</span> multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">c</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_elem_multiplicity_power_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="numeral">2</span> <span class="main">(</span><span class="free">c</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="main">(</span>of_nat <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>of_nat <span class="free">c</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> multiplicity_gauss_int_of_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="main">…</span> <span class="main">(</span>of_nat <span class="free">c</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>of_nat <span class="free">c</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> multiplicity_times_unit_left<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> multiplicity <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">(</span>of_nat <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> multiplicity_power_power<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Tha multiplicity of an inert Gaussian prime $q\in\mathbb{Z}$ in a Gaussian integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span> is 
  precisely half the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>-multiplicity of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>q›</span></span></span></span> in the norm of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span>.
›</span></span>
<span class="keyword1" id="Gaussian_Integers-multiplicity_prime_cong_3_mod_4"><span class="command">lemma</span></span> multiplicity_prime_cong_3_mod_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>of_nat <span class="free">q</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"multiplicity <span class="free">q</span> <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> multiplicity <span class="main">(</span>of_nat <span class="free">q</span><span class="main">)</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">q</span> <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span> <span class="main">=</span>
          multiplicity <span class="main">(</span>of_nat <span class="free">q</span><span class="main">)</span> <span class="main">(</span>of_nat <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multiplicity_gauss_int_of_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> multiplicity <span class="main">(</span>of_nat <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> self_mult_gauss_cnj<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> multiplicity <span class="main">(</span>of_nat <span class="free">q</span><span class="main">)</span> <span class="free">z</span> <span class="main">+</span> multiplicity <span class="main">(</span>gauss_cnj <span class="main">(</span>of_nat <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_elem_multiplicity_mult_distrib<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="main">(</span>gauss_cnj <span class="main">(</span>of_nat <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="main">(</span>of_nat <span class="free">q</span><span class="main">)</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> multiplicity_gauss_cnj<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">…</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For Gaussian primes <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> whose norm is congruent 1 modulo 4, the $\mathbb{Z}[i]$-multiplicity
  of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> in an integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c›</span></span></span></span> is just the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>-multiplicity of their norm in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c›</span></span></span></span>.
›</span></span>
<span class="keyword1" id="Gaussian_Integers-multiplicity_prime_cong_1_mod_4_aux"><span class="command">lemma</span></span> multiplicity_prime_cong_1_mod_4_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">p</span> <span class="main">≠</span> ReZ <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span>of_nat <span class="free">c</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="main">(</span>gauss_int_norm <span class="free">p</span><span class="main">)</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> antisym multiplicity_geI<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="main">(</span>of_nat <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="skolem">k</span> <span class="keyword1">dvd</span> of_nat <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multiplicity_dvd k_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">p</span> <span class="main">^</span> <span class="skolem">k</span> <span class="keyword1">dvd</span> of_nat <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> multiplicity_dvd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"gauss_cnj <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">c</span>"</span></span><span class="main">]</span>
            multiplicity_gauss_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">c</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">p</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> self_dvd_gauss_cnj_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">p</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">p</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms prime_elem_dvd_power <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> gauss_cnj <span class="free">p</span> <span class="main">^</span> <span class="skolem">k</span> <span class="keyword1">dvd</span> of_nat <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_elem_power_mult_dvdI<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> gauss_cnj <span class="free">p</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">=</span> of_nat <span class="main">(</span>gauss_int_norm <span class="free">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> self_mult_gauss_cnj <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="free">p</span> <span class="main">^</span> <span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> of_nat_dvd_of_nat_gauss_int_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> multiplicity <span class="main">(</span>gauss_int_norm <span class="free">p</span><span class="main">)</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="skolem">k</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> gauss_cnj <span class="free">p</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dvd_power_same<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_nat <span class="main">(</span>gauss_int_norm <span class="free">p</span> <span class="main">^</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> self_mult_gauss_cnj<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> of_nat <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> of_nat_dvd_of_nat_gauss_int_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> k_def multiplicity_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="skolem">k</span> <span class="keyword1">dvd</span> of_nat <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> gauss_int_norm_eq_Suc_0_iff›</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The multiplicity of a Gaussian prime with norm congruent 1 modulo 4 in some Gaussian integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span>
  and the multiplicity of its conjugate in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span> sum to the the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>-multiplicity of their norm in
  the norm of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span>:
›</span></span>
<span class="keyword1" id="Gaussian_Integers-multiplicity_prime_cong_1_mod_4"><span class="command">lemma</span></span> multiplicity_prime_cong_1_mod_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="free">p</span> <span class="main">≠</span> ReZ <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="main">(</span>gauss_int_norm <span class="free">p</span><span class="main">)</span> <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span> <span class="main">=</span>
           multiplicity <span class="free">p</span> <span class="free">z</span> <span class="main">+</span> multiplicity <span class="main">(</span>gauss_cnj <span class="free">p</span><span class="main">)</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="main">(</span>gauss_int_norm <span class="free">p</span><span class="main">)</span> <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span> <span class="main">=</span> 
          multiplicity <span class="free">p</span> <span class="main">(</span>of_nat <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> multiplicity_prime_cong_1_mod_4_aux<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> self_mult_gauss_cnj<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="free">z</span> <span class="main">+</span> multiplicity <span class="free">p</span> <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_elem_multiplicity_mult_distrib<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="main">(</span>gauss_cnj <span class="free">p</span><span class="main">)</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> multiplicity_gauss_cnj <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The multiplicity of the Gaussian prime <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span></span><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">1</span></span> <span class="main"><span class="main">+</span></span> <span class="keyword1"><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span></span>›</span></span></span></span> in a Gaussian integer <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span> is precisely
  the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>-multiplicity of 2 in the norm of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span>:
›</span></span>
<span class="keyword1" id="Gaussian_Integers-multiplicity_prime_1_plus_i"><span class="command">lemma</span></span> multiplicity_prime_1_plus_i<span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> multiplicity <span class="numeral">2</span> <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> prime_elem_one_plus_i_gauss_int
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> multiplicity <span class="numeral">2</span> <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">(</span>of_nat <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> multiplicity_prime_1_plus_i_aux <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> multiplicity <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> self_mult_gauss_cnj<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> multiplicity <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="free">z</span> <span class="main">+</span> multiplicity <span class="main">(</span>gauss_cnj <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_elem_multiplicity_mult_distrib<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="main">(</span>gauss_cnj <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> multiplicity_gauss_cnj<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="main">…</span> <span class="free">z</span> <span class="main">=</span> multiplicity <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> multiplicity_times_unit_left<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">…</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Coprimality of an element and its conjugate›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Using the classification of the primes, we now show that if the real and imaginary parts of a
  Gaussian integer are coprime and its norm is odd, then it is coprime to its own conjugate.
›</span></span>
<span class="keyword1" id="Gaussian_Integers-coprime_self_gauss_cnj"><span class="command">lemma</span></span> coprime_self_gauss_cnj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>ReZ <span class="free">z</span><span class="main">)</span> <span class="main">(</span>ImZ <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"coprime <span class="free">z</span> <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprimeI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> gauss_cnj <span class="skolem">p</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> gauss_int_norm <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> of_nat_d_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">d</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def self_mult_gauss_cnj d_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="skolem">p'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff p'_def gauss_cnj_dvd_left_iff<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> gauss_int_prime_classification<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> one_plus_i
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">=</span> gauss_int_norm <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">p</span> <span class="keyword1">dvd</span> gauss_int_norm <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> gauss_int_norm_dvd_mono<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹odd <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cong_3_mod_4 <span class="skolem">q</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> cong_1_mod_4
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">p'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> self_dvd_gauss_cnj_iff<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p'</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_elem_mult_dvdI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p'_def gauss_cnj_dvd_left_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">*</span> <span class="skolem">p'</span> <span class="main">=</span> of_nat <span class="main">(</span>gauss_int_norm <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def self_mult_gauss_cnj<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">p</span>"</span></span><span class="main">]</span> cong_1_mod_4
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">q</span> <span class="keyword1">dvd</span> gcd <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> of_int <span class="main">(</span>ReZ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_int <span class="main">(</span>ImZ <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> gcd_greatest<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">z</span> <span class="main">+</span> gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_cnj_dvd_right_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> of_int <span class="main">(</span>ReZ <span class="free">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> self_plus_gauss_cnj<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> of_int <span class="main">(</span>ReZ <span class="free">z</span><span class="main">)</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_cnj_dvd_right_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_int <span class="main">(</span>ImZ <span class="free">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> self_minus_gauss_cnj<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_int <span class="main">(</span>ImZ <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>ReZ <span class="free">z</span><span class="main">)</span> <span class="main">∨</span> odd <span class="main">(</span>ImZ <span class="free">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def even_nat_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>ReZ <span class="free">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>of_int <span class="main">(</span>ReZ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_int <span class="numeral">2</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> coprime_of_int_gauss_int coprime_right_2_iff_odd <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> gcd_mult_left_right_cancel<span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coprime_of_int_gauss_int coprime_commute is_unit_left_imp_coprime
                         is_unit_right_imp_coprime gcd_proj1_if_dvd gcd_proj2_if_dvd<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>ImZ <span class="free">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>of_int <span class="main">(</span>ImZ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_int <span class="numeral">2</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> coprime_of_int_gauss_int coprime_right_2_iff_odd <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> of_int <span class="main">(</span>ReZ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_int <span class="main">(</span>ImZ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> gcd <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> of_int <span class="main">(</span>ReZ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> gcd_mult_right_right_cancel<span class="main">)</span>
             <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coprime_of_int_gauss_int coprime_commute is_unit_left_imp_coprime
                         is_unit_right_imp_coprime<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> normalize <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> gcd <span class="main">(</span>of_int <span class="main">(</span>ReZ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> gcd_mult_left<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span>of_int <span class="main">(</span>ReZ <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> coprime_iff_gcd_eq_1 <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_unit_right_imp_coprime<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="main">(</span>of_nat <span class="numeral">2</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">dvd</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_nat_dvd_of_nat_gauss_int_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> primes_dvd_imp_eq two_is_prime_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> gauss_int_norm <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">dvd</span> gauss_int_norm <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">z</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> gauss_int_norm_dvd_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹odd <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword3"><span class="command">assume</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> gauss_cnj <span class="free">z</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_unit <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> d assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prime_divisorE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> prime_factors <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Square decompositions of prime numbers congruent 1 mod 4›</span></span>

<span class="keyword1" id="Gaussian_Integers-prime_1_mod_4_sum_of_squares_unique_aux"><span class="command">lemma</span></span> prime_1_mod_4_sum_of_squares_unique_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_power_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_product<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Any prime number congruent 1 modulo 4 can be written <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹uniquely›</span></span> as a sum of two squares
  $x^2 + y^2$ (up to commutativity of the addition). Additionally, we have shown above that
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> are both positive and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x ≠ y›</span></span></span></span>.
›</span></span>
<span class="keyword1" id="Gaussian_Integers-prime_1_mod_4_sum_of_squares_unique"><span class="command">lemma</span></span> prime_1_mod_4_sum_of_squares_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex_ex1I<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">z</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_cong_1_mod_4_gauss_int_norm_exists<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">z</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>ReZ <span class="skolem">z</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span>ImZ <span class="skolem">z</span><span class="main">¦</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> z <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span>
      <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span>nat <span class="main"><span class="main"><span class="main">¦</span></span></span>ReZ <span class="skolem"><span class="skolem"><span class="skolem">z</span></span></span><span class="main"><span class="main"><span class="main">¦</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> nat <span class="main"><span class="main"><span class="main">¦</span></span></span>ImZ <span class="skolem"><span class="skolem"><span class="skolem">z</span></span></span><span class="main"><span class="main"><span class="main">¦</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def nat_add_distrib <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> nat_power_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> z <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span>
      <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span>nat <span class="main"><span class="main"><span class="main">¦</span></span></span>ImZ <span class="skolem"><span class="skolem"><span class="skolem">z</span></span></span><span class="main"><span class="main"><span class="main">¦</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> nat <span class="main"><span class="main"><span class="main">¦</span></span></span>ReZ <span class="skolem"><span class="skolem"><span class="skolem">z</span></span></span><span class="main"><span class="main"><span class="main">¦</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def nat_add_distrib <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> nat_power_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z1</span> <span class="skolem">z2</span>
  <span class="keyword3"><span class="command">assume</span></span> z1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> <span class="skolem">z1</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="bound">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> z2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> <span class="skolem">z2</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="bound">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z1'</span></span> <span class="main">::</span> <span class="quoted">gauss_int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1'</span> <span class="main">=</span> of_nat <span class="main">(</span>fst <span class="skolem">z1</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="main">(</span>snd <span class="skolem">z1</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z2'</span></span> <span class="main">::</span> <span class="quoted">gauss_int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z2'</span> <span class="main">=</span> of_nat <span class="main">(</span>fst <span class="skolem">z2</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="main">(</span>snd <span class="skolem">z2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">interpret</span></span> noninert_gauss_int_prime <span class="quoted"><span class="free">p</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> norm_z1'<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">z1'</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> z1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z1'_def gauss_int_norm_def case_prod_unfold nat_add_distrib nat_power_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> norm_z2'<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">z2'</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> z2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z2'_def gauss_int_norm_def case_prod_unfold nat_add_distrib nat_power_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> sgns<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">z1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">z1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">z2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">z2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">z1</span> <span class="main">≠</span> snd <span class="skolem">z1</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">z2</span> <span class="main">≠</span> snd <span class="skolem">z2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_1_mod_4_sum_of_squares_unique_aux<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">z1</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">z1</span>"</span></span><span class="main">]</span> z1
          prime_1_mod_4_sum_of_squares_unique_aux<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">z2</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">z2</span>"</span></span><span class="main">]</span> z2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"normalize <span class="skolem">z1'</span> <span class="main">=</span> <span class="skolem">z1'</span>"</span></span> <span class="quoted"><span class="quoted">"normalize <span class="skolem">z2'</span> <span class="main">=</span> <span class="skolem">z2'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sgns <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> normalized_gauss_int_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z1'_def z2'_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">z1'</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">z2'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> norm_z1' norm_z2' assms <span class="keyword1"><span class="command">unfolding</span></span> prime_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_gauss_int_norm_imp_prime_elem<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">p</span> <span class="main">=</span> <span class="skolem">z1'</span> <span class="main">*</span> gauss_cnj <span class="skolem">z1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> self_mult_gauss_cnj norm_z1'<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1'</span> <span class="keyword1">dvd</span> of_nat <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="free">p</span> <span class="main">=</span> <span class="skolem">z2'</span> <span class="main">*</span> gauss_cnj <span class="skolem">z2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> self_mult_gauss_cnj norm_z2'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1'</span> <span class="keyword1">dvd</span> <span class="skolem">z2'</span> <span class="main">∨</span> <span class="skolem">z1'</span> <span class="keyword1">dvd</span> gauss_cnj <span class="skolem">z2'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> prime_elem_dvd_mult_iff<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_z1' prime_gauss_int_norm_imp_prime_elem<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span> <span class="main">=</span> <span class="skolem">z2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1'</span> <span class="keyword1">dvd</span> <span class="skolem">z2'</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">z1'</span>›</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">z2'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1'</span> <span class="main">=</span> <span class="skolem">z2'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_dvd_imp_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z1'_def z2'_def gauss_int_eq_iff prod_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> dvd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z1'</span> <span class="keyword1">dvd</span> gauss_cnj <span class="skolem">z2'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> gauss_cnj <span class="skolem">z2'</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> gauss_cnj <span class="skolem">z2'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sgns <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> normalized_gauss_int_iff<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> z2'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_elem <span class="main">(</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> gauss_cnj <span class="skolem">z2'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prime_gauss_int_norm_imp_prime_elem<span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_norm_mult norm_z2' <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> gauss_cnj <span class="skolem">z2'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> dvd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1'</span> <span class="keyword1">dvd</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> gauss_cnj <span class="skolem">z2'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1'</span> <span class="main">=</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> gauss_cnj <span class="skolem">z2'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="skolem">z1'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> primes_dvd_imp_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> z1 z2 sgns
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff z1'_def z2'_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-two_sum_of_squares_nat_iff"><span class="command">lemma</span></span> two_sum_of_squares_nat_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::</span> nat<span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> square_neq_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≠</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">2</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> * <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_power_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> power2_less_imp_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> power2_less_imp_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq square_neq_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> square_neq_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-prime_sum_of_squares_unique"><span class="command">lemma</span></span> prime_sum_of_squares_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span> <span class="main">::</span> nat<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> two_sum_of_squares_nat_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> prime_1_mod_4_sum_of_squares_unique<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now give a simple and inefficient algorithm to compute the canonical decomposition
  $x ^ 2 + y ^ 2$ with $x\leq y$.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prime_square_sum_nat_decomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">×</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prime_square_sum_nat_decomp</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> prime <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">then</span> <span class="keyword1">THE</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Gaussian_Integers-prime_square_sum_nat_decomp_eqI"><span class="command">lemma</span></span> prime_square_sum_nat_decomp_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prime_square_sum_nat_decomp <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>gauss_int_norm <span class="main">(</span>of_nat <span class="free">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="free">y</span><span class="main">)</span> <span class="main">≠</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gauss_int_norm_not_3_mod_4<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span>of_nat <span class="free">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def nat_add_distrib nat_power_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span> <span class="main">≠</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> prime_mod_4_cases<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_square_sum_nat_decomp <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_square_sum_nat_decomp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> the1_equality<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prime_sum_of_squares_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-prime_square_sum_nat_decomp_correct"><span class="command">lemma</span></span> prime_square_sum_nat_decomp_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≡</span> prime_square_sum_nat_decomp <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> snd <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">z</span> <span class="main">≤</span> snd <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="skolem">z'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> z_def z'_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_square_sum_nat_decomp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span><span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_sum_of_squares_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> <span class="skolem">z'</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> z'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> theI'<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> snd <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">z</span> <span class="main">≤</span> snd <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-sum_of_squares_nat_bound"><span class="command">lemma</span></span> sum_of_squares_nat_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> power2_eq_square <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">y</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-sum_of_squares_nat_bound'"><span class="command">lemma</span></span> sum_of_squares_nat_bound'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum_of_squares_nat_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers-is_singleton_conv_Ex1"><span class="command">lemma</span></span> is_singleton_conv_Ex1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_singleton <span class="free">A</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_singleton <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_singletonE<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_singleton <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equals0D is_singletonI'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-the_elemI"><span class="command">lemma</span></span> the_elemI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_singleton <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"the_elem <span class="free">A</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> is_singletonE<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers-prime_square_sum_nat_decomp_code_aux"><span class="command">lemma</span></span> prime_square_sum_nat_decomp_code_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≡</span> the_elem <span class="main">(</span>Set.filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="free">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prime_square_sum_nat_decomp <span class="free">p</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Set.filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="free">p</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sum_of_squares_nat_bound <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> sum_of_squares_nat_bound' <span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> Set.filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="free">p</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> z_def eq <span class="keyword1"><span class="command">using</span></span> prime_sum_of_squares_unique<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> the_elemI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_singleton_conv_Ex1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_square_sum_nat_decomp <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>fst <span class="free">z</span><span class="main">,</span> snd <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_square_sum_nat_decomp_eqI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers-prime_square_sum_nat_decomp_code"><span class="command">lemma</span></span> prime_square_sum_nat_decomp_code <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"prime_square_sum_nat_decomp <span class="free">p</span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> prime <span class="free">p</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">then</span> the_elem <span class="main">(</span>Set.filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">x</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="free">p</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">..</span><span class="free">p</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prime_square_sum_nat_decomp_code_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_square_sum_nat_decomp_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Executable factorisation of Gaussian integers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lastly, we use all of the above to give an executable (albeit not very efficient) factorisation
  algorithm for Gaussian integers based on factorisation of regular integers. Note that we will
  only compute the set of prime factors without multiplicity, but given that, it would be fairly
  easy to determine the multiplicity as well.

  First, we need the following function that computes the Gaussian integer factors of a 
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ℤ›</span></span></span></span>-prime <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span>:
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">factor_gauss_int_prime_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> gauss_int list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">factor_gauss_int_prime_nat</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">then</span> <span class="main">[</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">]</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">[</span>of_nat <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">]</span>
      <span class="keyword1">else</span> <span class="keyword1">case</span> prime_square_sum_nat_decomp <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span>
             <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">[</span>of_nat <span class="bound">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="bound">y</span><span class="main">,</span> of_nat <span class="bound">y</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="bound">x</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Gaussian_Integers-factor_gauss_int_prime_nat_correct"><span class="command">lemma</span></span> factor_gauss_int_prime_nat_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set <span class="main">(</span>factor_gauss_int_prime_nat <span class="free">p</span><span class="main">)</span> <span class="main">=</span> prime_factors <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prime_mod_4_cases<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factorization_2_gauss_int factor_gauss_int_prime_nat_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>of_nat <span class="free">p</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prime_gauss_int_of_nat<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factorization_prime factor_gauss_int_prime_nat_def cong_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> noninert_gauss_int_prime <span class="quoted"><span class="free">p</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> prime_square_sum_nat_decomp <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> fst <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> snd <span class="skolem">z</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_square_sum_nat_decomp_correct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main">]</span> * assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x_def y_def z_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> xy <span class="keyword1"><span class="command">have</span></span> xy_signs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_1_mod_4_sum_of_squares_unique_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> assms * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> norms<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
              <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span>of_nat <span class="skolem">y</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def nat_add_distrib nat_power_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> prime<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>of_nat <span class="skolem">y</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> norms xy_signs <span class="quoted"><span class="quoted">‹prime <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prime_def normalized_gauss_int_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prime_gauss_int_norm_imp_prime_elem<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normalize <span class="main">(</span><span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">y</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_nat <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>of_nat <span class="skolem">y</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="free">p</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> xy<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normalize <span class="main">…</span> <span class="main">=</span> of_nat <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"prime_factorization <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
         prime_factorization <span class="main">(</span>prod_mset <span class="main">{#</span>of_nat <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">y</span><span class="main">,</span> of_nat <span class="skolem">y</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">x</span><span class="main">#}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_unique<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{#</span>of_nat <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">y</span><span class="main">,</span> of_nat <span class="skolem">y</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">x</span><span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_prod_mset_primes<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>of_nat <span class="skolem">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">y</span><span class="main">,</span> of_nat <span class="skolem">y</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> set <span class="main">(</span>factor_gauss_int_prime_nat <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> factor_gauss_int_prime_nat_def case_prod_unfold
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def x_def y_def z_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we lift this to compute the prime factorisation of any integer in the Gaussian integers:
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prime_factors_gauss_int_of_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> gauss_int set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prime_factors_gauss_int_of_nat</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> 
     <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> set <span class="main">(</span>factor_gauss_int_prime_nat <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Gaussian_Integers-prime_factors_gauss_int_of_nat_correct"><span class="command">lemma</span></span> prime_factors_gauss_int_of_nat_correct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prime_factors_gauss_int_of_nat <span class="free">n</span> <span class="main">=</span> prime_factors <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">=</span>
          prime_factors <span class="main">(</span>of_nat <span class="main">(</span>prod_mset <span class="main">(</span>prime_factorization <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod_mset_prime_factorization_nat <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> prime_factors <span class="main">(</span>prod_mset <span class="main">(</span>image_mset of_nat <span class="main">(</span>prime_factorization <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_prod_mset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> prime_factors <span class="main">(</span>of_nat <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_prod_mset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> set <span class="main">(</span>factor_gauss_int_prime_nat <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> SUP_cong refl factor_gauss_int_prime_nat_correct <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_factors_gauss_int_of_nat_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  prime_factors_gauss_int_of_nat_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can now use this to factor any Gaussian integer by computing a factorisation of its
  norm and removing all the prime divisors that do not actually divide it.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prime_factors_gauss_int</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"gauss_int <span class="main">⇒</span> gauss_int set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prime_factors_gauss_int</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{}</span> 
     <span class="keyword1">else</span> Set.filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">(</span>prime_factors_gauss_int_of_nat <span class="main">(</span>gauss_int_norm <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Gaussian_Integers-prime_factors_gauss_int_correct"><span class="command">lemma</span></span> prime_factors_gauss_int_correct <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"prime_factors <span class="free">z</span> <span class="main">=</span> prime_factors_gauss_int <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> gauss_int_norm <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> n_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors_gauss_int <span class="free">z</span> <span class="main">=</span> Set.filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span>prime_factors <span class="main">(</span>of_nat <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_factors_gauss_int_of_nat_correct prime_factors_gauss_int_def n_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_nat <span class="skolem">n</span> <span class="main">=</span> <span class="free">z</span> <span class="main">*</span> gauss_cnj <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def self_mult_gauss_cnj<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">…</span> <span class="main">=</span> prime_factors <span class="free">z</span> <span class="main">∪</span> prime_factors <span class="main">(</span>gauss_cnj <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factors_product<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Set.filter <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="keyword1">dvd</span> <span class="free">z</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> prime_factors <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_prime_factors_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_factors_gauss_int_def<span class="main">)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">unbundle</span></span> no_gauss_int_notation
<span class="comment1">(*&gt;*)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Gaussian_Integers_Test">
<div class="head">
<h1>Theory Gaussian_Integers_Test</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Gaussian_Integers_Test.thy
  Author:   Manuel Eberl, TU München

  Test of code generation for executable factorisation algorithm for Gaussian integers
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Gaussian_Integers_Test
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Gaussian_Integers.html">Gaussian_Integers</a>
  <span class="quoted">"<a href="../Polynomial_Factorization/Prime_Factorization.html">Polynomial_Factorization.Prime_Factorization</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Numeral.html">HOL-Library.Code_Target_Numeral</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lastly, we apply our factorisation algorithm to some simple examples:
›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">includes</span></span> gauss_int_notation
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">1234</span> <span class="main">+</span> <span class="numeral">5678</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="numeral">321</span> <span class="main">+</span> <span class="numeral">654</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"prime_factors <span class="main">(</span><span class="numeral">4830</span> <span class="main">+</span> <span class="numeral">1610</span> <span class="main">*</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">)</span>"</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Gaussian_Integers_Sums_Of_Two_Squares">
<div class="head">
<h1>Theory Gaussian_Integers_Sums_Of_Two_Squares</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Gaussian_Integers_Sums_Of_Two_Squares.thy
  Author:   Manuel Eberl, TU München

  Application of Gaussian integers to determining which natural numbers can be written as a sum
  of two squares
*)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sums of two squares›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Gaussian_Integers_Sums_Of_Two_Squares
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Gaussian_Integers.html">Gaussian_Integers</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  As an application, we can now easily prove that a positive natural number is the
  sum of two squares if and only if all prime factors congruent 3 modulo 4 have even
  multiplicity.
›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">sum_of_2_squares_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sum_of_2_squares_nat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Gaussian_Integers_Sums_Of_Two_Squares-sum_of_2_squares_nat_altdef"><span class="command">lemma</span></span> sum_of_2_squares_nat_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="free">n</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">∈</span> range gauss_int_norm"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_of_2_squares_nat.cases<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> gauss_int_norm <span class="main">(</span>of_nat <span class="skolem">a</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_nat <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def nat_add_distrib nat_power_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">∈</span> range gauss_int_norm"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">gauss_int</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">z</span> <span class="main">=</span> nat <span class="main">¦</span>ReZ <span class="skolem">z</span><span class="main">¦</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> nat <span class="main">¦</span>ImZ <span class="skolem">z</span><span class="main">¦</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def nat_add_distrib <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> nat_power_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="main">(</span>gauss_int_norm <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum_of_2_squares_nat.intros<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers_Sums_Of_Two_Squares-sum_of_2_squares_nat_gauss_int_norm"><span class="command">lemma</span></span> sum_of_2_squares_nat_gauss_int_norm <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="main">(</span>gauss_int_norm <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_of_2_squares_nat_altdef<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers_Sums_Of_Two_Squares-sum_of_2_squares_nat_0"><span class="command">lemma</span></span> sum_of_2_squares_nat_0 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> sum_of_2_squares_nat_1 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sum_of_2_squares_nat_Suc_0 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sum_of_2_squares_nat_2 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum_of_2_squares_nat.intros<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> sum_of_2_squares_nat.intros<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
        sum_of_2_squares_nat.intros<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers_Sums_Of_Two_Squares-sum_of_2_squares_nat_mult"><span class="command">lemma</span></span> sum_of_2_squares_nat_mult <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> gauss_int_norm <span class="skolem">z1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> gauss_int_norm <span class="skolem">z2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_of_2_squares_nat_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> gauss_int_norm <span class="main">(</span><span class="skolem">z1</span> <span class="main">*</span> <span class="skolem">z2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_norm_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers_Sums_Of_Two_Squares-sum_of_2_squares_nat_power"><span class="command">lemma</span></span> sum_of_2_squares_nat_power <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="main">(</span><span class="free">m</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers_Sums_Of_Two_Squares-sum_of_2_squares_nat_prod"><span class="command">lemma</span></span> sum_of_2_squares_nat_prod <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> sum_of_2_squares_nat <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="main">(</span><span class="main">∏</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers_Sums_Of_Two_Squares-sum_of_2_squares_nat_prod_mset"><span class="command">lemma</span></span> sum_of_2_squares_nat_prod_mset <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">A</span> <span class="main">⟹</span> sum_of_2_squares_nat <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="main">(</span>prod_mset <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Gaussian_Integers_Sums_Of_Two_Squares-sum_of_2_squares_nat_necessary"><span class="command">lemma</span></span> sum_of_2_squares_nat_necessary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"even <span class="main">(</span>multiplicity <span class="free">p</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> multiplicity <span class="free">p</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">z</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_of_2_squares_nat_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> z <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> prime'<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>of_nat <span class="free">p</span> <span class="main">::</span> gauss_int<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms prime_gauss_int_of_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"multiplicity <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span> <span class="main">(</span>gauss_cnj <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> multiplicity_gauss_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_nat <span class="free">p</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span> <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">::</span> gauss_int<span class="main">)</span> <span class="main">=</span>
        multiplicity <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">*</span> gauss_cnj <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> self_mult_gauss_cnj<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> multiplicity <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_elem_multiplicity_mult_distrib<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"multiplicity <span class="free">p</span> <span class="free">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> multiplicity <span class="main">(</span>of_nat <span class="free">p</span><span class="main">)</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> multiplicity_gauss_int_of_nat<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers_Sums_Of_Two_Squares-sum_of_2_squares_nat_sufficient"><span class="command">lemma</span></span> sum_of_2_squares_nat_sufficient<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> prime_factors <span class="free">n</span> <span class="main">⟹</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">⟹</span> even <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P3</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">p</span></span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prime_factorization_nat<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">}</span><span class="main">∪</span><span class="skolem">P2</span><span class="main">∪</span><span class="skolem">P3</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prime_mod_4_cases
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.mono_neutral_left<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P2_def P3_def in_prime_factors_iff not_dvd_imp_multiplicity_0<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">}</span><span class="main">∪</span><span class="skolem">P2</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P3</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P2_def P3_def cong_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="numeral">2</span><span class="main">}</span><span class="main">∪</span><span class="skolem">P2</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span>
               <span class="numeral">2</span> <span class="main">^</span> multiplicity <span class="numeral">2</span> <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P2</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> prod.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P2_def cong_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P3</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P3</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> prod.cong refl<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P3</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>multiplicity <span class="skolem">p</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>multiplicity <span class="skolem">p</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>multiplicity <span class="skolem">p</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P3_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>multiplicity <span class="skolem">p</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> multiplicity <span class="skolem">p</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">^</span> multiplicity <span class="skolem">p</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>multiplicity <span class="skolem">p</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> multiplicity <span class="numeral">2</span> <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P2</span><span class="main">.</span> <span class="bound">p</span> <span class="main">^</span> multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> 
                      <span class="main">(</span><span class="main">∏</span><span class="bound">p</span><span class="main">∈</span><span class="skolem">P3</span><span class="main">.</span> <span class="bound">p</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">^</span> <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="free">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="main">…</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sum_of_2_squares_nat_mult sum_of_2_squares_nat_prod<span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> sum_of_2_squares_nat_power<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P2</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> prime_cong_1_mod_4_gauss_int_norm_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">P3</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="main">(</span>gauss_int_norm <span class="main">(</span>of_nat <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="main">(</span>of_nat <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="main">(</span><span class="skolem">p</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> sum_of_2_squares_nat_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_of_2_squares_nat <span class="free">n</span> <span class="main">⟷</span>
     <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>prime_factors <span class="free">n</span><span class="main">.</span> <span class="main">[</span><span class="bound">p</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">⟶</span> even <span class="main">(</span>multiplicity <span class="bound">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sum_of_2_squares_nat_necessary<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> sum_of_2_squares_nat_sufficient<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Gaussian_Integers_Pythagorean_Triples">
<div class="head">
<h1>Theory Gaussian_Integers_Pythagorean_Triples</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Gaussian_Integers_Pythagorean_Triples.thy
  Author:   Manuel Eberl, TU München

  Application of Gaussian integers to deriving Euclid's formula for primitive Pythagorean triples
*)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Primitive Pythagorean triples›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Gaussian_Integers_Pythagorean_Triples
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Gaussian_Integers.html">Gaussian_Integers</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we derive Euclid's formula for primitive Pythagorean triples using
  Gaussian integers, following Stillwell~\cite{stillwell}.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prim_pyth_triple</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prim_pyth_triple</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> coprime <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>

<span class="keyword1" id="Gaussian_Integers_Pythagorean_Triples-prim_pyth_triple_commute"><span class="command">lemma</span></span> prim_pyth_triple_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"prim_pyth_triple <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">⟷</span> prim_pyth_triple <span class="free">y</span> <span class="free">x</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prim_pyth_triple_def coprime_commute add_ac conj_ac<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers_Pythagorean_Triples-prim_pyth_triple_aux"><span class="command">lemma</span></span> prim_pyth_triple_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span> <span class="free">v</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≤</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">u</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">u</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> int <span class="free">u</span> <span class="main">*</span> int <span class="free">v</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>int <span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> int <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>int <span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> int <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> int <span class="main">(</span><span class="main">(</span><span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_nat_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers_Pythagorean_Triples-prim_pyth_tripleI1"><span class="command">lemma</span></span> prim_pyth_tripleI1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">&lt;</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">u</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>odd <span class="free">u</span> <span class="main">∧</span> odd <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prim_pyth_triple <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">u</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">(</span><span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> power_strict_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>int <span class="free">u</span><span class="main">)</span> <span class="main">(</span>int <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>int <span class="free">u</span><span class="main">)</span> <span class="main">(</span>int <span class="free">u</span> <span class="main">*</span> int <span class="free">u</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span>int <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> coprime_iff_gcd_eq_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> gcd_add_mult<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="free">u</span> <span class="main">*</span> int <span class="free">u</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span>int <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">&lt;</span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_diff <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> coprime1<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">u</span> <span class="main">(</span><span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>int <span class="free">v</span><span class="main">)</span> <span class="main">(</span>int <span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> coprime_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>int <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span>int <span class="free">v</span><span class="main">)</span> <span class="main">*</span> int <span class="free">v</span> <span class="main">+</span> int <span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> coprime_iff_gcd_eq_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> gcd_add_mult<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span>int <span class="free">v</span><span class="main">)</span> <span class="main">*</span> int <span class="free">v</span> <span class="main">+</span> int <span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> int <span class="main">(</span><span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">&lt;</span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_diff <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> coprime2<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">v</span> <span class="main">(</span><span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">u</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">&lt;</span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prim_pyth_triple_aux<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">u</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span>›</span></span> coprime1 coprime2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">u</span> <span class="main">^</span> <span class="numeral">2</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prim_pyth_triple_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers_Pythagorean_Triples-prim_pyth_tripleI2"><span class="command">lemma</span></span> prim_pyth_tripleI2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">&lt;</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">u</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>odd <span class="free">u</span> <span class="main">∧</span> odd <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"prim_pyth_triple <span class="main">(</span><span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">u</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> prim_pyth_tripleI1<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prim_pyth_triple_commute<span class="main">)</span>

<span class="keyword1" id="Gaussian_Integers_Pythagorean_Triples-primitive_pythagorean_tripleE_int"><span class="command">lemma</span></span> primitive_pythagorean_tripleE_int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">y</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">u</span> <span class="free">v</span> <span class="main">::</span> <span class="quoted">int</span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">u</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>odd <span class="free">u</span> <span class="main">∧</span> odd <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">u</span> <span class="main">*</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>  <span class="main">∨</span>  <span class="free">x</span> <span class="main">=</span> <span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">u</span> <span class="main">*</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>even <span class="free">x</span> <span class="main">∧</span> even <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_coprimeI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹coprime <span class="free">x</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>odd <span class="free">x</span> <span class="main">∧</span> odd <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">y</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong_add odd_square_cong_4_int<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">∨</span> <span class="main">[</span><span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">4</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> even_square_cong_4_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span> odd_square_cong_4_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="free">z</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cong_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="free">y</span> <span class="main">⟷</span> odd <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="free">z</span> <span class="main">⟷</span> even <span class="main">(</span><span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">⟷</span> even <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">y</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="free">x</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹even <span class="free">y</span> <span class="main">⟷</span> <span class="main">¬</span>even <span class="free">x</span>›</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> of_int <span class="free">x</span> <span class="main">+</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span> <span class="main">*</span> of_int <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> t_mult_cnj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">*</span> gauss_cnj <span class="skolem">t</span> <span class="main">=</span> of_int <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_def power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> of_int_mult of_int_add<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gauss_int_norm <span class="skolem">t</span> <span class="main">=</span> <span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gauss_int_norm_def t_def assms<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">x</span> <span class="free">y</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹odd <span class="free">z</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">t</span> <span class="main">(</span>gauss_cnj <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> coprime_self_gauss_cnj<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_def gauss_int_norm_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> even_nat_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_square <span class="main">(</span><span class="skolem">t</span> <span class="main">*</span> gauss_cnj <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> t_mult_cnj<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="numeral">2</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">*</span> gauss_cnj <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_nth_power_upto_unit_base<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_nth_power_upto_unit <span class="numeral">2</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_nth_power_upto_unit_mult_coprimeD1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_nth_power_upto_unit_def is_nth_power_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ab<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">,</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_unit_gauss_int_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="skolem">t</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">∧</span> ImZ <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">v</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">∨</span> 
                                ImZ <span class="skolem">t</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">∧</span> ReZ <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">v</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="skolem">t</span> <span class="main">=</span> ReZ <span class="skolem">b</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> ImZ <span class="skolem">b</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="skolem">t</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> ReZ <span class="skolem">b</span> <span class="main">*</span> ImZ <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff power2_eq_square<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="skolem">t</span> <span class="main">=</span> ImZ <span class="skolem">b</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span>ReZ <span class="skolem">b</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="skolem">t</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> ImZ <span class="skolem">b</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>ReZ <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="skolem">t</span> <span class="main">=</span> ImZ <span class="skolem">b</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> ReZ <span class="skolem">b</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="skolem">t</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> ImZ <span class="skolem">b</span> <span class="main">*</span> ReZ <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">-</span><span class="keyword1">𝗂<span class="hidden">⇩</span><sub>ℤ</sub></span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span>ReZ <span class="skolem">b</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> ImZ <span class="skolem">b</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="skolem">t</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>ReZ <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> ImZ <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gauss_int_eq_iff power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ReZ <span class="skolem">t</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ImZ <span class="skolem">t</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> not_both_odd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>odd <span class="skolem">u</span> <span class="main">∧</span> odd <span class="skolem">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">x</span> <span class="free">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprimeI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> xy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">x</span> <span class="free">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_coprimeI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> xy not_both_odd <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Gaussian_Integers_Pythagorean_Triples-prim_pyth_tripleE"><span class="command">lemma</span></span> prim_pyth_tripleE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"prim_pyth_triple <span class="free">x</span> <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">u</span> <span class="free">v</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">&lt;</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">u</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>odd <span class="free">u</span> <span class="main">∧</span> odd <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">u</span> <span class="main">*</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>  <span class="main">∨</span>  <span class="free">x</span> <span class="main">=</span> <span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">u</span> <span class="main">*</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span>int <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>int <span class="free">y</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>int <span class="free">x</span><span class="main">)</span> <span class="main">(</span>int <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> of_nat_power of_nat_add <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prim_pyth_triple_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">u</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>odd <span class="skolem">u</span> <span class="main">∧</span> odd <span class="skolem">v</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"int <span class="free">x</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">∧</span> int <span class="free">y</span> <span class="main">=</span> <span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>  <span class="main">∨</span>  int <span class="free">x</span> <span class="main">=</span> <span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">∧</span> int <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> primitive_pythagorean_tripleE_int<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">=</span> nat <span class="main">¦</span><span class="skolem">u</span><span class="main">¦</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">=</span> nat <span class="main">¦</span><span class="skolem">v</span><span class="main">¦</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u'</span> <span class="main">*</span> <span class="skolem">v'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">a</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span>int <span class="skolem">a</span><span class="main">¦</span> <span class="main">=</span> nat <span class="main">¦</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">v</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u'</span> <span class="main">*</span> <span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u'_def v'_def abs_mult nat_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">u'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">v'</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">u'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">v</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">v</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> int <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">v</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">u</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abs_le_square_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">u'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v'_def u'_def<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> int <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="skolem">u</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">¦</span> <span class="main">=</span> nat <span class="main">¦</span><span class="skolem">v</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> int <span class="skolem">a</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="skolem">u</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">u'</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u'_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> nat_power_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="skolem">v</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> int <span class="skolem">a</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">v'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_add_distrib v'_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> nat_power_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">u'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">v'</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u'</span> <span class="main">*</span> <span class="skolem">v'</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="skolem">u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>  <span class="main">∨</span>  <span class="free">x</span> <span class="main">=</span> <span class="skolem">u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u'</span> <span class="main">*</span> <span class="skolem">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">u'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> uv<span class="main">(</span>3<span class="main">)</span> **<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> **<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> ***<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main">]</span> ***<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">u'</span> <span class="skolem">v'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">u</span> <span class="skolem">v</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> u'_def v'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>odd <span class="skolem">u'</span> <span class="main">∧</span> odd <span class="skolem">v'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> uv<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> u'_def v'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≠</span> <span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">u'</span> <span class="skolem">v'</span>›</span></span> eq assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prim_pyth_triple_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">&lt;</span> <span class="skolem">u'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">≤</span> <span class="skolem">u'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="skolem">u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="skolem">v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">y</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prim_pyth_triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u'</span> <span class="main">*</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">u'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">v'</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u'</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">v'</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prim_pyth_triple_aux<span class="main">)</span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">u'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> prim_pyth_triple_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prim_pyth_triple <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">⟷</span>
     <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">&lt;</span> <span class="bound">u</span> <span class="main">∧</span> coprime <span class="bound">u</span> <span class="bound">v</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>odd <span class="bound">u</span> <span class="main">∧</span> odd <span class="bound">v</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">*</span> <span class="bound">v</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="bound">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="bound">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>  <span class="main">∨</span>  <span class="free">x</span> <span class="main">=</span> <span class="bound">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="bound">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">*</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">=</span> <span class="bound">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="bound">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"prim_pyth_triple <span class="free">x</span> <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> prim_pyth_tripleE<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">&lt;</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">u</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>odd <span class="skolem">u</span> <span class="main">∧</span> odd <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="skolem">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                        eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>  <span class="main">∨</span>  <span class="free">x</span> <span class="main">=</span> <span class="skolem">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">*</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"prim_pyth_triple <span class="free">x</span> <span class="free">y</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> uv prim_pyth_tripleI1<span class="main">[</span><span class="operator">OF</span> uv<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span><span class="main">]</span> prim_pyth_tripleI2<span class="main">[</span><span class="operator">OF</span> uv<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span><span class="main">]</span> uv<span class="main">(</span>5<span class="main">)</span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Gaussian_Integers_Everything">
<div class="head">
<h1>Theory Gaussian_Integers_Everything</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:     Gaussian_Integers_Everything.thy
  Author:   Manuel Eberl, TU München

  Dummy theory to import everything in the session to ensure the theories are loaded in the
  right order for the document.
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Gaussian_Integers_Everything
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Gaussian_Integers.html">Gaussian_Integers</a>
  <a href="Gaussian_Integers_Test.html">Gaussian_Integers_Test</a>
  <a href="Gaussian_Integers_Sums_Of_Two_Squares.html">Gaussian_Integers_Sums_Of_Two_Squares</a>
  <a href="Gaussian_Integers_Pythagorean_Triples.html">Gaussian_Integers_Pythagorean_Triples</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>