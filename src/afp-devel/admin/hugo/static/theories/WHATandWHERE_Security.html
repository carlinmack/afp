<div id="WHATWHERE_Security">
<div class="head">
<h1>Theory WHATWHERE_Security</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: WHATandWHERE-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> WHATWHERE_Security
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Strong_Security/Types.html">Strong_Security.Types</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> WHATWHERE <span class="main">=</span> 
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">SR</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TLSteps"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Evalfunction"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">pp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'com</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">DA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span>order<span class="main">)</span> DomainAssignment"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">lH</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span><span class="main">::</span>order<span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> lHatches"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹define when two states are indistinguishable for an observer on domain d›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">d_equal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span><span class="main">::</span>order <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State 
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">d_equal</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">DA</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">d_equal'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State 
  <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">::</span>order <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> bool"</span></span> 
<span class="main">(</span> <span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">=<span class="hidden">⇘</span><sub></sub></span>_<span class="keyword1"><span class="hidden">⇙</span></span> _<span class="keyword3">)</span>"</span> <span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main"><span class="free">=<span class="hidden">⇘</span><sub></sub></span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free"><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="main">≡</span> d_equal <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span>"</span></span>

<span class="comment1">― ‹transitivity of d-equality›</span>
<span class="keyword1"><span class="command">lemma</span></span> d_equal_trans<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">m</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">m'</span><span class="main">;</span> <span class="free">m'</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">m''</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">m''</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_equal_def<span class="main">)</span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SRabbr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="tfree">'com</span><span class="main">)</span> TLSteps_curry"</span></span>
<span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span> <span class="keyword1">→⊲</span>_<span class="keyword1">⊳</span><span class="keyword3">/ </span><span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 81<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">SR</span>"</span></span>


<span class="comment1">― ‹function for obtaining the unique memory (state) after one step for a command and a memory (state)›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">NextMem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'com</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State"</span></span>
<span class="main">(</span> <span class="quoted">"<span class="keyword1">⟦</span>_<span class="keyword1">⟧'(</span>_<span class="keyword1">')</span>"</span> <span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟦</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">⟧(</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">m'</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m'</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹function getting all escape hatches for some location›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">htchLoc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> Hatches"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">htchLoc</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">lH</span><span class="main">}</span>"</span></span>

<span class="comment1">― ‹function for getting all escape hatches for some set of locations›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">htchLocSet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> Hatches"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">htchLocSet</span> <span class="free"><span class="bound"><span class="entity">PP</span></span></span> <span class="main">≡</span> <span class="main">⋃</span><span class="main">{</span><span class="bound">h</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ι</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">PP</span></span></span><span class="main">.</span> <span class="bound">h</span> <span class="main">=</span> htchLoc <span class="bound">ι</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="comment1">― ‹predicate for (d,H)-equality›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dH_equal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> Hatches
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">dH_equal</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">d'</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="free">E</span> <span class="bound">e</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> <span class="free">E</span> <span class="bound">e</span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">dH_equal'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> <span class="tfree">'d</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> Hatches
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> bool"</span></span>
<span class="main">(</span> <span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">∼<span class="hidden">⇘</span><sub></sub></span>_<span class="keyword1">,</span>_<span class="keyword1"><span class="hidden">⇙</span></span> _<span class="keyword3">)</span>"</span> <span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main"><span class="free">∼<span class="hidden">⇘</span><sub></sub></span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main"><span class="free"><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="main">≡</span> dH_equal <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span>"</span></span>

<span class="comment1">― ‹predicate indicating that a command is not a d-declassification command›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">NDC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'com</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">NDC</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span> <span class="bound">m'</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">m'</span> <span class="main">⟶</span> <span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⟧(</span><span class="bound">m</span><span class="main">)</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⟧(</span><span class="bound">m'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹predicate indicating an 'immediate d-declassification command' for a set of escape hatches›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">IDC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'com</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> Hatches <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">IDC</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">m'</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">m'</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">¬</span> <span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⟧(</span><span class="bound">m</span><span class="main">)</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⟧(</span><span class="bound">m'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span> <span class="bound">m'</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">m'</span> <span class="main">⟶</span> <span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⟧(</span><span class="bound">m</span><span class="main">)</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⟧(</span><span class="bound">m'</span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stepResultsinR</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'com</span> ProgramState <span class="main">⇒</span> <span class="tfree">'com</span> ProgramState 
  <span class="main">⇒</span> <span class="tfree">'com</span> Bisimulation_type <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">stepResultsinR</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> None <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span> <span class="main">=</span> None<span class="main">)</span> <span class="main">∨</span> 
  <span class="main">(</span><span class="main">∃</span><span class="bound">c</span> <span class="bound">c'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Some <span class="bound">c</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span> <span class="main">=</span> Some <span class="bound">c'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="bound">c'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dhequality_alternative</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> nat set <span class="main">⇒</span> nat 
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">dhequality_alternative</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">PP</span></span></span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="main">(</span>htchLocSet <span class="free"><span class="bound"><span class="entity">PP</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="main">∨</span>
            <span class="main">(</span><span class="main">¬</span> <span class="main">(</span>htchLoc <span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>htchLocSet <span class="free"><span class="bound"><span class="entity">PP</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Strong_dlHPP_Bisimulation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> nat set 
  <span class="main">⇒</span> <span class="tfree">'com</span> Bisimulation_type <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Strong_dlHPP_Bisimulation</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">PP</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> 
  <span class="main">(</span>sym <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>trans <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">.</span> length <span class="bound">V</span> <span class="main">=</span> length <span class="bound">V'</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="bound">V</span><span class="main">.</span> 
    <span class="main">(</span><span class="main">(</span>NDC <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">(</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
     <span class="main">(</span>IDC <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">(</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span>htchLoc <span class="main">(</span><span class="free">pp</span> <span class="main">(</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">m1</span> <span class="bound">m1'</span> <span class="bound">m2</span> <span class="bound">α</span> <span class="bound">p</span><span class="main">.</span>
    <span class="main">(</span> <span class="main">⟨</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m2</span><span class="main">⟩</span> <span class="main">∧</span> <span class="bound">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="main">(</span>htchLocSet <span class="free"><span class="bound"><span class="entity">PP</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">m1'</span><span class="main">)</span>
    <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">(</span> <span class="main">⟨</span><span class="bound">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
        <span class="main">(</span>stepResultsinR <span class="bound">p</span> <span class="bound">p'</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∧</span> 
        <span class="main">(</span>dhequality_alternative <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">PP</span></span></span> <span class="main">(</span><span class="free">pp</span> <span class="main">(</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">m2</span> <span class="bound">m2'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="comment1">― ‹predicate to define when a program is strongly secure›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">WHATWHERE_Secure</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'com</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">WHATWHERE_Secure</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="bound">PP</span><span class="main">.</span> 
  <span class="main">(</span><span class="main">∃</span><span class="bound">R</span><span class="main">.</span> Strong_dlHPP_Bisimulation <span class="bound">d</span> <span class="bound">PP</span> <span class="bound">R</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="bound">R</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="comment1">― ‹auxiliary lemma to obtain central strong (d,lH,PP)-Bisimulation property as Lemma
 in meta logic (allows instantiating all the variables manually if necessary)›</span>
<span class="keyword1"><span class="command">lemma</span></span> strongdlHPPB_aux<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">V</span> <span class="bound">V'</span> <span class="bound">m1</span> <span class="bound">m1'</span> <span class="bound">m2</span> <span class="bound">p</span> <span class="bound">i</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟦</span> Strong_dlHPP_Bisimulation <span class="free">d</span> <span class="free">PP</span> <span class="free">R</span><span class="main">;</span>
  <span class="bound">i</span> <span class="main">&lt;</span> length <span class="bound">V</span><span class="main">;</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> 
  <span class="main">⟨</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m2</span><span class="main">⟩</span><span class="main">;</span> <span class="bound">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main">,</span><span class="main">(</span>htchLocSet <span class="free">PP</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">m1'</span> <span class="main">⟧</span>
 <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span>
  <span class="main">∧</span> stepResultsinR <span class="bound">p</span> <span class="bound">p'</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> 
  <span class="main">(</span>dhequality_alternative <span class="free">d</span> <span class="free">PP</span> <span class="main">(</span><span class="free">pp</span> <span class="main">(</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">m2</span> <span class="bound">m2'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="comment1">― ‹auxiliary lemma to obtain 'NDC or IDC' from strong (d,lH,PP)-Bisimulation as lemma
  in meta logic allowing instantiation of the variables›</span>
<span class="keyword1"><span class="command">lemma</span></span> strongdlHPPB_NDCIDCaux<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">V</span> <span class="bound">V'</span> <span class="bound">i</span><span class="main">.</span> <span class="main">⟦</span>Strong_dlHPP_Bisimulation <span class="free">d</span> <span class="free">PP</span> <span class="free">R</span><span class="main">;</span>
  <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="bound">V</span> <span class="main">⟧</span>
        <span class="main">⟹</span> <span class="main">(</span>NDC <span class="free">d</span> <span class="main">(</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∨</span> IDC <span class="free">d</span> <span class="main">(</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span>htchLoc <span class="main">(</span><span class="free">pp</span> <span class="main">(</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> WHATWHERE_empty<span class="main">:</span>
<span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span>
  <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def sym_def trans_def<span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Up_To_Technique">
<div class="head">
<h1>Theory Up_To_Technique</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: WHATandWHERE-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Up_To_Technique
<span class="keyword2"><span class="keyword">imports</span></span> <a href="WHATWHERE_Security.html">WHATWHERE_Security</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> WHATWHERE
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SdlHPPB</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">SdlHPPB</span> <span class="main">≡</span> Strong_dlHPP_Bisimulation"</span></span>

<span class="comment1">― ‹define the 'reflexive part' of a relation (sets of elements which are related with themselves by the given relation)›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Arefl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Arefl</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="bound">e</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> commonArefl_subset_commonDomain<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>Arefl <span class="free">R1</span> <span class="main">∩</span> Arefl <span class="free">R2</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>Domain <span class="free">R1</span> <span class="main">∩</span> Domain <span class="free">R2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Arefl_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="comment1">― ‹define disjoint strong (d,lH,PP)-bisimulation up-to-R' for a relation R›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">disj_dlHPP_Bisimulation_Up_To_R'</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> nat set <span class="main">⇒</span> <span class="tfree">'com</span> Bisimulation_type 
  <span class="main">⇒</span> <span class="tfree">'com</span> Bisimulation_type <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">disj_dlHPP_Bisimulation_Up_To_R'</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">PP</span></span></span> <span class="free"><span class="bound"><span class="entity">R'</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span>
  SdlHPPB <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">PP</span></span></span> <span class="free"><span class="bound"><span class="entity">R'</span></span></span> <span class="main">∧</span> <span class="main">(</span>sym <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>trans <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">)</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">.</span> length <span class="bound">V</span> <span class="main">=</span> length <span class="bound">V'</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="bound">V</span><span class="main">.</span> 
    <span class="main">(</span><span class="main">(</span>NDC <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">(</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
     <span class="main">(</span>IDC <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">(</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span>htchLoc <span class="main">(</span><span class="free">pp</span> <span class="main">(</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">m1</span> <span class="bound">m1'</span> <span class="bound">m2</span> <span class="bound">α</span> <span class="bound">p</span><span class="main">.</span>
    <span class="main">(</span><span class="main">⟨</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m2</span><span class="main">⟩</span> <span class="main">∧</span> <span class="bound">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="main">(</span>htchLocSet <span class="free"><span class="bound"><span class="entity">PP</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">m1'</span><span class="main">)</span>
    <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
        <span class="main">(</span>stepResultsinR <span class="bound">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">R'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">R'</span></span></span><span class="main">)</span> <span class="main">∧</span> 
        <span class="main">(</span>dhequality_alternative <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">PP</span></span></span> <span class="main">(</span><span class="free">pp</span> <span class="main">(</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">m2</span> <span class="bound">m2'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹lemma about the transitivity of the union of symmetric and transitive relations under certain circumstances›</span>
<span class="keyword1"><span class="command">lemma</span></span> trans_RuR'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> transR<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> symR<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> transR'<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">R'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> symR'<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="free">R'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eqlenR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">.</span> length <span class="bound">V</span> <span class="main">=</span> length <span class="bound">V'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eqlenR'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span><span class="main">.</span> length <span class="bound">V</span> <span class="main">=</span> length <span class="bound">V'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Areflassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Arefl <span class="free">R</span> <span class="main">∩</span> Arefl <span class="free">R'</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="free">R'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
 <span class="keyword1"><span class="command">{</span></span> 
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">V''</span>
   <span class="keyword3"><span class="command">assume</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="free">R'</span><span class="main">)</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="free">R'</span><span class="main">)</span>"</span></span>

   <span class="keyword1"><span class="command">from</span></span> p1 p2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="free">R'</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
         <span class="keyword3"><span class="command">assume</span></span> inR1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
         <span class="keyword3"><span class="command">assume</span></span> inR2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
         <span class="keyword1"><span class="command">from</span></span> inR1 inR2 transR <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> trans_def
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> inR'1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span>"</span></span>
         <span class="keyword3"><span class="command">assume</span></span> inR'2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span>"</span></span>
         <span class="keyword3"><span class="command">assume</span></span> notinR'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∉</span> <span class="free">R'</span>"</span></span>
         <span class="keyword1"><span class="command">from</span></span> inR'1 inR'2 transR' <span class="keyword1"><span class="command">have</span></span> inR'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> trans_def
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">from</span></span> notinR' inR' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> inR1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
         <span class="keyword3"><span class="command">assume</span></span> inR'2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span>"</span></span>
         <span class="keyword1"><span class="command">from</span></span> inR1 symR transR <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> sym_def trans_def
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">hence</span></span> AreflR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">}</span> <span class="main">⊆</span> Arefl <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Arefl_def<span class="main">)</span>
         <span class="keyword1"><span class="command">from</span></span> inR'2 symR' transR' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">V''</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> sym_def trans_def
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">hence</span></span> AreflR'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">}</span> <span class="main">⊆</span> Arefl <span class="free">R'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Arefl_def<span class="main">)</span>

         <span class="keyword1"><span class="command">from</span></span> AreflR AreflR' Areflassump <span class="keyword1"><span class="command">have</span></span> V'empt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Arefl_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
         <span class="keyword1"><span class="command">with</span></span> inR'2 eqlenR' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="skolem">V''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">with</span></span> inR1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span> <span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> inR'1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span>"</span></span>
         <span class="keyword3"><span class="command">assume</span></span> inR2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
         <span class="keyword1"><span class="command">from</span></span> inR'1 symR' transR' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> sym_def trans_def
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">hence</span></span> AreflR'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">}</span> <span class="main">⊆</span> Arefl <span class="free">R'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Arefl_def<span class="main">)</span>
         <span class="keyword1"><span class="command">from</span></span> inR2 symR transR <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">V''</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> sym_def trans_def
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">hence</span></span> AreflR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">}</span> <span class="main">⊆</span> Arefl <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Arefl_def<span class="main">)</span>

         <span class="keyword1"><span class="command">from</span></span> AreflR AreflR' Areflassump <span class="keyword1"><span class="command">have</span></span> V'empt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Arefl_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
         <span class="keyword1"><span class="command">with</span></span> inR'1 eqlenR' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">with</span></span> inR2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span> <span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">qed</span></span>        
 <span class="keyword1"><span class="command">}</span></span>
 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Up_To_Technique<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> disj_dlHPP_Bisimulation_Up_To_R' <span class="free">d</span> <span class="free">PP</span> <span class="free">R'</span> <span class="free">R</span><span class="main">;</span> 
  Arefl <span class="free">R</span> <span class="main">∩</span> Arefl <span class="free">R'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span> <span class="main">⟧</span>
  <span class="main">⟹</span> SdlHPPB <span class="free">d</span> <span class="free">PP</span> <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="free">R'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disj_dlHPP_Bisimulation_Up_To_R'_def 
    Strong_dlHPP_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> symR'<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="free">R'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> symR<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> symR' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="free">R'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> symR'<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="free">R'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> symR<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="free">R</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> transR'<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">R'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> transR<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">R</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eqlenR'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span> <span class="bound">V'</span><span class="main">)</span><span class="main">∈</span><span class="free">R'</span><span class="main">.</span> length <span class="bound">V</span> <span class="main">=</span> length <span class="bound">V'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eqlenR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span> <span class="bound">V'</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span><span class="main">.</span> length <span class="bound">V</span> <span class="main">=</span> length <span class="bound">V'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> areflassump<span class="main">:</span> <span class="quoted"><span class="quoted">"Arefl <span class="free">R</span> <span class="main">∩</span> Arefl <span class="free">R'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> symR' symR transR' transR eqlenR' eqlenR areflassump trans_RuR'
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="free">R'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="comment1">― ‹condition about IDC and NDC and equal length already proven above by auto tactic!›</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">i</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">m2</span> <span class="skolem">α</span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> inR'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> dhequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main">,</span><span class="main">(</span>htchLocSet <span class="free">PP</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> disjBisimUpTo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span><span class="main">∈</span><span class="free">R'</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="bound">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">m1</span> <span class="bound">m1'</span> <span class="bound">m2</span> <span class="bound">α</span> <span class="bound">p</span><span class="main">.</span>
    <span class="main">⟨</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m2</span><span class="main">⟩</span> <span class="main">∧</span> <span class="bound">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main">,</span><span class="main">(</span>htchLocSet <span class="free">PP</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">m1'</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">V'</span><span class="main">!</span><span class="bound">i</span><span class="main">,</span><span class="bound">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
    stepResultsinR <span class="bound">p</span> <span class="bound">p'</span> <span class="free">R'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">α</span><span class="main">,</span> <span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span> <span class="main">∧</span>
    dhequality_alternative <span class="free">d</span> <span class="free">PP</span> <span class="main">(</span><span class="free">pp</span> <span class="main">(</span><span class="bound">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">m2</span> <span class="bound">m2'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> inR' irange step dhequal disjBisimUpTo <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span>
    <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span> stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="free">R'</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span><span class="main">)</span> <span class="main">∧</span> 
    dhequality_alternative <span class="free">d</span> <span class="free">PP</span> <span class="main">(</span><span class="free">pp</span> <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def<span class="main"><span class="keyword3">,</span></span><span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

  
<span class="keyword1"><span class="command">lemma</span></span> Union_Strong_dlHPP_Bisim<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> SdlHPPB <span class="free">d</span> <span class="free">PP</span> <span class="free">R</span><span class="main">;</span> SdlHPPB <span class="free">d</span> <span class="free">PP</span> <span class="free">R'</span><span class="main">;</span> 
  Arefl <span class="free">R</span> <span class="main">∩</span> Arefl <span class="free">R'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span> <span class="main">⟧</span>
  <span class="main">⟹</span> SdlHPPB <span class="free">d</span> <span class="free">PP</span> <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="free">R'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Up_To_Technique<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 
  disj_dlHPP_Bisimulation_Up_To_R'_def 
  Strong_dlHPP_Bisimulation_def stepResultsinR_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> adding_emptypair_keeps_SdlHPPB<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> SdlHPP<span class="main">:</span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="free">d</span> <span class="free">PP</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="free">d</span> <span class="free">PP</span> <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> SdlHPPemp<span class="main">:</span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="free">d</span> <span class="free">PP</span> <span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def sym_def trans_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> commonDom<span class="main">:</span> <span class="quoted"><span class="quoted">"Domain <span class="free">R</span> <span class="main">∩</span> Domain <span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">with</span></span> commonArefl_subset_commonDomain <span class="keyword1"><span class="command">have</span></span> Areflassump<span class="main">:</span>
    <span class="quoted"><span class="quoted">"Arefl <span class="free">R</span> <span class="main">∩</span> Arefl <span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">with</span></span> SdlHPP SdlHPPemp Union_Strong_dlHPP_Bisim <span class="keyword3"><span class="command">show</span></span> 
    <span class="quoted"><span class="quoted">"SdlHPPB <span class="free">d</span> <span class="free">PP</span> <span class="main">(</span><span class="free">R</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="MWLs">
<div class="head">
<h1>Theory MWLs</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: WHATandWHERE-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> MWLs
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Strong_Security/Types.html">Strong_Security.Types</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹type parameters not instantiated:›</span>
<span class="comment1">― ‹'exp: expressions (arithmetic, boolean...)›</span>
<span class="comment1">― ‹'val: numbers, boolean constants....›</span>
<span class="comment1">― ‹'id: identifier names›</span>

<span class="comment1">― ‹SYNTAX›</span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom
  <span class="main">=</span> Skip <span class="quoted"><span class="quoted">"nat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">⇙</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>50<span class="main">]</span> 70<span class="main">)</span>
  <span class="main">|</span> Assign <span class="quoted"><span class="quoted">"<span class="tfree">'id</span>"</span></span> <span class="quoted"><span class="quoted">"nat"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span>"</span></span>
       <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">:=<span class="hidden">⇘</span><sub></sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">⇙</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>70<span class="main">,</span>50<span class="main">,</span>70<span class="main">]</span> 70<span class="main">)</span>

  <span class="main">|</span> Seq <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom"</span></span>
       <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span> <span class="main">[</span>61<span class="main">,</span>60<span class="main">]</span> 60<span class="main">)</span>

  <span class="main">|</span> If_Else <span class="quoted"><span class="quoted">"nat"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom"</span></span>
       <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">⇙</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">then</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">else</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">fi</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>50<span class="main">,</span>80<span class="main">,</span>79<span class="main">,</span>79<span class="main">]</span> 70<span class="main">)</span>

  <span class="main">|</span> While_Do <span class="quoted"><span class="quoted">"nat"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom"</span></span>
       <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">⇙</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">do</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">od</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>50<span class="main">,</span>80<span class="main">,</span>79<span class="main">]</span> 70<span class="main">)</span>

  <span class="main">|</span> Spawn <span class="quoted"><span class="quoted">"nat"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom<span class="main">)</span> list"</span></span>
       <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="hidden">⇙</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>50<span class="main">,</span>70<span class="main">]</span> 70<span class="main">)</span>

<span class="comment1">― ‹function for obtaining the program point of some MWLsloc command›</span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">pp</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pp</span> <span class="main">(</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">pp</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pp</span> <span class="main">(</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="keyword1">fi</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pp</span> <span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pp</span> <span class="main">(</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span>"</span></span>

<span class="comment1">― ‹mutually recursive functions to collect program points of commands and thread pools›</span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">PPc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLsCom <span class="main">⇒</span> nat list"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity">PPV</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLsCom list <span class="main">⇒</span> nat list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">PPc</span> <span class="main">(</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">PPc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">PPc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">PPc</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="free">PPc</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">PPc</span> <span class="main">(</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="keyword1">fi</span><span class="main">)</span> <span class="main">=</span>  <span class="main">[</span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span><span class="free">PPc</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="free">PPc</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">PPc</span> <span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span><span class="free">PPc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">PPc</span> <span class="main">(</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">(</span><span class="free">PPV</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>

<span class="quoted"><span class="quoted">"<span class="free">PPV</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">PPV</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">PPc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="free">PPV</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹predicate indicating that a command only contains unique program points›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unique_PPc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">unique_PPc</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> distinct <span class="main">(</span>PPc <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹predicate indicating that a thread pool only contains unique program points›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unique_PPV</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">unique_PPV</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> distinct <span class="main">(</span>PPV <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> PPc_nonempt<span class="main">:</span> <span class="quoted"><span class="quoted">"PPc <span class="free">c</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> unique_c_uneq<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>PPc <span class="free">c'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">≠</span> <span class="free">c'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> PPc_nonempt<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> V_nonempt_PPV_nonempt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> PPV <span class="free">V</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">V</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> PPc_nonempt<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> unique_V_uneq<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">V</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> <span class="free">V'</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>PPV <span class="free">V'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">V</span> <span class="main">≠</span> <span class="free">V'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">V</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> V_nonempt_PPV_nonempt<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> PPc_in_PPV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> set <span class="free">V</span> <span class="main">⟹</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">V</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> listindices_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">V</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nth_mem<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> PPc_in_PPV_version<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">V</span> <span class="main">⟹</span> set <span class="main">(</span>PPc <span class="main">(</span><span class="free">V</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> PPc_in_PPV<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> listindices_aux<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> uniPPV_uniPPc<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPV <span class="free">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">V</span><span class="main">.</span> unique_PPc <span class="main">(</span><span class="free">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPV_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">V</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPc_def<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">metis</span> in_set_conv_nth length_Suc_conv set_ConsD<span class="main">)</span>

<span class="comment1">― ‹SEMANTICS›</span>

<span class="keyword1"><span class="command">locale</span></span> MWLs_semantics <span class="main">=</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Evalfunction"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">BMap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'val</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹steps semantics, set of deterministic steps from commands to program states›</span>
<span class="keyword1"><span class="command">inductive_set</span></span>
<span class="entity">MWLsSteps_det</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom<span class="main">)</span> TLSteps"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity"><span class="free">MWLslocSteps_det'</span></span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom<span class="main">)</span> TLSteps_curry"</span></span>
<span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span> <span class="keyword1">→⊲</span>_<span class="keyword1">⊳</span><span class="keyword3">/ </span><span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 81<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">MWLsSteps_det</span>"</span></span> <span class="main">|</span>
skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="main">[]</span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span>None<span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
assign<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟹</span>
  <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="main">[]</span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span>None<span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
seq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span>None<span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">⟹</span>
  <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span>Some <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
seq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span>Some <span class="free"><span class="bound"><span class="entity">c1'</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">⟹</span>
  <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1'</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
iftrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> True <span class="main">⟹</span>
  <span class="main"><span class="free">⟨</span></span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="keyword1">fi</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="main">[]</span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span>Some <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
iffalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> False <span class="main">⟹</span>
  <span class="main"><span class="free">⟨</span></span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="keyword1">fi</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="main">[]</span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span>Some <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
whiletrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> True <span class="main">⟹</span>
  <span class="main"><span class="free">⟨</span></span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">od</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="main">[]</span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span>Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
whilefalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">=</span> False <span class="main">⟹</span>
  <span class="main"><span class="free">⟨</span></span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">od</span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="main">[]</span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span>None<span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
spawn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span>None<span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> MWLsSteps_det_cases<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="free">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="free">p</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="free">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="free">p</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="free">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="free">p</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span> <span class="keyword1">fi</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="free">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="free">p</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">c</span> <span class="keyword1">od</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="free">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="free">p</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">V</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="free">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="free">p</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span>"</span></span>

<span class="comment1">― ‹non-deterministic, possibilistic system step (added for intuition, not used in the proofs)›</span>
<span class="keyword1"><span class="command">inductive_set</span></span>
<span class="entity">MWLsSteps_ndet</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom<span class="main">)</span> TPSteps"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity"><span class="free">MWLsSteps_ndet'</span></span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom<span class="main">)</span> TPSteps_curry"</span></span>
<span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span> <span class="keyword1">⇒</span><span class="keyword3">/ </span><span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 81<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">⇒</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">V'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">MWLsSteps_ndet</span>"</span></span> <span class="main">|</span>
stepthreadi1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">ci</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">⟩</span> <span class="main">→⊲</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">⊳</span> <span class="main">⟨</span>None<span class="main">,</span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main">⟩</span> <span class="main">⟹</span>
  <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">ci</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ca</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">⇒</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ca</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span> <span class="main">|</span>
stepthreadi2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">ci</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">⟩</span> <span class="main">→⊲</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">⊳</span> <span class="main">⟨</span>Some <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m'</span></span></span><span class="main">⟩</span> <span class="main">⟹</span>
  <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">ci</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ca</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">⇒</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">ca</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">⟩</span></span>"</span></span>


<span class="comment1">― ‹lemma about existence and uniqueness of next memory of a step›</span>
<span class="keyword1"><span class="command">lemma</span></span> nextmem_exists_and_unique<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m'</span> <span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m'</span><span class="main">⟩</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m''</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m''</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">m''</span> <span class="main">=</span> <span class="bound">m'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLsSteps_det.skip MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">metis</span> MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> MWLsSteps_det.assign<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> MWLsSteps_det.seq1 MWLsSteps_det.seq2
    MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> not_Some_eq<span class="main"><span class="keyword3">,</span></span>
    <span class="operator">metis</span> MWLsSteps_det.iffalse MWLsSteps_det.iftrue
    MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">metis</span> MWLsSteps_det.whilefalse MWLsSteps_det.whiletrue
    MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">metis</span> MWLsSteps_det.spawn MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> PPsc_of_step<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="free">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="free">p</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span><span class="main">;</span> <span class="main">∃</span><span class="bound">c'</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> Some <span class="bound">c'</span> <span class="main">⟧</span>
  <span class="main">⟹</span> set <span class="main">(</span>PPc <span class="main">(</span>the <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> MWLsSteps_det.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> PPsα_of_step<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">c</span><span class="main">,</span><span class="free">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="free">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="free">p</span><span class="main">,</span><span class="free">m'</span><span class="main">⟩</span>
  <span class="main">⟹</span> set <span class="main">(</span>PPV <span class="free">α</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> MWLsSteps_det.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Parallel_Composition">
<div class="head">
<h1>Theory Parallel_Composition</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: WHATandWHERE-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Parallel_Composition
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Up_To_Technique.html">Up_To_Technique</a> <a href="MWLs.html">MWLs</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> WHATWHERE_Secure_Programs <span class="main">=</span>
L<span class="main">?</span> <span class="main">:</span> MWLs_semantics <span class="quoted"><span class="quoted">"<span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span>"</span></span>
<span class="main">+</span> WWs<span class="main">?</span> <span class="main">:</span> WHATWHERE <span class="quoted"><span class="quoted">"MWLsSteps_det"</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"pp"</span></span> <span class="quoted"><span class="quoted">"<span class="free">DA</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">lH</span>"</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Evalfunction"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">BMap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'val</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">DA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span>order<span class="main">)</span> DomainAssignment"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">lH</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> lHatches"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SdlHPPB_restricted_on_PP_is_SdlHPPB<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> SdlHPPB<span class="main">:</span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="free">d</span> <span class="free">PP</span> <span class="free">R'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inR'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">V</span><span class="main">,</span><span class="free">V</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Rdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V'</span><span class="main">,</span><span class="bound">V''</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">V'</span><span class="main">,</span><span class="bound">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span> 
    <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span>
    <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V''</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="free">d</span> <span class="free">PP</span> <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> SdlHPPB <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">R'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Rdef <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">R</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> SdlHPPB <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">R'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Rdef <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="free">R</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V'</span> <span class="skolem">V''</span>
  <span class="keyword3"><span class="command">assume</span></span> inR_part<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> SdlHPPB Rdef <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">V'</span> <span class="main">=</span> length <span class="skolem">V''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V'</span> <span class="skolem">V''</span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> inR_part<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> notIDC<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">¬</span> IDC <span class="free">d</span> <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> SdlHPPB inR_part irange Rdef 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"NDC <span class="free">d</span> <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V'</span> <span class="skolem">V''</span> <span class="skolem">i</span> <span class="skolem">α</span> <span class="skolem">p</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">m2</span>
  <span class="keyword3"><span class="command">assume</span></span> inR_part<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> dhequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main">,</span><span class="main">(</span>htchLocSet <span class="free">PP</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> inR_part SdlHPPB Rdef <span class="keyword1"><span class="command">have</span></span> eqlen<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">V'</span> <span class="main">=</span> length <span class="skolem">V''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> inR_part Rdef 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>PPV <span class="skolem">V'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> set <span class="main">(</span>PPV <span class="skolem">V''</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">with</span></span> irange PPc_in_PPV_version eqlen
  <span class="keyword1"><span class="command">have</span></span> PPc_Vs_at_i<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"set <span class="main">(</span>PPc <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> set <span class="main">(</span>PPc <span class="main">(</span><span class="skolem">V''</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subset_trans<span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> SdlHPPB inR_part Rdef irange step dhequal
    strongdlHPPB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">PP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">R'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">V'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">α'</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> stepreq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V''</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p'</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
    stepResultsinR <span class="skolem">p</span> <span class="skolem">p'</span> <span class="free">R'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="skolem">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span> <span class="main">∧</span>
    dhequality_alternative <span class="free">d</span> <span class="free">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="skolem">m2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Rpp'<span class="main">:</span> <span class="quoted"><span class="quoted">"stepResultsinR <span class="skolem">p</span> <span class="skolem">p'</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">c'</span>
      <span class="keyword3"><span class="command">assume</span></span> step1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span>Some <span class="skolem">c</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> step2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V''</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α'</span><span class="main">⊳</span> <span class="main">⟨</span>Some <span class="skolem">c'</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> inR'_res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">c</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R'</span>"</span></span>
      
      <span class="keyword1"><span class="command">from</span></span> PPc_Vs_at_i step1 step2 PPsc_of_step
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>PPc <span class="skolem">c</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> set <span class="main">(</span>PPc <span class="skolem">c'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> option.sel xt1<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
      
      <span class="keyword1"><span class="command">with</span></span> inR'_res Rdef <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">c</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>      
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> step stepResultsinR_def stepreq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
             
  <span class="keyword1"><span class="command">have</span></span> Rαα'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="skolem">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">from</span></span> PPc_Vs_at_i step stepreq PPsα_of_step <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"set <span class="main">(</span>PPV <span class="skolem">α</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> set <span class="main">(</span>PPV <span class="skolem">α'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> xt1<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> stepreq Rdef <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> stepreq Rpp' Rαα' <span class="keyword3"><span class="command">show</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V''</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
    stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span>
    dhequality_alternative <span class="free">d</span> <span class="free">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> parallel_composition<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">V</span><span class="main">.</span> WHATWHERE_Secure <span class="main">[</span><span class="free">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">;</span> unique_PPV <span class="free">V</span> <span class="main">⟧</span>
  <span class="main">⟹</span> WHATWHERE_Secure <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">V</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">PP</span>
  <span class="keyword1"><span class="command">from</span></span> WHATWHERE_empty 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="bound">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">V</span> <span class="skolem">d</span> <span class="skolem">PP</span>
  <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">V</span><span class="main">.</span>
    <span class="main">∀</span><span class="bound">d</span> <span class="bound">PP</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span><span class="main">.</span> SdlHPPB <span class="bound">d</span> <span class="bound">PP</span> <span class="bound">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">R</span><span class="main">;</span>
    unique_PPV <span class="skolem">V</span> <span class="main">⟧</span>
    <span class="main">⟹</span> <span class="main">∀</span><span class="bound">d</span> <span class="bound">PP</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span><span class="main">.</span> SdlHPPB <span class="bound">d</span> <span class="bound">PP</span> <span class="bound">R</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ISassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">V</span><span class="main">)</span><span class="main">.</span>
    <span class="main">∀</span><span class="bound">d</span> <span class="bound">PP</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span><span class="main">.</span> SdlHPPB <span class="bound">d</span> <span class="bound">PP</span> <span class="bound">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="skolem">c</span><span class="main">#</span><span class="skolem">V</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="main">(</span><span class="skolem">c</span><span class="main">#</span><span class="skolem">V</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> uniPPcV<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPV <span class="main">(</span><span class="skolem">c</span><span class="main">#</span><span class="skolem">V</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">hence</span></span> IHassump1<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPV <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPV_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> uniPPcV <span class="keyword1"><span class="command">have</span></span> nocommonPP<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>PPc <span class="skolem">c</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>PPV <span class="skolem">V</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPV_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> ISassump <span class="keyword1"><span class="command">have</span></span> IHassump2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">V</span><span class="main">.</span> 
    <span class="main">∀</span><span class="bound">d</span> <span class="bound">PP</span><span class="main">.</span> <span class="main">∃</span><span class="bound">R</span><span class="main">.</span> SdlHPPB <span class="bound">d</span> <span class="bound">PP</span> <span class="bound">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">with</span></span> IHassump1 IH <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">RV'</span></span> <span class="keyword2"><span class="keyword">where</span></span> RV'assump<span class="main">:</span>
    <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">RV'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">RV'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">RV</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RV</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V'</span><span class="main">,</span><span class="bound">V''</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">V'</span><span class="main">,</span><span class="bound">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">RV'</span> <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="skolem">V</span><span class="main">)</span>
    <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V''</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="skolem">V</span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">with</span></span> RV'assump RV_def SdlHPPB_restricted_on_PP_is_SdlHPPB
  <span class="keyword1"><span class="command">have</span></span> SdlHPPRV<span class="main">:</span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">RV</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">from</span></span> ISassump <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Rc'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Rc'assump<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">Rc'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Rc'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil drop_Nil neq0_conv not_Cons_self 
      nth_append_length Cons_nth_drop_Suc zero_less_Suc<span class="main">)</span>
 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Rc</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Rc</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V'</span><span class="main">,</span><span class="bound">V''</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">V'</span><span class="main">,</span><span class="bound">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Rc'</span> <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="skolem">c</span><span class="main">)</span>
    <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V''</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="skolem">c</span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">with</span></span> Rc'assump Rc_def SdlHPPB_restricted_on_PP_is_SdlHPPB
  <span class="keyword1"><span class="command">have</span></span> SdlHPPRc<span class="main">:</span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">Rc</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">from</span></span> nocommonPP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Domain <span class="skolem">RV</span> <span class="main">∩</span> Domain <span class="skolem">Rc</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RV_def Rc_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">metis</span> Int_mono inf_commute inf_idem le_bot nocommonPP unique_V_uneq<span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> commonArefl_subset_commonDomain
  <span class="keyword1"><span class="command">have</span></span> Areflassump1<span class="main">:</span> <span class="quoted"><span class="quoted">"Arefl <span class="skolem">RV</span> <span class="main">∩</span> Arefl <span class="skolem">Rc</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V'</span><span class="main">,</span><span class="bound">V''</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c</span> <span class="bound">c'</span> <span class="bound">W</span> <span class="bound">W'</span><span class="main">.</span> <span class="bound">V'</span> <span class="main">=</span> <span class="bound">c</span><span class="main">#</span><span class="bound">W</span> <span class="main">∧</span> <span class="bound">V''</span> <span class="main">=</span> <span class="bound">c'</span><span class="main">#</span><span class="bound">W'</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">≠</span> <span class="main">[]</span>
    <span class="main">∧</span> <span class="bound">W'</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="bound">c'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Rc</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">W</span><span class="main">,</span><span class="bound">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">RV</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">with</span></span> RV_def RV'assump Rc_def Rc'assump <span class="keyword1"><span class="command">have</span></span> inR<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">c</span><span class="main">#</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">c</span><span class="main">#</span><span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="keyword1"><span class="command">from</span></span> R_def Rc_def RV_def nocommonPP
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Domain <span class="skolem">R</span> <span class="main">∩</span> Domain <span class="main">(</span><span class="skolem">Rc</span> <span class="main">∪</span> <span class="skolem">RV</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def Rc_def RV_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">metis</span> inf_bot_right le_inf_iff subset_empty unique_V_uneq<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> inf_absorb1 inf_bot_right le_inf_iff unique_c_uneq<span class="main">)</span>
            
  <span class="keyword1"><span class="command">with</span></span> commonArefl_subset_commonDomain
  <span class="keyword1"><span class="command">have</span></span> Areflassump2<span class="main">:</span> <span class="quoted"><span class="quoted">"Arefl <span class="skolem">R</span> <span class="main">∩</span> Arefl <span class="main">(</span><span class="skolem">Rc</span> <span class="main">∪</span> <span class="skolem">RV</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> disjuptoR<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"disj_dlHPP_Bisimulation_Up_To_R' <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span><span class="skolem">Rc</span> <span class="main">∪</span> <span class="skolem">RV</span><span class="main">)</span> <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disj_dlHPP_Bisimulation_Up_To_R'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Areflassump1 SdlHPPRc SdlHPPRV Union_Strong_dlHPP_Bisim
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span><span class="skolem">Rc</span> <span class="main">∪</span> <span class="skolem">RV</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> SdlHPPRV <span class="keyword1"><span class="command">have</span></span> symRV<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">RV</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> SdlHPPRc <span class="keyword1"><span class="command">have</span></span> symRc<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">Rc</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> symRV R_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> SdlHPPRV <span class="keyword1"><span class="command">have</span></span> transRV<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="skolem">RV</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> SdlHPPRc <span class="keyword1"><span class="command">have</span></span> transRc<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="skolem">Rc</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="skolem">R</span>"</span></span>
           <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">V''</span>
            <span class="keyword3"><span class="command">assume</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">from</span></span> p1 R_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="skolem"><span class="skolem">W'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p1assump<span class="main">:</span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">#</span><span class="skolem">W</span> <span class="main">∧</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="skolem">c'</span><span class="main">#</span><span class="skolem">W'</span> <span class="main">∧</span> <span class="skolem">W</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">W'</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">[</span><span class="skolem">c</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Rc</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">RV</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> p2 R_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c''</span></span> <span class="skolem"><span class="skolem">W''</span></span> <span class="keyword2"><span class="keyword">where</span></span> p2assump<span class="main">:</span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> <span class="main">=</span> <span class="skolem">c''</span><span class="main">#</span><span class="skolem">W''</span> <span class="main">∧</span> <span class="skolem">W''</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">[</span><span class="skolem">c'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Rc</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">W'</span><span class="main">,</span><span class="skolem">W''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">RV</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> p1assump transRc transRV <span class="keyword1"><span class="command">have</span></span> 
                  trans_assump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">c</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Rc</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">W''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">RV</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> p1assump p2assump R_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
             <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
           <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> R_def SdlHPPRV <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">V</span> <span class="main">=</span> length <span class="skolem">V'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> notIDC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> IDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
          <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> inR R_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="skolem"><span class="skolem">W'</span></span> <span class="keyword2"><span class="keyword">where</span></span> VV'assump<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">#</span><span class="skolem">W</span> <span class="main">∧</span> <span class="skolem">V'</span><span class="main">=</span><span class="skolem">c'</span><span class="main">#</span><span class="skolem">W'</span> <span class="main">∧</span> <span class="skolem">W</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">W'</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">[</span><span class="skolem">c</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Rc</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">RV</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="comment1">― ‹Case separation for i›</span>
        <span class="keyword1"><span class="command">from</span></span> VV'assump SdlHPPRc <span class="keyword1"><span class="command">have</span></span> Case_i0<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>NDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∨</span>
            IDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> VV'assump SdlHPPRV <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">W</span><span class="main">.</span> 
          <span class="main">(</span>NDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">W</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∨</span>
            IDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">W</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="main">(</span><span class="skolem">W</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

        <span class="keyword1"><span class="command">with</span></span> irange VV'assump <span class="keyword1"><span class="command">have</span></span> Case_in0<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>NDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∨</span> 
          IDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> notIDC Case_i0 Case_in0 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"NDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">m2</span> <span class="skolem">α</span> <span class="skolem">p</span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> dhequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main">,</span><span class="main">(</span>htchLocSet <span class="skolem">PP</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>
        
        <span class="keyword1"><span class="command">from</span></span> inR R_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="skolem"><span class="skolem">W'</span></span> <span class="keyword2"><span class="keyword">where</span></span> VV'assump<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">#</span><span class="skolem">W</span> <span class="main">∧</span> <span class="skolem">V'</span><span class="main">=</span><span class="skolem">c'</span><span class="main">#</span><span class="skolem">W'</span> <span class="main">∧</span> <span class="skolem">W</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">W'</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">[</span><span class="skolem">c</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Rc</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">RV</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="comment1">― ‹Case separation for i›</span>
        <span class="keyword1"><span class="command">from</span></span> VV'assump SdlHPPRc strongdlHPPB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PP</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">Rc</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c'</span><span class="main">]</span>"</span></span><span class="main">]</span> step dhequal
        <span class="keyword1"><span class="command">have</span></span> Case_i0<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span>
          <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
          stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Rc</span> <span class="main">∪</span> <span class="skolem">RV</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Rc</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">RV</span><span class="main">)</span> <span class="main">∧</span>
          dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> step VV'assump irange <span class="keyword1"><span class="command">have</span></span> rewV<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">i</span><span class="main">-</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">W</span> <span class="main">∧</span> <span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="skolem">W</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span><span class="main">-</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">with</span></span> irange VV'assump step dhequal SdlHPPRV 
          strongdlHPPB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RV</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W'</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> Case_in0<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span>  <span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span>
          <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
          stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Rc</span> <span class="main">∪</span> <span class="skolem">RV</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Rc</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">RV</span><span class="main">)</span> <span class="main">∧</span>
          dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
        
        <span class="keyword1"><span class="command">from</span></span> Case_i0 Case_in0 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span>
          <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
          stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Rc</span> <span class="main">∪</span> <span class="skolem">RV</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Rc</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">RV</span><span class="main">)</span> <span class="main">∧</span>
          dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> Areflassump2 Rc'assump Up_To_Technique
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="bound">R</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c</span><span class="main">#</span><span class="skolem">V</span><span class="main">,</span> <span class="skolem">c</span><span class="main">#</span><span class="skolem">V</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnCI inR<span class="main">)</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="WHATWHERE_Secure_Skip_Assign">
<div class="head">
<h1>Theory WHATWHERE_Secure_Skip_Assign</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: WHATandWHERE-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> WHATWHERE_Secure_Skip_Assign
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Parallel_Composition.html">Parallel_Composition</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> WHATWHERE_Secure_Programs
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">NextMem'</span> 
<span class="main">(</span><span class="quoted">"<span class="keyword1">⟦</span>_<span class="keyword1">⟧'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟦</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">⟧(</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">≡</span> NextMem <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="comment1">― ‹define when two expressions are indistinguishable with respect to a domain d›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">d_indistinguishable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span><span class="main">::</span>order <span class="main">⇒</span> <span class="tfree">'exp</span> <span class="main">⇒</span> <span class="tfree">'exp</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">d_indistinguishable</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">m</span> <span class="bound">m'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">m</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">m'</span><span class="main">)</span> 
  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="bound">m'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">d_indistinguishable'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span> <span class="main">⇒</span> <span class="tfree">'d</span><span class="main">::</span>order <span class="main">⇒</span> <span class="tfree">'exp</span> <span class="main">⇒</span> bool"</span></span> 
<span class="main">(</span> <span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">≡<span class="hidden">⇘</span><sub></sub></span>_<span class="keyword1"><span class="hidden">⇙</span></span> _<span class="keyword3">)</span>"</span> <span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main"><span class="free">≡<span class="hidden">⇘</span><sub></sub></span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free"><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">≡</span> d_indistinguishable <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span>"</span></span>

<span class="comment1">― ‹symmetry of d-indistinguishable›</span>
<span class="keyword1"><span class="command">lemma</span></span> d_indistinguishable_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e'</span> <span class="main">⟹</span> <span class="free">e'</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_indistinguishable_def d_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="comment1">― ‹transitivity of d-indistinguishable›</span>
<span class="keyword1"><span class="command">lemma</span></span> d_indistinguishable_trans<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">e</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e'</span><span class="main">;</span> <span class="free">e'</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e''</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">e</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e''</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_indistinguishable_def d_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>


<span class="comment1">― ‹predicate for dH-indistinguishable›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dH_indistinguishable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'d</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> Hatches 
  <span class="main">⇒</span> <span class="tfree">'exp</span> <span class="main">⇒</span> <span class="tfree">'exp</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">dH_indistinguishable</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span> <span class="bound">m'</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">m'</span> 
  <span class="main">⟶</span> <span class="main">(</span><span class="free">E</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="bound">m</span> <span class="main">=</span> <span class="free">E</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="bound">m'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">dH_indistinguishable'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span> <span class="main">⇒</span> <span class="tfree">'d</span> 
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> Hatches <span class="main">⇒</span> <span class="tfree">'exp</span> <span class="main">⇒</span> bool"</span></span> 
<span class="main">(</span> <span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">≡<span class="hidden">⇘</span><sub></sub></span>_<span class="keyword1">,</span>_<span class="keyword1"><span class="hidden">⇙</span></span> _<span class="keyword3">)</span>"</span> <span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main"><span class="free">≡<span class="hidden">⇘</span><sub></sub></span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main"><span class="free"><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">≡</span> dH_indistinguishable <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> empH_implies_dHindistinguishable_eq_dindistinguishable<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main">,</span><span class="main">{}</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">e</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_indistinguishable_def dH_indistinguishable_def 
  dH_equal_def d_equal_def<span class="main">)</span>


<span class="keyword1"><span class="command">theorem</span></span> WHATWHERE_Secure_Skip<span class="main">:</span>
<span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">PP</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">::</span><span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLsCom list<span class="main">,</span><span class="bound">V'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLsCom list<span class="main">)</span><span class="main">.</span> 
    <span class="bound">V</span> <span class="main">=</span> <span class="bound">V'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def R_def sym_def trans_def
      NDC_def NextMem_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m1</span> <span class="skolem">m1'</span>
      <span class="keyword3"><span class="command">assume</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> nextm1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">m2</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m2</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> MWLsSteps_det.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span></span></span><span class="free"><span class="free"><span class="free">ι</span></span></span><span class="main"><span class="main"><span class="main"><span class="hidden">⇙</span></span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">m1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
          <span class="operator">force</span><span class="main">)</span>
    
      <span class="keyword1"><span class="command">have</span></span> nextm1'<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m1'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> MWLsSteps_det.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span></span></span><span class="free"><span class="free"><span class="free">ι</span></span></span><span class="main"><span class="main"><span class="main"><span class="hidden">⇙</span></span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">m1'</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
          <span class="operator">force</span><span class="main">)</span>
    
      <span class="keyword1"><span class="command">with</span></span> dequal nextm1 <span class="keyword3"><span class="command">show</span></span> 
        <span class="quoted"><span class="quoted">"<span class="keyword1">THE</span> <span class="bound">m2</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m2</span><span class="main">⟩</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span>
        <span class="keyword1">THE</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">m2</span> <span class="skolem">α</span>
       <span class="keyword3"><span class="command">assume</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main">,</span><span class="main">(</span>htchLocSet <span class="skolem">PP</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>
       <span class="keyword3"><span class="command">assume</span></span> skipstep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
       <span class="keyword1"><span class="command">with</span></span>  MWLsSteps_det.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span><span class="main">]</span> 
       <span class="keyword1"><span class="command">have</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> None <span class="main">∧</span> <span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span> <span class="main">∧</span> <span class="skolem">α</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">with</span></span> dequal skipstep MWLsSteps_det.skip
       <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">m2'</span><span class="main">.</span>
         <span class="main">⟨</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
         stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span> <span class="bound">V'</span><span class="main">)</span><span class="main">.</span> <span class="bound">V</span> <span class="main">=</span> <span class="bound">V'</span> <span class="main">∧</span> 
         <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span>
         <span class="main">(</span><span class="skolem">α</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">α</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
         dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="free">ι</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def dhequality_alternative_def<span class="main"><span class="keyword3">,</span></span> 
           <span class="operator">fastforce</span><span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>

     <span class="keyword1"><span class="command">with</span></span> inR <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="bound">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
 

<span class="comment1">― ‹auxiliary lemma for assign side condition (lemma 9 in original paper)›</span>
<span class="keyword1"><span class="command">lemma</span></span> semAssignSC_aux<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> dhind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="free">DA</span> <span class="free">x</span><span class="main">,</span><span class="main">(</span>htchLoc <span class="free">ι</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"NDC <span class="free">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">)</span> <span class="main">∨</span> IDC <span class="free">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">)</span> <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="main">(</span><span class="free">x</span><span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IDC_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NDC_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m1</span> <span class="skolem">m1'</span>
  <span class="keyword3"><span class="command">assume</span></span> dhequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main">,</span>htchLoc <span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> dequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dH_equal_def<span class="main">)</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> veq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="free">e</span> <span class="skolem">m1</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> m2eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m1</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NextMem_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">insert</span> MWLsSteps_det.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">x</span></span></span> <span class="main"><span class="main"><span class="main">:=<span class="hidden">⇘</span><sub></sub></span></span></span><span class="free"><span class="free"><span class="free">ι</span></span></span><span class="main"><span class="main"><span class="main"><span class="hidden">⇙</span></span></span></span> <span class="free"><span class="free"><span class="free">e</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">m1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">force</span><span class="main">)</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> v'eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="free">e</span> <span class="skolem">m1'</span> <span class="main">=</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> m2'eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m1'</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NextMem_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">insert</span> MWLsSteps_det.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">x</span></span></span> <span class="main"><span class="main"><span class="main">:=<span class="hidden">⇘</span><sub></sub></span></span></span><span class="free"><span class="free"><span class="free">ι</span></span></span><span class="main"><span class="main"><span class="main"><span class="hidden">⇙</span></span></span></span> <span class="free"><span class="free"><span class="free">e</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">m1'</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">force</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> dhequal <span class="keyword1"><span class="command">have</span></span> shiftdomain<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="free">DA</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> <span class="skolem">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free">DA</span> <span class="free">x</span><span class="main">,</span><span class="main">(</span>htchLoc <span class="free">ι</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dH_equal_def d_equal_def htchLoc_def<span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> veq v'eq dhind
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">DA</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟹</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">v'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dH_indistinguishable_def<span class="main">)</span> 

  <span class="keyword1"><span class="command">with</span></span> dequal m2eq m2'eq
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1</span><span class="main">)</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_equal_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> WHATWHERE_Secure_Assign<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dhind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="free">DA</span> <span class="free">x</span><span class="main">,</span><span class="main">(</span>htchLoc <span class="free">ι</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dheq_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="bound">m'</span> <span class="bound">d</span> <span class="bound">ι'</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="bound">d</span><span class="main">,</span><span class="main">(</span>htchLoc <span class="bound">ι'</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">m'</span> <span class="main">∧</span> 
  <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="bound">m</span><span class="main">)</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="bound">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="bound">m'</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟶</span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="bound">m</span><span class="main">)</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="bound">d</span><span class="main">,</span><span class="main">(</span>htchLoc <span class="bound">ι'</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="bound">m'</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">PP</span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">::</span><span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLsCom list<span class="main">,</span><span class="bound">V'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLsCom list<span class="main">)</span><span class="main">.</span> 
    <span class="bound">V</span> <span class="main">=</span> <span class="bound">V'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">]</span><span class="main">)</span><span class="main">}</span>"</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> inR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def R_def 
        sym_def trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> notIDC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> IDC <span class="skolem">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">)</span> <span class="main">(</span>htchLoc <span class="free">ι</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> dhind semAssignSC_aux
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"NDC <span class="skolem">d</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">m2</span> <span class="skolem">p</span> <span class="skolem">α</span>
      <span class="keyword3"><span class="command">assume</span></span> assignstep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> dhequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main">,</span>htchLocSet <span class="skolem">PP</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>
      
      <span class="keyword1"><span class="command">from</span></span> assignstep <span class="keyword1"><span class="command">have</span></span> nextm1<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> None <span class="main">∧</span> <span class="skolem">α</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NextMem_def<span class="main"><span class="keyword3">,</span></span> 
          <span class="operator">insert</span> MWLsSteps_det.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">x</span></span></span> <span class="main"><span class="main"><span class="main">:=<span class="hidden">⇘</span><sub></sub></span></span></span><span class="free"><span class="free"><span class="free">ι</span></span></span><span class="main"><span class="main"><span class="main"><span class="hidden">⇙</span></span></span></span> <span class="free"><span class="free"><span class="free">e</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">m1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
      
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> nextm1'<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="main">[]</span><span class="main">⊳</span> <span class="main">⟨</span>None<span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m2'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NextMem_def<span class="main"><span class="keyword3">,</span></span> 
          <span class="operator">insert</span> MWLsSteps_det.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">x</span></span></span> <span class="main"><span class="main"><span class="main">:=<span class="hidden">⇘</span><sub></sub></span></span></span><span class="free"><span class="free"><span class="free">ι</span></span></span><span class="main"><span class="main"><span class="main"><span class="hidden">⇙</span></span></span></span> <span class="free"><span class="free"><span class="free">e</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">m1'</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
      
      <span class="keyword1"><span class="command">from</span></span> dhequal <span class="keyword1"><span class="command">have</span></span> dhequal_ι<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ι</span><span class="main">.</span> htchLoc <span class="bound">ι</span> <span class="main">⊆</span> htchLocSet <span class="skolem">PP</span> 
        <span class="main">⟹</span> <span class="skolem">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main">,</span><span class="main">(</span>htchLoc <span class="bound">ι</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dH_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      
      <span class="keyword1"><span class="command">with</span></span> dhind semAssignSC_aux 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"htchLoc <span class="free">ι</span> <span class="main">⊆</span> htchLocSet <span class="skolem">PP</span> <span class="main">⟹</span> 
        <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1</span><span class="main">)</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NDC_def IDC_def dH_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
      
      <span class="keyword1"><span class="command">with</span></span> dhind dheq_imp dhequal_ι 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"htchLoc <span class="free">ι</span> <span class="main">⊆</span> htchLocSet <span class="skolem">PP</span> <span class="main">⟹</span> 
        <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1</span><span class="main">)</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main">,</span><span class="main">(</span>htchLocSet <span class="skolem">PP</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> htchLocSet_def dH_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      
      <span class="keyword1"><span class="command">with</span></span> nextm1 nextm1' assignstep dhequal
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">m2'</span><span class="main">.</span>
        <span class="main">⟨</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
        stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span> <span class="bound">V'</span><span class="main">)</span><span class="main">.</span> <span class="bound">V</span> <span class="main">=</span> <span class="bound">V'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">]</span><span class="main">)</span><span class="main">}</span> <span class="main">∧</span>
        <span class="main">(</span><span class="skolem">α</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">α</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="free">ι</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def dhequality_alternative_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">with</span></span> inR <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="bound">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="free">x</span><span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="free">x</span><span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Language_Composition">
<div class="head">
<h1>Theory Language_Composition</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: WHATandWHERE-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Language_Composition
<span class="keyword2"><span class="keyword">imports</span></span> <a href="WHATWHERE_Secure_Skip_Assign.html">WHATWHERE_Secure_Skip_Assign</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> WHATWHERE_Secure_Programs
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Compositionality_Seq<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> WWs_part1<span class="main">:</span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="free">c1</span><span class="main">]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> WWs_part2<span class="main">:</span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="free">c2</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uniPPc1c2<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="main">(</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">PP</span>

  <span class="keyword1"><span class="command">from</span></span> uniPPc1c2 <span class="keyword1"><span class="command">have</span></span> nocommonPP<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPV_def unique_PPc_def<span class="main">)</span>
    
  <span class="keyword1"><span class="command">from</span></span> WWs_part1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> R1'assump<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R1'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="free">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="free">c1</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R1</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1'</span> <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> 
    <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> R1'assump R1_def SdlHPPB_restricted_on_PP_is_SdlHPPB
  <span class="keyword1"><span class="command">have</span></span> SdlHPPR1<span class="main">:</span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    
  <span class="keyword1"><span class="command">from</span></span> WWs_part2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> R2'assump<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R2'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="free">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="free">c2</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R2</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2'</span> <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span> 
    <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> R2'assump R2_def SdlHPPB_restricted_on_PP_is_SdlHPPB
  <span class="keyword1"><span class="command">have</span></span> SdlHPPR2<span class="main">:</span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">from</span></span> nocommonPP <span class="keyword1"><span class="command">have</span></span> nocommonDomain<span class="main">:</span> <span class="quoted"><span class="quoted">"Domain <span class="skolem">R1</span> <span class="main">∩</span> Domain <span class="skolem">R2</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1_def R2_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">metis</span> inf_greatest inf_idem le_bot unique_V_uneq<span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> commonArefl_subset_commonDomain
  <span class="keyword1"><span class="command">have</span></span> Areflassump1<span class="main">:</span> <span class="quoted"><span class="quoted">"Arefl <span class="skolem">R1</span> <span class="main">∩</span> Arefl <span class="skolem">R2</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
     
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s1</span><span class="main">,</span><span class="bound">s2</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">c1</span> <span class="bound">c1'</span> <span class="bound">c2</span> <span class="bound">c2'</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="main">[</span><span class="bound">c1</span><span class="main">;</span><span class="bound">c2</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">s2</span> <span class="main">=</span> <span class="main">[</span><span class="bound">c1'</span><span class="main">;</span><span class="bound">c2'</span><span class="main">]</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">[</span><span class="bound">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="bound">c1'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="bound">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="bound">c2'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">with</span></span> R1_def R1'assump R2_def R2'assump 
  <span class="keyword1"><span class="command">have</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Domain <span class="skolem">R0</span> <span class="main">∩</span> Domain <span class="main">(</span><span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R0_def R1_def R2_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Int_absorb1 Int_assoc Int_empty_left 
      nocommonPP unique_c_uneq<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Int_absorb Int_absorb1 
      Int_assoc Int_empty_left nocommonPP unique_c_uneq<span class="main">)</span>
    
  <span class="keyword1"><span class="command">with</span></span> commonArefl_subset_commonDomain
  <span class="keyword1"><span class="command">have</span></span> Areflassump2<span class="main">:</span> <span class="quoted"><span class="quoted">"Arefl <span class="skolem">R0</span> <span class="main">∩</span> Arefl <span class="main">(</span><span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> disjuptoR0<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"disj_dlHPP_Bisimulation_Up_To_R' <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span><span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span><span class="main">)</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disj_dlHPP_Bisimulation_Up_To_R'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Areflassump1 SdlHPPR1 SdlHPPR2 Union_Strong_dlHPP_Bisim
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span><span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> SdlHPPR1 <span class="keyword1"><span class="command">have</span></span> symR1<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R1</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> SdlHPPR2 <span class="keyword1"><span class="command">have</span></span> symR2<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R2</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> symR1 R0_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> SdlHPPR1 <span class="keyword1"><span class="command">have</span></span> transR1<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="skolem">R1</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> SdlHPPR2 <span class="keyword1"><span class="command">have</span></span> transR2<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="skolem">R2</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="skolem">R0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">V''</span>
            <span class="keyword3"><span class="command">assume</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">from</span></span> p1 R0_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">c2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p1assump<span class="main">:</span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">;</span><span class="skolem">c2'</span><span class="main">]</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">[</span><span class="skolem">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> p2 R0_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1''</span></span> <span class="skolem"><span class="skolem">c2''</span></span> <span class="keyword2"><span class="keyword">where</span></span> p2assump<span class="main">:</span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1''</span><span class="main">;</span><span class="skolem">c2''</span><span class="main">]</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">with</span></span> p1assump transR1 transR2 <span class="keyword1"><span class="command">have</span></span> 
                  trans_assump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
                <span class="keyword1"><span class="command">with</span></span> p1assump p2assump R0_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
             <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> R0_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">V</span> <span class="main">=</span> length <span class="skolem">V'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> notIDC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> IDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> inR0 R0_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">c2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> VV'assump<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">;</span><span class="skolem">c2'</span><span class="main">]</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">[</span><span class="skolem">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> eqnextmem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">⟧(</span><span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟦</span><span class="skolem">c1</span><span class="main">⟧(</span><span class="bound">m</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
            <span class="keyword1"><span class="command">from</span></span> nextmem_exists_and_unique <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1nextmem<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="skolem">m'</span><span class="main">⟩</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m''</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m''</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">m''</span> <span class="main">=</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

            <span class="keyword1"><span class="command">hence</span></span> eqdir1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">c1</span><span class="main">⟧(</span><span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NextMem_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            
            <span class="keyword1"><span class="command">from</span></span> c1nextmem <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">m'</span><span class="main">⟩</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

            <span class="keyword1"><span class="command">with</span></span> c1nextmem <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="skolem">m'</span><span class="main">⟩</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m''</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m''</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">m''</span> <span class="main">=</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLsSteps_det.seq1 MWLsSteps_det.seq2 
                option.exhaust<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
                            
            <span class="keyword1"><span class="command">hence</span></span> eqdir2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">⟧(</span><span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NextMem_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

            <span class="keyword1"><span class="command">with</span></span> eqdir1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">⟧(</span><span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟦</span><span class="skolem">c1</span><span class="main">⟧(</span><span class="skolem">m</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
            
        <span class="keyword1"><span class="command">have</span></span> eqpp<span class="main">:</span> <span class="quoted"><span class="quoted">"pp <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span> <span class="main">=</span> pp <span class="skolem">c1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> VV'assump SdlHPPR1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IDC <span class="skolem">d</span> <span class="skolem">c1</span> <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="skolem">c1</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∨</span> NDC <span class="skolem">d</span> <span class="skolem">c1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> eqnextmem eqpp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span>
          <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> NDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IDC_def NDC_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> inR0 irange notIDC VV'assump
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"NDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IDC_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">m2</span> <span class="skolem">α</span> <span class="skolem">p</span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> dhequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main">,</span>htchLocSet <span class="skolem">PP</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>

        <span class="keyword1"><span class="command">from</span></span> inR0 R0_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="skolem"><span class="skolem">c2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> R0pair<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">;</span><span class="skolem">c2'</span><span class="main">]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span>
          <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
       <span class="keyword1"><span class="command">from</span></span> R0pair irange <span class="keyword1"><span class="command">have</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

       <span class="keyword1"><span class="command">have</span></span> eqpp<span class="main">:</span> <span class="quoted"><span class="quoted">"pp <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span> <span class="main">=</span> pp <span class="skolem">c1</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="comment1">― ‹get the two different cases:›</span>
        <span class="keyword1"><span class="command">from</span></span> R0pair step i0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c3</span></span> <span class="keyword2"><span class="keyword">where</span></span> case_distinction<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> Some <span class="skolem">c2</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span>None<span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span><span class="main">)</span>
          <span class="main">∨</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">c3</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span>Some <span class="skolem">c3</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> MWLsSteps_det.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">c1</span></span></span><span class="main"><span class="main"><span class="main">;</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">c2</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">m1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="comment1">― ‹Case 1: first command terminates›</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> passump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Some <span class="skolem">c2</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> StepAssump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span>None<span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> Vstep_case1<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span>Some <span class="skolem">c2</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLsSteps_det.seq1<span class="main">)</span>
          
          <span class="keyword1"><span class="command">from</span></span> SdlHPPR1 StepAssump R0pair dhequal
            strongdlHPPB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PP</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">R1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"None"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">α'</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1c1'reason<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> None <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c1'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p'</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="skolem">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∧</span> 
            dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="skolem">c1</span><span class="main">)</span> <span class="skolem">m2</span> <span class="skolem">m2'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
 
          <span class="keyword1"><span class="command">with</span></span> eqpp c1c1'reason <span class="keyword1"><span class="command">have</span></span> conclpart<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1'</span><span class="main">;</span><span class="skolem">c2'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α'</span><span class="main">⊳</span> <span class="main">⟨</span>Some <span class="skolem">c2'</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> 
            dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="skolem">m2'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLsSteps_det.seq1<span class="main">)</span>

          <span class="keyword1"><span class="command">with</span></span> passump R0pair c1c1'reason i0
          <span class="keyword1"><span class="command">have</span></span> case1_concl<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span>
             <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
             stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span><span class="main">)</span> <span class="main">∧</span>
             dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="comment1">― ‹Case 2: first command does not terminate›</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> passump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">c3</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> StepAssump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span>Some <span class="skolem">c3</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>

          <span class="keyword1"><span class="command">hence</span></span> Vstep_case2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span>Some <span class="main">(</span><span class="skolem">c3</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLsSteps_det.seq2<span class="main">)</span>

          <span class="keyword1"><span class="command">from</span></span> SdlHPPR1 StepAssump R0pair dhequal
            strongdlHPPB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PP</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">R1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"Some <span class="skolem">c3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">c3'</span></span> <span class="skolem"><span class="skolem">α'</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1c1'reason<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> Some <span class="skolem">c3'</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c1'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p'</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">[</span><span class="skolem">c3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c3'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="skolem">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∧</span>
            dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="skolem">c1</span><span class="main">)</span> <span class="skolem">m2</span> <span class="skolem">m2'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

          <span class="keyword1"><span class="command">with</span></span> eqpp c1c1'reason <span class="keyword1"><span class="command">have</span></span> conclpart<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1'</span><span class="main">;</span><span class="skolem">c2'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α'</span><span class="main">⊳</span> <span class="main">⟨</span>Some <span class="main">(</span><span class="skolem">c3'</span><span class="main">;</span><span class="skolem">c2'</span><span class="main">)</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> 
            dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="skolem">m2'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLsSteps_det.seq2<span class="main">)</span>

          <span class="keyword1"><span class="command">from</span></span> c1c1'reason R0pair R0_def <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">c3</span><span class="main">;</span><span class="skolem">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c3'</span><span class="main">;</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          
          <span class="keyword1"><span class="command">with</span></span> R0pair conclpart passump c1c1'reason i0
          <span class="keyword1"><span class="command">have</span></span> case1_concl<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
            stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span><span class="main">)</span> <span class="main">∧</span>
            dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
             stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span><span class="main">)</span> <span class="main">∧</span>
             dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
        
  <span class="keyword1"><span class="command">with</span></span> inR0 Areflassump2 Up_To_Technique
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">with</span></span> inR0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="bound">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="free">c1</span><span class="main">;</span><span class="free">c2</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> Compositionality_Spawn<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> WWs_threads<span class="main">:</span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uniPPspawn<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="main">(</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">V</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">PP</span>
    
  <span class="keyword1"><span class="command">from</span></span> uniPPspawn <span class="keyword1"><span class="command">have</span></span> pp_difference<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∉</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPc_def<span class="main">)</span>
  
  <span class="comment1">― ‹Step 1›</span>
  <span class="keyword1"><span class="command">from</span></span> WWs_threads <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R'</span></span> <span class="keyword2"><span class="keyword">where</span></span> R'assump<span class="main">:</span>
    <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">V</span><span class="main">,</span><span class="free">V</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V'</span><span class="main">,</span><span class="bound">V''</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">V'</span><span class="main">,</span><span class="bound">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R'</span> <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span>
    <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V''</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> R'assump R_def SdlHPPB_restricted_on_PP_is_SdlHPPB
  <span class="keyword1"><span class="command">have</span></span> SdlHPPR<span class="main">:</span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="comment1">― ‹Step 2›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">sp1</span><span class="main">,</span><span class="bound">sp2</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ι'</span> <span class="bound">ι''</span> <span class="bound">V'</span> <span class="bound">V''</span><span class="main">.</span> 
    <span class="bound">sp1</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="bound">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">V'</span><span class="main">]</span> <span class="main">∧</span> <span class="bound">sp2</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="bound">ι''</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">V''</span><span class="main">]</span>
    <span class="main">∧</span> <span class="bound">ι'</span> <span class="main">∉</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">ι''</span> <span class="main">∉</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V'</span><span class="main">,</span><span class="bound">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">with</span></span> R_def R'assump pp_difference <span class="keyword1"><span class="command">have</span></span> inR0<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">V</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">V</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="comment1">― ‹Step 3›</span>
  <span class="keyword1"><span class="command">from</span></span> R0_def R_def R'assump <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Domain <span class="skolem">R0</span> <span class="main">∩</span> Domain <span class="skolem">R</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">with</span></span> commonArefl_subset_commonDomain
  <span class="keyword1"><span class="command">have</span></span> Areflassump<span class="main">:</span> <span class="quoted"><span class="quoted">"Arefl <span class="skolem">R0</span> <span class="main">∩</span> Arefl <span class="skolem">R</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  
  <span class="comment1">― ‹Step 4›</span>
  <span class="keyword1"><span class="command">have</span></span> disjuptoR0<span class="main">:</span>
    <span class="quoted"><span class="quoted">"disj_dlHPP_Bisimulation_Up_To_R' <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disj_dlHPP_Bisimulation_Up_To_R'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> SdlHPPR <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> SdlHPPR <span class="keyword1"><span class="command">have</span></span> symR<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> R0_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>  
      <span class="keyword1"><span class="command">from</span></span> SdlHPPR <span class="keyword1"><span class="command">have</span></span> transR<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="skolem">R</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> R0_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="skolem">R0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V1</span> <span class="skolem">V2</span> <span class="skolem">V3</span>
          <span class="keyword3"><span class="command">assume</span></span> inR1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V1</span><span class="main">,</span><span class="skolem">V2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> inR2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V2</span><span class="main">,</span><span class="skolem">V3</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> inR1 R0_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="skolem"><span class="skolem">W'</span></span> <span class="skolem"><span class="skolem">ι</span></span> <span class="skolem"><span class="skolem">ι'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V1</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">W</span><span class="main">]</span> 
            <span class="main">∧</span> <span class="skolem">V2</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">W'</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">ι</span> <span class="main">∉</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ι'</span> <span class="main">∉</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span>
            <span class="main">∧</span> <span class="main">(</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">W'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> inR2 R0_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W''</span></span> <span class="skolem"><span class="skolem">ι''</span></span> <span class="keyword2"><span class="keyword">where</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V3</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι''</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">W''</span><span class="main">]</span>
            <span class="main">∧</span> <span class="skolem">ι''</span> <span class="main">∉</span> set <span class="main">(</span>PPV <span class="free">V</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">W'</span><span class="main">,</span><span class="skolem">W''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> p1 p2 transR <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">W</span><span class="main">,</span><span class="skolem">W''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trans_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> p1 p2 R0_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V1</span><span class="main">,</span><span class="skolem">V3</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V'</span> <span class="skolem">V''</span>
      <span class="keyword1"><span class="command">from</span></span> SdlHPPR <span class="keyword1"><span class="command">have</span></span> eqlenR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">⟹</span> length <span class="skolem">V'</span> <span class="main">=</span> length <span class="skolem">V''</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> R0_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">⟹</span> length <span class="skolem">V'</span> <span class="main">=</span> length <span class="skolem">V''</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V'</span> <span class="skolem">V''</span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> inR0 R0_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι'</span></span> <span class="skolem"><span class="skolem">ι''</span></span> <span class="skolem"><span class="skolem">W'</span></span> <span class="skolem"><span class="skolem">W''</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> R0pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">W'</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">V''</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι''</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">W''</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
        <span class="keyword1"><span class="command">from</span></span> nextmem_exists_and_unique <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> spawnnextmem<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">W'</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="skolem">m'</span><span class="main">⟩</span> 
          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m''</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">W'</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m''</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">m''</span> <span class="main">=</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">m'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MWLsSteps_det.spawn<span class="main">)</span>

        <span class="keyword1"><span class="command">with</span></span> spawnnextmem <span class="keyword1"><span class="command">have</span></span> eqnextmem<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">W'</span><span class="main">⟧(</span><span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NextMem_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>

      <span class="keyword1"><span class="command">with</span></span> R0pair irange <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"NDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NDC_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V'</span> <span class="skolem">V''</span> <span class="skolem">i</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">m2</span> <span class="skolem">α</span> <span class="skolem">p</span>
      <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V'</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> dhequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main">,</span>htchLocSet <span class="skolem">PP</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> inR0 R0_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι'</span></span> <span class="skolem"><span class="skolem">ι''</span></span> <span class="skolem"><span class="skolem">W'</span></span> <span class="skolem"><span class="skolem">W''</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> R0pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">W'</span><span class="main">]</span> 
        <span class="main">∧</span> <span class="skolem">V''</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι''</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">W''</span><span class="main">]</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">W'</span><span class="main">,</span><span class="skolem">W''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
      <span class="keyword1"><span class="command">with</span></span> step irange
      <span class="keyword1"><span class="command">have</span></span> conc_step1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="skolem">W'</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">=</span> None <span class="main">∧</span> <span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
        
      <span class="keyword1"><span class="command">from</span></span> R0pair irange 
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">α'</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> conc_step2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V''</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p'</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span>
        <span class="main">∧</span> <span class="skolem">p'</span> <span class="main">=</span> None <span class="main">∧</span> <span class="skolem">α'</span> <span class="main">=</span> <span class="skolem">W''</span> <span class="main">∧</span> <span class="skolem">m2'</span> <span class="main">=</span> <span class="skolem">m1'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLsSteps_det.spawn<span class="main">)</span> 
     
      <span class="keyword1"><span class="command">with</span></span> R0pair conc_step1 dhequal irange
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V''</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
        stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
        dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def 
          dhequality_alternative_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>       
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="comment1">― ‹Step 5›</span>
  <span class="keyword1"><span class="command">with</span></span> Areflassump Up_To_Technique
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
  <span class="keyword1"><span class="command">with</span></span> inR0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="bound">R</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">V</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">V</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> Compositionality_If<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="free">b</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="bound">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> WWs_branch1<span class="main">:</span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="free">c1</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> WWs_branch2<span class="main">:</span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="free">c2</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uniPPif<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="main">(</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span> <span class="keyword1">fi</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span> <span class="keyword1">fi</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">PP</span>
  <span class="keyword1"><span class="command">from</span></span> uniPPif <span class="keyword1"><span class="command">have</span></span> nocommonPP<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPc_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> uniPPif <span class="keyword1"><span class="command">have</span></span> pp_difference<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPc_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> WWs_branch1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> R1'assump<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R1'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="free">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="free">c1</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R1</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1'</span> <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> 
    <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> R1'assump R1_def SdlHPPB_restricted_on_PP_is_SdlHPPB
  <span class="keyword1"><span class="command">have</span></span> SdlHPPR1<span class="main">:</span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    
  <span class="keyword1"><span class="command">from</span></span> WWs_branch2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> R2'assump<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R2'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="free">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="free">c2</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R2</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2'</span> <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span> 
    <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> R2'assump R2_def SdlHPPB_restricted_on_PP_is_SdlHPPB
  <span class="keyword1"><span class="command">have</span></span> SdlHPPR2<span class="main">:</span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">from</span></span> nocommonPP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Domain <span class="skolem">R1</span> <span class="main">∩</span> Domain <span class="skolem">R2</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>

    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R1_def R2_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">metis</span> empty_subsetI inf_idem inf_mono set_eq_subset unique_V_uneq<span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> commonArefl_subset_commonDomain
  <span class="keyword1"><span class="command">have</span></span> Areflassump1<span class="main">:</span> <span class="quoted"><span class="quoted">"Arefl <span class="skolem">R1</span> <span class="main">∩</span> Arefl <span class="skolem">R2</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    
  <span class="keyword1"><span class="command">with</span></span> SdlHPPR1 SdlHPPR2 Union_Strong_dlHPP_Bisim <span class="keyword1"><span class="command">have</span></span> SdlHPPR1R2<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span><span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">}</span>"</span></span>
  
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">i1</span><span class="main">,</span><span class="bound">i2</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ι'</span> <span class="bound">ι''</span> <span class="bound">b'</span> <span class="bound">b''</span> <span class="bound">c1'</span> <span class="bound">c1''</span> <span class="bound">c2'</span> <span class="bound">c2''</span><span class="main">.</span> 
    <span class="bound">i1</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="bound">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">b'</span> <span class="keyword1">then</span> <span class="bound">c1'</span> <span class="keyword1">else</span> <span class="bound">c2'</span> <span class="keyword1">fi</span><span class="main">]</span>
    <span class="main">∧</span> <span class="bound">i2</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="bound">ι''</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">b''</span> <span class="keyword1">then</span> <span class="bound">c1''</span> <span class="keyword1">else</span> <span class="bound">c2''</span> <span class="keyword1">fi</span><span class="main">]</span> 
    <span class="main">∧</span> <span class="bound">ι'</span> <span class="main">∉</span> <span class="main">(</span>set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="bound">ι''</span> <span class="main">∉</span> <span class="main">(</span>set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="bound">c1'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="bound">c1''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="bound">c2'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="bound">c2''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> <span class="main">∧</span> <span class="bound">b'</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">b''</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">with</span></span> R_def R1_def R1'assump R2_def R2'assump pp_difference dind
  <span class="keyword1"><span class="command">have</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span> <span class="keyword1">fi</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span> <span class="keyword1">fi</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> R0_def R_def R1_def R2_def
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Domain <span class="skolem">R0</span> <span class="main">∩</span> Domain <span class="skolem">R</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="keyword1"><span class="command">with</span></span> commonArefl_subset_commonDomain
  <span class="keyword1"><span class="command">have</span></span> Areflassump2<span class="main">:</span> <span class="quoted"><span class="quoted">"Arefl <span class="skolem">R0</span> <span class="main">∩</span> Arefl <span class="skolem">R</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  
  <span class="keyword1"><span class="command">have</span></span> disjuptoR0<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"disj_dlHPP_Bisimulation_Up_To_R' <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R</span> <span class="skolem">R0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disj_dlHPP_Bisimulation_Up_To_R'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> SdlHPPR1R2 adding_emptypair_keeps_SdlHPPB
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> SdlHPPR1 <span class="keyword1"><span class="command">have</span></span> symR1<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> SdlHPPR2 <span class="keyword1"><span class="command">have</span></span> symR2<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> symR1 symR2 d_indistinguishable_sym R0_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> SdlHPPR1 <span class="keyword1"><span class="command">have</span></span> transR1<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="skolem">R1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> SdlHPPR2 <span class="keyword1"><span class="command">have</span></span> transR2<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="skolem">R2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="skolem">R0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>  <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V'</span> <span class="skolem">V''</span> <span class="skolem">V'''</span>
            <span class="keyword3"><span class="command">assume</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V''</span><span class="main">,</span><span class="skolem">V'''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
            
            <span class="keyword1"><span class="command">from</span></span> p1 R0_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι'</span></span> <span class="skolem"><span class="skolem">ι''</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">b''</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">c1''</span></span> <span class="skolem"><span class="skolem">c2'</span></span> <span class="skolem"><span class="skolem">c2''</span></span> <span class="keyword2"><span class="keyword">where</span></span>
              passump1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">then</span> <span class="skolem">c1'</span> <span class="keyword1">else</span> <span class="skolem">c2'</span> <span class="keyword1">fi</span><span class="main">]</span>
              <span class="main">∧</span> <span class="skolem">V''</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι''</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span> <span class="keyword1">then</span> <span class="skolem">c1''</span> <span class="keyword1">else</span> <span class="skolem">c2''</span> <span class="keyword1">fi</span><span class="main">]</span>
              <span class="main">∧</span> <span class="skolem">ι'</span> <span class="main">∉</span> <span class="main">(</span>set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∧</span> <span class="skolem">ι''</span> <span class="main">∉</span> <span class="main">(</span>set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> 
              <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

            <span class="keyword1"><span class="command">with</span></span> p2 R0_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι'''</span></span> <span class="skolem"><span class="skolem">b'''</span></span> <span class="skolem"><span class="skolem">c1'''</span></span> <span class="skolem"><span class="skolem">c2'''</span></span> <span class="keyword2"><span class="keyword">where</span></span>
              passump2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'''</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'''</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'''</span> <span class="keyword1">then</span> <span class="skolem">c1'''</span> <span class="keyword1">else</span> <span class="skolem">c2'''</span> <span class="keyword1">fi</span><span class="main">]</span>
              <span class="main">∧</span> <span class="skolem">ι'''</span> <span class="main">∉</span> <span class="main">(</span>set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c1''</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1'''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2''</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2'''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> 
              <span class="main">∧</span> <span class="skolem">b''</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'''</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

            <span class="keyword1"><span class="command">with</span></span> passump1 transR1 transR2 d_indistinguishable_trans
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1'''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2'''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span> 
              <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'''</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> transD<span class="main">)</span>

            <span class="keyword1"><span class="command">with</span></span> passump1 passump2 R0_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V'''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span>
      <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> R0_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">V</span> <span class="main">=</span> length <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V'</span> <span class="skolem">V''</span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V'</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> notIDC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> IDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> inR0 R0_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι'</span></span> <span class="skolem"><span class="skolem">ι''</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">b''</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">c1''</span></span> <span class="skolem"><span class="skolem">c2'</span></span> <span class="skolem"><span class="skolem">c2''</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> R0pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">then</span> <span class="skolem">c1'</span> <span class="keyword1">else</span> <span class="skolem">c2'</span> <span class="keyword1">fi</span><span class="main">]</span> 
        <span class="main">∧</span> <span class="skolem">V''</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι''</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span> <span class="keyword1">then</span> <span class="skolem">c1''</span> <span class="keyword1">else</span> <span class="skolem">c2''</span> <span class="keyword1">fi</span><span class="main">]</span>
        <span class="main">∧</span> <span class="skolem">ι'</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="skolem">ι''</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>
        <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"NDC <span class="skolem">d</span> <span class="main">(</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">then</span> <span class="skolem">c1'</span> <span class="keyword1">else</span> <span class="skolem">c2'</span> <span class="keyword1">fi</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
            <span class="keyword1"><span class="command">from</span></span> nextmem_exists_and_unique <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> ifnextmem<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">then</span> <span class="skolem">c1'</span> <span class="keyword1">else</span> <span class="skolem">c2'</span> <span class="keyword1">fi</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">m'</span><span class="main">⟩</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m''</span><span class="main">.</span><span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span><span class="main">⟨</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">then</span> <span class="skolem">c1'</span> <span class="keyword1">else</span> <span class="skolem">c2'</span> <span class="keyword1">fi</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m''</span><span class="main">⟩</span><span class="main">)</span> 
              <span class="main">⟶</span> <span class="bound">m''</span> <span class="main">=</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">m'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MWLsSteps_det.iffalse MWLsSteps_det.iftrue<span class="main">)</span>
            
            <span class="keyword1"><span class="command">with</span></span> ifnextmem <span class="keyword1"><span class="command">have</span></span> eqnextmem<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">then</span> <span class="skolem">c1'</span> <span class="keyword1">else</span> <span class="skolem">c2'</span> <span class="keyword1">fi</span><span class="main">⟧(</span><span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NextMem_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NDC_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">with</span></span> R0pair irange <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"NDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V'</span> <span class="skolem">V''</span> <span class="skolem">i</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">m2</span> <span class="skolem">α</span> <span class="skolem">p</span> 
      <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V'</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> dhequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main">,</span>htchLocSet <span class="skolem">PP</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> inR0 R0_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι'</span></span> <span class="skolem"><span class="skolem">ι''</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">b''</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">c1''</span></span> <span class="skolem"><span class="skolem">c2'</span></span> <span class="skolem"><span class="skolem">c2''</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> R0pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">then</span> <span class="skolem">c1'</span> <span class="keyword1">else</span> <span class="skolem">c2'</span> <span class="keyword1">fi</span><span class="main">]</span> 
        <span class="main">∧</span> <span class="skolem">V''</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι''</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span> <span class="keyword1">then</span> <span class="skolem">c1''</span> <span class="keyword1">else</span> <span class="skolem">c2''</span> <span class="keyword1">fi</span><span class="main">]</span>
        <span class="main">∧</span> <span class="skolem">ι'</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="skolem">ι''</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c1</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>PPc <span class="free">c2</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>
        <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

      <span class="keyword1"><span class="command">with</span></span> R0pair irange step <span class="keyword1"><span class="command">have</span></span> case_distinction<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> Some <span class="skolem">c1'</span> <span class="main">∧</span> <span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b'</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> True<span class="main">)</span>
        <span class="main">∨</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> Some <span class="skolem">c2'</span> <span class="main">∧</span> <span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b'</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> False<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="comment1">― ‹Case 1: b evaluates to True›</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> passump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Some <span class="skolem">c1'</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b'</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> True"</span></span>

        <span class="keyword1"><span class="command">from</span></span> R0pair step irange <span class="keyword1"><span class="command">have</span></span> stepconcl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLs_semantics.MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
          
        <span class="keyword1"><span class="command">from</span></span> eval R0pair dhequal <span class="keyword1"><span class="command">have</span></span> eval'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b''</span> <span class="skolem">m1'</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_indistinguishable_def dH_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

        <span class="keyword1"><span class="command">hence</span></span> step'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι''</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span> <span class="keyword1">then</span> <span class="skolem">c1''</span> <span class="keyword1">else</span> <span class="skolem">c2''</span> <span class="keyword1">fi</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="main">[]</span><span class="main">⊳</span> 
          <span class="main">⟨</span>Some <span class="skolem">c1''</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLsSteps_det.iftrue<span class="main">)</span>

        <span class="keyword1"><span class="command">with</span></span> passump R0pair R_def dhequal stepconcl irange
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V''</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
        stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
        dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def dhequality_alternative_def<span class="main"><span class="keyword3">,</span></span> 
            <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="comment1">― ‹Case 2: b evaluates to False›</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> passump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Some <span class="skolem">c2'</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b'</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> False"</span></span>

        <span class="keyword1"><span class="command">from</span></span> R0pair step irange <span class="keyword1"><span class="command">have</span></span> stepconcl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLs_semantics.MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> eval R0pair dhequal <span class="keyword1"><span class="command">have</span></span> eval'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b''</span> <span class="skolem">m1'</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_indistinguishable_def dH_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

        <span class="keyword1"><span class="command">hence</span></span> step'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι''</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span> <span class="keyword1">then</span> <span class="skolem">c1''</span> <span class="keyword1">else</span> <span class="skolem">c2''</span> <span class="keyword1">fi</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="main">[]</span><span class="main">⊳</span> 
          <span class="main">⟨</span>Some <span class="skolem">c2''</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLsSteps_det.iffalse<span class="main">)</span>

        <span class="keyword1"><span class="command">with</span></span> passump R0pair R_def dhequal stepconcl irange
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V''</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
        stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
        dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def dhequality_alternative_def<span class="main"><span class="keyword3">,</span></span> 
            <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V''</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
        stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
        dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
      
  <span class="keyword1"><span class="command">with</span></span> Areflassump2 Up_To_Technique
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">with</span></span> inR0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="bound">R</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span> <span class="keyword1">fi</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">c1</span> <span class="keyword1">else</span> <span class="free">c2</span> <span class="keyword1">fi</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Compositionality_While<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="free">b</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="bound">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> WWs_body<span class="main">:</span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="free">c</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uniPPwhile<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">c</span> <span class="keyword1">od</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">c</span> <span class="keyword1">od</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">PP</span> 
  
  <span class="keyword1"><span class="command">from</span></span> uniPPwhile <span class="keyword1"><span class="command">have</span></span> pp_difference<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ι</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPc_def<span class="main">)</span>
   
  <span class="keyword1"><span class="command">from</span></span> WWs_body <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R'</span></span> <span class="keyword2"><span class="keyword">where</span></span> R'assump<span class="main">:</span>
    <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="comment1">― ‹add the empty pair because it is needed later in the proof›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R'</span> <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> <span class="main">∧</span>
    set <span class="main">(</span>PPV <span class="bound">V'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">}</span>"</span></span>
  
  <span class="keyword1"><span class="command">with</span></span> R'assump SdlHPPB_restricted_on_PP_is_SdlHPPB 
    adding_emptypair_keeps_SdlHPPB
  <span class="keyword1"><span class="command">have</span></span> SdlHPPR<span class="main">:</span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword1"><span class="command">from</span></span> R'assump SdlHPPB_restricted_on_PP_is_SdlHPPB <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> 
          <span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R'</span> <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> <span class="main">∧</span>
          set <span class="main">(</span>PPV <span class="bound">V'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

      <span class="keyword1"><span class="command">with</span></span> adding_emptypair_keeps_SdlHPPB <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> 
          <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R'</span> <span class="main">∧</span> set <span class="main">(</span>PPV <span class="bound">V</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> <span class="main">∧</span>
          set <span class="main">(</span>PPV <span class="bound">V'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">with</span></span> R_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R1</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">w1</span><span class="main">,</span><span class="bound">w2</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ι</span> <span class="bound">ι'</span> <span class="bound">b</span> <span class="bound">b'</span> <span class="bound">c1</span> <span class="bound">c1'</span> <span class="bound">c2</span> <span class="bound">c2'</span><span class="main">.</span> 
    <span class="bound">w1</span> <span class="main">=</span> <span class="main">[</span><span class="bound">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="bound">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">b</span> <span class="keyword1">do</span> <span class="bound">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span>
    <span class="main">∧</span> <span class="bound">w2</span> <span class="main">=</span> <span class="main">[</span><span class="bound">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="bound">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">b'</span> <span class="keyword1">do</span> <span class="bound">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span> 
    <span class="main">∧</span> <span class="bound">ι</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">ι'</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="bound">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="bound">c1'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="bound">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="bound">c2'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>
    <span class="main">∧</span> <span class="bound">b</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">b'</span><span class="main">}</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R2</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">w1</span><span class="main">,</span><span class="bound">w2</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ι</span> <span class="bound">ι'</span> <span class="bound">b</span> <span class="bound">b'</span> <span class="bound">c1</span> <span class="bound">c1'</span><span class="main">.</span> 
    <span class="bound">w1</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="bound">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">b</span> <span class="keyword1">do</span> <span class="bound">c1</span> <span class="keyword1">od</span><span class="main">]</span>
    <span class="main">∧</span> <span class="bound">w2</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="bound">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">b'</span> <span class="keyword1">do</span> <span class="bound">c1'</span> <span class="keyword1">od</span><span class="main">]</span> 
    <span class="main">∧</span> <span class="bound">ι</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">ι'</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">[</span><span class="bound">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="bound">c1'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">b'</span><span class="main">}</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R0</span> <span class="main">=</span> <span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span>"</span></span> 

  <span class="keyword1"><span class="command">from</span></span> R2_def R_def R'assump pp_difference dind
  <span class="keyword1"><span class="command">have</span></span> inR2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">c</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">c</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> R0_def R1_def R2_def R_def R'assump <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"Domain <span class="skolem">R0</span> <span class="main">∩</span> Domain <span class="skolem">R</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">with</span></span> commonArefl_subset_commonDomain
  <span class="keyword1"><span class="command">have</span></span> Areflassump<span class="main">:</span> <span class="quoted"><span class="quoted">"Arefl <span class="skolem">R0</span> <span class="main">∩</span> Arefl <span class="skolem">R</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="comment1">― ‹show some facts about R1 and R2 needed later in the proof at several positions›</span>
  <span class="keyword1"><span class="command">from</span></span> SdlHPPR <span class="keyword1"><span class="command">have</span></span> symR<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> symR R1_def d_indistinguishable_sym <span class="keyword1"><span class="command">have</span></span> symR1<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> symR R2_def d_indistinguishable_sym <span class="keyword1"><span class="command">have</span></span> symR2<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> disjuptoR1R2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"disj_dlHPP_Bisimulation_Up_To_R' <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R</span> <span class="skolem">R0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disj_dlHPP_Bisimulation_Up_To_R'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> SdlHPPR <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="skolem">R</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> symR1 symR2 R0_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="skolem">R0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sym_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> SdlHPPR <span class="keyword1"><span class="command">have</span></span> transR<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="skolem">R</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> transR1<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="skolem">R1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">V''</span>
            <span class="keyword3"><span class="command">assume</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span>"</span></span>
            
            <span class="keyword1"><span class="command">from</span></span> p1 R1_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι</span></span> <span class="skolem"><span class="skolem">ι'</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="skolem"><span class="skolem">c2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> passump1<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span>
              <span class="main">∧</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span> 
              <span class="main">∧</span> <span class="skolem">ι</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ι'</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>
              <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

            <span class="keyword1"><span class="command">with</span></span> p2 R1_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι''</span></span> <span class="skolem"><span class="skolem">b''</span></span> <span class="skolem"><span class="skolem">c1''</span></span> <span class="skolem"><span class="skolem">c2''</span></span> <span class="keyword2"><span class="keyword">where</span></span> passump2<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1''</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι''</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span> <span class="keyword1">do</span> <span class="skolem">c2''</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">ι''</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>
              <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

            <span class="keyword1"><span class="command">with</span></span> passump1 transR d_indistinguishable_trans
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> trans_def<span class="main">)</span>
              
            <span class="keyword1"><span class="command">with</span></span> passump1 passump2 R1_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
          
        <span class="keyword1"><span class="command">have</span></span> transR2<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="skolem">R2</span>"</span></span>
         <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">V''</span>
            <span class="keyword3"><span class="command">assume</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V'</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>"</span></span>

            <span class="keyword1"><span class="command">from</span></span> p1 R2_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι</span></span> <span class="skolem"><span class="skolem">ι'</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> passump1<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">]</span>
              <span class="main">∧</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">]</span> 
              <span class="main">∧</span> <span class="skolem">ι</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ι'</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

            <span class="keyword1"><span class="command">with</span></span> p2 R2_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι''</span></span> <span class="skolem"><span class="skolem">b''</span></span> <span class="skolem"><span class="skolem">c1''</span></span> <span class="keyword2"><span class="keyword">where</span></span> passump2<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="skolem">V''</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι''</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span> <span class="keyword1">do</span> <span class="skolem">c1''</span> <span class="keyword1">od</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">ι''</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="skolem">b'</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

            <span class="keyword1"><span class="command">with</span></span> passump1 transR d_indistinguishable_trans
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1''</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b''</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> trans_def<span class="main">)</span>

            <span class="keyword1"><span class="command">with</span></span> passump1 passump2 R2_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V''</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R2</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">from</span></span> SdlHPPR <span class="keyword1"><span class="command">have</span></span> eqlenR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span><span class="main">∈</span><span class="skolem">R</span><span class="main">.</span> length <span class="bound">V</span> <span class="main">=</span> length <span class="bound">V'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Strong_dlHPP_Bisimulation_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> R1_def eqlenR <span class="keyword1"><span class="command">have</span></span> eqlenR1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span><span class="main">∈</span><span class="skolem">R1</span><span class="main">.</span> length <span class="bound">V</span> <span class="main">=</span> length <span class="bound">V'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> R2_def eqlenR <span class="keyword1"><span class="command">have</span></span> eqlenR2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">V</span><span class="main">,</span><span class="bound">V'</span><span class="main">)</span><span class="main">∈</span><span class="skolem">R2</span><span class="main">.</span> length <span class="bound">V</span> <span class="main">=</span> length <span class="bound">V'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> R1_def R2_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Domain <span class="skolem">R1</span> <span class="main">∩</span> Domain <span class="skolem">R2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">with</span></span> commonArefl_subset_commonDomain <span class="keyword1"><span class="command">have</span></span> Arefl_a<span class="main">:</span>
        <span class="quoted"><span class="quoted">"Arefl <span class="skolem">R1</span> <span class="main">∩</span> Arefl <span class="skolem">R2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

      <span class="keyword1"><span class="command">with</span></span> symR1 symR2 transR1 transR2 eqlenR1 eqlenR2 trans_RuR'
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span><span class="skolem">R1</span> <span class="main">∪</span> <span class="skolem">R2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">with</span></span> R0_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="skolem">R0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span>
      <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> R0_def R1_def R2_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">V</span> <span class="main">=</span> length <span class="skolem">V'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">i</span>
      <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> notIDC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> IDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
        <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> inR0 R0_def R1_def R2_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι</span></span> <span class="skolem"><span class="skolem">ι'</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="skolem"><span class="skolem">c2'</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> R0pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span> 
        <span class="main">∧</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>
        <span class="main">∨</span> <span class="main">(</span><span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∧</span> <span class="skolem">ι</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ι'</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>
        <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

      <span class="keyword1"><span class="command">with</span></span> irange SdlHPPR strongdlHPPB_NDCIDCaux
      <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> c1NDCIDC<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"NDC <span class="skolem">d</span> <span class="skolem">c1</span> <span class="main">∨</span> IDC <span class="skolem">d</span> <span class="skolem">c1</span> <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="skolem">c1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="comment1">― ‹first alternative for V and V'›</span>
      <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"NDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
        IDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> eqnextmem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">⟧(</span><span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟦</span><span class="skolem">c1</span><span class="main">⟧(</span><span class="bound">m</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
            <span class="keyword1"><span class="command">from</span></span> nextmem_exists_and_unique <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1nextmem<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="skolem">m'</span><span class="main">⟩</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m''</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m''</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">m''</span> <span class="main">=</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

            <span class="keyword1"><span class="command">hence</span></span> eqdir1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">c1</span><span class="main">⟧(</span><span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NextMem_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
            
            <span class="keyword1"><span class="command">from</span></span> c1nextmem <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">m'</span><span class="main">⟩</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

            <span class="keyword1"><span class="command">with</span></span> c1nextmem <span class="keyword1"><span class="command">have</span></span> 
              <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="skolem">m'</span><span class="main">⟩</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m''</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m''</span><span class="main">⟩</span><span class="main">)</span> 
              <span class="main">⟶</span> <span class="bound">m''</span> <span class="main">=</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLsSteps_det.seq1 MWLsSteps_det.seq2 
                option.exhaust<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
             
            <span class="keyword1"><span class="command">hence</span></span> eqdir2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">⟧(</span><span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NextMem_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

            <span class="keyword1"><span class="command">with</span></span> eqdir1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">⟧(</span><span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟦</span><span class="skolem">c1</span><span class="main">⟧(</span><span class="skolem">m</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          
          <span class="keyword1"><span class="command">have</span></span> eqpp<span class="main">:</span> <span class="quoted"><span class="quoted">"pp <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pp <span class="skolem">c1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">with</span></span> c1NDCIDC eqnextmem <span class="keyword3"><span class="command">show</span></span> 
            <span class="quoted"><span class="quoted">"NDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
            IDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>htchLoc <span class="main">(</span>pp <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> IDC_def NDC_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

      <span class="comment1">― ‹second alternative for V V'›</span>
      <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span> <span class="quoted"><span class="quoted">"NDC <span class="skolem">d</span> <span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
            <span class="keyword1"><span class="command">from</span></span> nextmem_exists_and_unique <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">α</span></span> 
              <span class="keyword2"><span class="keyword">where</span></span> whilenextmem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">m'</span><span class="main">⟩</span> 
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m''</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">,</span><span class="skolem">m</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m''</span><span class="main">⟩</span><span class="main">)</span> 
              <span class="main">⟶</span> <span class="bound">m''</span> <span class="main">=</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">m'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MWLsSteps_det.whilefalse MWLsSteps_det.whiletrue<span class="main">)</span>
          
            <span class="keyword1"><span class="command">with</span></span> whilenextmem <span class="keyword1"><span class="command">have</span></span> eqnextmem<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">⟧(</span><span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NextMem_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"NDC <span class="skolem">d</span> <span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NDC_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">from</span></span> R0pair case1 case2 irange notIDC
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"NDC <span class="skolem">d</span> <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">V'</span> <span class="skolem">i</span> <span class="skolem">m1</span> <span class="skolem">m1'</span> <span class="skolem">m2</span> <span class="skolem">α</span> <span class="skolem">p</span>
      <span class="keyword3"><span class="command">assume</span></span> inR0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">V'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> irange<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">V</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> dhequal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main">,</span>htchLocSet <span class="skolem">PP</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> inR0 R0_def R1_def R2_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ι</span></span> <span class="skolem"><span class="skolem">ι'</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="skolem"><span class="skolem">c2'</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> R0pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span> 
        <span class="main">∧</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>
        <span class="main">∨</span> <span class="main">(</span><span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">]</span> <span class="main">∧</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∧</span> <span class="skolem">ι</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ι'</span> <span class="main">∉</span> set <span class="main">(</span>PPc <span class="free">c</span><span class="main">)</span> 
        <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c1</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span><span class="skolem">c2</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c2'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span>
        <span class="main">∧</span> <span class="skolem">b</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="skolem">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

      <span class="comment1">― ‹Case 1: V and V' are sequential commands›</span>
      <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span><span class="main">;</span> 
        <span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span> <span class="main">⟧</span>
        <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
        stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
        dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> Vassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> V'assump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">]</span>"</span></span>

          <span class="keyword1"><span class="command">have</span></span> eqpp<span class="main">:</span> <span class="quoted"><span class="quoted">"pp <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pp <span class="skolem">c1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">from</span></span> Vassump irange step irange <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c3</span></span> 
            <span class="keyword2"><span class="keyword">where</span></span> case_distinction<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> Some <span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span>None<span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span><span class="main">)</span>
            <span class="main">∨</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">c3</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span>Some <span class="skolem">c3</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="comment1">― ‹Case 1a: first command terminates›</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> passump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Some <span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> stepassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span>None<span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>

            <span class="keyword1"><span class="command">with</span></span> R0pair SdlHPPR dhequal
            strongdlHPPB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span>"</span></span>
            <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"None"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">α'</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1c1'reason<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> None <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c1'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p'</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="skolem">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span>
              dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="skolem">c1</span><span class="main">)</span> <span class="skolem">m2</span> <span class="skolem">m2'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

            <span class="keyword1"><span class="command">hence</span></span> conclpart<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> 
              <span class="main">→⊲</span><span class="skolem">α'</span><span class="main">⊳</span> <span class="main">⟨</span>Some <span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLsSteps_det.seq1<span class="main">)</span>

            <span class="keyword1"><span class="command">from</span></span> R0pair R0_def R2_def <span class="keyword1"><span class="command">have</span></span> 
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
            <span class="keyword1"><span class="command">with</span></span> passump V'assump Vassump eqpp conclpart 
              c1c1'reason irange 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
              stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> 
              <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span> 
              dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="comment1">― ‹Case 1b: first command does not terminate›</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> passump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">c3</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> stepassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α</span><span class="main">⊳</span> <span class="main">⟨</span>Some <span class="skolem">c3</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span>"</span></span>

            <span class="keyword1"><span class="command">with</span></span> R0pair SdlHPPR dhequal
            strongdlHPPB_aux<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">PP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span>"</span></span>
            <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">c1'</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"Some <span class="skolem">c3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span><span class="main">]</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">c3'</span></span> <span class="skolem"><span class="skolem">α'</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1c1'reason<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> Some <span class="skolem">c3'</span> <span class="main">∧</span> <span class="main">⟨</span><span class="skolem">c1'</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="skolem">p'</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="main">[</span><span class="skolem">c3</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c3'</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="skolem">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">∧</span>
              dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="skolem">c1</span><span class="main">)</span> <span class="skolem">m2</span> <span class="skolem">m2'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

            <span class="keyword1"><span class="command">hence</span></span> conclpart<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="skolem">c1'</span><span class="main">;</span><span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="skolem">α'</span><span class="main">⊳</span> 
              <span class="main">⟨</span>Some <span class="main">(</span><span class="skolem">c3'</span><span class="main">;</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLsSteps_det.seq2<span class="main">)</span>
            
            <span class="keyword1"><span class="command">from</span></span> c1c1'reason R0pair R0_def R1_def <span class="keyword1"><span class="command">have</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">c3</span><span class="main">;</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c2</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c3'</span><span class="main">;</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c2'</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            
            <span class="keyword1"><span class="command">with</span></span> passump V'assump Vassump eqpp conclpart c1c1'reason irange
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
              stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
              dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
              stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
              dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
          
      <span class="comment1">― ‹Case 2: V and V' are while commands›</span>
      <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">;</span> <span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">]</span> <span class="main">⟧</span>
        <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
        stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
        dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> Vassump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">]</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> V'assump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V'</span> <span class="main">=</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">]</span>"</span></span>

          <span class="keyword1"><span class="command">from</span></span> Vassump irange step <span class="keyword1"><span class="command">have</span></span> case_distinction<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">=</span> None <span class="main">∧</span> <span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> False<span class="main">)</span>
            <span class="main">∨</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span>Some <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> option.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="comment1">― ‹Case 2a: b evaluates to False›</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> passump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> None"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> False"</span></span>

            <span class="keyword1"><span class="command">with</span></span> Vassump step irange <span class="keyword1"><span class="command">have</span></span> stepconcl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
                                      
            <span class="keyword1"><span class="command">from</span></span> eval R0pair dhequal <span class="keyword1"><span class="command">have</span></span> eval'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b'</span> <span class="skolem">m1'</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_indistinguishable_def dH_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
           
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="main">[]</span><span class="main">⊳</span> <span class="main">⟨</span>None<span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLsSteps_det.whilefalse<span class="main">)</span>

            <span class="keyword1"><span class="command">with</span></span> passump R_def Vassump V'assump stepconcl dhequal irange
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
            stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
            dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def dhequality_alternative_def<span class="main"><span class="keyword3">,</span></span> 
                <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="comment1">― ‹Case 2b: b evaluates to True›</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> passump<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span>Some <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> True"</span></span>

            <span class="keyword1"><span class="command">with</span></span> Vassump step irange <span class="keyword1"><span class="command">have</span></span> stepconcl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> MWLsSteps_det_cases<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>      
              
            <span class="keyword1"><span class="command">from</span></span> eval R0pair dhequal <span class="keyword1"><span class="command">have</span></span> eval'<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="free">BMap</span> <span class="main">(</span><span class="free">E</span> <span class="skolem">b'</span> <span class="skolem">m1'</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_indistinguishable_def dH_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
           
            <span class="keyword1"><span class="command">hence</span></span> step'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="main">[]</span><span class="main">⊳</span> 
              <span class="main">⟨</span>Some <span class="main">(</span><span class="skolem">c1'</span><span class="main">;</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">)</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> MWLsSteps_det.whiletrue<span class="main">)</span>

            <span class="keyword1"><span class="command">from</span></span> R1_def R0pair <span class="keyword1"><span class="command">have</span></span> inR1<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">c1</span><span class="main">;</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c1</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">,</span><span class="main">[</span><span class="skolem">c1'</span><span class="main">;</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b'</span> <span class="keyword1">do</span> <span class="skolem">c1'</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              
            <span class="keyword1"><span class="command">with</span></span> step' R0_def passump R_def Vassump V'assump 
              stepconcl dhequal irange
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
            stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
            dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stepResultsinR_def dhequality_alternative_def<span class="main"><span class="keyword3">,</span></span> 
                <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
            stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
            dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">with</span></span> case1 R0pair <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">α'</span> <span class="bound">m2'</span><span class="main">.</span> <span class="main">⟨</span><span class="skolem">V'</span><span class="main">!</span><span class="skolem">i</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α'</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p'</span><span class="main">,</span><span class="bound">m2'</span><span class="main">⟩</span> <span class="main">∧</span>
        stepResultsinR <span class="skolem">p</span> <span class="bound">p'</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R0</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">α</span><span class="main">,</span><span class="bound">α'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">∧</span>
        dhequality_alternative <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span>pp <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m2</span> <span class="bound">m2'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
      
  <span class="keyword1"><span class="command">with</span></span> Areflassump Up_To_Technique
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="main">(</span><span class="skolem">R0</span> <span class="main">∪</span> <span class="skolem">R</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">with</span></span> inR2 R0_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">R</span><span class="main">.</span> SdlHPPB <span class="skolem">d</span> <span class="skolem">PP</span> <span class="bound">R</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">c</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">b</span> <span class="keyword1">do</span> <span class="free">c</span> <span class="keyword1">od</span><span class="main">]</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>      

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Type_System">
<div class="head">
<h1>Theory Type_System</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: WHATandWHERE-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Type_System
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Language_Composition.html">Language_Composition</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">locale</span></span> Type_System <span class="main">=</span>
  WWP<span class="main">?</span><span class="main">:</span> WHATWHERE_Secure_Programs <span class="quoted"><span class="quoted">"<span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">BMap</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">DA</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">lH</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Evalfunction"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">BMap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'val</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">DA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">::</span>order<span class="main">)</span> DomainAssignment"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">lH</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'d</span><span class="main">,</span> <span class="tfree">'exp</span><span class="main">)</span> lHatches"</span></span>
<span class="main">+</span> 
<span class="keyword2"><span class="keyword">fixes</span></span>
<span class="free">AssignSideCondition</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'id</span> <span class="main">⇒</span> <span class="tfree">'exp</span> <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">WhileSideCondition</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">IfSideCondition</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'exp</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLsCom <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLsCom <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">assumes</span></span> semAssignSC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">AssignSideCondition</span> <span class="free">x</span> <span class="free">e</span> <span class="free">ι</span> <span class="main">⟹</span> 
  <span class="free">e</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="free">DA</span> <span class="free">x</span><span class="main">,</span><span class="main">(</span>htchLoc <span class="free">ι</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span> <span class="bound">m'</span> <span class="bound">d</span> <span class="bound">ι'</span><span class="main">.</span> <span class="main">(</span><span class="bound">m</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="bound">d</span><span class="main">,</span><span class="main">(</span>htchLoc <span class="bound">ι'</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="bound">m'</span> <span class="main">∧</span> 
  <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="bound">m</span><span class="main">)</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="bound">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="bound">m'</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟶</span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="bound">m</span><span class="main">)</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="bound">d</span><span class="main">,</span><span class="main">(</span>htchLoc <span class="bound">ι'</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="bound">m'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> semWhileSC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">WhileSideCondition</span> <span class="free">e</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="free">e</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="bound">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> semIfSC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">IfSideCondition</span> <span class="free">e</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">d</span><span class="main">.</span> <span class="free">e</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="bound">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹Security typing rules for the language commands›</span>
<span class="keyword1"><span class="command">inductive</span></span>
<span class="entity">ComSecTyping</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span> _"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity">ComSecTypingL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'exp</span><span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLsCom list <span class="main">⇒</span> bool"</span></span>
   <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇘</span><sub>𝒱</sub><span class="hidden">⇙</span></span> _"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
Skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span></span> <span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span>"</span></span> <span class="main">|</span>
Assign<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">AssignSideCondition</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span> <span class="main">|</span>
Spawn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒱</sub><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span></span> <span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span> <span class="main">|</span>
Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span> <span class="main">|</span>
While<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span> <span class="free">WhileSideCondition</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟧</span> 
     <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span></span> <span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">do</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">od</span>"</span></span> <span class="main">|</span>
If<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">;</span> <span class="free">IfSideCondition</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span></span> <span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main"><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="keyword1">fi</span>"</span></span> <span class="main">|</span>
Parallel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">.</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">!</span><span class="bound">i</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>𝒱</sub><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> parallel_cases<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇘</span><sub>𝒱</sub><span class="hidden">⇙</span></span> <span class="free">V</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">auxiliary_predicate</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">auxiliary_predicate</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> unique_PPV <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">⟶</span> WHATWHERE_Secure <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span> 

<span class="comment1">― ‹soundness proof of abstract type system›</span>
<span class="keyword1"><span class="command">theorem</span></span> ComSecTyping_single_is_sound<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span> <span class="free">c</span><span class="main">;</span> unique_PPc <span class="free">c</span> <span class="main">⟧</span>
  <span class="main">⟹</span> WHATWHERE_Secure <span class="main">[</span><span class="free">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ComSecTyping_ComSecTypingL.inducts<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
    <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"auxiliary_predicate"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> auxiliary_predicate_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="keyword1">skip<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WHATWHERE_Secure_Skip<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">e</span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">AssignSideCondition</span> <span class="skolem">x</span> <span class="skolem">e</span> <span class="skolem">ι</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="skolem">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">e</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WHATWHERE_Secure_Assign semAssignSC<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPV <span class="skolem">V</span> <span class="main">⟶</span> WHATWHERE_Secure <span class="skolem">V</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> uniPPspawn<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="main">(</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"unique_PPV <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPV_def unique_PPc_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> uniPPspawn <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="keyword1">spawn<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">V</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Compositionality_Spawn<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span>
  <span class="keyword3"><span class="command">assume</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="skolem">c1</span> <span class="main">⟹</span> WHATWHERE_Secure <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="skolem">c2</span> <span class="main">⟹</span> WHATWHERE_Secure <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> uniPPc1c2<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="main">(</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> uniPPc1c2 <span class="keyword1"><span class="command">have</span></span> uniPPc1<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="skolem">c1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPc_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> IH1 <span class="keyword1"><span class="command">have</span></span> IS1<span class="main">:</span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> uniPPc1c2 <span class="keyword1"><span class="command">have</span></span> uniPPc2<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="skolem">c2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPc_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> IH2 <span class="keyword1"><span class="command">have</span></span> IS2<span class="main">:</span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> IS1 IS2 uniPPc1c2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="skolem">c1</span><span class="main">;</span><span class="skolem">c2</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Compositionality_Seq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">b</span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span> SC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">WhileSideCondition</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="skolem">c</span> <span class="main">⟹</span> WHATWHERE_Secure <span class="main">[</span><span class="skolem">c</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> uniPPwhile<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="main">(</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c</span> <span class="keyword1">od</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"unique_PPc <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPc_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="skolem">c</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> uniPPwhile SC <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="keyword1">while<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">do</span> <span class="skolem">c</span> <span class="keyword1">od</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Compositionality_While semWhileSC<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">b</span> <span class="skolem">ι</span>
  <span class="keyword3"><span class="command">assume</span></span> SC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">IfSideCondition</span> <span class="skolem">b</span> <span class="skolem">c1</span> <span class="skolem">c2</span>"</span></span>  
  <span class="keyword3"><span class="command">assume</span></span> IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="skolem">c1</span> <span class="main">⟹</span> WHATWHERE_Secure <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="skolem">c2</span> <span class="main">⟹</span> WHATWHERE_Secure <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> uniPPif<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPc <span class="main">(</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">then</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span> <span class="keyword1">fi</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> uniPPif <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unique_PPc <span class="skolem">c1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPc_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> IH1 <span class="keyword1"><span class="command">have</span></span> IS1<span class="main">:</span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="skolem">c1</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> uniPPif <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unique_PPc <span class="skolem">c2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_PPc_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> IH2 <span class="keyword1"><span class="command">have</span></span> IS2<span class="main">:</span> <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="skolem">c2</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> IS1 IS2 SC uniPPif <span class="keyword3"><span class="command">show</span></span> 
    <span class="quoted"><span class="quoted">"WHATWHERE_Secure <span class="main">[</span><span class="keyword1">if<span class="hidden">⇘</span><sub></sub></span><span class="skolem">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">b</span> <span class="keyword1">then</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span> <span class="keyword1">fi</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Compositionality_If semIfSC<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span>
  <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">V</span><span class="main">.</span> <span class="keyword1">⊢<span class="hidden">⇘</span><sub>𝒞</sub><span class="hidden">⇙</span></span> <span class="skolem">V</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">∧</span>
    <span class="main">(</span>unique_PPc <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">⟶</span> WHATWHERE_Secure <span class="main">[</span><span class="skolem">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unique_PPV <span class="skolem">V</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">V</span><span class="main">.</span> unique_PPc <span class="main">(</span><span class="skolem">V</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> uniPPV_uniPPc<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unique_PPV <span class="skolem">V</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">V</span><span class="main">.</span> WHATWHERE_Secure <span class="main">[</span><span class="skolem">V</span><span class="main">!</span><span class="bound">i</span><span class="main">]</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> uniPPV<span class="main">:</span> <span class="quoted"><span class="quoted">"unique_PPV <span class="skolem">V</span> <span class="main">⟶</span> WHATWHERE_Secure <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> parallel_composition<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> ComSecTyping_list_is_sound<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1">⊢<span class="hidden">⇘</span><sub>𝒱</sub><span class="hidden">⇙</span></span> <span class="free">V</span><span class="main">;</span> unique_PPV <span class="free">V</span> <span class="main">⟧</span> <span class="main">⟹</span> WHATWHERE_Secure <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ComSecTyping_single_is_sound parallel_cases 
  parallel_composition uniPPV_uniPPc<span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Type_System_example">
<div class="head">
<h1>Theory Type_System_example</h1>
</div>
<pre class="source"><span class="comment1">(*
Title: WHATandWHERE-Security
Authors: Sylvia Grewe, Alexander Lux, Heiko Mantel, Jens Sauer
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Type_System_example
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Type_System.html">Type_System</a> <a href="../Strong_Security/Expr.html">Strong_Security.Expr</a> <a href="../Strong_Security/Domain_example.html">Strong_Security.Domain_example</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">― ‹When interpreting, we have to instantiate the type for domains. As an example, we take a type containing 'low' and 'high' as domains.›</span>

<span class="keyword1"><span class="command">consts</span></span> DA <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span>Dom<span class="main">)</span> DomainAssignment"</span></span>
<span class="keyword1"><span class="command">consts</span></span> BMap <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'val</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword1"><span class="command">consts</span></span> lH <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Dom<span class="main">,</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">)</span> lHatches"</span></span>

<span class="comment1">― ‹redefine all the abbreviations necessary for auxiliary lemmas with the 
  correct parameter instantiation›</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">MWLsStepsdet'</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">,</span> <span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">,</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">,</span><span class="tfree">'id</span><span class="main">)</span> MWLsCom<span class="main">)</span> TLSteps_curry"</span></span>
<span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span> <span class="keyword1">→⊲</span>_<span class="keyword1">⊳</span><span class="keyword3">/ </span><span class="keyword3">(1</span><span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/</span>_<span class="keyword1">⟩</span><span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 81<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main"><span class="free">→⊲</span></span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main"><span class="free">⊳</span></span> <span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">≡</span> 
  <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">α</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> MWLs_semantics.MWLsSteps_det ExprEval BMap"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">d_equal'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State 
  <span class="main">⇒</span> Dom <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> bool"</span></span> 
<span class="main">(</span> <span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">=<span class="hidden">⇘</span><sub></sub></span>_<span class="keyword1"><span class="hidden">⇙</span></span> _<span class="keyword3">)</span>"</span> <span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main"><span class="free">=<span class="hidden">⇘</span><sub></sub></span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free"><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="main">≡</span> WHATWHERE.d_equal DA <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">dH_equal'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> Dom 
  <span class="main">⇒</span> <span class="main">(</span>Dom<span class="main">,</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">)</span> Hatches
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> bool"</span></span>
<span class="main">(</span> <span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">∼<span class="hidden">⇘</span><sub></sub></span>_<span class="keyword1">,</span>_<span class="keyword1"><span class="hidden">⇙</span></span> _<span class="keyword3">)</span>"</span> <span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main"><span class="free">∼<span class="hidden">⇘</span><sub></sub></span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main"><span class="free"><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span> <span class="main">≡</span> WHATWHERE.dH_equal ExprEval DA <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">m'</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">NextMem'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom 
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> State <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> State"</span></span>
<span class="main">(</span><span class="quoted">"<span class="keyword1">⟦</span>_<span class="keyword1">⟧'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟦</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">⟧(</span></span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main"><span class="free">)</span></span> 
  <span class="main">≡</span> WHATWHERE.NextMem <span class="main">(</span>MWLs_semantics.MWLsSteps_det ExprEval BMap<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">dH_indistinguishable'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> Dom 
  <span class="main">⇒</span> <span class="main">(</span>Dom<span class="main">,</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">)</span> Hatches <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> bool"</span></span> 
<span class="main">(</span> <span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">≡<span class="hidden">⇘</span><sub></sub></span>_<span class="keyword1">,</span>_<span class="keyword1"><span class="hidden">⇙</span></span> _<span class="keyword3">)</span>"</span> <span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main"><span class="free">≡<span class="hidden">⇘</span><sub></sub></span></span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main"><span class="free"><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> 
  <span class="main">≡</span> WHATWHERE_Secure_Programs.dH_indistinguishable ExprEval DA <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">htchLoc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>Dom<span class="main">,</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">)</span> Hatches"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">htchLoc</span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">≡</span> WHATWHERE.htchLoc lH <span class="free"><span class="bound"><span class="entity">ι</span></span></span>"</span></span>


<span class="comment1">― ‹Security typing rules for expressions›</span>
<span class="keyword1"><span class="command">inductive</span></span> 
<span class="entity">ExprSecTyping</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Dom<span class="main">,</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span><span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">)</span> Hatches
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> Dom <span class="main">⇒</span> bool"</span></span>
<span class="main">(</span><span class="quoted">"_ <span class="keyword1">⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span></span> _ <span class="keyword1">:</span> _"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="entity">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Dom<span class="main">,</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">)</span> Hatches"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
Consts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span></span></span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span> <span class="main">|</span>
Vars<span class="main">:</span> <span class="quoted"><span class="quoted">"DA <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⟹</span> <span class="free">H</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span></span></span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span> <span class="main">|</span>
Hatch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">H</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span> <span class="main">|</span>
Ops<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">arglist</span></span></span><span class="main">.</span> <span class="free">H</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">arglist</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">dl</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">dl</span></span></span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="free">H</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span></span></span> <span class="main">(</span>Op <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">arglist</span></span></span><span class="main">)</span> <span class="main"><span class="free">:</span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span>"</span></span>

<span class="comment1">― ‹function substituting a certain expression with another expression 
  in expressions›</span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">Subst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr 
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr"</span></span>
<span class="main">(</span><span class="quoted">"_<span class="keyword1">&lt;</span>_\<span class="keyword1">\</span>_<span class="keyword1">&gt;</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity">SubstL</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr 
  <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main"><span class="free">&lt;</span></span><span class="free"><span class="bound"><span class="entity">e1</span></span></span>\<span class="main"><span class="free">\</span></span><span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main"><span class="free">&gt;</span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">=</span><span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="keyword1">else</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="free">&lt;</span></span><span class="free"><span class="bound"><span class="entity">e1</span></span></span>\<span class="main"><span class="free">\</span></span><span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main"><span class="free">&gt;</span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">=</span><span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="keyword1">else</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span>Op <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">arglist</span></span></span><span class="main">)</span><span class="main"><span class="free">&lt;</span></span><span class="free"><span class="bound"><span class="entity">e1</span></span></span>\<span class="main"><span class="free">\</span></span><span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main"><span class="free">&gt;</span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">=</span><span class="main">(</span>Op <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">arglist</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="keyword1">else</span> 
  <span class="main">(</span>Op <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free">SubstL</span> <span class="free"><span class="bound"><span class="entity">arglist</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>

<span class="quoted"><span class="quoted">"<span class="free">SubstL</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">SubstL</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main"><span class="free">&lt;</span></span><span class="free"><span class="bound"><span class="entity">e1</span></span></span>\<span class="main"><span class="free">\</span></span><span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main"><span class="free">&gt;</span></span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="free">SubstL</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SubstClosure</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'id</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">SubstClosure</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">e'</span><span class="main">,</span><span class="bound">ι'</span><span class="main">)</span> <span class="main">∈</span> lH<span class="main">.</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">e'</span><span class="main">&lt;</span><span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>\<span class="main">\</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">&gt;</span><span class="main">,</span><span class="bound">ι'</span><span class="main">)</span> <span class="main">∈</span> lH"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">synAssignSC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'id</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">synAssignSC</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">ι</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>htchLoc <span class="free"><span class="bound"><span class="entity">ι</span></span></span><span class="main">)</span> <span class="keyword1">⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">:</span> <span class="bound">d</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">≤</span> DA <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>
  <span class="main">∧</span> <span class="main">(</span>SubstClosure <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">synWhileSC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">synWhileSC</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="main">{}</span> <span class="keyword1">⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">:</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d</span> <span class="main">≤</span> <span class="bound">d'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">synIfSC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr
  <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom 
  <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'id</span><span class="main">,</span> <span class="tfree">'val</span><span class="main">)</span> Expr<span class="main">,</span> <span class="tfree">'id</span><span class="main">)</span> MWLsCom <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">synIfSC</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">d</span><span class="main">.</span> <span class="main">(</span><span class="main">{}</span> <span class="keyword1">⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">:</span> <span class="bound">d</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">d'</span><span class="main">.</span> <span class="bound">d</span> <span class="main">≤</span> <span class="bound">d'</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="comment1">― ‹auxiliary lemma for locale interpretation (theorem 7 in original paper)›</span>
<span class="keyword1"><span class="command">lemma</span></span> ExprTypable_with_smallerd_implies_dH_indistinguishable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">H</span> <span class="keyword1">⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span></span> <span class="free">e</span> <span class="main">:</span> <span class="free">d'</span><span class="main">;</span> <span class="free">d'</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">e</span> <span class="main">≡<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main">,</span><span class="free">H</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ExprSecTyping.induct<span class="main"><span class="keyword3">,</span></span> 
    <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE_Secure_Programs.dH_indistinguishable_def 
    WHATWHERE.dH_equal_def WHATWHERE.d_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">dl</span> <span class="skolem">arglist</span> <span class="skolem">f</span> <span class="skolem">m1</span> <span class="skolem">m2</span> <span class="skolem">d'</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">arglist</span><span class="main">.</span>
    <span class="main">(</span><span class="free">H</span> <span class="keyword1">⊢<span class="hidden">⇘</span><sub>ℰ</sub><span class="hidden">⇙</span></span> <span class="main">(</span><span class="skolem">arglist</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span><span class="skolem">dl</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">dl</span><span class="main">!</span><span class="bound">i</span> <span class="main">≤</span> <span class="skolem">d</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">m1</span> <span class="bound">m2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> DA <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">d</span> <span class="main">⟶</span> <span class="bound">m1</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">m2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">∈</span><span class="free">H</span><span class="main">.</span> <span class="bound">d'</span> <span class="main">≤</span> <span class="skolem">d</span> <span class="main">⟶</span> ExprEval <span class="bound">e</span> <span class="bound">m1</span> <span class="main">=</span> ExprEval <span class="bound">e</span> <span class="bound">m2</span><span class="main">)</span> <span class="main">⟶</span>
    ExprEval <span class="main">(</span><span class="skolem">arglist</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">m1</span> <span class="main">=</span> ExprEval <span class="main">(</span><span class="skolem">arglist</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="bound">m2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">dl</span><span class="main">!</span><span class="bound">i</span> <span class="main">≤</span> <span class="skolem">d'</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> smaller<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eqeval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span><span class="main">.</span> <span class="bound">d'</span> <span class="main">≤</span> <span class="skolem">d</span> <span class="main">⟶</span> ExprEval <span class="bound">e</span> <span class="skolem">m1</span> <span class="main">=</span> ExprEval <span class="bound">e</span> <span class="skolem">m2</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eqstate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> DA <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">d</span> <span class="main">⟶</span> <span class="skolem">m1</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">m2</span> <span class="bound">x</span>"</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> main smaller <span class="keyword1"><span class="command">have</span></span> irangesubst<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">arglist</span><span class="main">.</span> <span class="skolem">dl</span><span class="main">!</span><span class="bound">i</span> <span class="main">≤</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_trans<span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> eqstate eqeval main <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="skolem">arglist</span><span class="main">.</span> ExprEval <span class="main">(</span><span class="skolem">arglist</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">m1</span> 
       <span class="main">=</span> ExprEval <span class="main">(</span><span class="skolem">arglist</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="skolem">m2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">hence</span></span> substmap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ExprEvalL <span class="skolem">arglist</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ExprEvalL <span class="skolem">arglist</span> <span class="skolem">m2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">arglist</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>ExprEvalL <span class="skolem">arglist</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">(</span>ExprEvalL <span class="skolem">arglist</span> <span class="skolem">m2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> substmap<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">― ‹auxiliary lemma about substitutions in expressions and in memories›</span>
<span class="keyword1"><span class="command">lemma</span></span> substexp_substmem<span class="main">:</span>
<span class="quoted"><span class="quoted">"ExprEval <span class="free">e'</span><span class="main">&lt;</span>Var <span class="free">x</span>\<span class="main">\</span><span class="free">e</span><span class="main">&gt;</span> <span class="free">m</span> <span class="main">=</span> ExprEval <span class="free">e'</span> <span class="main">(</span><span class="free">m</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> ExprEval <span class="free">e</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>
  <span class="main">∧</span> ExprEvalL <span class="main">(</span>SubstL <span class="free">elist</span> <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span> <span class="free">e</span><span class="main">)</span> <span class="free">m</span>
  <span class="main">=</span> ExprEvalL <span class="free">elist</span> <span class="main">(</span><span class="free">m</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> ExprEval <span class="free">e</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">e'</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">elist</span></span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ExprEval.induct ExprEvalL.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>


<span class="comment1">― ‹another auxiliary lemma for locale interpretation (lemma 8 in original paper)›</span>
<span class="keyword1"><span class="command">lemma</span></span> SubstClosure_implications<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> SubstClosure <span class="free">x</span> <span class="free">e</span><span class="main">;</span> <span class="free">m</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main">,</span><span class="main">(</span>htchLoc <span class="free">ι'</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">m'</span><span class="main">;</span> 
  <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="free">m</span><span class="main">)</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="free">m'</span><span class="main">)</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="free">m</span><span class="main">)</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main">,</span><span class="main">(</span>htchLoc <span class="free">ι'</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="free">m'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m1</span> <span class="skolem">m1'</span>
  <span class="keyword3"><span class="command">assume</span></span> substclosure<span class="main">:</span> <span class="quoted"><span class="quoted">"SubstClosure <span class="free">x</span> <span class="free">e</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> dequalm2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1</span><span class="main">)</span> <span class="main">=<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1'</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> dhequalm1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main">,</span><span class="main">(</span>htchLoc <span class="free">ι'</span><span class="main">)</span><span class="main"><span class="hidden">⇙</span></span> <span class="skolem">m1'</span>"</span></span>  
  
  <span class="keyword1"><span class="command">from</span></span> MWLs_semantics.nextmem_exists_and_unique <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m2</span></span> <span class="keyword2"><span class="keyword">where</span></span> m1step<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="skolem">m2</span><span class="main">⟩</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m''</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">,</span><span class="skolem">m1</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m''</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">m''</span> <span class="main">=</span> <span class="skolem">m2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> m2_is_next<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE.NextMem_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> m1step MWLs_semantics.MWLsSteps_det.assign
     <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ExprEval"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι</span>"</span></span> <span class="quoted"><span class="quoted">"BMap"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> m2eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m2</span> <span class="main">=</span> <span class="skolem">m1</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="main">(</span>ExprEval <span class="free">e</span> <span class="skolem">m1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> MWLs_semantics.nextmem_exists_and_unique <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> m1'step<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="skolem">m2'</span><span class="main">⟩</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m''</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span> <span class="bound">α</span><span class="main">.</span> <span class="main">⟨</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">,</span><span class="skolem">m1'</span><span class="main">⟩</span> <span class="main">→⊲</span><span class="bound">α</span><span class="main">⊳</span> <span class="main">⟨</span><span class="bound">p</span><span class="main">,</span><span class="bound">m''</span><span class="main">⟩</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">m''</span> <span class="main">=</span> <span class="skolem">m2'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> m2'_is_next<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE.NextMem_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> m1'step MWLs_semantics.MWLsSteps_det.assign
     <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ExprEval"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m1'</span>"</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ι</span>"</span></span> <span class="quoted"><span class="quoted">"BMap"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> m2'eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m2'</span> <span class="main">=</span> <span class="skolem">m1'</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="main">(</span>ExprEval <span class="free">e</span> <span class="skolem">m1'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> m2eq substexp_substmem
  <span class="keyword1"><span class="command">have</span></span> substeval1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e'</span><span class="main">.</span> ExprEval <span class="main">(</span><span class="bound">e'</span><span class="main">&lt;</span>Var <span class="free">x</span>\<span class="main">\</span><span class="free">e</span><span class="main">&gt;</span><span class="main">)</span> <span class="skolem">m1</span> <span class="main">=</span> ExprEval <span class="bound">e'</span> <span class="skolem">m2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">from</span></span> m2'eq substexp_substmem
  <span class="keyword1"><span class="command">have</span></span> substeval2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e'</span><span class="main">.</span> ExprEval <span class="bound">e'</span><span class="main">&lt;</span>Var <span class="free">x</span>\<span class="main">\</span><span class="free">e</span><span class="main">&gt;</span> <span class="skolem">m1'</span> <span class="main">=</span> ExprEval <span class="bound">e'</span> <span class="skolem">m2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
   
  <span class="keyword1"><span class="command">from</span></span> substclosure <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">e'</span><span class="main">)</span> <span class="main">∈</span> htchLoc <span class="free">ι'</span><span class="main">.</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">e'</span><span class="main">&lt;</span>Var <span class="free">x</span>\<span class="main">\</span><span class="free">e</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>htchLoc <span class="free">ι'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SubstClosure_def WHATWHERE.htchLoc_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> dhequalm1 <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">e'</span><span class="main">)</span> <span class="main">∈</span> htchLoc <span class="free">ι'</span><span class="main">.</span> 
    <span class="bound">d'</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟶</span> ExprEval <span class="bound">e'</span><span class="main">&lt;</span>Var <span class="free">x</span>\<span class="main">\</span><span class="free">e</span><span class="main">&gt;</span> <span class="skolem">m1</span> <span class="main">=</span> ExprEval <span class="bound">e'</span><span class="main">&lt;</span>Var <span class="free">x</span>\<span class="main">\</span><span class="free">e</span><span class="main">&gt;</span> <span class="skolem">m1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE.dH_equal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> substeval1 substeval2 <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">e'</span><span class="main">)</span> <span class="main">∈</span> htchLoc <span class="free">ι'</span><span class="main">.</span>
    <span class="bound">d'</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟶</span> ExprEval <span class="bound">e'</span> <span class="skolem">m2</span> <span class="main">=</span> ExprEval <span class="bound">e'</span> <span class="skolem">m2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">with</span></span> dequalm2 m2_is_next m2'_is_next
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1</span><span class="main">)</span> <span class="main">∼<span class="hidden">⇘</span><sub></sub></span><span class="free">d</span><span class="main">,</span>htchLoc <span class="free">ι'</span><span class="main"><span class="hidden">⇙</span></span> <span class="main">⟦</span><span class="free">x</span> <span class="main">:=<span class="hidden">⇘</span><sub></sub></span><span class="free">ι</span><span class="main"><span class="hidden">⇙</span></span> <span class="free">e</span><span class="main">⟧(</span><span class="skolem">m1'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> WHATWHERE.dH_equal_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">― ‹interpretation of the abstract type system using the above definitions for the side conditions›</span>
<span class="keyword1"><span class="command">interpretation</span></span> Type_System_example<span class="main">:</span> Type_System <span class="quoted">ExprEval</span> <span class="quoted">BMap</span> <span class="quoted">DA</span> <span class="quoted">lH</span>
  <span class="quoted">synAssignSC</span> <span class="quoted">synWhileSC</span> <span class="quoted">synIfSC</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> ExprTypable_with_smallerd_implies_dH_indistinguishable 
  synAssignSC_def<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> SubstClosure_implications synAssignSC_def<span class="main"><span class="keyword3">,</span></span> 
  <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> synWhileSC_def<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> ExprTypable_with_smallerd_implies_dH_indistinguishable 
  WHATWHERE_Secure_Programs.empH_implies_dHindistinguishable_eq_dindistinguishable<span class="main"><span class="keyword3">,</span></span> 
  <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> synIfSC_def<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> ExprTypable_with_smallerd_implies_dH_indistinguishable 
  WHATWHERE_Secure_Programs.empH_implies_dHindistinguishable_eq_dindistinguishable<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>