<div id="Var">
<div class="head">
<h1>Theory Var</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹UTP variables›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Var
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹UTP variables are characterized by two functions, $select$ and $update$. 
        The variable type is then defined as a tuple ($select$ * $update$).›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'r</span><span class="main">)</span> var <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'r</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The $lookup$ function returns the corrsponding $select$ function of a variable.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lookup</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'r</span><span class="main">)</span> var <span class="main">⇒</span> <span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lookup</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The $assign$ function uses the $update$ function of a variable to update its value.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">assign</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'r</span><span class="main">)</span> var <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'r</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">assign</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main"><span class="bound">_</span></span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The $VAR$ function allows to retrieve a variable given its name.›</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_VAR"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'r</span><span class="main">)</span> var"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">VAR</span> _"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> <span class="quoted">"<span class="keyword1">VAR</span> x"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> _update_name <span class="free">x</span><span class="main">)</span>"</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Relations">
<div class="head">
<h1>Theory Relations</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Predicates and relations›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Relations
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Var.html">Var</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">default_sort</span></span> <span class="quoted">type</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Unifying Theories of Programming (UTP) is a semantic framework based on 
an alphabetized relational calculus. An alphabetized predicate is a pair (alphabet, predicate) 
where the free variables appearing in the predicate are all in the alphabet.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹An alphabetized relation is an alphabetized predicate where the alphabet is
composed of input (undecorated) and output (dashed) variables. In this case the
predicate describes a relation between input and output variables.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section, the definitions of predicates, relations and 
standard operators are given.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> <span class="quoted">"alphabet"</span>  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> predicate <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> alphabet <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">true</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> predicate"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">true</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">A</span><span class="main">.</span> True"</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">false</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> predicate"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">false</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">A</span><span class="main">.</span> False"</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">not</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> predicate <span class="main">⇒</span> <span class="tfree">'α</span> predicate"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">¬</span> _"</span> <span class="main">[</span>40<span class="main">]</span> 40<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">¬</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">≡</span> <span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">conj</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> predicate <span class="main">⇒</span> <span class="tfree">'α</span> predicate <span class="main">⇒</span> <span class="tfree">'α</span> predicate"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∧</span>"</span> 35<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">∧</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">A</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">A</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">disj</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> predicate <span class="main">⇒</span> <span class="tfree">'α</span> predicate <span class="main">⇒</span> <span class="tfree">'α</span> predicate"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∨</span>"</span> 30<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">∨</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">A</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">A</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">impl</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> predicate <span class="main">⇒</span> <span class="tfree">'α</span> predicate <span class="main">⇒</span> <span class="tfree">'α</span> predicate"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⟶</span>"</span> 25<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⟶</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">A</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">A</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iff</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> predicate <span class="main">⇒</span> <span class="tfree">'α</span> predicate <span class="main">⇒</span> <span class="tfree">'α</span> predicate"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⟷</span>"</span> 25<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⟷</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">A</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">A</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ex</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'β</span> <span class="main">⇒</span><span class="tfree">'α</span> predicate<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> predicate"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∃</b></span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>∃</b></span></span><span class="bound">x</span><span class="main"><span class="free">.</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">x</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="bound">A</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">all</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'β</span> <span class="main">⇒</span><span class="tfree">'α</span> predicate<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> predicate"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∀</b></span>"</span> 10<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="hidden">❙</span><b>∀</b></span></span><span class="bound">x</span><span class="main"><span class="free">.</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">x</span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="bound">A</span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> condition <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> relation  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'α</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cond</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation <span class="main">⇒</span> <span class="tfree">'α</span> condition <span class="main">⇒</span> <span class="tfree">'α</span> relation <span class="main">⇒</span> <span class="tfree">'α</span> relation"</span></span> 
                                                          <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span>_ <span class="keyword1">◃</span> _ <span class="keyword1">▹</span> <span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>14<span class="main">,</span>0<span class="main">,</span>15<span class="main">]</span> 14<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">◃</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main"><span class="free">▹</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">comp</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'β</span><span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'β</span> <span class="main">×</span> <span class="tfree">'γ</span><span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> <span class="main">×</span> <span class="tfree">'γ</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> 
                                                                          <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">;;</span>"</span> 25<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">;;</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">:</span> <span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">p</span><span class="main">}</span> <span class="keyword1">O</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">q</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Assign</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> var <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> relation"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Assign</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>assign <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="bound">A</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_assignment"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> relation"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">:==</span> _"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"y <span class="main">:==</span> <span class="free">vv</span>"</span>   <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> Assign <span class="main">(</span><span class="keyword1">VAR</span> y<span class="main">)</span> <span class="free">vv</span>"</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">closure</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> predicate <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">[</span>_<span class="keyword1">]</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">[</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">]</span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">A</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">A</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">ndet</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation <span class="main">⇒</span> <span class="tfree">'α</span> relation <span class="main">⇒</span> <span class="tfree">'α</span> relation"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">⊓</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⊓</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">join</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation <span class="main">⇒</span> <span class="tfree">'α</span> relation <span class="main">⇒</span> <span class="tfree">'α</span> relation"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">⊔</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⊔</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">ndetS</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation set <span class="main">⇒</span> <span class="tfree">'α</span> relation"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">⨅</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⨅</span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">p</span><span class="main">}</span> <span class="main">|</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">conjS</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation set <span class="main">⇒</span> <span class="tfree">'α</span> relation"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span><span class="keyword1">⨆</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⨆</span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="main">⋂</span><span class="main">{</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">p</span><span class="main">}</span> <span class="main">|</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">skip_r</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Πr</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Πr</span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span> <span class="main">.</span> <span class="bound">A</span> <span class="main">=</span> <span class="bound">A'</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">Bot</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Bot</span> <span class="main">≡</span> true"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">Top</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Top</span> <span class="main">≡</span> false"</span></span>


<span class="keyword1"><span class="command">lemmas</span></span> utp_defs <span class="main">=</span> true_def false_def conj_def disj_def not_def impl_def iff_def
                  ex_def all_def cond_def comp_def Assign_def


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Proofs›</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹All useful proved lemmas over predicates and relations are presented here.
First, we introduce the most important lemmas that will be used by automatic tools to simplify
proofs. In the second part, other lemmas are proved using these basic ones.›</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Setup of automated tools›</span></span>

<span class="keyword1" id="Relations-true_intro"><span class="command">lemma</span></span> true_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"true <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>
<span class="keyword1" id="Relations-false_elim"><span class="command">lemma</span></span> false_elim<span class="main">:</span> <span class="quoted"><span class="quoted">"false <span class="free">x</span> <span class="main">⟹</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>
<span class="keyword1" id="Relations-true_elim"><span class="command">lemma</span></span> true_elim<span class="main">:</span> <span class="quoted"><span class="quoted">"true <span class="free">x</span> <span class="main">⟹</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-not_intro"><span class="command">lemma</span></span> not_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> false <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>
<span class="keyword1" id="Relations-not_elim"><span class="command">lemma</span></span> not_elim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>
<span class="keyword1" id="Relations-not_dest"><span class="command">lemma</span></span> not_dest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-conj_intro"><span class="command">lemma</span></span> conj_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>
<span class="keyword1" id="Relations-conj_elim"><span class="command">lemma</span></span> conj_elim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-disj_introC"><span class="command">lemma</span></span> disj_introC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="free">Q</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>
<span class="keyword1" id="Relations-disj_elim"><span class="command">lemma</span></span> disj_elim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Q</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-impl_intro"><span class="command">lemma</span></span> impl_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟶</span> <span class="free">Q</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>
<span class="keyword1" id="Relations-impl_elimC"><span class="command">lemma</span></span> impl_elimC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⟶</span> <span class="free">Q</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Q</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">R</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-iff_intro"><span class="command">lemma</span></span> iff_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Q</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟷</span> <span class="free">Q</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>
<span class="keyword1" id="Relations-iff_elimC"><span class="command">lemma</span></span> iff_elimC<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⟷</span> <span class="free">Q</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">¬</span> <span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">Q</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-all_intro"><span class="command">lemma</span></span> all_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>
<span class="keyword1" id="Relations-all_elim"><span class="command">lemma</span></span> all_elim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="free">a</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-ex_intro"><span class="command">lemma</span></span> ex_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">a</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>
<span class="keyword1" id="Relations-ex_elim"><span class="command">lemma</span></span> ex_elim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-comp_intro"><span class="command">lemma</span></span> comp_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>

<span class="keyword1" id="Relations-comp_elim"><span class="command">lemma</span></span> comp_elim<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="free">ac</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">ac</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> not_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> iff_intro <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> not_intro <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> impl_intro <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> disj_introC <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> conj_intro <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> true_intro <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> comp_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> not_dest <span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> iff_elimC <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> false_elim <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> impl_elimC <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> disj_elim <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> conj_elim <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> comp_elim <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> true_elim <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">declare</span></span> all_intro <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> ex_intro <span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> ex_elim <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> all_elim <span class="main">[</span><span class="operator">elim</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> relation_rules <span class="main">=</span> iff_intro not_intro impl_intro disj_introC conj_intro true_intro
                        comp_intro not_dest iff_elimC false_elim impl_elimC all_elim
                        disj_elim conj_elim comp_elim all_intro ex_intro ex_elim 
                        


<span class="keyword1" id="Relations-split_cond"><span class="command">lemma</span></span> split_cond<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">(</span><span class="free">P</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="free">b</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">A</span> <span class="main">(</span><span class="free">Q</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="free">x</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-split_cond_asm"><span class="command">lemma</span></span> split_cond_asm<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">A</span> <span class="main">(</span><span class="free">P</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span> <span class="free">b</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">A</span> <span class="main">(</span><span class="free">Q</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="free">x</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> cond_splits <span class="main">=</span> split_cond split_cond_asm


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Misc lemmas›</span></span>

<span class="keyword1" id="Relations-cond_idem"><span class="command">lemma</span></span> cond_idem<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_symm"><span class="command">lemma</span></span> cond_symm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="main">¬</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_assoc"><span class="command">lemma</span></span> cond_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">c</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">c</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_distr"><span class="command">lemma</span></span> cond_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">c</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">c</span> <span class="main">▹</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_unit_T"><span class="command">lemma</span></span> cond_unit_T<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> true <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_unit_F"><span class="command">lemma</span></span> cond_unit_F<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> false <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_L6"><span class="command">lemma</span></span> cond_L6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_L7"><span class="command">lemma</span></span> cond_L7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">c</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_and_distr"><span class="command">lemma</span></span> cond_and_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">R</span> <span class="main">∧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_or_distr"><span class="command">lemma</span></span> cond_or_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">R</span> <span class="main">∨</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_imp_distr"><span class="command">lemma</span></span> cond_imp_distr<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⟶</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">R</span> <span class="main">⟶</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_eq_distr"><span class="command">lemma</span></span> cond_eq_distr<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⟷</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">R</span> <span class="main">⟷</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-comp_assoc"><span class="command">lemma</span></span> comp_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-conj_comp"><span class="command">lemma</span></span> conj_comp<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-comp_cond_left_distr"><span class="command">lemma</span></span> comp_cond_left_distr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">b</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-ndet_symm"><span class="command">lemma</span></span> ndet_symm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'a</span> relation<span class="main">)</span> <span class="main">⊓</span> <span class="free">Q</span> <span class="main">=</span> <span class="free">Q</span> <span class="main">⊓</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-ndet_assoc"><span class="command">lemma</span></span> ndet_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⊓</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-ndet_idemp"><span class="command">lemma</span></span> ndet_idemp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊓</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-ndet_distr"><span class="command">lemma</span></span> ndet_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⊓</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-cond_ndet_distr"><span class="command">lemma</span></span> cond_ndet_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⊓</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-ndet_cond_distr"><span class="command">lemma</span></span> ndet_cond_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">Q</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-comp_ndet_l_distr"><span class="command">lemma</span></span> comp_ndet_l_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-comp_ndet_r_distr"><span class="command">lemma</span></span> comp_ndet_r_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⊓</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-l2_5_1_A"><span class="command">lemma</span></span> l2_5_1_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">X</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">[</span><span class="bound">X</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">⨅</span> <span class="free">S</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-l2_5_1_B"><span class="command">lemma</span></span> l2_5_1_B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">[</span><span class="bound">X</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">]</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">[</span><span class="main">(</span><span class="main">⨅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-l2_5_1"><span class="command">lemma</span></span> l2_5_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">⨅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">]</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">[</span><span class="bound">X</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-empty_disj"><span class="command">lemma</span></span> empty_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">{}</span> <span class="main">=</span> Top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-l2_5_1_2"><span class="command">lemma</span></span> l2_5_1_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">⨆</span> <span class="free">S</span><span class="main">)</span><span class="main">]</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">X</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">[</span><span class="free">P</span> <span class="main">⟶</span> <span class="bound">X</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-empty_conj"><span class="command">lemma</span></span> empty_conj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="main">{}</span> <span class="main">=</span> Bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-l2_5_2"><span class="command">lemma</span></span> l2_5_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⨆</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="main">{</span><span class="bound">P</span> <span class="main">⊓</span> <span class="free">Q</span> <span class="main">|</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span><span class="main">∈</span><span class="free">S</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-l2_5_3"><span class="command">lemma</span></span> l2_5_3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⨅</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="main">{</span><span class="bound">P</span> <span class="main">⊔</span> <span class="free">Q</span> <span class="main">|</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> <span class="free">S</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-l2_5_4"><span class="command">lemma</span></span> l2_5_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⨅</span> <span class="free">S</span><span class="main">)</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="main">{</span><span class="bound">P</span> <span class="main">;;</span> <span class="free">Q</span> <span class="main">|</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> <span class="free">S</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-l2_5_5"><span class="command">lemma</span></span> l2_5_5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Q</span> <span class="main">;;</span> <span class="main">(</span><span class="main">⨅</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨅</span><span class="main">{</span><span class="free">Q</span> <span class="main">;;</span> <span class="bound">P</span> <span class="main">|</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> <span class="free">S</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-all_idem"><span class="command">lemma</span></span> all_idem <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">b</span><span class="main">.</span> <span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_def<span class="main">)</span>

<span class="keyword1" id="Relations-comp_unit_R"><span class="command">lemma</span></span> comp_unit_R <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="keyword1">Πr</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-comp_unit_L"><span class="command">lemma</span></span> comp_unit_L <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Πr</span> <span class="main">;;</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff utp_defs<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> comp_unit_simps <span class="main">=</span> comp_unit_R comp_unit_L

<span class="keyword1" id="Relations-not_cond"><span class="command">lemma</span></span> not_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="main">¬</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_conj_not_distr"><span class="command">lemma</span></span> cond_conj_not_distr<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free">R</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">R</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-imp_cond_distr"><span class="command">lemma</span></span> imp_cond_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">R</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">R</span> <span class="main">⟶</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_imp_dist"><span class="command">lemma</span></span> cond_imp_dist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⟶</span> <span class="free">R</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⟶</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_conj_distr"><span class="command">lemma</span></span> cond_conj_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_disj_distr"><span class="command">lemma</span></span> cond_disj_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∨</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">R</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∨</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_know_b"><span class="command">lemma</span></span> cond_know_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_know_nb"><span class="command">lemma</span></span> cond_know_nb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_ass_if"><span class="command">lemma</span></span> cond_ass_if<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-cond_ass_else"><span class="command">lemma</span></span> cond_ass_else<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span><span class="free">b</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Relations-not_true_eq_false"><span class="command">lemma</span></span> not_true_eq_false<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> true<span class="main">)</span> <span class="main">=</span> false"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-not_false_eq_true"><span class="command">lemma</span></span> not_false_eq_true<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> false<span class="main">)</span> <span class="main">=</span> true"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-conj_idem"><span class="command">lemma</span></span> conj_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-disj_idem"><span class="command">lemma</span></span> disj_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∨</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-conj_comm"><span class="command">lemma</span></span> conj_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-disj_comm"><span class="command">lemma</span></span> disj_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∨</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-conj_subst"><span class="command">lemma</span></span> conj_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-disj_subst"><span class="command">lemma</span></span> disj_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-conj_assoc"><span class="command">lemma</span></span> conj_assoc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-disj_assoc"><span class="command">lemma</span></span> disj_assoc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∨</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∨</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-conj_disj_abs"><span class="command">lemma</span></span> conj_disj_abs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-disj_conj_abs"><span class="command">lemma</span></span> disj_conj_abs<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-conj_disj_distr"><span class="command">lemma</span></span> conj_disj_distr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∨</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-disj_conj_dsitr"><span class="command">lemma</span></span> disj_conj_dsitr<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-true_conj_id"><span class="command">lemma</span></span> true_conj_id<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> true<span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-true_dsij_zero"><span class="command">lemma</span></span> true_dsij_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> true<span class="main">)</span> <span class="main">=</span> true"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-true_conj_zero"><span class="command">lemma</span></span> true_conj_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> false<span class="main">)</span> <span class="main">=</span> false"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-true_dsij_id"><span class="command">lemma</span></span> true_dsij_id<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> false<span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-imp_vacuous"><span class="command">lemma</span></span> imp_vacuous<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>false <span class="main">⟶</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> true"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-p_and_not_p"><span class="command">lemma</span></span> p_and_not_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> false"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-conj_disj_not_abs"><span class="command">lemma</span></span> conj_disj_not_abs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span><span class="free">P</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-p_or_not_p"><span class="command">lemma</span></span> p_or_not_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> true"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-double_negation"><span class="command">lemma</span></span> double_negation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-not_conj_deMorgans"><span class="command">lemma</span></span> not_conj_deMorgans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-not_disj_deMorgans"><span class="command">lemma</span></span> not_disj_deMorgans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-p_imp_p"><span class="command">lemma</span></span> p_imp_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> true"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-imp_imp"><span class="command">lemma</span></span> imp_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⟶</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">R</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-imp_trans"><span class="command">lemma</span></span> imp_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⟶</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⟶</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">⟶</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> true"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-p_equiv_p"><span class="command">lemma</span></span> p_equiv_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⟷</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> true"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-equiv_eq"><span class="command">lemma</span></span> equiv_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span><span class="free">P</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> true<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-equiv_eq1"><span class="command">lemma</span></span> equiv_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> predicate<span class="main">)</span> <span class="main">⟷</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> true<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-cond_subst"><span class="command">lemma</span></span> cond_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">c</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">◃</span> <span class="free">c</span> <span class="main">▹</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Relations-ex_disj_distr"><span class="command">lemma</span></span> ex_disj_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span><span class="bound">x</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∃</b></span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">∨</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-all_disj_distr"><span class="command">lemma</span></span> all_disj_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">x</span><span class="main">.</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-all_conj_distr"><span class="command">lemma</span></span> all_conj_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">x</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-all_triv"><span class="command">lemma</span></span> all_triv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="hidden">❙</span><b>∀</b></span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-closure_true"><span class="command">lemma</span></span> closure_true<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>true<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-closure_p_eq_true"><span class="command">lemma</span></span> closure_p_eq_true<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">P</span><span class="main">]</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">P</span> <span class="main">=</span> true<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-closure_equiv_eq"><span class="command">lemma</span></span> closure_equiv_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">P</span> <span class="main">⟷</span> <span class="free">Q</span><span class="main">]</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff utp_defs<span class="main">)</span>

<span class="keyword1" id="Relations-closure_conj_distr"><span class="command">lemma</span></span> closure_conj_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="free">P</span><span class="main">]</span> <span class="main">∧</span> <span class="main">[</span><span class="free">Q</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-closure_imp_distr"><span class="command">lemma</span></span> closure_imp_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">P</span> <span class="main">⟶</span> <span class="free">Q</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">[</span><span class="free">P</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">[</span><span class="free">Q</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-true_iff"><span class="command">lemma</span></span> true_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⟷</span> true<span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Relations-true_imp"><span class="command">lemma</span></span> true_imp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>true <span class="main">⟶</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Designs">
<div class="head">
<h1>Theory Designs</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Designs›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Designs
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Relations.html">Relations</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In UTP, in order to explicitly record the termination of a program, 
a subset of alphabetized relations is introduced. These relations are called 
designs and their alphabet should contain the special boolean observational variable ok. 
It is used to record the start and termination of a program.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the following, the definitions of designs alphabets, designs and 
healthiness (well-formedness) conditions are given. The healthiness conditions of
designs are defined by $H1$, $H2$, $H3$ and $H4$.›</span></span>

<span class="keyword1"><span class="command">record</span></span> alpha_d <span class="main">=</span> ok<span class="main">::</span><span class="quoted">bool</span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> alphabet_d  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> alpha_d_scheme alphabet"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> relation_d <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> alphabet_d relation"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">design</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation_d <span class="main">⇒</span> <span class="tfree">'α</span> relation_d <span class="main">⇒</span> <span class="tfree">'α</span> relation_d"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_ <span class="keyword1">⊢</span> _<span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">" <span class="main"><span class="free">(</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⊢</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span> <span class="main">.</span>  <span class="main">(</span>ok <span class="bound">A</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>ok <span class="bound">A'</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">A'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">skip_d</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation_d"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Πd</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Πd</span></span> <span class="main">≡</span> <span class="main">(</span>true <span class="main">⊢</span> <span class="keyword1">Πr</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">J</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span>  <span class="main">≡</span>  <span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span>ok <span class="bound">A</span>  <span class="main">⟶</span>  ok <span class="bound">A'</span><span class="main">)</span> <span class="main">∧</span> more <span class="bound">A</span> <span class="main">=</span> more <span class="bound">A'</span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> Healthiness_condition <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation <span class="main">⇒</span> <span class="tfree">'α</span> relation"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
<span class="entity">Healthy</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation <span class="main">⇒</span> <span class="tfree">'α</span> Healthiness_condition <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">is</span> _ <span class="keyword1">healthy</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">is</span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="keyword1"><span class="free">healthy</span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Designs-Healthy_def'"><span class="command">lemma</span></span> Healthy_def'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> <span class="free">H</span> <span class="keyword1">healthy</span> <span class="main">=</span> <span class="main">(</span><span class="free">H</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Healthy_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">H1</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> alphabet_d<span class="main">)</span> Healthiness_condition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">H1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>  <span class="main">≡</span>  <span class="main">(</span>ok <span class="keyword1">o</span> fst  <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">H2</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> alphabet_d<span class="main">)</span> Healthiness_condition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">H2</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>  <span class="main">≡</span>  <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">;;</span> J"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">H3</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> alphabet_d<span class="main">)</span> Healthiness_condition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">H3</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>  <span class="main">≡</span>  <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">;;</span> <span class="keyword1">Πd</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">H4</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> alphabet_d<span class="main">)</span> Healthiness_condition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">H4</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>  <span class="main">≡</span>  <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">;;</span>true<span class="main">)</span> <span class="main">⟷</span> true<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">σf</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation_d <span class="main">⇒</span> <span class="tfree">'α</span> relation_d"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">σf</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">σt</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation_d <span class="main">⇒</span> <span class="tfree">'α</span> relation_d"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">σt</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok<span class="main">:=</span>True<span class="main">⦈</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">OKAY</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation_d"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">OKAY</span> <span class="main">≡</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span> <span class="main">.</span> ok <span class="bound">A</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">OKAY'</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> relation_d"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">OKAY'</span> <span class="main">≡</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span> <span class="main">.</span> ok <span class="bound">A'</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> design_defs <span class="main">=</span> design_def skip_d_def J_def Healthy_def H1_def H2_def H3_def
                     H4_def σf_def σt_def OKAY_def OKAY'_def

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Proofs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proof of theorems and properties of designs and their healthiness conditions 
are given in the following.›</span></span>

<span class="keyword1" id="Designs-t_comp_lz_d"><span class="command">lemma</span></span> t_comp_lz_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>true<span class="main">;;</span><span class="main">(</span><span class="free">P</span> <span class="main">⊢</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> true"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff design_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Designs-pi_comp_left_unit"><span class="command">lemma</span></span> pi_comp_left_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">Πd</span><span class="main">;;</span><span class="main">(</span><span class="free">P</span> <span class="main">⊢</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊢</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff design_defs<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> t3_1_4_2<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P1</span> <span class="main">⊢</span> <span class="free">Q1</span><span class="main">)</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="main">(</span><span class="free">P2</span> <span class="main">⊢</span> <span class="free">Q2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P1</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">P2</span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">Q1</span> <span class="main">◃</span> <span class="free">b</span> <span class="main">▹</span> <span class="free">Q2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff design_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Designs-conv_conj_distr"><span class="command">lemma</span></span> conv_conj_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"σt <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>σt <span class="free">P</span> <span class="main">∧</span> σt <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-conv_disj_distr"><span class="command">lemma</span></span> conv_disj_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"σt <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>σt <span class="free">P</span> <span class="main">∨</span> σt <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-conv_imp_distr"><span class="command">lemma</span></span> conv_imp_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"σt <span class="main">(</span><span class="free">P</span> <span class="main">⟶</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>σt <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span> σt <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-conv_not_distr"><span class="command">lemma</span></span> conv_not_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"σt <span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span>σt <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-div_conj_distr"><span class="command">lemma</span></span> div_conj_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"σf <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>σf <span class="free">P</span> <span class="main">∧</span> σf <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-div_disj_distr"><span class="command">lemma</span></span> div_disj_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"σf <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>σf <span class="free">P</span> <span class="main">∨</span> σf <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-div_imp_distr"><span class="command">lemma</span></span> div_imp_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"σf <span class="main">(</span><span class="free">P</span> <span class="main">⟶</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>σf <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span> σf <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-div_not_distr"><span class="command">lemma</span></span> div_not_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"σf <span class="main">(</span><span class="main">¬</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span>σf <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-ok_conv"><span class="command">lemma</span></span> ok_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"σt OKAY <span class="main">=</span> OKAY"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-ok_div"><span class="command">lemma</span></span> ok_div<span class="main">:</span> <span class="quoted"><span class="quoted">"σf OKAY <span class="main">=</span> OKAY"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-ok'_conv"><span class="command">lemma</span></span> ok'_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"σt OKAY' <span class="main">=</span> true"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-ok'_div"><span class="command">lemma</span></span> ok'_div<span class="main">:</span> <span class="quoted"><span class="quoted">"σf OKAY' <span class="main">=</span> false"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-H2_J_1"><span class="command">lemma</span></span> H2_J_1<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> H2 <span class="keyword1">healthy</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-H2_J_2_a"><span class="command">lemma</span></span> H2_J_2_a <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> J<span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> J_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Designs-ok_or_not_ok"><span class="command">lemma</span></span> ok_or_not_ok <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span><span class="main">;</span> <span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>True<span class="main">⦈</span> <span class="main">=</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span> <span class="main">=</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Designs-H2_J_2_b"><span class="command">lemma</span></span> H2_J_2_b <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> J<span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> B
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="improper">ba</span><span class="main">⦇</span>ok<span class="main">:=</span>True<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ba</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="improper">ba</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">ba</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="improper">ba</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="improper">ba</span><span class="main">⦇</span>ok<span class="main">:=</span>True<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ba</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  

<span class="keyword1" id="Designs-H2_J_2"><span class="command">lemma</span></span> H2_J_2 <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> H2 <span class="keyword1">healthy</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H2_def Healthy_def fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H2_J_2_a<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> H2_J_2_b <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Designs-H2_J"><span class="command">lemma</span></span> H2_J<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="free">P</span> <span class="keyword1">is</span> H2 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> H2_J_1 H2_J_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Designs-design_eq1"><span class="command">lemma</span></span> design_eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊢</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊢</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs<span class="main">)</span>

<span class="keyword1" id="Designs-H1_idem"><span class="command">lemma</span></span> H1_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"H1 <span class="keyword1">o</span> H1 <span class="main">=</span> H1"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-H1_idem2"><span class="command">lemma</span></span> H1_idem2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H1 <span class="main">(</span>H1 <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>H1 <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H1_idem<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> fun_eq_iff Fun.comp_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-H2_idem"><span class="command">lemma</span></span> H2_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"H2 <span class="keyword1">o</span> H2 <span class="main">=</span> H2"</span></span>  
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>
  
<span class="keyword1" id="Designs-H2_idem2"><span class="command">lemma</span></span> H2_idem2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>H2 <span class="main">(</span>H2 <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>H2 <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H2_idem<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> fun_eq_iff Fun.comp_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-H1_H2_commute"><span class="command">lemma</span></span> H1_H2_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"H1 <span class="keyword1">o</span> H2 <span class="main">=</span> H2 <span class="keyword1">o</span> H1"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Designs-H1_H2_commute2"><span class="command">lemma</span></span> H1_H2_commute2<span class="main">:</span> <span class="quoted"><span class="quoted">"H1 <span class="main">(</span>H2 <span class="free">P</span><span class="main">)</span> <span class="main">=</span> H2 <span class="main">(</span>H1 <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H1_H2_commute<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> fun_eq_iff Fun.comp_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-alpha_d_eqD"><span class="command">lemma</span></span> alpha_d_eqD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">r'</span> <span class="main">⟹</span> ok <span class="free">r</span> <span class="main">=</span> ok <span class="free">r'</span> <span class="main">∧</span> alpha_d.more <span class="free">r</span> <span class="main">=</span> alpha_d.more <span class="free">r'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> alpha_d.equality<span class="main">)</span>

<span class="keyword1" id="Designs-design_H1"><span class="command">lemma</span></span> design_H1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊢</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">is</span> H1 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Designs-design_H2"><span class="command">lemma</span></span> design_H2<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊢</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">is</span> H2 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> H2_J_2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Reactive_Processes">
<div class="head">
<h1>Theory Reactive_Processes</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Reactive processes›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Reactive_Processes
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Designs.html">Designs</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Sublist.html">HOL-Library.Sublist</a>"</span>
<span class="comment1">(* isabelle2012 "HOL-Library.List_Prefix" *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Following the way of UTP to describe reactive processes, more observational
variables are needed to record the interaction with the environment. Three observational 
variables are defined for this subset of relations: $wait$, $tr$ and $ref$.
The boolean variable $wait$ records if the process is waiting for an interaction
or has terminated. $tr$ records the list (trace) of interactions the process has
performed so far. The variable $ref$ contains the set of interactions (events) the
process may refuse to perform.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section, we introduce first some preliminary notions, useful for 
 trace manipulations. The definitions of reactive process alphabets and healthiness 
conditions are also given. Finally, proved lemmas and theorems are listed.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> trace <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> list"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">list_diff</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> list <span class="main">⇒</span> <span class="tfree">'α</span> list <span class="main">⇒</span> <span class="tfree">'α</span> list option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">list_diff</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">[]</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">l</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">list_diff</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> None"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">list_diff</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">list_diff</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span>  list <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">minus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> list_minus <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">≡</span> the <span class="main">(</span>list_diff <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Reactive_Processes-list_diff_empty"><span class="command">lemma</span></span> list_diff_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span>list_diff <span class="free">l</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Reactive_Processes-prefix_diff_empty"><span class="command">lemma</span></span> prefix_diff_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span>  <span class="main">-</span> <span class="main">[]</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_minus<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-prefix_diff_eq"><span class="command">lemma</span></span> prefix_diff_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">-</span> <span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_minus<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-prefix_diff"><span class="command">lemma</span></span> prefix_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">l</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_minus<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-prefix_subst"><span class="command">lemma</span></span> prefix_subst <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">@</span> <span class="free">t</span> <span class="main">=</span> <span class="free">m</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">-</span> <span class="free">l</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-prefix_subst1"><span class="command">lemma</span></span> prefix_subst1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">l</span> <span class="main">@</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">-</span> <span class="free">l</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-prefix_diff1"><span class="command">lemma</span></span> prefix_diff1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">l</span> <span class="main">@</span> <span class="free">m</span><span class="main">)</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">l</span> <span class="main">@</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prefix_diff<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-prefix_diff2"><span class="command">lemma</span></span> prefix_diff2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span> <span class="main">@</span> <span class="main">(</span><span class="free">m</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">l</span> <span class="main">@</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> append_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> prefix_diff1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Reactive_Processes-prefix_diff3"><span class="command">lemma</span></span> prefix_diff3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span> <span class="main">@</span> <span class="free">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">l</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_minus<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-prefix_diff4"><span class="command">lemma</span></span> prefix_diff4 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">m</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_minus<span class="main">)</span>


<span class="keyword1"><span class="command">class</span></span> ev_eq <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">ev_eq</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ev_eq</span> <span class="free">a</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ev_eq</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="free">ev_eq</span> <span class="free">b</span> <span class="free">a</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">filter_chan_set</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">e</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">.</span> ev_eq <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Reactive_Processes-in_imp_not_fcs"><span class="command">lemma</span></span> in_imp_not_fcs<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">S</span> <span class="main">⟹</span> <span class="main">¬</span> filter_chan_set <span class="free">x</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_chan_set_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> refl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tr_filter</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ev_eq list <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">tr_filter</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">tr_filter</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>filter_chan_set <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="main">(</span><span class="free">tr_filter</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span>
                                                                  <span class="keyword1">else</span> <span class="main">(</span><span class="free">tr_filter</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Reactive_Processes-tr_filter_conc"><span class="command">lemma</span></span> tr_filter_conc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tr_filter <span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="free">b</span><span class="main">)</span> <span class="free">cs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>tr_filter <span class="free">a</span> <span class="free">cs</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>tr_filter <span class="free">b</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-filter_chan_set_hd_tr_filter"><span class="command">lemma</span></span> filter_chan_set_hd_tr_filter<span class="main">:</span>
<span class="quoted"><span class="quoted">"tr_filter <span class="free">l</span> <span class="free">cs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">--&gt;</span> filter_chan_set <span class="main">(</span>hd <span class="main">(</span>tr_filter <span class="free">l</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span> <span class="free">cs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-tr_filter_conc_eq1"><span class="command">lemma</span></span> tr_filter_conc_eq1<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="free">b</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="free">c</span><span class="main">)</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="free">c</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr_filter <span class="main">(</span><span class="improper">a2</span> <span class="main">@</span> <span class="free">c</span><span class="main">)</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> filter_chan_set_hd_tr_filter<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr_filter <span class="main">(</span><span class="improper">a2</span> <span class="main">@</span> <span class="free">c</span><span class="main">)</span> <span class="free">cs</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Reactive_Processes-tr_filter_conc_eq2"><span class="command">lemma</span></span> tr_filter_conc_eq2<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="free">b</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="free">c</span><span class="main">)</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="free">a</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr_filter <span class="main">(</span><span class="improper">a2</span> <span class="main">@</span> <span class="free">c</span><span class="main">)</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> filter_chan_set_hd_tr_filter<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr_filter <span class="main">(</span><span class="improper">a2</span> <span class="main">@</span> <span class="free">c</span><span class="main">)</span> <span class="free">cs</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr_filter <span class="main">(</span><span class="improper">a2</span> <span class="main">@</span> <span class="free">c</span><span class="main">)</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> filter_chan_set_hd_tr_filter<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr_filter <span class="main">(</span><span class="improper">a2</span> <span class="main">@</span> <span class="free">c</span><span class="main">)</span> <span class="free">cs</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Reactive_Processes-tr_filter_conc_eq"><span class="command">lemma</span></span> tr_filter_conc_eq<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="free">b</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="free">c</span><span class="main">)</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="free">c</span> <span class="free">cs</span><span class="main">)</span> <span class="main">&amp;</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="free">a</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tr_filter_conc_eq1<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tr_filter_conc_eq2<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tr_filter_conc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Reactive_Processes-tr_filter_conc_eq3"><span class="command">lemma</span></span> tr_filter_conc_eq3<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="main">(</span><span class="free">a</span><span class="main">@</span><span class="free">c</span><span class="main">)</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">b1</span> <span class="bound">b2</span><span class="main">.</span> <span class="free">b</span><span class="main">=</span><span class="bound">b1</span><span class="main">@</span><span class="bound">b2</span> <span class="main">&amp;</span> <span class="bound">b2</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="free">c</span> <span class="free">cs</span><span class="main">)</span> <span class="main">&amp;</span> <span class="bound">b1</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="free">a</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tr_filter_conc<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-tr_filter_un"><span class="command">lemma</span></span> tr_filter_un<span class="main">:</span>
<span class="quoted"><span class="quoted">"tr_filter <span class="free">l</span> <span class="main">(</span><span class="free">s1</span> <span class="main">∪</span> <span class="free">s2</span><span class="main">)</span> <span class="main">=</span> tr_filter <span class="main">(</span>tr_filter <span class="free">l</span> <span class="free">s1</span><span class="main">)</span> <span class="free">s2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_chan_set_def<span class="main">)</span>


<span class="keyword1"><span class="command">instantiation</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted">ev_eq</span><span class="main">)</span> <span class="quoted">ev_eq</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">ev_eq_list</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ev_eq_list</span> <span class="main">[]</span> <span class="main">[]</span> <span class="main">=</span> True"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ev_eq_list</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ev_eq_list</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> False"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ev_eq_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>ev_eq <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">ev_eq_list</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="keyword1">else</span> False<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ev_eq list"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ev_eq <span class="skolem">a</span> <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ev_eq_class.refl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ev_eq list"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ev_eq <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> ev_eq <span class="skolem">b</span> <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ev_eq_class.comm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hypsubst_thin</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ev_eq_class.comm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ev_eq <span class="improper">aa</span> <span class="improper">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ev_eq_class.comm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">list</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">atomize</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="improper">list</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="improper">list</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> hd_Cons_tl<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="comment1">(* isabelle 2013 *)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">subl</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">≤</span> _"</span><span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main"><span class="free">≤</span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">==</span> Sublist.prefix <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span>"</span></span>

<span class="keyword1" id="Reactive_Processes-list_diff_empty_eq"><span class="command">lemma</span></span> list_diff_empty_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l1</span> <span class="main">-</span> <span class="free">l2</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">l2</span> <span class="main">≤</span> <span class="free">l1</span> <span class="main">⟹</span> <span class="free">l1</span> <span class="main">=</span> <span class="free">l2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>


<span class="comment1">(* end isabelle 2013 *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The definitions of reactive process alphabets and healthiness conditions are given
in the following. The healthiness conditions of reactive processes are defined by 
$R1$, $R2$, $R3$ and their composition $R$.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'θ</span> refusal <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'θ</span> set"</span></span>
  
<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'θ</span> alpha_rp  <span class="main">=</span> <span class="quoted">alpha_d</span> <span class="main">+</span> 
                         wait<span class="main">::</span> <span class="quoted">bool</span>
                         tr  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'θ</span> trace"</span></span>
                         ref <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'θ</span> refusal"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Note that we define here the class of UTP alphabets that contain
$wait$, $tr$ and $ref$, or, in other words, we define here the class of reactive process
alphabets.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> alphabet_rp  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> alpha_rp_scheme alphabet"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> relation_rp  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> alphabet_rp relation"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">diff_tr</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>tr <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>tr <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>bool<span class="main">,</span> bool<span class="main">,</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> relation_rp<span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> relation_rp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">spec</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">b'</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">A</span><span class="main">⦇</span>wait <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">b'</span></span></span><span class="main">⦈</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⦈</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Speciftt</span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>t</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="keyword1"><span class="free"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">≡</span> spec True True <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Specifff</span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="keyword1"><span class="free"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span></span> <span class="main">≡</span> spec False False <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Speciftf</span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="keyword1"><span class="free"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span></span> <span class="main">≡</span> spec True False <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Specifft</span> <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>t</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="keyword1"><span class="free"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">≡</span> spec False True <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">R1</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> alphabet_rp<span class="main">)</span> Healthiness_condition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">R1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>  <span class="main">≡</span>  <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>tr <span class="bound">A</span> <span class="main">≤</span> tr <span class="bound">A'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">R2</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> alphabet_rp<span class="main">)</span> Healthiness_condition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">R2</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>  <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">A</span><span class="main">⦇</span>tr<span class="main">:=</span><span class="main">[]</span><span class="main">⦈</span><span class="main">,</span><span class="bound">A'</span><span class="main">⦇</span>tr<span class="main">:=</span> tr <span class="bound">A'</span> <span class="main">-</span> tr <span class="bound">A</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span> tr <span class="bound">A</span> <span class="main">≤</span> tr <span class="bound">A'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Πrea</span>   
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Πrea</span>  <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span>ok <span class="bound">A</span> <span class="main">∧</span> tr <span class="bound">A</span> <span class="main">≤</span> tr <span class="bound">A'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>ok <span class="bound">A'</span> <span class="main">∧</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span> 
                            <span class="main">∧</span> <span class="main">(</span>wait <span class="bound">A</span> <span class="main">=</span> wait <span class="bound">A'</span><span class="main">)</span> <span class="main">∧</span> ref <span class="bound">A</span> <span class="main">=</span> ref <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A</span> <span class="main">=</span> more <span class="bound">A'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">R3</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> alphabet_rp<span class="main">)</span> Healthiness_condition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">R3</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>  <span class="main">≡</span> <span class="main">(</span>Πrea <span class="main">◃</span> wait <span class="keyword1">o</span> fst <span class="main">▹</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">R</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> alphabet_rp<span class="main">)</span> Healthiness_condition"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span>  <span class="main">≡</span> R3 <span class="keyword1">o</span> R2 <span class="keyword1">o</span> R1"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> rp_defs <span class="main">=</span> R1_def R2_def Πrea_def R3_def R_def spec_def

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Proofs›</span></span>

<span class="keyword1" id="Reactive_Processes-tr_filter_empty"><span class="command">lemma</span></span> tr_filter_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tr_filter <span class="free">l</span> <span class="main">{}</span> <span class="main">=</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_chan_set_def<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-trf_imp_filtercs"><span class="command">lemma</span></span> trf_imp_filtercs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">xs</span> <span class="main">=</span> tr_filter <span class="free">ys</span> <span class="free">cs</span><span class="main">;</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> filter_chan_set <span class="main">(</span>hd <span class="free">xs</span><span class="main">)</span> <span class="free">cs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ys</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"filter_chan_set <span class="improper">a</span> <span class="free">cs</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Reactive_Processes-filtercs_imp_trf"><span class="command">lemma</span></span> filtercs_imp_trf<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span>filter_chan_set <span class="free">x</span> <span class="free">cs</span><span class="main">;</span> <span class="free">xs</span> <span class="main">=</span> tr_filter <span class="free">ys</span> <span class="free">cs</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">#</span><span class="free">xs</span> <span class="main">=</span> tr_filter <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">ys</span><span class="main">)</span> <span class="free">cs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Reactive_Processes-alpha_d_more_eqI"><span class="command">lemma</span></span> alpha_d_more_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tr <span class="free">r</span> <span class="main">=</span> tr <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"wait <span class="free">r</span> <span class="main">=</span> wait <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"ref <span class="free">r</span> <span class="main">=</span> ref <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"more <span class="free">r</span> <span class="main">=</span> more <span class="free">r'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"alpha_d.more <span class="free">r</span> <span class="main">=</span> alpha_d.more <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">r'</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Reactive_Processes-alpha_d_more_eqE"><span class="command">lemma</span></span> alpha_d_more_eqE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"alpha_d.more <span class="free">r</span> <span class="main">=</span> alpha_d.more <span class="free">r'</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"tr <span class="free">r</span> <span class="main">=</span> tr <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"wait <span class="free">r</span> <span class="main">=</span> wait <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"ref <span class="free">r</span> <span class="main">=</span> ref <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"more <span class="free">r</span> <span class="main">=</span> more <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">r'</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Reactive_Processes-alpha_rp_eqE"><span class="command">lemma</span></span> alpha_rp_eqE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">r'</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"ok <span class="free">r</span> <span class="main">=</span> ok <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"tr <span class="free">r</span> <span class="main">=</span> tr <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"wait <span class="free">r</span> <span class="main">=</span> wait <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"ref <span class="free">r</span> <span class="main">=</span> ref <span class="free">r'</span>"</span></span> <span class="quoted"><span class="quoted">"more <span class="free">r</span> <span class="main">=</span> more <span class="free">r'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">r'</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Reactive_Processes-R_idem"><span class="command">lemma</span></span> R_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"R <span class="keyword1">o</span> R <span class="main">=</span> R"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R_idem2"><span class="command">lemma</span></span> R_idem2<span class="main">:</span> <span class="quoted"><span class="quoted">"R <span class="main">(</span>R <span class="free">P</span><span class="main">)</span> <span class="main">=</span> R <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R1_idem"><span class="command">lemma</span></span> R1_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"R1 <span class="keyword1">o</span> R1 <span class="main">=</span> R1"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R1_idem2"><span class="command">lemma</span></span> R1_idem2<span class="main">:</span> <span class="quoted"><span class="quoted">"R1 <span class="main">(</span>R1 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> R1 <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R2_idem"><span class="command">lemma</span></span> R2_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"R2 <span class="keyword1">o</span> R2 <span class="main">=</span> R2"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff prefix_def<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R2_idem2"><span class="command">lemma</span></span> R2_idem2<span class="main">:</span> <span class="quoted"><span class="quoted">"R2 <span class="main">(</span>R2 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> R2 <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff prefix_def<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R3_idem"><span class="command">lemma</span></span> R3_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"R3 <span class="keyword1">o</span> R3 <span class="main">=</span> R3"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R3_idem2"><span class="command">lemma</span></span> R3_idem2<span class="main">:</span> <span class="quoted"><span class="quoted">"R3 <span class="main">(</span>R3 <span class="free">x</span><span class="main">)</span> <span class="main">=</span> R3 <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R3_idem<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Fun.comp_def fun_eq_iff<span class="main"><span class="main">]</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R1_R2_commute"><span class="command">lemma</span></span> R1_R2_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R1 <span class="keyword1">o</span> R2<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>R2 <span class="keyword1">o</span> R1<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff prefix_def<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R1_R3_commute"><span class="command">lemma</span></span> R1_R3_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R1 <span class="keyword1">o</span> R3<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>R3 <span class="keyword1">o</span> R1<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R2_R3_commute"><span class="command">lemma</span></span> R2_R3_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"R2 <span class="keyword1">o</span> R3 <span class="main">=</span> R3 <span class="keyword1">o</span> R2"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff prefix_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R_abs_R1"><span class="command">lemma</span></span> R_abs_R1<span class="main">:</span> <span class="quoted"><span class="quoted">"R <span class="keyword1">o</span> R1 <span class="main">=</span> R"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> R1_idem<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Reactive_Processes-R_abs_R2"><span class="command">lemma</span></span> R_abs_R2<span class="main">:</span> <span class="quoted"><span class="quoted">"R <span class="keyword1">o</span> R2 <span class="main">=</span> R"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R_abs_R3"><span class="command">lemma</span></span> R_abs_R3<span class="main">:</span> <span class="quoted"><span class="quoted">"R <span class="keyword1">o</span> R3 <span class="main">=</span> R"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R_is_R1"><span class="command">lemma</span></span> R_is_R1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R1 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="free">P</span><span class="main">)</span> <span class="keyword1">is</span> R1 <span class="keyword1">healthy</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Reactive_Processes-R_is_R2"><span class="command">lemma</span></span> R_is_R2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R2 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="free">P</span><span class="main">)</span> <span class="keyword1">is</span> R2 <span class="keyword1">healthy</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs rp_defs fun_eq_iff prefix_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Reactive_Processes-R_is_R3"><span class="command">lemma</span></span> R_is_R3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R3 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="free">P</span><span class="main">)</span> <span class="keyword1">is</span> R3 <span class="keyword1">healthy</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Reactive_Processes-R_disj"><span class="command">lemma</span></span> R_disj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"R <span class="free">Q</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>R <span class="free">P</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>R <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Reactive_Processes-R_disj2"><span class="command">lemma</span></span> R_disj2<span class="main">:</span>  <span class="quoted"><span class="quoted">"R <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>R <span class="free">P</span> <span class="main">∨</span> R <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> R_disj<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"R <span class="free"><span class="free">P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_idem2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff rp_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Reactive_Processes-R1_comp"><span class="command">lemma</span></span> R1_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R1 <span class="keyword1">healthy</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="keyword1">is</span> R1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">;;</span><span class="free">Q</span><span class="main">)</span> <span class="keyword1">is</span> R1 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R1 <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"R1 <span class="free">Q</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>R1 <span class="free">P</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>R1 <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">is</span> R1 <span class="keyword1">healthy</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Reactive_Processes-R1_comp2"><span class="command">lemma</span></span> R1_comp2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="keyword1">is</span> R1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"R1 <span class="main">(</span><span class="free">P</span><span class="main">;;</span><span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>R1 <span class="free">P</span><span class="main">)</span><span class="main">;;</span><span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> A B
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> R1_comp<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff rp_defs design_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Reactive_Processes-J_is_R1"><span class="command">lemma</span></span> J_is_R1<span class="main">:</span> <span class="quoted"><span class="quoted">"J <span class="keyword1">is</span> R1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-J_is_R2"><span class="command">lemma</span></span> J_is_R2<span class="main">:</span> <span class="quoted"><span class="quoted">"J <span class="keyword1">is</span> R2 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff prefix_def
    <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_d_more_eqI<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R1_H2_commute2"><span class="command">lemma</span></span> R1_H2_commute2<span class="main">:</span> <span class="quoted"><span class="quoted">"R1 <span class="main">(</span>H2 <span class="free">P</span><span class="main">)</span> <span class="main">=</span> H2 <span class="main">(</span>R1 <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H2_def R1_def J_def fun_eq_iff
    <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_d_more_eqI<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R1_H2_commute"><span class="command">lemma</span></span> R1_H2_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"R1 <span class="keyword1">o</span> H2 <span class="main">=</span> H2 <span class="keyword1">o</span> R1"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R1_H2_commute2<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R2_H2_commute2"><span class="command">lemma</span></span> R2_H2_commute2<span class="main">:</span> <span class="quoted"><span class="quoted">"R2 <span class="main">(</span>H2 <span class="free">P</span><span class="main">)</span> <span class="main">=</span> H2 <span class="main">(</span>R2 <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff rp_defs design_defs strict_prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">a</span> <span class="main">@</span> tr <span class="improper">ba</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff prefix_def
  <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE alpha_rp_eqE <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_d_more_eqI alpha_rp.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">a</span> <span class="main">@</span> tr <span class="improper">ba</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE alpha_rp_eqE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqI alpha_rp.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">a</span> <span class="main">@</span> tr <span class="improper">ba</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE alpha_rp_eqE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqI alpha_rp.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">zs</span></span></span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Reactive_Processes-R2_H2_commute"><span class="command">lemma</span></span> R2_H2_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"R2 <span class="keyword1">o</span> H2 <span class="main">=</span> H2 <span class="keyword1">o</span> R2"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R2_H2_commute2<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R3_H2_commute2"><span class="command">lemma</span></span> R3_H2_commute2<span class="main">:</span> <span class="quoted"><span class="quoted">"R3 <span class="main">(</span>H2 <span class="free">P</span><span class="main">)</span> <span class="main">=</span> H2 <span class="main">(</span>R3 <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff rp_defs design_defs strict_prefix_def 
            <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Reactive_Processes-R3_H2_commute"><span class="command">lemma</span></span> R3_H2_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"R3 <span class="keyword1">o</span> H2 <span class="main">=</span> H2 <span class="keyword1">o</span> R3"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R3_H2_commute2<span class="main">)</span>

<span class="keyword1" id="Reactive_Processes-R_join"><span class="command">lemma</span></span> R_join<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"R <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>R <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>R <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Reactive_Processes-R_meet"><span class="command">lemma</span></span> R_meet<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"R <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>R <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>R <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Reactive_Processes-R_H2_commute"><span class="command">lemma</span></span> R_H2_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"R <span class="keyword1">o</span> H2 <span class="main">=</span> H2 <span class="keyword1">o</span> R"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits 
                     <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">b</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits
  <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE alpha_rp_eqE <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_d_more_eqI alpha_rp.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ba</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_d_more_eqI alpha_rp.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ba</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_d_more_eqI alpha_rp.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">b</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ba</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE alpha_rp_eqE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqI alpha_rp.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">b</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE alpha_rp_eqE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqI alpha_rp.equality <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ba</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span>
  <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE alpha_rp_eqE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqI alpha_rp.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Reactive_Processes-R_H2_commute2"><span class="command">lemma</span></span> R_H2_commute2<span class="main">:</span> <span class="quoted"><span class="quoted">"R <span class="main">(</span>H2 <span class="free">P</span><span class="main">)</span> <span class="main">=</span> H2 <span class="main">(</span>R <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff R_H2_commute<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> fun_eq_iff Fun.comp_def<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CSP_Processes">
<div class="head">
<h1>Theory CSP_Processes</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹CSP processes›</span></span>

<span class="keyword1"><span class="command">theory</span></span> CSP_Processes
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Reactive_Processes.html">Reactive_Processes</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A CSP process is a UTP reactive process that satisfies two additional
healthiness conditions called $CSP1$ and $CSP2$. A reactive process that satisfies 
$CSP1$ and $CSP2$ is said to be CSP healthy.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We introduce here the definitions of the CSP healthiness conditions.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">CSP1</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> alphabet_rp<span class="main">)</span> Healthiness_condition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">CSP1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>  <span class="main">≡</span>  <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span>ok <span class="bound">A</span> <span class="main">∧</span> tr <span class="bound">A</span> <span class="main">≤</span> tr <span class="bound">A'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">J_csp</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">J_csp</span>  <span class="main">≡</span>  <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>ok <span class="bound">A</span> <span class="main">⟶</span> ok <span class="bound">A'</span><span class="main">)</span> <span class="main">∧</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span> <span class="main">∧</span> wait <span class="bound">A</span> <span class="main">=</span> wait <span class="bound">A'</span> 
                                                     <span class="main">∧</span> ref <span class="bound">A</span> <span class="main">=</span> ref <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A</span> <span class="main">=</span> more <span class="bound">A'</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">CSP2</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> alphabet_rp<span class="main">)</span> Healthiness_condition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">CSP2</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>  <span class="main">≡</span>  <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">;;</span> J_csp"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_CSP_process</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> relation_rp <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_CSP_process</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> csp_defs <span class="main">=</span> CSP1_def J_csp_def CSP2_def is_CSP_process_def

<span class="keyword1" id="CSP_Processes-is_CSP_processE1"><span class="command">lemma</span></span> is_CSP_processE1 <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_CSP_process_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="CSP_Processes-is_CSP_processE2"><span class="command">lemma</span></span> is_CSP_processE2 <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"CSP1 <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"CSP2 <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"R <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_CSP_process_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def'<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Proofs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorems and lemmas relative to CSP processes are introduced here.›</span></span>

<span class="keyword1" id="CSP_Processes-CSP1_CSP2_commute"><span class="command">lemma</span></span> CSP1_CSP2_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"CSP1 <span class="keyword1">o</span> CSP2 <span class="main">=</span> CSP2 <span class="keyword1">o</span> CSP1"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP2_is_H2"><span class="command">lemma</span></span> CSP2_is_H2<span class="main">:</span> <span class="quoted"><span class="quoted">"H2 <span class="main">=</span> CSP2"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> comp_elim<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">ba</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_d_more_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-H2_CSP1_commute"><span class="command">lemma</span></span> H2_CSP1_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"H2 <span class="keyword1">o</span> CSP1 <span class="main">=</span> CSP1 <span class="keyword1">o</span> H2"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP2_is_H2<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CSP1_CSP2_commute<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-H2_CSP1_commute2"><span class="command">lemma</span></span> H2_CSP1_commute2<span class="main">:</span> <span class="quoted"><span class="quoted">"H2 <span class="main">(</span>CSP1 <span class="free">P</span><span class="main">)</span> <span class="main">=</span> CSP1 <span class="main">(</span>H2 <span class="free">P</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H2_CSP1_commute<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Fun.comp_def fun_eq_iff<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP1_R_commute"><span class="command">lemma</span></span> CSP1_R_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"CSP1 <span class="main">(</span>R <span class="free">P</span><span class="main">)</span> <span class="main">=</span> R <span class="main">(</span>CSP1 <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs rp_defs fun_eq_iff prefix_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP2_R_commute"><span class="command">lemma</span></span> CSP2_R_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"CSP2 <span class="main">(</span>R <span class="free">P</span><span class="main">)</span> <span class="main">=</span> R <span class="main">(</span>CSP2 <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP2_is_H2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> R_H2_commute2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-CSP1_idem"><span class="command">lemma</span></span> CSP1_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"CSP1 <span class="main">=</span> CSP1 <span class="keyword1">o</span> CSP1"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP2_idem"><span class="command">lemma</span></span> CSP2_idem<span class="main">:</span> <span class="quoted"><span class="quoted">"CSP2 <span class="main">=</span> CSP2 <span class="keyword1">o</span> CSP2"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP_is_CSP1"><span class="command">lemma</span></span> CSP_is_CSP1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_CSP_process_def design_defs<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP_is_CSP2"><span class="command">lemma</span></span> CSP_is_CSP2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs prefix_def is_CSP_process_def<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP_is_R"><span class="command">lemma</span></span> CSP_is_R<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs prefix_def is_CSP_process_def<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-t_or_f_a"><span class="command">lemma</span></span> t_or_f_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="free">b</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ssubst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">b</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP2_ok_a"><span class="command">lemma</span></span> CSP2_ok_a<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>CSP2 <span class="free">P</span><span class="main">)</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>True<span class="main">⦈</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>True<span class="main">⦈</span><span class="main">)</span> <span class="main">∨</span> <span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> prefixE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">ba</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ssubst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> back_subst<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_rp.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-CSP2_ok_b"><span class="command">lemma</span></span> CSP2_ok_b<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>True<span class="main">⦈</span><span class="main">)</span> <span class="main">∨</span> <span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>CSP2 <span class="free">P</span><span class="main">)</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>True<span class="main">⦈</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP2_ok"><span class="command">lemma</span></span> CSP2_ok<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>CSP2 <span class="free">P</span><span class="main">)</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>True<span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>True<span class="main">⦈</span><span class="main">)</span> <span class="main">∨</span> <span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CSP2_ok_a<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CSP2_ok_b<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP2_notok_a"><span class="command">lemma</span></span> CSP2_notok_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>CSP2 <span class="free">P</span><span class="main">)</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">ba</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ssubst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> back_subst<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_rp.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-CSP2_notok_b"><span class="command">lemma</span></span> CSP2_notok_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>CSP2 <span class="free">P</span><span class="main">)</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP2_notok"><span class="command">lemma</span></span> CSP2_notok<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>CSP2 <span class="free">P</span><span class="main">)</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CSP2_notok_a<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CSP2_notok_b<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP2_t_f"><span class="command">lemma</span></span> CSP2_t_f<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>CSP2 <span class="main">(</span>R <span class="main">(</span><span class="free">r</span> <span class="main">⊢</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>CSP2 <span class="main">(</span>R <span class="main">(</span><span class="free">r</span> <span class="main">⊢</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>False<span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">(</span>CSP2 <span class="main">(</span>R <span class="main">(</span><span class="free">r</span> <span class="main">⊢</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">⦇</span>ok<span class="main">:=</span>True<span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> B<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> A<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-disj_CSP1"><span class="command">lemma</span></span> disj_CSP1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-disj_CSP2"><span class="command">lemma</span></span> disj_CSP2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span> <span class="main">==&gt;</span> <span class="free">Q</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CSP2_is_H2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Healthy_def' design_defs comp_ndet_l_distr<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-disj_CSP"><span class="command">lemma</span></span> disj_CSP<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="main">(</span><span class="free">P</span> <span class="main">∨</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_CSP_process_def Healthy_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> disj_CSP2<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> A<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> CSP_is_CSP2<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> B<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> CSP_is_CSP2<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> disj_CSP1<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> A<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> CSP_is_CSP1<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> B<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> CSP_is_CSP1<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> R_disj<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> A<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> CSP_is_R<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> B<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> CSP_is_R<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-seq_CSP1"><span class="command">lemma</span></span> seq_CSP1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> A B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-seq_CSP2"><span class="command">lemma</span></span> seq_CSP2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> A
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CSP2_is_H2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> H2_J<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="CSP_Processes-seq_R"><span class="command">lemma</span></span> seq_R<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"R <span class="free">Q</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="free">P</span> <span class="main">;;</span> R <span class="free">Q</span><span class="main">)</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs rp_defs prefix_def fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">zs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper"><span class="improper">ba</span></span></span><span class="main"><span class="main"><span class="main">⦇</span></span></span>tr <span class="main"><span class="main"><span class="main">:=</span></span></span> tr <span class="improper"><span class="improper"><span class="improper">a</span></span></span> <span class="main"><span class="main"><span class="main">@</span></span></span> tr <span class="improper"><span class="improper"><span class="improper">ba</span></span></span><span class="main"><span class="main"><span class="main">⦈</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="CSP_Processes-seq_CSP"><span class="command">lemma</span></span> seq_CSP<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="main">(</span><span class="free">P</span> <span class="main">;;</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_CSP_process_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> seq_CSP1<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CSP_is_CSP1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> CSP1_idem<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> seq_CSP2<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CSP_is_CSP2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> CSP2_idem<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> seq_R<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> B<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CSP_is_R<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> R_idem2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-rd_ind_wait"><span class="command">lemma</span></span> rd_ind_wait<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R<span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="free">P</span> <span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">=</span> <span class="main">(</span>R<span class="main">(</span><span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                  <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">,</span> wait <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">,</span> wait <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">,</span> wait <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">,</span> wait <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">,</span> wait <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">,</span> wait <span class="main">:=</span> False<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-rd_H1"><span class="command">lemma</span></span> rd_H1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R<span class="main">(</span><span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                      <span class="main">(</span>R <span class="main">(</span><span class="main">(</span><span class="main">¬</span> H1 <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">⊢</span> H1 <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-rd_H1_H2"><span class="command">lemma</span></span> rd_H1_H2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R<span class="main">(</span><span class="main">(</span><span class="main">¬</span> H1 <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                  <span class="main">⊢</span> H1 <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                        <span class="main">(</span>R<span class="main">(</span><span class="main">(</span><span class="main">¬</span><span class="main">(</span>H1 <span class="keyword1">o</span> H2<span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                  <span class="main">⊢</span> <span class="main">(</span>H1 <span class="keyword1">o</span> H2<span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs rp_defs prefix_def fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> alpha_d_more_eqE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">ba</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_d.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">ba</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_d.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">ba</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_d.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> True<span class="main">⦈</span> <span class="main">=</span> <span class="improper">ba</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_d.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> True<span class="main">⦈</span> <span class="main">=</span> <span class="improper">ba</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_d.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-rd_H1_H2_R_H1_H2"><span class="command">lemma</span></span> rd_H1_H2_R_H1_H2<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="main">(</span><span class="main">(</span><span class="main">¬</span> <span class="main">(</span>H1 <span class="keyword1">o</span> H2<span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">⊢</span> <span class="main">(</span>H1 <span class="keyword1">o</span> H2<span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span>R <span class="keyword1">o</span> H1 <span class="keyword1">o</span> H2<span class="main">)</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ba</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_d.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ba</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_d.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">ba</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ba</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ba</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> alpha_d.equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-CSP1_is_R1_H1"><span class="command">lemma</span></span> CSP1_is_R1_H1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">is</span> R1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"CSP1 <span class="free">P</span> <span class="main">=</span> R1 <span class="main">(</span>H1 <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP1_is_R1_H1_2"><span class="command">lemma</span></span> CSP1_is_R1_H1_2<span class="main">:</span> <span class="quoted"><span class="quoted">"CSP1 <span class="main">(</span>R1 <span class="free">P</span><span class="main">)</span> <span class="main">=</span> R1 <span class="main">(</span>H1 <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP1_R1_commute"><span class="command">lemma</span></span> CSP1_R1_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"CSP1 <span class="keyword1">o</span> R1 <span class="main">=</span> R1 <span class="keyword1">o</span> CSP1"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP1_R1_commute2"><span class="command">lemma</span></span> CSP1_R1_commute2<span class="main">:</span> <span class="quoted"><span class="quoted">"CSP1 <span class="main">(</span>R1 <span class="free">P</span><span class="main">)</span> <span class="main">=</span> R1 <span class="main">(</span>CSP1 <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP1_is_R1_H1_b"><span class="command">lemma</span></span> CSP1_is_R1_H1_b<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="main">(</span>R <span class="main">∘</span> R1 <span class="main">∘</span> H1 <span class="main">∘</span> H2<span class="main">)</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="main">(</span>R <span class="main">∘</span> CSP1 <span class="main">∘</span> H2<span class="main">)</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> H1_H2_commute2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> R1_H2_commute2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP1_is_R1_H1_2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> H2_CSP1_commute2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> R1_H2_commute2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP1_R1_commute2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> R_abs_R1<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Fun.comp_def fun_eq_iff<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-CSP1_join"><span class="command">lemma</span></span> CSP1_join<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> A B
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def CSP1_def fun_eq_iff utp_defs<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP2_join"><span class="command">lemma</span></span> CSP2_join<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> A B
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs csp_defs fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper"><span class="improper">b</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP1_meet"><span class="command">lemma</span></span> CSP1_meet<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> A B
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def CSP1_def fun_eq_iff utp_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper"><span class="improper">b</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP2_meet"><span class="command">lemma</span></span> CSP2_meet<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> A B
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def CSP2_def fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper"><span class="improper">b</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ca</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> J_csp_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-CSP_join"><span class="command">lemma</span></span> CSP_join<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> A B
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_CSP_process_def CSP1_join CSP2_join R_join<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-CSP_meet"><span class="command">lemma</span></span> CSP_meet<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> A B
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_CSP_process_def CSP1_meet CSP2_meet R_meet<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹CSP processes and reactive designs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section, we prove the relation between CSP processes and reactive designs.›</span></span>

<span class="keyword1" id="CSP_Processes-rd_is_CSP1"><span class="command">lemma</span></span> rd_is_CSP1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="main">(</span><span class="free">r</span> <span class="main">⊢</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> prefixE<span class="main">)</span>

<span class="keyword1" id="CSP_Processes-rd_is_CSP2"><span class="command">lemma</span></span> rd_is_CSP2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">r</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="main">(</span><span class="free">r</span> <span class="main">⊢</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP2_is_H2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> R_H2_commute2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> design_H2<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-rd_is_CSP"><span class="command">lemma</span></span> rd_is_CSP<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">r</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">⦇</span>ok <span class="main">:=</span> True<span class="main">⦈</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">r</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="main">(</span>R <span class="main">(</span><span class="free">r</span> <span class="main">⊢</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_CSP_process_def Healthy_def fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> R_idem2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rd_is_CSP2<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> A<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rd_is_CSP1<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="CSP_Processes-CSP_is_rd"><span class="command">lemma</span></span> CSP_is_rd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span>R <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="free">P</span> <span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">⊢</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rd_ind_wait<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rd_H1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rd_H1_H2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rd_H1_H2_R_H1_H2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> R_abs_R1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP1_is_R1_H1_b<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP2_is_H2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_CSP2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_CSP1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_R<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> Healthy_def<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Circus_Actions">
<div class="head">
<h1>Theory Circus_Actions</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Circus actions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Circus_Actions
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOLCF/HOLCF.html">HOLCF</a> <a href="CSP_Processes.html">CSP_Processes</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section, we introduce definitions for Circus actions with 
some useful theorems and lemmas.›</span></span>

<span class="keyword1"><span class="command">default_sort</span></span> <span class="quoted">type</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The Circus actions type is defined as the set of all the CSP healthy reactive processes.›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span><span class="quoted"><span class="quoted">"ev_eq"</span></span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span>  <span class="quoted">"action"</span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">::</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> relation_rp<span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">morphisms</span></span> relation_of action_of
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R <span class="main">(</span>false <span class="main">⊢</span> true<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> relation_rp<span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rd_is_CSP<span class="main">)</span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">print_theorems</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The type-definition introduces a new type by stating a set. In our case, 
 it is the set of reactive processes that satisfy the healthiness-conditions
 for CSP-processes, isomorphic to the new type.
 Technically, this construct introduces two constants (morphisms) definitions $relation\_of$
 and $action\_of$ as well as the usual axioms expressing the bijection <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> relation_of_inverse<span class="antiquote"><span class="antiquote">}</span></span></span></span>
 and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> action_of_inverse<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Circus_Actions-relation_of_CSP"><span class="command">lemma</span></span> relation_of_CSP<span class="main">:</span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="main">(</span>relation_of <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of <span class="free">x</span><span class="main">)</span> <span class="main">:</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> relation_of<span class="main">)</span>
<span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="main">(</span>relation_of <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Circus_Actions-relation_of_CSP1"><span class="command">lemma</span></span> relation_of_CSP1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of <span class="free">x</span><span class="main">)</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> CSP_is_CSP1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> relation_of_CSP<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Circus_Actions-relation_of_CSP2"><span class="command">lemma</span></span> relation_of_CSP2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of <span class="free">x</span><span class="main">)</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> CSP_is_CSP2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> relation_of_CSP<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Circus_Actions-relation_of_R"><span class="command">lemma</span></span> relation_of_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of <span class="free">x</span><span class="main">)</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> CSP_is_R<span class="main"><span class="main">[</span></span><span class="operator">OF</span> relation_of_CSP<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Proofs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the following, Circus actions are proved to be an instance of the $Complete\_Lattice$ class.›</span></span>

<span class="keyword1" id="Circus_Actions-relation_of_spec_f_f"><span class="command">lemma</span></span> relation_of_spec_f_f<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>relation_of <span class="free">y</span> <span class="main">⟶</span> relation_of <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span>
           <span class="main">(</span>relation_of <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span>
                      <span class="main">(</span>relation_of <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> spec_def<span class="main">)</span>

<span class="keyword1" id="Circus_Actions-relation_of_spec_t_f"><span class="command">lemma</span></span> relation_of_spec_t_f<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>relation_of <span class="free">y</span> <span class="main">⟶</span> relation_of <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span>
           <span class="main">(</span>relation_of <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span>
                     <span class="main">(</span>relation_of <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="free">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> spec_def<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"action"</span><span class="main">::</span><span class="main">(</span><span class="quoted">ev_eq</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">below</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> ref_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">[</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"action"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">ev_eq</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">po</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊑</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ref_def utp_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊑</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊑</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">⊑</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ref_def utp_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊑</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊑</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ref_def relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"action"</span>  <span class="main">::</span>  <span class="main">(</span><span class="quoted">ev_eq</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> inf_action <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inf <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> action_of <span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> sup_action <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sup <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> action_of <span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> less_eq_action <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>less_eq <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> less_action <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>less <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_action less_eq_action<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_action<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_action ref_def utp_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_action ref_def relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> utp_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inf <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_action inf_action ref_def
        csp_defs design_defs rp_defs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> action_of_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CSP_join<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inf <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_action inf_action ref_def csp_defs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> action_of_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CSP_join<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> inf <span class="skolem">y</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_action inf_action ref_def impl_def csp_defs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper"><span class="improper">b</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> action_of_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">z</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CSP_join<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> sup <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_action sup_action ref_def 
         impl_def csp_defs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> action_of_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CSP_meet<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> sup <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_action sup_action ref_def
         impl_def csp_defs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> action_of_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CSP_meet<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sup <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_action sup_action ref_def  impl_def csp_defs<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper"><span class="improper">b</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> action_of_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">z</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CSP_meet<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Circus_Actions-bot_is_action"><span class="command">lemma</span></span> bot_is_action<span class="main">:</span> <span class="quoted"><span class="quoted">"R <span class="main">(</span>false <span class="main">⊢</span> true<span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rd_is_CSP<span class="main">)</span>

<span class="keyword1" id="Circus_Actions-bot_eq_true"><span class="command">lemma</span></span> bot_eq_true<span class="main">:</span> <span class="quoted"><span class="quoted">"R <span class="main">(</span>false <span class="main">⊢</span> true<span class="main">)</span> <span class="main">=</span> R true"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff design_defs rp_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"action"</span>  <span class="main">::</span>  <span class="main">(</span><span class="quoted">ev_eq</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">bounded_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> bot_action <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bot<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action<span class="main">)</span> <span class="main">≡</span> action_of <span class="main">(</span>R<span class="main">(</span>false <span class="main">⊢</span> true<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> top_action <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action<span class="main">)</span> <span class="main">≡</span> action_of <span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> false<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bot_action
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_action less_eq_action ref_def bot_action<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> action_of_inverse<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bot_is_action<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> bot_eq_true<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> relation_of_CSP<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> top"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_action less_eq_action ref_def top_action<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> action_of_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> action_of_cases<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> action_of_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_rd<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Circus_Actions-relation_of_top"><span class="command">lemma</span></span> relation_of_top<span class="main">:</span> <span class="quoted"><span class="quoted">"relation_of top <span class="main">=</span> R<span class="main">(</span>true <span class="main">⊢</span> false<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_action<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> action_of_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> utp_defs design_defs rp_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Circus_Actions-relation_of_bot"><span class="command">lemma</span></span> relation_of_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"relation_of bot <span class="main">=</span> R true"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_action<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> action_of_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_is_action<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> bot_eq_true<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Circus_Actions-non_emptyE"><span class="command">lemma</span></span> non_emptyE<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">:</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ex_in_conv <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Circus_Actions-CSP1_Inf"><span class="command">lemma</span></span> CSP1_Inf<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> CSP1 <span class="main">(</span><span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword1"><span class="command">note</span></span> * <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">p</span><span class="main">}</span> <span class="main">|</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> CSP1 <span class="main">(</span><span class="main">λ</span><span class="bound">Aa</span><span class="main">.</span> <span class="bound">Aa</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">p</span><span class="main">}</span> <span class="main">|</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disj_introC<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disj_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">P</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> non_emptyE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Collect <span class="main">(</span>relation_of <span class="improper">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of <span class="improper">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Circus_Actions-CSP2_Inf"><span class="command">lemma</span></span> CSP2_Inf<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> CSP2 <span class="main">(</span><span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword1"><span class="command">note</span></span> * <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">p</span><span class="main">}</span> <span class="main">|</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> CSP2 <span class="main">(</span><span class="main">λ</span><span class="bound">Aa</span><span class="main">.</span> <span class="bound">Aa</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">p</span><span class="main">}</span> <span class="main">|</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">P</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> comp_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Collect <span class="improper">Pa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">Pa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> Set.imageE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs rp_defs prefix_def design_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> True<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> True<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> True<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="improper">zs</span><span class="main">,</span> ok <span class="main">:=</span> True<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Circus_Actions-R_Inf"><span class="command">lemma</span></span> R_Inf<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> R <span class="main">(</span><span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">p</span><span class="main">}</span> <span class="main">|</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> R <span class="main">(</span><span class="main">λ</span><span class="bound">Aa</span><span class="main">.</span> <span class="bound">Aa</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">{</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">p</span><span class="main">}</span> <span class="main">|</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∈</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">}</span><span class="main">)</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">P</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs rp_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> Set.imageE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs prefix_def design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"relation_of <span class="improper">xa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs prefix_def design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> *<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> non_emptyE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Collect <span class="main">(</span>relation_of <span class="improper">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of <span class="improper">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs prefix_def design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> Set.imageE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of <span class="improper">xa</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs prefix_def design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs prefix_def design_defs rp_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Circus_Actions-CSP_Inf"><span class="command">lemma</span></span> CSP_Inf<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="main">(</span><span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_CSP_process_def 
  <span class="keyword1"><span class="command">using</span></span> assms CSP1_Inf CSP2_Inf R_Inf 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Circus_Actions-Inf_is_action"><span class="command">lemma</span></span> Inf_is_action<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">⨅</span> relation_of <span class="main">`</span> <span class="free">A</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> CSP_Inf<span class="main">)</span>

<span class="keyword1" id="Circus_Actions-CSP1_Sup"><span class="command">lemma</span></span> CSP1_Sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨆</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs csp_defs fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs prefix_def design_defs rp_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Circus_Actions-CSP2_Sup"><span class="command">lemma</span></span> CSP2_Sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨆</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> design_defs csp_defs fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> comp_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P</span><span class="main">.</span> <span class="improper">x</span> <span class="main">=</span> Collect <span class="bound">P</span> <span class="main">&amp;</span> <span class="bound">P</span> <span class="main">∈</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> Set.imageE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> True<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> True<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ba</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> True<span class="main">⦈</span> <span class="main">=</span> <span class="improper">c</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">c</span> <span class="main">-</span> tr <span class="improper">aa</span><span class="main">,</span> ok <span class="main">:=</span> True<span class="main">⦈</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Circus_Actions-R_Sup"><span class="command">lemma</span></span> R_Sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⨆</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rp_defs design_defs csp_defs fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"wait <span class="improper">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> non_emptyE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Collect <span class="main">(</span>relation_of <span class="improper">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"relation_of <span class="improper">x</span> <span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="improper">b</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of <span class="improper">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">P</span><span class="main">.</span> <span class="improper">x</span> <span class="main">=</span> Collect <span class="bound">P</span> <span class="main">&amp;</span> <span class="bound">P</span> <span class="main">∈</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> Set.imageE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> non_emptyE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Collect <span class="main">(</span>relation_of <span class="improper">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"relation_of <span class="improper">x</span> <span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="improper">b</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of <span class="improper">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> Set.imageE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> Set.imageE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"relation_of <span class="improper">xa</span> <span class="main">(</span><span class="improper">a</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">,</span> <span class="improper">b</span><span class="main">⦇</span>tr <span class="main">:=</span> tr <span class="improper">b</span> <span class="main">-</span> tr <span class="improper">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> csp_defs design_defs rp_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">P</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Circus_Actions-CSP_Sup"><span class="command">lemma</span></span> CSP_Sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> is_CSP_process <span class="main">(</span><span class="main">⨆</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_CSP_process_def <span class="keyword1"><span class="command">using</span></span> CSP1_Sup CSP2_Sup R_Sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Circus_Actions-Sup_is_action"><span class="command">lemma</span></span> Sup_is_action<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">⨆</span> relation_of <span class="main">`</span> <span class="free">A</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> CSP_Sup<span class="main">)</span>

<span class="keyword1" id="Circus_Actions-relation_of_Sup"><span class="command">lemma</span></span> relation_of_Sup<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> relation_of <span class="main">(</span>action_of <span class="main">⨆</span> relation_of <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">⨆</span> relation_of <span class="main">`</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> action_of_inverse <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Sup_is_action<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"action"</span>  <span class="main">::</span>  <span class="main">(</span><span class="quoted">ev_eq</span><span class="main">,</span> <span class="quoted">type</span><span class="main">)</span> <span class="quoted">complete_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> Sup_action <span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>Sup <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action set<span class="main">)</span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">=</span><span class="main">{}</span> <span class="keyword1">then</span> bot <span class="keyword1">else</span> action_of <span class="main">⨆</span> <span class="main">(</span>relation_of <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> Inf_action <span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>Inf <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action set<span class="main">)</span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">=</span><span class="main">{}</span> <span class="keyword1">then</span> top <span class="keyword1">else</span> action_of <span class="main">⨅</span> <span class="main">(</span>relation_of <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">z</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Inf <span class="skolem">A</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_action less_eq_action Inf_action ref_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> action_of_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Inf_is_action<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> rule1 <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="bound">x</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> Inf <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_action<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> *
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_action<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_action Inf_action ref_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> action_of_inverse<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> ex_in_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Inf_is_action<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span><span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">(</span>Sup <span class="skolem">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_action less_eq_action Sup_action ref_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> action_of_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Sup_is_action<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> rule2 <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Sup <span class="skolem">A</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_action<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">atomize</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> rule2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_action less_eq_action Sup_action ref_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> action_of_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Sup_is_action<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> action_of_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Sup_is_action<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">}</span></span> 
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span><span class="main">{}</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action set<span class="main">)</span> <span class="main">=</span> top"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Inf_action<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Sup <span class="main">(</span><span class="main">{}</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> action set<span class="main">)</span> <span class="main">=</span> bot"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Sup_action<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Var_list">
<div class="head">
<h1>Theory Var_list</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Circus variables›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Var_list
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Circus variables are represented by a stack (list) of values. 
they are characterized by two functions, $select$ and $update$.
The Circus variable type is defined as a tuple ($select$ * $update$) with a 
list of values instead of a single value.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> var_list <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'a</span> list<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'σ</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The $select$ function returns the top value of the stack.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">select</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'r</span><span class="main">)</span> var_list <span class="main">⇒</span> <span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">select</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">A</span><span class="main">.</span> hd <span class="main">(</span><span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="bound">A</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The $increase$ function pushes a new value to the top of the stack.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">increase</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'r</span><span class="main">)</span> var_list <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'r</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">increase</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">val</span></span></span> <span class="main">≡</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">val</span></span></span><span class="main">#</span><span class="bound">l</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The $increase0$ function pushes an arbitrary value to the top of the stack.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">increase0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'r</span><span class="main">)</span> var_list <span class="main">⇒</span> <span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'r</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">increase0</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">val</span><span class="main">.</span> True<span class="main">)</span><span class="main">#</span><span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The $decrease$ function pops the top value of the stack.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">decrease</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'r</span><span class="main">)</span> var_list <span class="main">⇒</span> <span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'r</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">decrease</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span>tl <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The $update$ function updates the top value of the stack.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">update</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'r</span><span class="main">)</span> var_list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'r</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">update</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">upd</span></span></span> <span class="main">≡</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">upd</span></span></span> <span class="main">(</span>hd <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>tl <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The $update0$ function initializes the top of the stack with an arbitrary value.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">update0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'r</span><span class="main">)</span> var_list <span class="main">⇒</span> <span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'r</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">update0</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">upd</span><span class="main">.</span> True<span class="main">)</span> <span class="main">(</span>hd <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>tl <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span>  <span class="keyword2"><span class="keyword">where</span></span> select_increase<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>select <span class="free">v</span> <span class="main">(</span>increase <span class="free">v</span> <span class="free">a</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The $VAR-LIST$ function allows to retrieve a Circus variable from its name.›</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_VAR_LIST"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'r</span><span class="main">)</span> var_list"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">VAR'_LIST</span> _"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> <span class="quoted">"<span class="keyword1">VAR_LIST</span> x"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> _update_name <span class="free">x</span><span class="main">)</span>"</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Denotational_Semantics">
<div class="head">
<h1>Theory Denotational_Semantics</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Denotational semantics of Circus actions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Denotational_Semantics 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Circus_Actions.html">Circus_Actions</a> <a href="Var_list.html">Var_list</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section, we introduce the definitions of Circus actions denotational semantics.
We provide the proof of well-formedness of every action. We also provide proofs concerning 
the monotonicity of operators over actions.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Skip›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Skip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Skip</span> <span class="main">≡</span> action_of 
                  <span class="main">(</span>R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A</span> <span class="main">=</span> more <span class="bound">A'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Denotational_Semantics-Skip_is_action"><span class="command">lemma</span></span> Skip_is_action<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A</span> <span class="main">=</span> more <span class="bound">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> Skip_is_CSP <span class="main">=</span> Skip_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_Skip"><span class="command">lemma</span></span> relation_of_Skip<span class="main">:</span> 
<span class="quoted"><span class="quoted">"relation_of Skip <span class="main">=</span> 
                  <span class="main">(</span>R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A</span> <span class="main">=</span> more <span class="bound">A'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Skip_def action_of_inverse Skip_is_CSP<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">CSP3</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> alphabet_rp<span class="main">)</span> Healthiness_condition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">CSP3</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>  <span class="main">≡</span>  relation_of Skip <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">CSP4</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> alphabet_rp<span class="main">)</span> Healthiness_condition"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">CSP4</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>  <span class="main">≡</span>  <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">;;</span> relation_of Skip"</span></span>

<span class="keyword1" id="Denotational_Semantics-Skip_is_CSP3"><span class="command">lemma</span></span> Skip_is_CSP3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of Skip<span class="main">)</span> <span class="keyword1">is</span> CSP3 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_Skip rp_defs design_defs fun_eq_iff CSP3_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-Skip_is_CSP4"><span class="command">lemma</span></span> Skip_is_CSP4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of Skip<span class="main">)</span> <span class="keyword1">is</span> CSP4 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_Skip rp_defs design_defs fun_eq_iff CSP4_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="Denotational_Semantics-Skip_comp_absorb"><span class="command">lemma</span></span> Skip_comp_absorb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of Skip <span class="main">;;</span> relation_of Skip<span class="main">)</span> <span class="main">=</span> relation_of Skip"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_Skip fun_eq_iff rp_defs true_def design_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">aa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">aa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Stop›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Stop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Stop</span> <span class="main">≡</span> action_of <span class="main">(</span>R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> wait <span class="bound">A'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Denotational_Semantics-Stop_is_action"><span class="command">lemma</span></span> Stop_is_action<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> wait <span class="bound">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> Stop_is_CSP <span class="main">=</span> Stop_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_Stop"><span class="command">lemma</span></span> relation_of_Stop<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of Stop <span class="main">=</span> <span class="main">(</span>R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> wait <span class="bound">A'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Stop_def action_of_inverse Stop_is_CSP<span class="main">)</span>


<span class="keyword1" id="Denotational_Semantics-Stop_is_CSP3"><span class="command">lemma</span></span> Stop_is_CSP3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of Stop<span class="main">)</span> <span class="keyword1">is</span> CSP3 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_Stop relation_of_Skip rp_defs design_defs fun_eq_iff CSP3_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">aa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr <span class="improper">aa</span> <span class="main">≤</span> tr <span class="improper">ba</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">ba</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr <span class="improper">ba</span> <span class="main">≤</span> tr <span class="improper">c</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">zs</span><span class="main">@</span><span class="improper">zsa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">zs</span><span class="main">@</span><span class="improper">zsa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> true_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">zs</span><span class="main">@</span><span class="improper">zsa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="Denotational_Semantics-Stop_is_CSP4"><span class="command">lemma</span></span> Stop_is_CSP4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of Stop<span class="main">)</span> <span class="keyword1">is</span> CSP4 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_Stop relation_of_Skip rp_defs design_defs fun_eq_iff CSP4_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">aa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr <span class="improper">aa</span> <span class="main">≤</span> tr <span class="improper">ba</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">ba</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr <span class="improper">ba</span> <span class="main">≤</span> tr <span class="improper">c</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">zs</span><span class="main">@</span><span class="improper">zsa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">zs</span><span class="main">@</span><span class="improper">zsa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> true_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">zs</span><span class="main">@</span><span class="improper">zsa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Chaos›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Chaos</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Chaos</span> <span class="main">≡</span> action_of <span class="main">(</span>R<span class="main">(</span>false <span class="main">⊢</span> true<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Denotational_Semantics-Chaos_is_action"><span class="command">lemma</span></span> Chaos_is_action<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R<span class="main">(</span>false <span class="main">⊢</span> true<span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> Chaos_is_CSP <span class="main">=</span> Chaos_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_Chaos"><span class="command">lemma</span></span> relation_of_Chaos<span class="main">:</span> <span class="quoted"><span class="quoted">"relation_of Chaos <span class="main">=</span> <span class="main">(</span>R<span class="main">(</span>false <span class="main">⊢</span> true<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Chaos_def action_of_inverse Chaos_is_CSP<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹State update actions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Pre</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'σ</span> relation  <span class="main">⇒</span> <span class="tfree">'σ</span> predicate"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Pre</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">A</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">A'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">state_update_before</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'σ</span> relation <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">state_update_before</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="free"><span class="bound"><span class="entity">Ac</span></span></span> <span class="main">=</span> action_of<span class="main">(</span>R <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>Pre <span class="free"><span class="bound"><span class="entity">sc</span></span></span><span class="main">)</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> 
                      <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="main">(</span>more <span class="bound">A</span><span class="main">,</span> more <span class="bound">A'</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">&amp;</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> relation_of <span class="free"><span class="bound"><span class="entity">Ac</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Denotational_Semantics-state_update_before_is_action"><span class="command">lemma</span></span> state_update_before_is_action<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>Pre <span class="free">sc</span><span class="main">)</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> 
                               <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span><span class="free">sc</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">,</span> more <span class="bound">A'</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">&amp;</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> relation_of <span class="free">Ac</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> seq_CSP<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R_idem2 Healthy_def relation_of_CSP<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> state_update_before_is_CSP <span class="main">=</span> state_update_before_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_state_update_before"><span class="command">lemma</span></span> relation_of_state_update_before<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>state_update_before <span class="free">sc</span> <span class="free">Ac</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>R <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>Pre <span class="free">sc</span><span class="main">)</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> 
                               <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">sc</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">,</span> more <span class="bound">A'</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">&amp;</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> relation_of <span class="free">Ac</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> state_update_before_def action_of_inverse state_update_before_is_CSP<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-mono_state_update_before"><span class="command">lemma</span></span> mono_state_update_before<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span>state_update_before <span class="free">sc</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def less_eq_action ref_def relation_of_state_update_before design_defs rp_defs fun_eq_iff 
            <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> relation_of_spec_f_f<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> 
                                     relation_of_spec_t_f<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-state_update_before_is_CSP3"><span class="command">lemma</span></span> state_update_before_is_CSP3<span class="main">:</span> <span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>state_update_before <span class="free">sc</span> <span class="free">Ac</span><span class="main">)</span> <span class="keyword1">is</span> CSP3 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_state_update_before relation_of_Skip rp_defs design_defs fun_eq_iff CSP3_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">aa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">aa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr <span class="improper">aa</span> <span class="main">≤</span> tr <span class="improper">ab</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">ab</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr <span class="improper">ab</span> <span class="main">≤</span> tr <span class="improper">bb</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">zs</span><span class="main">@</span><span class="improper">zsa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">zs</span><span class="main">@</span><span class="improper">zsa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> true_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">zs</span><span class="main">@</span><span class="improper">zsa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="Denotational_Semantics-state_update_before_is_CSP4"><span class="command">lemma</span></span> state_update_before_is_CSP4<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A <span class="main">:</span> <span class="quoted"><span class="quoted">"relation_of <span class="free">Ac</span> <span class="keyword1">is</span> CSP4 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>state_update_before <span class="free">sc</span> <span class="free">Ac</span><span class="main">)</span> <span class="keyword1">is</span> CSP4 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_state_update_before relation_of_Skip rp_defs design_defs fun_eq_iff CSP4_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ba</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> design_defs rp_defs CSP4_def relation_of_Skip<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">state_update_after</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'σ</span> relation <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">state_update_after</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="free"><span class="bound"><span class="entity">Ac</span></span></span> <span class="main">=</span> action_of<span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">Ac</span></span></span> <span class="main">;;</span> R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="main">(</span>more <span class="bound">A</span><span class="main">,</span> more <span class="bound">A'</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">&amp;</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Denotational_Semantics-state_update_after_is_action"><span class="command">lemma</span></span> state_update_after_is_action<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of <span class="free">Ac</span> <span class="main">;;</span> R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">sc</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">,</span> more <span class="bound">A'</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">&amp;</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> seq_CSP<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> is_CSP_process_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> state_update_after_is_CSP <span class="main">=</span> state_update_after_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_state_update_after"><span class="command">lemma</span></span> relation_of_state_update_after<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>state_update_after <span class="free">sc</span> <span class="free">Ac</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>relation_of <span class="free">Ac</span> <span class="main">;;</span> R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">sc</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">,</span> more <span class="bound">A'</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">&amp;</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> state_update_after_def action_of_inverse state_update_after_is_CSP<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-mono_state_update_after"><span class="command">lemma</span></span> mono_state_update_after<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span>state_update_after <span class="free">sc</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def less_eq_action ref_def relation_of_state_update_after design_defs rp_defs fun_eq_iff 
            <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> relation_of_spec_f_f<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> 
                                     relation_of_spec_t_f<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1" id="Denotational_Semantics-state_update_after_is_CSP3"><span class="command">lemma</span></span> state_update_after_is_CSP3<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A <span class="main">:</span> <span class="quoted"><span class="quoted">"relation_of <span class="free">Ac</span> <span class="keyword1">is</span> CSP3 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>state_update_after <span class="free">sc</span> <span class="free">Ac</span><span class="main">)</span> <span class="keyword1">is</span> CSP3 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_state_update_after relation_of_Skip rp_defs design_defs fun_eq_iff CSP3_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">aa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> design_defs rp_defs CSP3_def relation_of_Skip<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="Denotational_Semantics-state_update_after_is_CSP4"><span class="command">lemma</span></span> state_update_after_is_CSP4<span class="main">:</span> <span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>state_update_after <span class="free">sc</span> <span class="free">Ac</span><span class="main">)</span> <span class="keyword1">is</span> CSP4 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_state_update_after relation_of_Skip rp_defs design_defs fun_eq_iff CSP4_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">c</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ba</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">bb</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr <span class="improper">bb</span> <span class="main">≤</span> tr <span class="improper">c</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">ca</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr <span class="improper">ca</span> <span class="main">≤</span> tr <span class="improper">c</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">zs</span><span class="main">@</span><span class="improper">zsa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> true_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">ca</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr <span class="improper">ca</span> <span class="main">≤</span> tr <span class="improper">c</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">zsa</span><span class="main">@</span><span class="improper">zs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tr <span class="improper">bb</span> <span class="main">≤</span> tr <span class="improper">c</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE <span class="main"><span class="keyword3">|</span></span> <span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">zsa</span><span class="main">@</span><span class="improper">zs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sequential composition›</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
<span class="entity">Seq</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">`;`</span>"</span> 24<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">`;`</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> action_of <span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">;;</span> relation_of <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Denotational_Semantics-Seq_is_action"><span class="command">lemma</span></span> Seq_is_action<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of <span class="free">P</span> <span class="main">;;</span> relation_of <span class="free">Q</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> seq_CSP<span class="main"><span class="main">[</span></span><span class="operator">OF</span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> CSP_is_CSP1<span class="main"><span class="main">]</span></span> relation_of_CSP<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> CSP_is_R<span class="main"><span class="main">]</span></span> relation_of_CSP<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Seq_is_CSP <span class="main">=</span> Seq_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_Seq"><span class="command">lemma</span></span> relation_of_Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"relation_of <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>relation_of <span class="free">P</span> <span class="main">;;</span> relation_of <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Seq_def action_of_inverse Seq_is_CSP<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-mono_Seq"><span class="command">lemma</span></span> mono_Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">(`;`)</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def less_eq_action ref_def relation_of_Seq<span class="main">)</span>


<span class="keyword1" id="Denotational_Semantics-CSP3_imp_left_Skip"><span class="command">lemma</span></span> CSP3_imp_left_Skip<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"relation_of <span class="free">P</span> <span class="keyword1">is</span> CSP3 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Skip <span class="main">`;`</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_Seq A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> design_defs CSP3_def<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-CSP4_imp_right_Skip"><span class="command">lemma</span></span> CSP4_imp_right_Skip<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"relation_of <span class="free">P</span> <span class="keyword1">is</span> CSP4 <span class="keyword1">healthy</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> Skip<span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_Seq A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> design_defs CSP4_def<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-Seq_assoc"><span class="command">lemma</span></span> Seq_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">`;`</span> <span class="main">(</span><span class="free">B</span> <span class="main">`;`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">`;`</span> <span class="free">B</span><span class="main">)</span> <span class="main">`;`</span> <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> fun_eq_iff relation_of_Seq rp_defs design_defs<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-Skip_absorb"><span class="command">lemma</span></span> Skip_absorb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Skip <span class="main">`;`</span> Skip<span class="main">)</span> <span class="main">=</span> Skip"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Skip_comp_absorb relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> relation_of_Seq<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Internal choice›</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
<span class="entity">Ndet</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 18<span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⊓</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> action_of <span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Denotational_Semantics-Ndet_is_action"><span class="command">lemma</span></span> Ndet_is_action<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>relation_of <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disj_CSP<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Ndet_is_CSP <span class="main">=</span> Ndet_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_Ndet"><span class="command">lemma</span></span> relation_of_Ndet<span class="main">:</span> <span class="quoted"><span class="quoted">"relation_of <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>relation_of <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ndet_def action_of_inverse Ndet_is_CSP<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-mono_Ndet"><span class="command">lemma</span></span> mono_Ndet<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">(⊓)</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def less_eq_action ref_def relation_of_Ndet<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹External choice›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">Det</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">□</span>"</span> 18<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">□</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> action_of<span class="main">(</span>R<span class="main">(</span><span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span>
                                             <span class="main">(</span><span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>
                                                <span class="main">◃</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span> <span class="main">∧</span> wait <span class="bound">A'</span> <span class="main">▹</span>
                                              <span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Denotational_Semantics-Det_is_action"><span class="command">lemma</span></span> Det_is_action<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>R<span class="main">(</span><span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">(</span>relation_of <span class="free">Q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span>
           <span class="main">(</span><span class="main">(</span><span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">Q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>
              <span class="main">◃</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span> <span class="main">∧</span> wait <span class="bound">A'</span> <span class="main">▹</span>
            <span class="main">(</span><span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">Q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spec_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Det_is_CSP <span class="main">=</span> Det_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_Det"><span class="command">lemma</span></span> relation_of_Det<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>R<span class="main">(</span><span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">(</span>relation_of <span class="free">Q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span>
                                          <span class="main">(</span><span class="main">(</span><span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">Q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>
                                             <span class="main">◃</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span> <span class="main">∧</span> wait <span class="bound">A'</span> <span class="main">▹</span>
                                           <span class="main">(</span><span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">Q</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Det_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> action_of_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Det_is_action<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-mono_Det"><span class="command">lemma</span></span> mono_Det<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">(□)</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def less_eq_action ref_def relation_of_Det design_defs rp_defs fun_eq_iff 
            <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> relation_of_spec_f_f<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> 
                                     relation_of_spec_t_f<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Reactive design assignment›</span></span>


<span class="keyword1"><span class="command">definition</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">rd_assign</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> action_of <span class="main">(</span>R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> ref <span class="bound">A'</span> <span class="main">=</span> ref <span class="bound">A</span> <span class="main">∧</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A'</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Denotational_Semantics-rd_assign_is_action"><span class="command">lemma</span></span> rd_assign_is_action<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> ref <span class="bound">A'</span> <span class="main">=</span> ref <span class="bound">A</span> <span class="main">∧</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A'</span> <span class="main">=</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> rd_assign_is_CSP <span class="main">=</span> rd_assign_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_rd_assign"><span class="command">lemma</span></span> relation_of_rd_assign<span class="main">:</span> 
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>rd_assign <span class="free">s</span><span class="main">)</span> <span class="main">=</span> 
                  <span class="main">(</span>R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> ref <span class="bound">A'</span> <span class="main">=</span> ref <span class="bound">A</span> <span class="main">∧</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A'</span> <span class="main">=</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rd_assign_def  action_of_inverse rd_assign_is_CSP<span class="main">)</span>





<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Local state external choice›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">Loc</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'σ</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="tfree">'σ</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span> 
                                        <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span><span class="keyword3">(</span><span class="keyword3">)</span><span class="keyword1">loc</span> _ <span class="keyword1">∙</span> _ <span class="keyword1">')</span> <span class="keyword1">\&lt;boxplus&gt;</span> <span class="keyword1">'(</span><span class="keyword3">(</span><span class="keyword3">)</span><span class="keyword1">loc</span> _ <span class="keyword1">∙</span> _ <span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(</span></span><span class="keyword1"><span class="free">loc</span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main"><span class="free">∙</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">)</span></span> <span class="main"><span class="free">\&lt;boxplus&gt;</span></span> <span class="main"><span class="free">(</span></span><span class="keyword1"><span class="free">loc</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main"><span class="free">∙</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">≡</span> 
                   <span class="main">(</span><span class="main">(</span>rd_assign <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span><span class="main">`;`</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">□</span> <span class="main">(</span><span class="main">(</span>rd_assign <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">`;`</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Schema expression›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Schema</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'σ</span> relation <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Schema</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="main">≡</span> action_of<span class="main">(</span>R <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>Pre <span class="free"><span class="bound"><span class="entity">sc</span></span></span><span class="main">)</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> 
                           <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">sc</span></span></span> <span class="main">(</span>more <span class="bound">A</span><span class="main">,</span> more <span class="bound">A'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Denotational_Semantics-Schema_is_action"><span class="command">lemma</span></span> Schema_is_action<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>Pre <span class="free">sc</span><span class="main">)</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> 
                 <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">sc</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">,</span> more <span class="bound">A'</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">&amp;</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Schema_is_CSP <span class="main">=</span> Schema_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_Schema"><span class="command">lemma</span></span> relation_of_Schema<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>Schema <span class="free">sc</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>R <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>Pre <span class="free">sc</span><span class="main">)</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> 
                          <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="free">sc</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">,</span> more <span class="bound">A'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Schema_def action_of_inverse Schema_is_CSP<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-Schema_is_state_update_before"><span class="command">lemma</span></span> Schema_is_state_update_before<span class="main">:</span> <span class="quoted"><span class="quoted">"Schema <span class="free">u</span> <span class="main">=</span> state_update_before <span class="free">u</span> Skip"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_Schema relation_of_state_update_before relation_of_Skip rp_defs fun_eq_iff
                  design_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Parallel composition›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'σ</span> local_state <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'σ</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'σ</span>  <span class="main">⇒</span> <span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'σ</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">MergeSt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'σ</span> local_state <span class="main">⇒</span> <span class="tfree">'σ</span> local_state <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> relation_rp"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">MergeSt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s2'</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1'</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span>more <span class="bound">S</span><span class="main">)</span> <span class="main">=</span> more <span class="bound">S'</span><span class="main">)</span><span class="main">;;</span> 
                            <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">S</span><span class="main">::</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> alphabet_rp<span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s2'</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">(</span>more <span class="bound">S</span><span class="main">)</span> <span class="main">=</span> more <span class="bound">S'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">listCons</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'θ</span> <span class="main">⇒</span> <span class="tfree">'θ</span> list list <span class="main">⇒</span> <span class="tfree">'θ</span> list list"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">##</span> _"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">##</span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>map <span class="main">(</span>Cons <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ParMergel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'θ</span><span class="main">::</span>ev_eq list <span class="main">⇒</span> <span class="tfree">'θ</span> list <span class="main">⇒</span> <span class="tfree">'θ</span> set <span class="main">⇒</span> <span class="tfree">'θ</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ParMergel</span> <span class="main">[]</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ParMergel</span> <span class="main">[]</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">tr2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>filter_chan_set <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span>
                                          <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">##</span> <span class="main">(</span><span class="free">ParMergel</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">tr2</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ParMergel</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">tr1</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>filter_chan_set <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span>
                                          <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">##</span> <span class="main">(</span><span class="free">ParMergel</span> <span class="free"><span class="bound"><span class="entity">tr1</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ParMergel</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">tr1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">tr2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span>
           <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>filter_chan_set <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span>
                   <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>ev_eq <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>
                              <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">##</span> <span class="main">(</span><span class="free">ParMergel</span> <span class="free"><span class="bound"><span class="entity">tr1</span></span></span> <span class="free"><span class="bound"><span class="entity">tr2</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span> 
                               <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>filter_chan_set <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> 
                                        <span class="keyword1">then</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span> 
                                         <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">##</span> <span class="main">(</span><span class="free">ParMergel</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">tr1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">tr2</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>filter_chan_set <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> 
                               <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">##</span> <span class="main">(</span><span class="free">ParMergel</span> <span class="free"><span class="bound"><span class="entity">tr1</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">tr2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span> 
                                 <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">##</span> <span class="main">(</span><span class="free">ParMergel</span> <span class="free"><span class="bound"><span class="entity">tr1</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">tr2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span> 
                                            <span class="main">@</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">##</span> <span class="main">(</span><span class="free">ParMergel</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">tr1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">tr2</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ParMerge</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'θ</span><span class="main">::</span>ev_eq list <span class="main">⇒</span> <span class="tfree">'θ</span> list <span class="main">⇒</span> <span class="tfree">'θ</span> set <span class="main">⇒</span> <span class="tfree">'θ</span> list set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ParMerge</span> <span class="free"><span class="bound"><span class="entity">tr1</span></span></span> <span class="free"><span class="bound"><span class="entity">tr2</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span> set <span class="main">(</span>ParMergel <span class="free"><span class="bound"><span class="entity">tr1</span></span></span> <span class="free"><span class="bound"><span class="entity">tr2</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Denotational_Semantics-set_Cons1"><span class="command">lemma</span></span> set_Cons1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tr1</span> <span class="main">∈</span> set <span class="free">l</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">#</span> <span class="free">tr1</span> <span class="main">∈</span> <span class="main">(#)</span> <span class="free">a</span> <span class="main">`</span> set <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-tr_in_set_eq"><span class="command">lemma</span></span> tr_in_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">tr1</span> <span class="main">∈</span> <span class="main">(#)</span> <span class="free">b</span> <span class="main">`</span> set <span class="free">l</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">tr1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="free">tr1</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> tl <span class="free">tr1</span> <span class="main">∈</span> set <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span> <span class="operator">auto</span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">M_par</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">)</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> alpha_rp_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'σ</span>  <span class="main">⇒</span> <span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'σ</span><span class="main">)</span>
                            <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> alpha_rp_scheme <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'σ</span><span class="main">)</span>
                                <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> relation_rp"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">M_par</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="free"><span class="bound"><span class="entity">x1</span></span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="free"><span class="bound"><span class="entity">x2</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">=</span> 
<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>diff_tr <span class="bound">S'</span> <span class="bound">S</span><span class="main">)</span> <span class="main">∈</span> ParMerge <span class="main">(</span>diff_tr <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="bound">S</span><span class="main">)</span> <span class="main">(</span>diff_tr <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="bound">S</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">&amp;</span>
     ev_eq <span class="main">(</span>tr_filter <span class="main">(</span>tr <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">(</span>tr_filter <span class="main">(</span>tr <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>wait <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main">∨</span> wait <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">∧</span> 
                             ref <span class="bound">S'</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>ref <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span><span class="main">∪</span><span class="main">(</span>ref <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">∩</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">∪</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>ref <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span><span class="main">∩</span><span class="main">(</span>ref <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
   <span class="main">◃</span> wait <span class="keyword1">o</span> snd <span class="main">▹</span>
   <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span>wait <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main">∨</span> <span class="main">¬</span>wait <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> MergeSt <span class="main">(</span><span class="main">(</span>more <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>more <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">Par</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> 
                    <span class="main">(</span><span class="tfree">'σ</span>  <span class="main">⇒</span> <span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'σ</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'θ</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'σ</span>  <span class="main">⇒</span> <span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'σ</span><span class="main">)</span> <span class="main">⇒</span> 
                    <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⟦</span> _ <span class="keyword1">|</span> _ <span class="keyword1">|</span> _ <span class="keyword1">⟧</span> _"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A1</span></span></span> <span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">ns1</span></span></span> <span class="main"><span class="free">|</span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main"><span class="free">|</span></span> <span class="free"><span class="bound"><span class="entity">ns2</span></span></span> <span class="main"><span class="free">⟧</span></span> <span class="free"><span class="bound"><span class="entity">A2</span></span></span> <span class="main">≡</span> <span class="main">(</span>action_of <span class="main">(</span>R <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> 
 <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">tr1</span> <span class="bound">tr2</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">;;</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr1</span> <span class="main">=</span> <span class="main">(</span>tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span> 
 <span class="main">∧</span> <span class="main">(</span>spec False <span class="main">(</span>wait <span class="bound">S</span><span class="main">)</span> <span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="bound">tr2</span> <span class="main">=</span> <span class="main">(</span>tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span>
 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>tr_filter <span class="bound">tr1</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="bound">tr2</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">tr1</span> <span class="bound">tr2</span><span class="main">.</span> <span class="main">(</span>spec False <span class="main">(</span>wait <span class="bound">S</span><span class="main">)</span> <span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span><span class="main">;;</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="bound">tr1</span> <span class="main">=</span> tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span>
 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">;;</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr2</span> <span class="main">=</span> <span class="main">(</span>tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span> 
 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>tr_filter <span class="bound">tr1</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="bound">tr2</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> 
   <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">s1</span><span class="main">)</span>
 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">s2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;;</span> M_par <span class="bound">s1</span> <span class="free"><span class="bound"><span class="entity">ns1</span></span></span> <span class="bound">s2</span> <span class="free"><span class="bound"><span class="entity">ns2</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Denotational_Semantics-Par_is_action"><span class="command">lemma</span></span> Par_is_action<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> 
 <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">tr1</span> <span class="bound">tr2</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">A1</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">;;</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr1</span> <span class="main">=</span> <span class="main">(</span>tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span> 
 <span class="main">∧</span> <span class="main">(</span>spec False <span class="main">(</span>wait <span class="bound">S</span><span class="main">)</span> <span class="main">(</span>relation_of <span class="free">A2</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr2</span> <span class="main">=</span> <span class="main">(</span>tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span>
 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>tr_filter <span class="bound">tr1</span> <span class="free">cs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="bound">tr2</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">tr1</span> <span class="bound">tr2</span><span class="main">.</span> <span class="main">(</span>spec False <span class="main">(</span>wait <span class="bound">S</span><span class="main">)</span> <span class="main">(</span>relation_of <span class="free">A1</span><span class="main">)</span><span class="main">;;</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="bound">tr1</span> <span class="main">=</span> tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span>
 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">A2</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">;;</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr2</span> <span class="main">=</span> <span class="main">(</span>tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span> 
 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>tr_filter <span class="bound">tr1</span> <span class="free">cs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="bound">tr2</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> 
   <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>relation_of <span class="free">A1</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">s1</span><span class="main">)</span>
 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">A2</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">s2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;;</span> M_par <span class="bound">s1</span> <span class="free">ns1</span> <span class="bound">s2</span> <span class="free">ns2</span> <span class="free">cs</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Par_is_CSP <span class="main">=</span> Par_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_Par"><span class="command">lemma</span></span> relation_of_Par<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span><span class="free">A1</span> <span class="main">⟦</span> <span class="free">ns1</span> <span class="main">|</span> <span class="free">cs</span> <span class="main">|</span> <span class="free">ns2</span> <span class="main">⟧</span> <span class="free">A2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>R <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> 
 <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">tr1</span> <span class="bound">tr2</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">A1</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">;;</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr1</span> <span class="main">=</span> <span class="main">(</span>tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span> 
 <span class="main">∧</span> <span class="main">(</span>spec False <span class="main">(</span>wait <span class="bound">S</span><span class="main">)</span> <span class="main">(</span>relation_of <span class="free">A2</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr2</span> <span class="main">=</span> <span class="main">(</span>tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span> 
 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>tr_filter <span class="bound">tr1</span> <span class="free">cs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="bound">tr2</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">tr1</span> <span class="bound">tr2</span><span class="main">.</span> <span class="main">(</span>spec False <span class="main">(</span>wait <span class="bound">S</span><span class="main">)</span> <span class="main">(</span>relation_of <span class="free">A1</span><span class="main">)</span><span class="main">;;</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="bound">tr1</span> <span class="main">=</span> tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span> 
 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">A2</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">;;</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr2</span> <span class="main">=</span> <span class="main">(</span>tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span> 
 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>tr_filter <span class="bound">tr1</span> <span class="free">cs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="bound">tr2</span> <span class="free">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> 
   <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>relation_of <span class="free">A1</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">s1</span><span class="main">)</span>
 <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">A2</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">s2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;;</span> M_par <span class="bound">s1</span> <span class="free">ns1</span> <span class="bound">s2</span> <span class="free">ns2</span> <span class="free">cs</span><span class="main">)</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Par_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> action_of_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Par_is_action<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-mono_Par"><span class="command">lemma</span></span> mono_Par<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span><span class="bound">Q</span><span class="main">.</span> <span class="free">P</span> <span class="main">⟦</span> <span class="free">ns1</span> <span class="main">|</span> <span class="free">cs</span> <span class="main">|</span> <span class="free">ns2</span> <span class="main">⟧</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def less_eq_action ref_def relation_of_Par design_defs fun_eq_iff rp_defs
              <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> relation_of_spec_f_f<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> relation_of_spec_t_f<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tr <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> relation_of_spec_f_f relation_of_spec_t_f<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Local parallel block›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">ParLoc</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'σ</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'σ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="tfree">'θ</span> set <span class="main">⇒</span> <span class="tfree">'σ</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'σ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span>
                                        <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span><span class="keyword3">(</span><span class="keyword3">)</span><span class="keyword1">par</span> _ <span class="keyword1">|</span> _ <span class="keyword1">∙</span> _ <span class="keyword1">')</span> <span class="keyword1">⟦</span> _ <span class="keyword1">⟧</span> <span class="keyword1">'(</span><span class="keyword3">(</span><span class="keyword3">)</span><span class="keyword1">par</span> _ <span class="keyword1">|</span> _ <span class="keyword1">∙</span> _ <span class="keyword1">')</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">(</span></span><span class="keyword1"><span class="free">par</span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main"><span class="free">|</span></span> <span class="free"><span class="bound"><span class="entity">ns1</span></span></span> <span class="main"><span class="free">∙</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">)</span></span> <span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main"><span class="free">⟧</span></span> <span class="main"><span class="free">(</span></span><span class="keyword1"><span class="free">par</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main"><span class="free">|</span></span> <span class="free"><span class="bound"><span class="entity">ns2</span></span></span> <span class="main"><span class="free">∙</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>rd_assign <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span><span class="main">`;`</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">ns1</span></span></span> <span class="main">|</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">|</span> <span class="free"><span class="bound"><span class="entity">ns2</span></span></span> <span class="main">⟧</span> <span class="main">(</span><span class="main">(</span>rd_assign <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span><span class="main">`;`</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Assignment›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ASSIGN</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> var_list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ASSIGN</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> action_of <span class="main">(</span>R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">S'</span> <span class="main">=</span> tr <span class="bound">S</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">S'</span> <span class="main">∧</span> 
                                 <span class="main">(</span>more <span class="bound">S'</span> <span class="main">=</span> <span class="main">(</span>update <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>more <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>more <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_assign"</span><span class="main">::</span><span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">`:=`</span> _"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> <span class="quoted">"y <span class="main">`:=`</span> <span class="free">vv</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> ASSIGN <span class="main">(</span><span class="keyword1">VAR</span> y<span class="main">)</span> <span class="free">vv</span>"</span>

<span class="keyword1" id="Denotational_Semantics-Assign_is_action"><span class="command">lemma</span></span> Assign_is_action<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">S'</span> <span class="main">=</span> tr <span class="bound">S</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">S'</span> <span class="main">∧</span> 
                <span class="main">(</span>more <span class="bound">S'</span> <span class="main">=</span> <span class="main">(</span>update <span class="free">x</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span><span class="free">e</span> <span class="main">(</span>more <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>more <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Assign_is_CSP <span class="main">=</span> Assign_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_Assign"><span class="command">lemma</span></span> relation_of_Assign<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>ASSIGN <span class="free">x</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>R <span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">S'</span> <span class="main">=</span> tr <span class="bound">S</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">S'</span> <span class="main">∧</span> 
                                   <span class="main">(</span>more <span class="bound">S'</span> <span class="main">=</span> <span class="main">(</span>update <span class="free">x</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span><span class="free">e</span> <span class="main">(</span>more <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>more <span class="bound">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ASSIGN_def action_of_inverse Assign_is_CSP<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-Assign_is_state_update_before"><span class="command">lemma</span></span> Assign_is_state_update_before<span class="main">:</span> <span class="quoted"><span class="quoted">"ASSIGN <span class="free">x</span> <span class="free">e</span> <span class="main">=</span> state_update_before <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">.</span> <span class="bound">s'</span> <span class="main">=</span> <span class="main">(</span>update <span class="free">x</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">(</span><span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> Skip"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_Assign relation_of_state_update_before relation_of_Skip rp_defs fun_eq_iff
                  Pre_def update_def design_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Variable scope›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Var</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> var_list <span class="main">⇒</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Var</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> action_of<span class="main">(</span>
     <span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>increase <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">a</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;;</span> 
     <span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">;;</span>
     <span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span>  tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>decrease <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_var"</span><span class="main">::</span><span class="quoted"><span class="quoted">"idt <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">var</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> <span class="quoted">"<span class="keyword1">var</span> <span class="free">y</span> <span class="main">∙</span> <span class="free">Act</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> Var <span class="main">(</span><span class="keyword1">VAR_LIST</span> y<span class="main">)</span> <span class="free">Act</span>"</span>

<span class="keyword1" id="Denotational_Semantics-Var_is_action"><span class="command">lemma</span></span> Var_is_action<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>increase <span class="free">v</span> <span class="bound">a</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;;</span> 
     <span class="main">(</span>relation_of <span class="free">A</span><span class="main">;;</span>
     <span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span>  tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>decrease <span class="free">v</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> seq_CSP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> seq_CSP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_CSP1 relation_of_R<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs rp_defs design_defs fun_eq_iff prefix_def increase_def decrease_def
               <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Var_is_CSP <span class="main">=</span> Var_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_Var"><span class="command">lemma</span></span> relation_of_Var<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>Var <span class="free">v</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>increase <span class="free">v</span> <span class="bound">a</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;;</span> 
     <span class="main">(</span>relation_of <span class="free">A</span><span class="main">;;</span>
     <span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span>  tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>decrease <span class="free">v</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Var_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> action_of_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Var_is_action<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="Denotational_Semantics-mono_Var"><span class="command">lemma</span></span> mono_Var <span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span>Var <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def less_eq_action ref_def relation_of_Var<span class="main">)</span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Let</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> var_list <span class="main">⇒</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Let</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> action_of<span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">;;</span>
     <span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span>  tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>decrease <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_let"</span><span class="main">::</span><span class="quoted"><span class="quoted">"idt <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">let</span> _ <span class="keyword1">∙</span> _"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> <span class="quoted">"<span class="keyword1">let</span> <span class="free">y</span> <span class="main">∙</span> <span class="free">Act</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> Let <span class="main">(</span><span class="keyword1">VAR_LIST</span> y<span class="main">)</span> <span class="free">Act</span>"</span>

<span class="keyword1" id="Denotational_Semantics-Let_is_action"><span class="command">lemma</span></span> Let_is_action<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span>relation_of <span class="free">A</span><span class="main">;;</span>
     <span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span>  tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>decrease <span class="free">v</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> seq_CSP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_CSP1 relation_of_R<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rd_is_CSP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Let_is_CSP <span class="main">=</span> Let_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_Let"><span class="command">lemma</span></span> relation_of_Let<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>Let <span class="free">v</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span>relation_of <span class="free">A</span><span class="main">;;</span>
     <span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span>  tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> <span class="main">¬</span>wait <span class="bound">A'</span> <span class="main">∧</span> more <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>decrease <span class="free">v</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def action_of_inverse Let_is_CSP<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-mono_Let"><span class="command">lemma</span></span> mono_Let <span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span>Let <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def less_eq_action ref_def relation_of_Let<span class="main">)</span>


<span class="keyword1" id="Denotational_Semantics-Var_is_state_update_before"><span class="command">lemma</span></span> Var_is_state_update_before<span class="main">:</span> <span class="quoted"><span class="quoted">"Var <span class="free">v</span> <span class="free">A</span> <span class="main">=</span> state_update_before <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">=</span> increase <span class="free">v</span> <span class="bound">a</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>Let <span class="free">v</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_Var relation_of_Let relation_of_state_update_before relation_of_Skip fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs fun_eq_iff Pre_def design_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A'</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">A'</span> <span class="main">=</span> increase <span class="free">v</span> <span class="bound">a</span> <span class="main">(</span>alpha_rp.more <span class="improper">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> true_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"increase <span class="free">v</span> <span class="free">a</span> <span class="main">(</span>alpha_rp.more <span class="improper">aa</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">ab</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A'</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">A'</span> <span class="main">=</span> increase <span class="free">v</span> <span class="bound">a</span> <span class="main">(</span>alpha_rp.more <span class="improper">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> true_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"increase <span class="free">v</span> <span class="free">a</span> <span class="main">(</span>alpha_rp.more <span class="improper">aa</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">bb</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="Denotational_Semantics-Let_is_state_update_after"><span class="command">lemma</span></span> Let_is_state_update_after<span class="main">:</span> <span class="quoted"><span class="quoted">"Let <span class="free">v</span> <span class="free">A</span> <span class="main">=</span> state_update_after <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">=</span> decrease <span class="free">v</span> <span class="bound">s</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_Var relation_of_Let relation_of_state_update_after relation_of_Skip fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs fun_eq_iff Pre_def design_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Guarded action›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Guard</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'σ</span> predicate <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">`&amp;`</span> _"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">`&amp;`</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> action_of<span class="main">(</span>R <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="keyword1">o</span> more <span class="keyword1">o</span> fst<span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> 
                             <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="keyword1">o</span> more <span class="keyword1">o</span> fst<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
                         <span class="main">(</span><span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="keyword1">o</span> more <span class="keyword1">o</span> fst<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> wait <span class="bound">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Denotational_Semantics-Guard_is_action"><span class="command">lemma</span></span> Guard_is_action<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>R <span class="main">(</span> <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">o</span> more <span class="keyword1">o</span> fst<span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> 
                <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">o</span> more <span class="keyword1">o</span> fst<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
                 <span class="main">(</span><span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">o</span> more <span class="keyword1">o</span> fst<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> wait <span class="bound">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spec_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rd_is_CSP<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> Guard_is_CSP <span class="main">=</span> Guard_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_Guard"><span class="command">lemma</span></span> relation_of_Guard<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span><span class="free">g</span> <span class="main">`&amp;`</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>R <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">o</span> more <span class="keyword1">o</span> fst<span class="main">)</span> <span class="main">⟶</span>  <span class="main">¬</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>f</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⊢</span> 
                             <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">o</span> more <span class="keyword1">o</span> fst<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>t</sup><span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
                          <span class="main">(</span><span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="free">g</span> <span class="keyword1">o</span> more <span class="keyword1">o</span> fst<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A'</span> <span class="main">=</span> tr <span class="bound">A</span> <span class="main">∧</span> wait <span class="bound">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Guard_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> action_of_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Guard_is_action<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-mono_Guard"><span class="command">lemma</span></span> mono_Guard <span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span>Guard <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def less_eq_action ref_def rp_defs design_defs relation_of_Guard 
                <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> relation_of_spec_f_f relation_of_spec_t_f<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-false_Guard"><span class="command">lemma</span></span> false_Guard<span class="main">:</span> <span class="quoted"><span class="quoted">"false <span class="main">`&amp;`</span> <span class="free">P</span> <span class="main">=</span> Stop"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_Stop<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_Guard<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff utp_defs csp_defs design_defs rp_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-false_Guard1"><span class="command">lemma</span></span> false_Guard1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span>alpha_rp.more <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> False <span class="main">⟹</span> 
                                <span class="main">(</span>relation_of <span class="main">(</span><span class="free">g</span> <span class="main">`&amp;`</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>relation_of Stop<span class="main">)</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_Guard<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_Stop<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff csp_defs design_defs rp_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-true_Guard"><span class="command">lemma</span></span> true_Guard<span class="main">:</span> <span class="quoted"><span class="quoted">"true <span class="main">`&amp;`</span> <span class="free">P</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_Guard<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_rd<span class="main"><span class="main">[</span></span><span class="operator">OF</span> relation_of_CSP<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff utp_defs csp_defs design_defs rp_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-true_Guard1"><span class="command">lemma</span></span> true_Guard1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">g</span> <span class="main">(</span>alpha_rp.more <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> True <span class="main">⟹</span> 
                                     <span class="main">(</span>relation_of <span class="main">(</span><span class="free">g</span> <span class="main">`&amp;`</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_Guard<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_rd<span class="main"><span class="main">[</span></span><span class="operator">OF</span> relation_of_CSP<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff csp_defs design_defs rp_defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-Guard_is_state_update_before"><span class="command">lemma</span></span> Guard_is_state_update_before<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">`&amp;`</span> <span class="free">P</span> <span class="main">=</span> state_update_before <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">.</span> <span class="free">g</span> <span class="bound">s</span><span class="main">)</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> relation_of_Guard relation_of_state_update_before relation_of_Skip rp_defs fun_eq_iff
                  Pre_def update_def design_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_rd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP rp_defs design_defs fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP rp_defs design_defs fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP rp_defs design_defs fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_rd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP rp_defs design_defs fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_rd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP rp_defs design_defs fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relation_of_CSP rp_defs design_defs fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>alpha_rp.more <span class="improper">aa</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> impl_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Prefixed action›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">do</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">do</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ref <span class="bound">A'</span><span class="main">)</span><span class="main">)</span> <span class="main">◃</span> wait <span class="keyword1">o</span> snd <span class="main">▹</span> 
         <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A'</span> <span class="main">=</span> <span class="main">(</span>tr <span class="bound">A</span> <span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">do_I</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span><span class="tfree">'θ</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'θ</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> relation_rp"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">do_I</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> tr <span class="bound">A</span> <span class="main">=</span> tr <span class="bound">A'</span> <span class="main">&amp;</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∩</span> <span class="main">(</span>ref <span class="bound">A'</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>
                                <span class="main">◃</span> wait <span class="keyword1">o</span> snd <span class="main">▹</span> 
  <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> hd <span class="main">(</span>tr <span class="bound">A'</span> <span class="main">-</span> tr <span class="bound">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">&amp;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>last <span class="main">(</span>tr <span class="bound">A'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(*
definition do_I::"('v ⇒ 'θ) ⇒ ('v, 'σ) var_list ⇒ 'v set ⇒ ('θ, 'σ) relation_rp"
where "do_I c x P ≡  ((λ(A, A'). tr A = tr A' ∧ (c`P) ∩ (ref A') = {})
                                ◃ wait o fst ▹ 
  (λ(A, A'). hd (tr A' - tr A) ∈ (c`P) ∧ (c (select x (more A)) = (last (tr A')))))"
*)</span>


<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">iPrefix</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'σ</span> relation<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'θ</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">iPrefix</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> action_of<span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>do_I <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span> <span class="main">&amp;</span> more <span class="bound">A'</span> <span class="main">=</span> more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">`;`</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="entity">oPrefix</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span><span class="tfree">'θ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">oPrefix</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> action_of<span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span>do <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> more <span class="bound">A'</span> <span class="main">=</span> more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">`;`</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Prefix0</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'θ</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Prefix0</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> action_of<span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span>do <span class="main">(</span><span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> more <span class="bound">A'</span> <span class="main">=</span> more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">`;`</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
<span class="entity">read</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'θ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> var_list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">read</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">≡</span> iPrefix <span class="main">(</span><span class="main">λ</span> <span class="bound">A</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>select <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">=</span> increase <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">a</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>Let <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> range <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
<span class="entity">read1</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'θ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> var_list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'v</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">read1</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">≡</span> iPrefix <span class="main">(</span><span class="main">λ</span> <span class="bound">A</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>select <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="main">&amp;</span> <span class="bound">s'</span> <span class="main">=</span> increase <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">a</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span>Let <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">`</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
<span class="entity">write1</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'θ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'σ</span> <span class="main">⇒</span> <span class="tfree">'v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">write1</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> oPrefix <span class="main">(</span><span class="main">λ</span> <span class="bound">A</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
<span class="entity">write0</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'θ</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">write0</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> Prefix0 <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
<span class="quoted">"_read"</span>  <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span>id<span class="main">,</span> pttrn<span class="main">,</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action<span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">`?`</span>_ <span class="keyword3">/</span><span class="keyword1">→</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>
<span class="quoted">"_readS"</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span>id<span class="main">,</span> pttrn<span class="main">,</span> <span class="tfree">'θ</span> set<span class="main">,</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action<span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">`?`</span>_<span class="keyword1">`:`</span>_ <span class="keyword3">/</span><span class="keyword1">→</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>
<span class="quoted">"_readSS"</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span>id<span class="main">,</span> pttrn<span class="main">,</span> <span class="tfree">'σ</span> <span class="main">=&gt;</span> <span class="tfree">'θ</span> set<span class="main">,</span><span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action<span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">`?`</span>_<span class="keyword1">`∈`</span>_ <span class="keyword3">/</span><span class="keyword1">→</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>
<span class="quoted">"_write"</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span>id<span class="main">,</span> <span class="tfree">'σ</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action<span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">`!`</span>_ <span class="keyword3">/</span><span class="keyword1">→</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>
<span class="quoted">"_writeS"</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'θ</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action<span class="main">]</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">→</span> _<span class="keyword3">)</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
<span class="quoted">"_read <span class="free">c</span> <span class="free">p</span> <span class="free">P</span>"</span>    <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> read <span class="free">c</span> <span class="main">(</span><span class="keyword1">VAR_LIST</span> p<span class="main">)</span> <span class="free">P</span>"</span> 
<span class="quoted">"_readS <span class="free">c</span> <span class="free">p</span> <span class="free">b</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> read1 <span class="free">c</span> <span class="main">(</span><span class="keyword1">VAR_LIST</span> p<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">_</span><span class="main">.</span> <span class="free">b</span><span class="main">)</span> <span class="free">P</span>"</span>
<span class="quoted">"_readSS <span class="free">c</span> <span class="free">p</span> <span class="free">b</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> read1 <span class="free">c</span> <span class="main">(</span><span class="keyword1">VAR_LIST</span> p<span class="main">)</span> <span class="free">b</span> <span class="free">P</span>"</span>
<span class="quoted">"_write <span class="free">c</span> <span class="free">p</span> <span class="free">P</span>"</span>   <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> write1 <span class="free">c</span> <span class="free">p</span> <span class="free">P</span>"</span>
<span class="quoted">"_writeS <span class="free">a</span> <span class="free">P</span>"</span>    <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> write0 <span class="free">a</span> <span class="free">P</span>"</span>

<span class="keyword1" id="Denotational_Semantics-Prefix_is_action"><span class="command">lemma</span></span> Prefix_is_action<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span>do <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> more <span class="bound">A'</span> <span class="main">=</span> more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rd_is_CSP<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-Prefix1_is_action"><span class="command">lemma</span></span> Prefix1_is_action<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> do_I <span class="free">c</span> <span class="main">(</span><span class="free">S</span> <span class="main">(</span>alpha_rp.more <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span> <span class="main">∧</span> alpha_rp.more <span class="bound">A'</span> <span class="main">=</span> alpha_rp.more <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rd_is_CSP<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-Prefix0_is_action"><span class="command">lemma</span></span> Prefix0_is_action<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span>do <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> more <span class="bound">A'</span> <span class="main">=</span> more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rd_is_CSP<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> Prefix_is_CSP <span class="main">=</span> Prefix_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> Prefix1_is_CSP <span class="main">=</span> Prefix1_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> Prefix0_is_CSP <span class="main">=</span> Prefix0_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_iPrefix"><span class="command">lemma</span></span> relation_of_iPrefix<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>iPrefix <span class="free">c</span> <span class="free">i</span> <span class="free">j</span> <span class="free">S</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> 
<span class="main">(</span><span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>do_I <span class="free">c</span> <span class="main">(</span><span class="free">S</span> <span class="main">(</span>more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span> <span class="main">&amp;</span> more <span class="bound">A'</span> <span class="main">=</span> more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;;</span> relation_of <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iPrefix_def relation_of_Seq action_of_inverse Prefix1_is_CSP<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_oPrefix"><span class="command">lemma</span></span> relation_of_oPrefix<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>oPrefix <span class="free">c</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> 
<span class="main">(</span><span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span>do <span class="free">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> more <span class="bound">A'</span> <span class="main">=</span> more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;;</span> relation_of <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> oPrefix_def relation_of_Seq action_of_inverse Prefix_is_CSP<span class="main">)</span>


<span class="keyword1" id="Denotational_Semantics-relation_of_Prefix0"><span class="command">lemma</span></span> relation_of_Prefix0<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span>Prefix0 <span class="free">c</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> 
<span class="main">(</span><span class="main">(</span>R<span class="main">(</span>true <span class="main">⊢</span> <span class="main">(</span>do <span class="main">(</span><span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> more <span class="bound">A'</span> <span class="main">=</span> more <span class="bound">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;;</span> relation_of <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Prefix0_def relation_of_Seq action_of_inverse Prefix0_is_CSP<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-mono_iPrefix"><span class="command">lemma</span></span> mono_iPrefix <span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span>iPrefix <span class="free">c</span> <span class="free">i</span> <span class="free">j</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def less_eq_action ref_def relation_of_iPrefix<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-mono_oPrefix"><span class="command">lemma</span></span> mono_oPrefix <span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span>oPrefix <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def less_eq_action ref_def relation_of_oPrefix<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-mono_Prefix0"><span class="command">lemma</span></span> mono_Prefix0 <span class="main">:</span> <span class="quoted"><span class="quoted">"mono<span class="main">(</span>Prefix0 <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def less_eq_action ref_def relation_of_Prefix0<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Hiding›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Hide</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="tfree">'θ</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"\<span class="keyword1">\</span>"</span> 18<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> \<span class="main"><span class="free">\</span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">≡</span> action_of<span class="main">(</span>R<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>diff_tr <span class="bound">S'</span> <span class="bound">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">(</span>tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">&amp;</span>
             <span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="bound">s</span><span class="main">,</span> ref <span class="main">:=</span> <span class="main">(</span>ref <span class="bound">S'</span><span class="main">)</span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">;;</span> <span class="main">(</span>relation_of Skip<span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">hid</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">==</span> <span class="main">(</span>R<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>diff_tr <span class="bound">S'</span> <span class="bound">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">(</span>tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="bound">s</span><span class="main">,</span> ref <span class="main">:=</span> <span class="main">(</span>ref <span class="bound">S'</span><span class="main">)</span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="main">(</span>relation_of Skip<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Denotational_Semantics-hid_is_R"><span class="command">lemma</span></span> hid_is_R<span class="main">:</span> <span class="quoted"><span class="quoted">"hid <span class="free">P</span> <span class="free">cs</span> <span class="keyword1">is</span> R <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hid_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> seq_R<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Healthy_def R_idem2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CSP_is_R<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> relation_of_CSP<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-hid_Skip"><span class="command">lemma</span></span> hid_Skip<span class="main">:</span> <span class="quoted"><span class="quoted">"hid <span class="free">P</span> <span class="free">cs</span> <span class="main">=</span> <span class="main">(</span>hid <span class="free">P</span> <span class="free">cs</span> <span class="main">;;</span> relation_of Skip<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hid_def comp_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Skip_comp_absorb<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-hid_is_CSP1"><span class="command">lemma</span></span> hid_is_CSP1<span class="main">:</span> <span class="quoted"><span class="quoted">"hid <span class="free">P</span> <span class="free">cs</span> <span class="keyword1">is</span> CSP1 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> design_defs CSP1_def hid_def rp_defs fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> CSP_is_rd<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs relation_of_CSP design_defs fun_eq_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diff_tr_def relation_of_Skip rp_defs design_defs true_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-hid_is_CSP2"><span class="command">lemma</span></span> hid_is_CSP2<span class="main">:</span> <span class="quoted"><span class="quoted">"hid <span class="free">P</span> <span class="free">cs</span> <span class="keyword1">is</span> CSP2 <span class="keyword1">healthy</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hid_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> seq_CSP2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> CSP_is_CSP2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> relation_of_CSP<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Denotational_Semantics-hid_is_CSP"><span class="command">lemma</span></span> hid_is_CSP<span class="main">:</span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="main">(</span>hid <span class="free">P</span> <span class="free">cs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> csp_defs hid_is_CSP1 hid_is_R hid_is_CSP2<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-Hide_is_action"><span class="command">lemma</span></span> Hide_is_action<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>R<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>diff_tr <span class="bound">S'</span> <span class="bound">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">(</span>tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="free">cs</span><span class="main">)</span> <span class="main">&amp;</span>
   <span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">⦇</span>tr <span class="main">:=</span> <span class="bound">s</span><span class="main">,</span> ref <span class="main">:=</span> <span class="main">(</span>ref <span class="bound">S'</span><span class="main">)</span> <span class="main">∪</span> <span class="free">cs</span> <span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">;;</span> <span class="main">(</span>relation_of Skip<span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hid_is_CSP<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> hid_def<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> Hide_is_CSP <span class="main">=</span> Hide_is_action<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1" id="Denotational_Semantics-relation_of_Hide"><span class="command">lemma</span></span> relation_of_Hide<span class="main">:</span>
<span class="quoted"><span class="quoted">"relation_of <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">cs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>R<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>diff_tr <span class="bound">S'</span> <span class="bound">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tr_filter <span class="main">(</span><span class="bound">s</span> <span class="main">-</span> <span class="main">(</span>tr <span class="bound">S</span><span class="main">)</span><span class="main">)</span> <span class="free">cs</span><span class="main">)</span>
        <span class="main">&amp;</span> <span class="main">(</span>relation_of <span class="free">P</span><span class="main">)</span><span class="main">(</span><span class="bound">S</span><span class="main">,</span> <span class="bound">S'</span><span class="main">⦇</span>tr <span class="main">:=</span><span class="bound">s</span><span class="main">,</span> ref <span class="main">:=</span> <span class="main">(</span>ref <span class="bound">S'</span><span class="main">)</span> <span class="main">∪</span> <span class="free">cs</span> <span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">;;</span> <span class="main">(</span>relation_of Skip<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hide_def action_of_inverse Hide_is_CSP<span class="main">)</span>

<span class="keyword1" id="Denotational_Semantics-mono_Hide"><span class="command">lemma</span></span> mono_Hide <span class="main">:</span> <span class="quoted"><span class="quoted">"mono<span class="main">(</span><span class="main">λ</span> <span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> \<span class="main">\</span> <span class="free">cs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_def less_eq_action ref_def prefix_def utp_defs relation_of_Hide rp_defs<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Recursion›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To represent the recursion operator "<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>μ›</span></span></span></span>" over actions, we use the
universal least fix-point operator "<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> lfp<span class="antiquote"><span class="antiquote">}</span></span></span></span>" defined in the HOL library for lattices. 
The operator "<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> lfp<span class="antiquote"><span class="antiquote">}</span></span></span></span>" is inherited from the "Complete Lattice class" under some conditions. 
All theorems defined over this operator can be reused.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="Circus_Actions.html"></a><a href="Circus_Actions.html">Circus.Circus_Actions</a><span class="antiquote"><span class="antiquote">}</span></span></span></span> theory, we presented the proof that Circus actions 
form a complete lattice. The Knaster-Tarski Theorem (in its simplest formulation) states 
that any monotone function on a complete lattice has a least fixed-point. 
This is a consequence of the basic boundary properties of the complete lattice operations. 
Instantiating the complete lattice class allows one to inherit these properties with the 
definition of the least fixed-point for monotonic functions over Circus actions.
›</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_MU"</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span>idt<span class="main">,</span> idt <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action<span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ</span><span class="main">)</span> action"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">μ</span> _ <span class="keyword1">∙</span> _"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span> <span class="quoted">"_MU <span class="free">X</span> <span class="free">P</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> lfp <span class="main">(</span><span class="main">λ</span> <span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>


<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Instead fo the following:›</span></span>
<span class="keyword1" id="Denotational_Semantics-is_action_REP_Mu"><span class="command">lemma</span></span> is_action_REP_Mu<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_CSP_process <span class="main">(</span>relation_of <span class="main">(</span>lfp <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">oops</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹... we refer to the proof of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> Sup_is_action<span class="antiquote">}</span></span> and its 
analogue who capture the essence of this proof at the level of the
type instantiation.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Monotonicity: STATUS: probably critical.  Does not seem to be necessary for 
parameterless Circus.›</span></span>
<span class="keyword1" id="Denotational_Semantics-mono_Mu"><span class="command">lemma</span></span> mono_Mu<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A <span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     B <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">X</span><span class="main">.</span> mono <span class="main">(</span><span class="free">P</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"mono <span class="main">(</span>lfp <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lfp_unfold<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A B<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1"><span class="command">term</span></span> <span class="quoted">Nat.Suc</span>
<span class="comment1">(*&gt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Circus_Syntax">
<div class="head">
<h1>Theory Circus_Syntax</h1>
</div>
<pre class="source">
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Circus syntax›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Circus_Syntax
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Denotational_Semantics.html">Denotational_Semantics</a>
<span class="keyword2"><span class="keyword">keywords</span></span> <span class="quoted">"alphabet"</span> <span class="quoted">"state"</span> <span class="quoted">"channel"</span> <span class="quoted">"nameset"</span> <span class="quoted">"chanset"</span> <span class="quoted">"schema"</span> <span class="quoted">"action"</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"circus_process"</span> <span class="main">::</span> thy_defn
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">list_select</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'a</span> list<span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">list_select</span> <span class="free"><span class="bound"><span class="entity">Sel</span></span></span> <span class="main">≡</span> hd <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">Sel</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">list_update</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'r</span><span class="main">]</span>
                         <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'r</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">list_update</span> <span class="free"><span class="bound"><span class="entity">Upd</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">e</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Upd</span></span></span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="bound">e</span> <span class="main">(</span>hd <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>tl <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">list_update_const</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'r</span><span class="main">]</span>
                                <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'r</span> relation"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">list_update_const</span> <span class="free"><span class="bound"><span class="entity">Upd</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">e</span><span class="main">.</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="bound">A'</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Upd</span></span></span> <span class="main">(</span><span class="main">λ</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">e</span><span class="main">#</span><span class="main">(</span>tl <span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="bound">A</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">update_const</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'r</span> <span class="main">⇒</span> <span class="tfree">'r</span><span class="main">]</span>
                                <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'r</span> relation"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">update_const</span> <span class="free"><span class="bound"><span class="entity">Upd</span></span></span> <span class="main">≡</span> <span class="main">λ</span> <span class="bound">e</span><span class="main">.</span> <span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">A'</span><span class="main">)</span><span class="main">.</span> <span class="bound">A'</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Upd</span></span></span> <span class="main">(</span><span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="bound">e</span><span class="main">)</span> <span class="bound">A</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_synt_assign"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"id <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> relation"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">:=</span> _"</span><span class="main">)</span>


<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">VARs_Data</span> <span class="main">=</span> Proof_Data
<span class="main">(</span>
  <span class="keyword1"><span class="keyword">type</span></span> <span class="entity">T</span> <span class="main">=</span> <span class="main">{</span>State_vars<span class="main">:</span> string list<span class="main">,</span> Alpha_vars<span class="main">:</span> string list<span class="main">}</span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">init</span> <span class="main">_</span> <span class="main">:</span> <span class="entity">T</span> <span class="main">=</span> <span class="main">{</span>State_vars <span class="main">=</span> <span class="main">[</span><span class="main">]</span><span class="main">,</span> Alpha_vars <span class="main">=</span> <span class="main">[</span><span class="main">]</span><span class="main">}</span>
<span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">nonterminal</span></span> circus_action <span class="keyword2"><span class="keyword">and</span></span> circus_schema

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_circus_action"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">=&gt;</span> circus_action"</span></span>  <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>   <span class="comment1">(* FIXME unused!? *)</span>
  <span class="quoted">"_circus_schema"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">=&gt;</span> circus_schema"</span></span>  <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>

<span class="keyword1"><span class="command">parse_translation</span></span> <span class="quoted">‹
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">antiquote_tr</span> <span class="entity">ctxt</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="main">{</span>State_vars<span class="main">=</span><span class="entity">sv</span><span class="main">,</span> Alpha_vars<span class="main">=</span><span class="entity">av</span><span class="main">}</span> <span class="main">=</span> VARs_Data.get <span class="entity">ctxt</span>

        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_selector</span> <span class="entity">x</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">c</span> <span class="main">=</span> Consts.intern <span class="main">(</span>Proof_Context.consts_of <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">x</span>
          <span class="keyword2"><span class="keyword">in</span></span>
                <span class="keyword2"><span class="keyword">if</span></span> member <span class="main">(</span><span class="main">=</span><span class="main">)</span> <span class="entity">av</span> <span class="entity">x</span> <span class="keyword2"><span class="keyword">then</span></span> SOME <span class="main">(</span>Const <span class="main">(</span><span class="inner_quoted">"Circus_Syntax.list_select"</span><span class="main">,</span> dummyT<span class="main">)</span> $ <span class="main">(</span>Syntax.const <span class="entity">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span>
                  <span class="keyword2"><span class="keyword">if</span></span> member <span class="main">(</span><span class="main">=</span><span class="main">)</span> <span class="entity">sv</span> <span class="entity">x</span> <span class="keyword2"><span class="keyword">then</span></span> SOME <span class="main">(</span>Syntax.const <span class="entity">c</span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span> NONE <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_update</span> <span class="entity">x</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">c</span> <span class="main">=</span> Consts.intern <span class="main">(</span>Proof_Context.consts_of <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">x</span>
          <span class="keyword2"><span class="keyword">in</span></span>
                <span class="keyword2"><span class="keyword">if</span></span> member <span class="main">(</span><span class="main">=</span><span class="main">)</span> <span class="entity">av</span> <span class="entity">x</span> <span class="keyword2"><span class="keyword">then</span></span> SOME <span class="main">(</span>Const <span class="main">(</span><span class="inner_quoted">"Circus_Syntax.list_update_const"</span><span class="main">,</span> dummyT<span class="main">)</span> $ <span class="main">(</span>Syntax.const <span class="main">(</span><span class="entity">c</span>^<span class="entity">Record.updateN</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span>
                  <span class="keyword2"><span class="keyword">if</span></span> member <span class="main">(</span><span class="main">=</span><span class="main">)</span> <span class="entity">sv</span> <span class="entity">x</span> <span class="keyword2"><span class="keyword">then</span></span> SOME <span class="main">(</span>Const <span class="main">(</span><span class="inner_quoted">"Circus_Syntax.update_const"</span><span class="main">,</span> dummyT<span class="main">)</span> $ <span class="main">(</span>Syntax.const <span class="main">(</span><span class="entity">c</span>^<span class="entity">Record.updateN</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span> NONE <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">print</span> <span class="entity">text</span> <span class="main">=</span>  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> writeln <span class="entity">text</span><span class="main">;</span> <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">x</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span><span class="main">;</span>

        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rel_op_type</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'c</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'c</span> <span class="main">⇒</span> bool"</span><span class="antiquote">}</span></span><span class="main">;</span>

        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">tr</span> <span class="entity">i</span> <span class="main">(</span><span class="entity">t</span> <span class="keyword1"><span class="keyword">as</span></span> Free <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">get_selector</span> <span class="entity">x</span> <span class="keyword2"><span class="keyword">of</span></span>
                SOME <span class="entity">c</span> <span class="main">=&gt;</span>  <span class="entity">c</span> $ Bound <span class="main">(</span><span class="entity">i</span> + <span class="inner_numeral">1</span><span class="main">)</span>
              <span class="main">|</span> NONE <span class="main">=&gt;</span>
                  <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> try <span class="main">(</span>unsuffix <span class="inner_quoted">"'"</span><span class="main">)</span> <span class="entity">x</span> <span class="keyword2"><span class="keyword">of</span></span>
                    SOME <span class="entity">y</span> <span class="main">=&gt;</span>
                      <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">get_selector</span> <span class="entity">y</span> <span class="keyword2"><span class="keyword">of</span></span> SOME <span class="entity">c</span> <span class="main">=&gt;</span> <span class="entity">c</span> $ Bound <span class="entity">i</span> <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="entity">t</span><span class="main">)</span>
                  <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="entity">t</span><span class="main">)</span><span class="main">)</span>
          <span class="main">|</span> <span class="entity">tr</span> <span class="entity">i</span> <span class="main">(</span><span class="entity">t</span> <span class="keyword1"><span class="keyword">as</span></span> <span class="main">(</span>Const <span class="main">(</span><span class="inner_quoted">"_synt_assign"</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ Free <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">get_update</span> <span class="entity">x</span> <span class="keyword2"><span class="keyword">of</span></span>
                SOME <span class="entity">c</span> <span class="main">=&gt;</span>  <span class="entity">c</span> $ <span class="main">(</span><span class="entity">tr</span> <span class="entity">i</span> <span class="entity">r</span><span class="main">)</span> $ <span class="main">(</span>Const <span class="main">(</span><span class="inner_quoted">"Product_Type.Pair"</span><span class="main">,</span> dummyT<span class="main">)</span> $ Bound <span class="main">(</span><span class="entity">i</span> + <span class="inner_numeral">1</span><span class="main">)</span> $ Bound <span class="entity">i</span><span class="main">)</span>
              <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="entity">t</span><span class="main">)</span>
<span class="comment1">(*          | tr i (t as (Const (c, rel_op_type) $ l $ r)) = print c
              ((Syntax.const @{const_name case_prod} $
                Abs ("B", dummyT, Abs ("B'", dummyT, Const (c, rel_op_type)))) $ tr i l $ tr i r)
                  $ (Const ("Product_Type.Pair", dummyT) $ Bound (i + 1) $ Bound i)*)</span>
          <span class="main">|</span> <span class="entity">tr</span> <span class="entity">i</span> <span class="main">(</span><span class="entity">t</span> $ <span class="entity">u</span><span class="main">)</span> <span class="main">=</span> <span class="entity">tr</span> <span class="entity">i</span> <span class="entity">t</span> $ <span class="entity">tr</span> <span class="entity">i</span> <span class="entity">u</span>
          <span class="main">|</span> <span class="entity">tr</span> <span class="entity">i</span> <span class="main">(</span>Abs <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">T</span><span class="main">,</span> <span class="entity">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">T</span><span class="main">,</span> <span class="entity">tr</span> <span class="main">(</span><span class="entity">i</span> + <span class="inner_numeral">1</span><span class="main">)</span> <span class="entity">t</span><span class="main">)</span>
          <span class="main">|</span> <span class="entity">tr</span> <span class="main">_</span> <span class="entity">a</span> <span class="main">=</span> <span class="entity">a</span><span class="main">;</span>
      <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">tr</span> <span class="inner_numeral">0</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">quote_tr</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span> <span class="main">=</span>
          Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> case_prod<span class="antiquote">}</span></span> $
            Abs <span class="main">(</span><span class="inner_quoted">"A"</span><span class="main">,</span> dummyT<span class="main">,</span> Abs <span class="main">(</span><span class="inner_quoted">"A'"</span><span class="main">,</span> dummyT<span class="main">,</span> <span class="entity">antiquote_tr</span> <span class="entity">ctxt</span> <span class="main">(</span>Term.incr_boundvars <span class="inner_numeral">2</span> <span class="entity">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> <span class="entity">quote_tr</span> <span class="main">_</span> <span class="entity">ts</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"quote_tr"</span><span class="main">,</span> <span class="entity">ts</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_circus_schema"<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">quote_tr</span><span class="main">)</span><span class="main">]</span> <span class="keyword2"><span class="keyword">end</span></span>
›</span>


<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_fields</span> <span class="main">(</span>SOME <span class="main">(</span><span class="main">{</span><span class="entity">fields</span><span class="main">,</span> <span class="entity">parent</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span><span class="main">:</span> <span class="entity">Record.info</span><span class="main">)</span><span class="main">)</span> <span class="entity">thy</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> <span class="entity">parent</span> <span class="keyword2"><span class="keyword">of</span></span>
       SOME <span class="main">(</span> <span class="main">_</span><span class="main">,</span><span class="entity">y</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">fields</span> @ <span class="entity">get_fields</span> <span class="main">(</span><span class="entity">Record.get_info</span> <span class="entity">thy</span> <span class="entity">y</span><span class="main">)</span> <span class="entity">thy</span>
     <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="entity">fields</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">get_fields</span> NONE <span class="main">_</span> <span class="main">=</span> <span class="main">[</span><span class="main">]</span>


<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">dummy</span> <span class="main">=</span> Term.dummy_pattern dummyT<span class="main">;</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_eq</span> <span class="main">(</span><span class="entity">l</span><span class="main">,</span> <span class="entity">r</span><span class="main">)</span> <span class="main">=</span> <span class="entity">HOLogic.Trueprop</span> $ <span class="main">(</span><span class="main">(</span><span class="entity">HOLogic.eq_const</span> dummyT<span class="main">)</span> $ <span class="entity">l</span> $ <span class="entity">r</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">add_datatype</span> <span class="main">(</span><span class="entity">params</span><span class="main">,</span> <span class="entity">binding</span><span class="main">)</span> <span class="entity">constr_specs</span> <span class="entity">thy</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="main">[</span><span class="entity">dt_name</span><span class="main">]</span><span class="main">,</span> <span class="entity">thy'</span><span class="main">)</span> <span class="main">=</span> <span class="entity">thy</span>
      |&gt; <span class="entity">BNF_LFP_Compat.add_datatype</span> <span class="main">[</span><span class="entity">BNF_LFP_Compat.Keep_Nesting</span><span class="main">]</span>
        <span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="entity">binding</span><span class="main">,</span> <span class="entity">params</span><span class="main">,</span> NoSyn<span class="main">)</span><span class="main">,</span> <span class="entity">constr_specs</span><span class="main">)</span><span class="main">]</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">constr_names</span> <span class="main">=</span>
      map fst <span class="main">(</span>the_single <span class="main">(</span>map <span class="main">(</span><span class="main">#</span><span class="inner_numeral">3</span> o snd<span class="main">)</span>
        <span class="main">(</span><span class="main">#</span>descr <span class="main">(</span><span class="entity">BNF_LFP_Compat.the_info</span> <span class="entity">thy'</span> <span class="main">[</span><span class="entity">BNF_LFP_Compat.Keep_Nesting</span><span class="main">]</span> <span class="entity">dt_name</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">constr</span> <span class="main">(</span><span class="entity">c</span><span class="main">,</span> <span class="entity">Ts</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Const <span class="main">(</span><span class="entity">c</span><span class="main">,</span> dummyT<span class="main">)</span><span class="main">,</span> length <span class="entity">Ts</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">constrs</span> <span class="main">=</span> map <span class="main">#</span><span class="inner_numeral">1</span> <span class="entity">constr_specs</span> ~~ map <span class="entity">constr</span> <span class="main">(</span><span class="entity">constr_names</span> ~~ map <span class="main">#</span><span class="inner_numeral">2</span> <span class="entity">constr_specs</span><span class="main">)</span><span class="main">;</span>
   <span class="keyword2"><span class="keyword">in</span></span> <span class="main">(</span><span class="main">(</span><span class="entity">dt_name</span><span class="main">,</span> <span class="entity">constrs</span><span class="main">)</span><span class="main">,</span> <span class="entity">thy'</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">define_channels</span> <span class="main">(</span><span class="entity">params</span><span class="main">,</span> <span class="entity">binding</span><span class="main">)</span> <span class="entity">typesyn</span> <span class="entity">channels</span> <span class="entity">thy</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">typesyn</span> <span class="keyword2"><span class="keyword">of</span></span>
  NONE <span class="main">=&gt;</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">dt_binding</span> <span class="main">=</span> Binding.suffix_name <span class="inner_quoted">"_channels"</span> <span class="entity">binding</span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">constr_specs</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">b</span><span class="main">,</span> <span class="entity">opt_T</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">b</span><span class="main">,</span> the_list <span class="entity">opt_T</span><span class="main">,</span> NoSyn<span class="main">)</span><span class="main">)</span> <span class="entity">channels</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="main">(</span><span class="entity">dt_name</span><span class="main">,</span> <span class="entity">constrs</span><span class="main">)</span><span class="main">,</span> <span class="entity">thy1</span><span class="main">)</span> <span class="main">=</span>
      <span class="entity">add_datatype</span> <span class="main">(</span><span class="entity">params</span><span class="main">,</span> <span class="entity">dt_binding</span><span class="main">)</span> <span class="entity">constr_specs</span> <span class="entity">thy</span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">T</span> <span class="main">=</span> Type <span class="main">(</span><span class="entity">dt_name</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">fun_name</span> <span class="main">=</span> <span class="inner_quoted">"ev_eq"</span> ^ <span class="inner_quoted">"_"</span> ^ Long_Name.base_name <span class="entity">dt_name</span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ev_equ</span> <span class="main">=</span> Free <span class="main">(</span><span class="entity">fun_name</span><span class="main">,</span> <span class="entity">T</span> --&gt; <span class="entity">T</span> --&gt; <span class="entity">HOLogic.boolT</span><span class="main">)</span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">eqs</span> <span class="main">=</span> map_product <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">(</span><span class="entity">c</span><span class="main">,</span> <span class="entity">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">(</span><span class="entity">c1</span><span class="main">,</span><span class="entity">n1</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t</span> <span class="main">=</span> Term.list_comb <span class="main">(</span><span class="entity">c</span><span class="main">,</span> replicate <span class="entity">n</span> <span class="entity">dummy</span><span class="main">)</span><span class="main">;</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t1</span> <span class="main">=</span> Term.list_comb <span class="main">(</span><span class="entity">c1</span><span class="main">,</span> replicate <span class="entity">n1</span> <span class="entity">dummy</span><span class="main">)</span><span class="main">;</span>
      <span class="keyword2"><span class="keyword">in</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="entity">c</span> <span class="main">=</span> <span class="entity">c1</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">mk_eq</span> <span class="main">(</span><span class="main">(</span><span class="entity">ev_equ</span> $ <span class="entity">t</span> $ <span class="entity">t1</span><span class="main">)</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">True</span><span class="antiquote">}</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">mk_eq</span> <span class="main">(</span><span class="main">(</span><span class="entity">ev_equ</span> $ <span class="entity">t</span> $ <span class="entity">t1</span><span class="main">)</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">False</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span><span class="main">)</span> <span class="entity">constrs</span> <span class="entity">constrs</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">case_tac</span> <span class="entity">x</span> <span class="entity">ctxt</span> <span class="main">=</span>
    resolve_tac <span class="entity">ctxt</span> <span class="main">[</span>Thm.instantiate' <span class="main">[</span><span class="main">]</span> <span class="main">[</span>SOME <span class="entity">x</span><span class="main">]</span>
      <span class="main">(</span><span class="main">#</span>exhaust <span class="main">(</span><span class="entity">BNF_LFP_Compat.the_info</span> <span class="main">(</span>Proof_Context.theory_of <span class="entity">ctxt</span><span class="main">)</span> <span class="main">[</span><span class="entity">BNF_LFP_Compat.Keep_Nesting</span><span class="main">]</span> <span class="entity">dt_name</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">proof</span> <span class="entity">ctxt</span> <span class="main">=</span> <span class="main">(</span><span class="entity">Class.intro_classes_tac</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="main">]</span> THEN
                      <span class="entity">Subgoal.FOCUS</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt'</span><span class="main">,</span> params <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="entity">x</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
                                        <span class="main">(</span><span class="entity">case_tac</span> <span class="entity">x</span> <span class="entity">ctxt'</span><span class="main">)</span> <span class="inner_numeral">1</span>
                                            THEN <span class="entity">auto_tac</span> <span class="entity">ctxt'</span><span class="main">)</span> <span class="entity">ctxt</span> <span class="inner_numeral">1</span> THEN
                      <span class="entity">Subgoal.FOCUS</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt'</span><span class="main">,</span> params <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="entity">x</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="entity">y</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=&gt;</span>
                                        <span class="main">(</span><span class="main">(</span><span class="entity">case_tac</span> <span class="entity">x</span> <span class="entity">ctxt'</span><span class="main">)</span> THEN_ALL_NEW <span class="main">(</span><span class="entity">case_tac</span> <span class="entity">y</span> <span class="entity">ctxt'</span><span class="main">)</span><span class="main">)</span> <span class="inner_numeral">1</span>
                                            THEN <span class="entity">auto_tac</span> <span class="entity">ctxt'</span><span class="main">)</span> <span class="entity">ctxt</span> <span class="inner_numeral">1</span><span class="main">)</span><span class="main">;</span>

 <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thy2</span> <span class="main">=</span>
      <span class="entity">thy1</span>
      |&gt; <span class="entity">Class.instantiation</span> <span class="main">(</span><span class="main">[</span><span class="entity">dt_name</span><span class="main">]</span><span class="main">,</span> <span class="entity">params</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">sort</span> <span class="quoted">ev_eq</span><span class="antiquote">}</span></span><span class="main">)</span>
      |&gt; Local_Theory.begin_nested
      |&gt; snd
      |&gt; <span class="entity">Function_Fun.add_fun</span> <span class="main">[</span><span class="main">(</span>Binding.name <span class="entity">fun_name</span><span class="main">,</span> NONE<span class="main">,</span> NoSyn<span class="main">)</span><span class="main">]</span>
           <span class="main">(</span>map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">t</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">(</span>Binding.empty_atts<span class="main">,</span> <span class="entity">t</span><span class="main">)</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="entity">eqs</span><span class="main">)</span> <span class="entity">Function_Fun.fun_config</span>
      |&gt; Local_Theory.end_nested
      |&gt; <span class="entity">Class.prove_instantiation_exit</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="entity">proof</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="main">(</span><span class="main">(</span><span class="entity">dt_name</span><span class="main">,</span> <span class="entity">constrs</span><span class="main">)</span><span class="main">,</span> <span class="entity">thy2</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>
  <span class="main">|</span> <span class="main">(</span>SOME <span class="entity">typn</span><span class="main">)</span> <span class="main">=&gt;</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">dt_binding</span> <span class="main">=</span> Binding.suffix_name <span class="inner_quoted">"_channels"</span> <span class="entity">binding</span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">dt_name</span><span class="main">,</span> <span class="entity">thy1</span><span class="main">)</span> <span class="main">=</span>
            <span class="entity">thy</span>
            |&gt; <span class="entity">Named_Target.theory_init</span>
            |&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="entity">Typedecl.abbrev</span> <span class="main">(</span><span class="entity">dt_binding</span><span class="main">,</span> map fst <span class="entity">params</span><span class="main">,</span> NoSyn<span class="main">)</span> <span class="main">(</span>Proof_Context.read_typ <span class="entity">ctxt</span> <span class="entity">typn</span><span class="main">)</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">;</span>

   <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thy2</span> <span class="main">=</span> <span class="entity">thy1</span> |&gt; Local_Theory.exit_global<span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="main">(</span><span class="main">(</span><span class="entity">dt_name</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="entity">thy2</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">define_chanset</span> <span class="entity">binding</span> <span class="entity">channel_constrs</span> <span class="main">(</span><span class="entity">name</span><span class="main">,</span> <span class="entity">chans</span><span class="main">)</span> <span class="entity">thy</span>  <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">constrs</span> <span class="main">=</span>
       filter <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">b</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=&gt;</span> exists <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">a</span> <span class="main">=&gt;</span> <span class="entity">a</span> <span class="main">=</span> Binding.name_of <span class="entity">b</span><span class="main">)</span> <span class="entity">chans</span><span class="main">)</span> <span class="entity">channel_constrs</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">bad_chans</span> <span class="main">=</span>
      filter_out <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">a</span> <span class="main">=&gt;</span> exists <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">b</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">a</span> <span class="main">=</span> Binding.name_of <span class="entity">b</span><span class="main">)</span> <span class="entity">channel_constrs</span><span class="main">)</span> <span class="entity">chans</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> null <span class="entity">bad_chans</span> <span class="keyword1"><span class="keyword">orelse</span></span>
      error <span class="main">(</span><span class="inner_quoted">"Bad elements "</span> ^ commas_quote <span class="entity">bad_chans</span> ^ <span class="inner_quoted">" in chanset: "</span> ^ quote <span class="main">(</span>Binding.print <span class="entity">name</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">base_name</span> <span class="main">=</span> Binding.name_of <span class="entity">name</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">cs</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">(</span><span class="entity">c</span><span class="main">,</span> <span class="entity">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> Term.list_comb <span class="main">(</span><span class="entity">c</span><span class="main">,</span> replicate <span class="entity">n</span> <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> undefined<span class="antiquote">}</span></span><span class="main">,</span> dummyT<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="entity">constrs</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">chanset_eq</span> <span class="main">=</span> <span class="entity">mk_eq</span> <span class="main">(</span><span class="main">(</span>Free <span class="main">(</span><span class="entity">base_name</span><span class="main">,</span> dummyT<span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="entity">HOLogic.mk_set</span> dummyT <span class="entity">cs</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
      <span class="entity">thy</span>
      |&gt; <span class="entity">Named_Target.theory_init</span>
      |&gt; <span class="entity">Specification.definition</span> <span class="main">(</span>SOME <span class="main">(</span>Binding.qualify_name true <span class="entity">binding</span> <span class="entity">base_name</span><span class="main">,</span> NONE<span class="main">,</span> NoSyn<span class="main">)</span><span class="main">)</span>
          <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="main">(</span>Binding.empty_atts<span class="main">,</span> <span class="entity">chanset_eq</span><span class="main">)</span>
      |&gt; snd |&gt; Local_Theory.exit_global
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">define_nameset</span> <span class="entity">binding</span> <span class="main">(</span><span class="entity">rec_binding</span><span class="main">,</span> <span class="entity">alphabet</span><span class="main">)</span> <span class="main">(</span><span class="entity">ns_binding</span><span class="main">,</span> <span class="entity">names</span><span class="main">)</span> <span class="entity">thy</span>  <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">all_selectors</span> <span class="main">=</span> <span class="entity">get_fields</span> <span class="main">(</span><span class="entity">Record.get_info</span> <span class="entity">thy</span> <span class="main">(</span>Sign.full_name <span class="entity">thy</span> <span class="entity">rec_binding</span><span class="main">)</span><span class="main">)</span> <span class="entity">thy</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">bad_names</span> <span class="main">=</span>
      filter_out <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">a</span> <span class="main">=&gt;</span> exists <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">b</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=&gt;</span> String.isSuffix <span class="entity">a</span> <span class="entity">b</span><span class="main">)</span> <span class="entity">all_selectors</span><span class="main">)</span> <span class="entity">names</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> null <span class="entity">bad_names</span> <span class="keyword1"><span class="keyword">orelse</span></span>
      error <span class="main">(</span><span class="inner_quoted">"Bad elements "</span> ^ commas_quote <span class="entity">bad_names</span> ^ <span class="inner_quoted">" in nameset: "</span> ^ quote <span class="main">(</span>Binding.print <span class="entity">ns_binding</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">selectors</span> <span class="main">=</span>
       filter <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">b</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=&gt;</span> exists <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">a</span> <span class="main">=&gt;</span> String.isSuffix <span class="entity">a</span> <span class="entity">b</span><span class="main">)</span> <span class="entity">names</span><span class="main">)</span> <span class="entity">all_selectors</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">updates</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="main">(</span>fst <span class="entity">x</span><span class="main">,</span> <span class="main">(</span><span class="main">(</span>suffix <span class="entity">Record.updateN</span><span class="main">)</span> o fst<span class="main">)</span> <span class="entity">x</span><span class="main">)</span><span class="main">)</span> <span class="entity">selectors</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">selectors'</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">x</span> <span class="main">=&gt;</span> <span class="main">(</span>fst <span class="entity">x</span><span class="main">,</span> Const<span class="main">(</span>fst <span class="entity">x</span><span class="main">,</span> dummyT<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="entity">selectors</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">updates'</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">y</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> Const<span class="main">(</span><span class="entity">y</span><span class="main">,</span> dummyT<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="entity">updates</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">l</span> <span class="main">=</span>
       map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">b</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=&gt;</span> Binding.name_of <span class="entity">b</span><span class="main">)</span> <span class="entity">alphabet</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">formulas</span> <span class="main">=</span> map2 <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">nx</span><span class="main">,</span> <span class="entity">x</span><span class="main">)</span> <span class="main">=&gt;</span>
                           <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">ny</span><span class="main">,</span> <span class="entity">y</span><span class="main">)</span> <span class="main">=&gt;</span>
                             <span class="keyword2"><span class="keyword">if</span></span> <span class="main">(</span>exists <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">b</span> <span class="main">=&gt;</span> String.isSuffix <span class="entity">b</span> <span class="entity">nx</span><span class="main">)</span> <span class="entity">l</span><span class="main">)</span>
                             <span class="keyword2"><span class="keyword">then</span></span> Abs <span class="main">(</span><span class="inner_quoted">"A"</span><span class="main">,</span> dummyT<span class="main">,</span> <span class="main">(</span>Const<span class="main">(</span><span class="inner_quoted">"Circus_Syntax.list_update"</span><span class="main">,</span> dummyT<span class="main">)</span> $ <span class="entity">x</span><span class="main">)</span>
                                          $ <span class="main">(</span>Abs <span class="main">(</span><span class="inner_quoted">"_"</span><span class="main">,</span> dummyT<span class="main">,</span> <span class="main">(</span>Const<span class="main">(</span><span class="inner_quoted">"Circus_Syntax.list_select"</span><span class="main">,</span> dummyT<span class="main">)</span> $ <span class="entity">y</span><span class="main">)</span> $ <span class="main">(</span>Bound <span class="inner_numeral">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="keyword2"><span class="keyword">else</span></span> Abs <span class="main">(</span><span class="inner_quoted">"A"</span><span class="main">,</span> dummyT<span class="main">,</span> <span class="entity">x</span> $ <span class="main">(</span>Abs <span class="main">(</span><span class="inner_quoted">"_"</span><span class="main">,</span> dummyT<span class="main">,</span> <span class="entity">y</span> $ <span class="main">(</span>Bound <span class="inner_numeral">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="entity">updates'</span> <span class="entity">selectors'</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">base_name</span> <span class="main">=</span> Binding.name_of <span class="entity">ns_binding</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">comp</span> <span class="main">[</span><span class="entity">a</span><span class="main">]</span> <span class="main">=</span> <span class="entity">a</span> $ <span class="main">(</span>Bound <span class="inner_numeral">1</span><span class="main">)</span> $ <span class="main">(</span>Bound <span class="inner_numeral">0</span><span class="main">)</span>
      <span class="main">|</span> <span class="entity">comp</span> <span class="main">(</span><span class="entity">a</span>::<span class="entity">l</span><span class="main">)</span> <span class="main">=</span> <span class="entity">a</span> $ <span class="main">(</span>Bound <span class="inner_numeral">1</span><span class="main">)</span> $ <span class="main">(</span><span class="entity">comp</span> <span class="entity">l</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">nameset_eq</span> <span class="main">=</span> <span class="entity">mk_eq</span> <span class="main">(</span><span class="main">(</span>Free <span class="main">(</span><span class="entity">base_name</span><span class="main">,</span> dummyT<span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>Abs <span class="main">(</span><span class="inner_quoted">"_"</span><span class="main">,</span> dummyT<span class="main">,</span> <span class="main">(</span>Abs <span class="main">(</span><span class="inner_quoted">"_"</span><span class="main">,</span> dummyT<span class="main">,</span> <span class="entity">comp</span> <span class="entity">formulas</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
      <span class="entity">thy</span>
      |&gt; <span class="entity">Named_Target.theory_init</span>
      |&gt; <span class="entity">Specification.definition</span> <span class="main">(</span>SOME <span class="main">(</span>Binding.qualify_name true <span class="entity">binding</span> <span class="entity">base_name</span><span class="main">,</span> NONE<span class="main">,</span> NoSyn<span class="main">)</span><span class="main">)</span>
          <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="main">(</span>Binding.empty_atts<span class="main">,</span> <span class="entity">nameset_eq</span><span class="main">)</span>
      |&gt; snd |&gt; Local_Theory.exit_global
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>


<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">define_schema</span> <span class="entity">binding</span> <span class="main">(</span><span class="entity">ex_binding</span><span class="main">,</span> <span class="entity">expr</span><span class="main">)</span> <span class="main">(</span><span class="entity">alph_bind</span><span class="main">,</span> <span class="entity">alpha</span><span class="main">,</span> <span class="entity">state</span><span class="main">)</span> <span class="entity">thy</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">fields_names</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>Binding.name_of <span class="entity">x</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="entity">alpha</span> @ <span class="entity">state</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">alpha'</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>Binding.name_of <span class="entity">x</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span><span class="main">)</span> <span class="entity">alpha</span><span class="main">)</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">state'</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span>Binding.name_of <span class="entity">x</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span><span class="main">)</span> <span class="entity">state</span><span class="main">)</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">all_selectors</span> <span class="main">=</span> <span class="entity">get_fields</span> <span class="main">(</span><span class="entity">Record.get_info</span> <span class="entity">thy</span> <span class="main">(</span>Sign.full_name <span class="entity">thy</span> <span class="entity">alph_bind</span><span class="main">)</span><span class="main">)</span> <span class="entity">thy</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">base_name</span> <span class="main">=</span> Binding.name_of <span class="entity">ex_binding</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt</span> <span class="main">=</span> Proof_Context.init_global <span class="entity">thy</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">term</span> <span class="main">=</span>
        Syntax.read_term
          <span class="main">(</span><span class="entity">ctxt</span>
            |&gt; VARs_Data.put <span class="main">(</span><span class="main">{</span>State_vars<span class="main">=</span><span class="main">(</span>map fst <span class="entity">state'</span><span class="main">)</span><span class="main">,</span> Alpha_vars<span class="main">=</span><span class="main">(</span>map fst <span class="entity">alpha'</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
            |&gt; Config.put Syntax.root <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">nonterminal</span> circus_schema<span class="antiquote">}</span></span><span class="main">)</span> <span class="entity">expr</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sc_eq</span> <span class="main">=</span> <span class="entity">mk_eq</span> <span class="main">(</span><span class="main">(</span>Free <span class="main">(</span><span class="entity">base_name</span><span class="main">,</span> dummyT<span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="entity">term</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">thy</span>
    |&gt; <span class="entity">Named_Target.theory_init</span>
    |&gt; <span class="entity">Specification.definition</span> <span class="main">(</span>SOME <span class="main">(</span>Binding.qualify_name true <span class="entity">binding</span> <span class="entity">base_name</span><span class="main">,</span> NONE<span class="main">,</span> NoSyn<span class="main">)</span><span class="main">)</span>
        <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="main">(</span>Binding.empty_atts<span class="main">,</span> <span class="entity">sc_eq</span><span class="main">)</span>
    |&gt; snd
    |&gt; Local_Theory.exit_global
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>


<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">define_action</span> <span class="entity">binding</span> <span class="main">(</span><span class="entity">ex_binding</span><span class="main">,</span> <span class="entity">expr</span><span class="main">)</span> <span class="entity">alph_bind</span> <span class="entity">chan_bind</span> <span class="entity">thy</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">base_name</span> <span class="main">=</span> Binding.name_of <span class="entity">ex_binding</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt</span> <span class="main">=</span> Proof_Context.init_global <span class="entity">thy</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">actT</span> <span class="main">=</span> <span class="inner_quoted">"Circus_Actions.action"</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">action_eq</span> <span class="main">=</span>
      <span class="entity">mk_eq</span>
        <span class="main">(</span><span class="main">(</span>Free <span class="main">(</span><span class="entity">base_name</span><span class="main">,</span>
          Type <span class="main">(</span><span class="entity">actT</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>Proof_Context.read_type_name <span class="main">{</span>proper<span class="main">=</span>true<span class="main">,</span> strict<span class="main">=</span>false<span class="main">}</span> <span class="entity">ctxt</span> <span class="main">(</span>Sign.full_name <span class="entity">thy</span> <span class="entity">chan_bind</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
            <span class="main">(</span>Proof_Context.read_type_name <span class="main">{</span>proper<span class="main">=</span>true<span class="main">,</span> strict<span class="main">=</span>false<span class="main">}</span> <span class="entity">ctxt</span> <span class="main">(</span>Sign.full_name <span class="entity">thy</span> <span class="entity">alph_bind</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
        <span class="main">(</span>Syntax.parse_term <span class="entity">ctxt</span> <span class="entity">expr</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">thy</span>
    |&gt; <span class="entity">Named_Target.theory_init</span>
    |&gt; <span class="entity">Specification.definition</span> <span class="main">(</span>SOME <span class="main">(</span>Binding.qualify_name true <span class="entity">binding</span> <span class="entity">base_name</span><span class="main">,</span> NONE<span class="main">,</span> NoSyn<span class="main">)</span><span class="main">)</span>
        <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="main">(</span>Binding.empty_atts<span class="main">,</span> <span class="entity">action_eq</span><span class="main">)</span>
    |&gt; snd
    |&gt; Local_Theory.exit_global
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>



<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">define_expr</span> <span class="entity">binding</span> <span class="main">(</span><span class="entity">alph_bind</span><span class="main">,</span> <span class="entity">alpha</span><span class="main">,</span> <span class="entity">state</span><span class="main">)</span> <span class="entity">chan_bind</span> <span class="main">(</span><span class="entity">ex_binding</span><span class="main">,</span> <span class="main">(</span><span class="entity">is_schema</span><span class="main">,</span> <span class="entity">expr</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">is_schema</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">define_schema</span> <span class="entity">binding</span> <span class="main">(</span><span class="entity">ex_binding</span><span class="main">,</span> <span class="entity">expr</span><span class="main">)</span> <span class="main">(</span><span class="entity">alph_bind</span><span class="main">,</span> <span class="entity">alpha</span><span class="main">,</span> <span class="entity">state</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">define_action</span> <span class="entity">binding</span> <span class="main">(</span><span class="entity">ex_binding</span><span class="main">,</span> <span class="entity">expr</span><span class="main">)</span> <span class="entity">alph_bind</span> <span class="entity">chan_bind</span><span class="main">;</span>



<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">prep_field</span> <span class="entity">prep_typ</span> <span class="main">(</span><span class="entity">b</span><span class="main">:</span> binding<span class="main">,</span> <span class="entity">raw_T</span><span class="main">)</span> <span class="entity">ctxt</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">T</span> <span class="main">=</span> <span class="entity">prep_typ</span> <span class="entity">ctxt</span> <span class="entity">raw_T</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt'</span> <span class="main">=</span> Variable.declare_typ <span class="entity">T</span> <span class="entity">ctxt</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="main">(</span><span class="main">(</span><span class="entity">b</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span><span class="main">,</span> <span class="entity">ctxt'</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">prep_constr</span> <span class="entity">prep_typ</span> <span class="main">(</span><span class="entity">b</span><span class="main">:</span> binding<span class="main">,</span> <span class="entity">raw_T</span><span class="main">)</span> <span class="entity">ctxt</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">T</span> <span class="main">=</span> Option.map <span class="main">(</span><span class="entity">prep_typ</span> <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">raw_T</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt'</span> <span class="main">=</span> fold Variable.declare_typ <span class="main">(</span>the_list <span class="entity">T</span><span class="main">)</span> <span class="entity">ctxt</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="main">(</span><span class="main">(</span><span class="entity">b</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span><span class="main">,</span> <span class="entity">ctxt'</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>


<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">gen_circus_process</span> <span class="entity">prep_constraint</span> <span class="entity">prep_typ</span>
    <span class="main">(</span><span class="entity">raw_params</span><span class="main">,</span> <span class="entity">binding</span><span class="main">)</span> <span class="entity">raw_alphabet</span> <span class="entity">raw_state</span> <span class="main">(</span><span class="entity">typesyn</span><span class="main">,</span> <span class="entity">raw_channels</span><span class="main">)</span> <span class="entity">namesets</span> <span class="entity">chansets</span>
    <span class="entity">exprs</span> <span class="entity">act</span> <span class="entity">thy</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt</span> <span class="main">=</span> Proof_Context.init_global <span class="entity">thy</span><span class="main">;</span>


    <span class="comment1">(* internalize arguments *)</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">params</span> <span class="main">=</span> map <span class="main">(</span><span class="entity">prep_constraint</span> <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">raw_params</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt0</span> <span class="main">=</span> fold <span class="main">(</span>Variable.declare_typ o TFree<span class="main">)</span> <span class="entity">params</span> <span class="entity">ctxt</span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">alphabet</span><span class="main">,</span> <span class="entity">ctxt1</span><span class="main">)</span> <span class="main">=</span> fold_map <span class="main">(</span><span class="entity">prep_field</span> <span class="entity">prep_typ</span><span class="main">)</span> <span class="entity">raw_alphabet</span> <span class="entity">ctxt0</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">state</span><span class="main">,</span> <span class="entity">ctxt2</span><span class="main">)</span> <span class="main">=</span> fold_map <span class="main">(</span><span class="entity">prep_field</span> <span class="entity">prep_typ</span><span class="main">)</span> <span class="entity">raw_state</span> <span class="entity">ctxt1</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">channels</span><span class="main">,</span> <span class="entity">ctxt3</span><span class="main">)</span> <span class="main">=</span> fold_map <span class="main">(</span><span class="entity">prep_constr</span> <span class="entity">prep_typ</span><span class="main">)</span> <span class="entity">raw_channels</span> <span class="entity">ctxt2</span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">params'</span> <span class="main">=</span> map <span class="main">(</span>Proof_Context.check_tfree <span class="entity">ctxt3</span><span class="main">)</span> <span class="entity">params</span><span class="main">;</span>


    <span class="comment1">(* type definitions *)</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">fields</span> <span class="main">=</span>
      map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">b</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">b</span><span class="main">,</span> <span class="entity">T</span><span class="main">,</span> NoSyn<span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>apsnd <span class="entity">HOLogic.listT</span><span class="main">)</span> <span class="entity">alphabet</span> @ <span class="entity">state</span><span class="main">)</span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thy1</span> <span class="main">=</span> <span class="entity">thy</span>
      |&gt; not <span class="main">(</span>null <span class="entity">fields</span><span class="main">)</span> ?
        <span class="entity">Record.add_record</span> <span class="main">{</span>overloaded <span class="main">=</span> false<span class="main">}</span>
          <span class="main">(</span><span class="entity">params'</span><span class="main">,</span> Binding.suffix_name <span class="inner_quoted">"_alphabet"</span> <span class="entity">binding</span><span class="main">)</span> NONE <span class="entity">fields</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">channel_constrs</span><span class="main">,</span> <span class="entity">thy2</span><span class="main">)</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">if</span></span> not <span class="main">(</span>null <span class="entity">channels</span><span class="main">)</span> <span class="keyword1"><span class="keyword">orelse</span></span> is_some <span class="entity">typesyn</span>
      <span class="keyword2"><span class="keyword">then</span></span> apfst snd <span class="main">(</span><span class="entity">define_channels</span> <span class="main">(</span><span class="entity">params'</span><span class="main">,</span> <span class="entity">binding</span><span class="main">)</span> <span class="entity">typesyn</span> <span class="entity">channels</span> <span class="entity">thy1</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span><span class="main">[</span><span class="main">]</span><span class="main">,</span> <span class="entity">thy1</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thy3</span> <span class="main">=</span> <span class="entity">thy2</span>
      |&gt; not <span class="main">(</span>null <span class="entity">chansets</span><span class="main">)</span> ? fold <span class="main">(</span><span class="entity">define_chanset</span> <span class="entity">binding</span> <span class="entity">channel_constrs</span><span class="main">)</span> <span class="entity">chansets</span>
      |&gt; not <span class="main">(</span>null <span class="entity">namesets</span><span class="main">)</span> ?
        fold <span class="main">(</span><span class="entity">define_nameset</span> <span class="entity">binding</span> <span class="main">(</span><span class="main">(</span>Binding.suffix_name <span class="inner_quoted">"_alphabet"</span> <span class="entity">binding</span><span class="main">)</span><span class="main">,</span> <span class="entity">alphabet</span><span class="main">)</span><span class="main">)</span> <span class="entity">namesets</span>
      |&gt; not <span class="main">(</span>null <span class="entity">exprs</span><span class="main">)</span> ?
        fold <span class="main">(</span><span class="entity">define_expr</span> <span class="entity">binding</span> <span class="main">(</span><span class="main">(</span>Binding.suffix_name <span class="inner_quoted">"_alphabet"</span> <span class="entity">binding</span><span class="main">)</span><span class="main">,</span> <span class="entity">alphabet</span><span class="main">,</span> <span class="entity">state</span><span class="main">)</span>
          <span class="main">(</span>Binding.suffix_name <span class="inner_quoted">"_channels"</span> <span class="entity">binding</span><span class="main">)</span><span class="main">)</span> <span class="entity">exprs</span>
      |&gt; <span class="entity">define_action</span> <span class="entity">binding</span> <span class="main">(</span><span class="entity">binding</span><span class="main">,</span> <span class="entity">act</span><span class="main">)</span>
        <span class="main">(</span>Binding.suffix_name <span class="inner_quoted">"_alphabet"</span> <span class="entity">binding</span><span class="main">)</span> <span class="main">(</span>Binding.suffix_name <span class="inner_quoted">"_channels"</span> <span class="entity">binding</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">thy3</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">circus_process</span> <span class="entity">x</span> <span class="main">=</span> <span class="entity">gen_circus_process</span> <span class="main">(</span>K I<span class="main">)</span> Syntax.check_typ <span class="entity">x</span><span class="main">;</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">circus_process_cmd</span> <span class="entity">x</span> <span class="main">=</span> <span class="entity">gen_circus_process</span> <span class="main">(</span>apsnd o <span class="entity">Typedecl.read_constraint</span><span class="main">)</span> Syntax.read_typ <span class="entity">x</span><span class="main">;</span>


<span class="keyword2"><span class="keyword">local</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">fields</span> <span class="main">=</span>
  <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">[</span>"<span class="antiquote">}</span></span></span> |-- Parse.enum1 <span class="inner_quoted">","</span> <span class="main">(</span>Parse.binding -- <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">::</span>"<span class="antiquote">}</span></span></span> |-- Parse.!!! Parse.typ<span class="main">)</span><span class="main">)</span>
    --| <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span>  "<span class="keyword2">]</span>"<span class="antiquote">}</span></span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">constrs</span> <span class="main">=</span>
  <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span>  "<span class="keyword2">[</span>"<span class="antiquote">}</span></span></span> |-- Parse.enum1 <span class="inner_quoted">","</span> <span class="main">(</span>Parse.binding -- Scan.option Parse.typ<span class="main">)</span> --| <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span>  "<span class="keyword2">]</span>"<span class="antiquote">}</span></span></span><span class="main">)</span> &gt;&gt; pair NONE
  || Parse.typ &gt;&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">b</span> <span class="main">=&gt;</span> <span class="main">(</span>SOME <span class="entity">b</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">names</span> <span class="main">=</span>
  <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">[</span>"<span class="antiquote">}</span></span></span> |-- Parse.enum1 <span class="inner_quoted">","</span> Parse.name --| <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span>  "<span class="keyword2">]</span>"<span class="antiquote">}</span></span></span><span class="main">;</span>

<span class="keyword2"><span class="keyword">in</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span>
  <span class="entity">Outer_Syntax.command</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">command_keyword</span> <span class="keyword1">circus_process</span><span class="antiquote">}</span></span></span> <span class="inner_quoted">"Circus process specification"</span>
    <span class="main">(</span><span class="main">(</span>Parse.type_args_constrained -- Parse.binding --| <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span>  "<span class="keyword2">=</span>"<span class="antiquote">}</span></span></span><span class="main">)</span> --
      Scan.optional <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">alphabet</span>"<span class="antiquote">}</span></span></span> |-- Parse.!!! <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span>  "<span class="keyword2">=</span>"<span class="antiquote">}</span></span></span> |-- <span class="entity">fields</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">]</span> --
      Scan.optional <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">state</span>"<span class="antiquote">}</span></span></span> |-- Parse.!!! <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span>  "<span class="keyword2">=</span>"<span class="antiquote">}</span></span></span> |-- <span class="entity">fields</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">]</span> --
      Scan.optional <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">channel</span>"<span class="antiquote">}</span></span></span> |-- Parse.!!! <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span>  "<span class="keyword2">=</span>"<span class="antiquote">}</span></span></span> |-- <span class="entity">constrs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>NONE<span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span> --
      Scan.repeat <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">nameset</span>"<span class="antiquote">}</span></span></span> |-- Parse.!!! <span class="main">(</span><span class="main">(</span>Parse.binding --| <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">=</span>"<span class="antiquote">}</span></span></span><span class="main">)</span> -- <span class="entity">names</span><span class="main">)</span><span class="main">)</span> --
      Scan.repeat <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">chanset</span>"<span class="antiquote">}</span></span></span> |-- Parse.!!! <span class="main">(</span><span class="main">(</span>Parse.binding --| <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">=</span>"<span class="antiquote">}</span></span></span><span class="main">)</span> -- <span class="entity">names</span><span class="main">)</span><span class="main">)</span> --
      Scan.repeat <span class="main">(</span><span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">schema</span>"<span class="antiquote">}</span></span></span> |-- Parse.!!! <span class="main">(</span><span class="main">(</span>Parse.binding --| <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">=</span>"<span class="antiquote">}</span></span></span><span class="main">)</span> -- <span class="main">(</span>Parse.term &gt;&gt; pair true<span class="main">)</span><span class="main">)</span><span class="main">)</span> ||
                   <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">action</span>"<span class="antiquote">}</span></span></span> |-- Parse.!!! <span class="main">(</span><span class="main">(</span>Parse.binding --| <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">keyword</span> "<span class="keyword2">=</span>"<span class="antiquote">}</span></span></span><span class="main">)</span> -- <span class="main">(</span>Parse.term &gt;&gt; pair false<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> --
      <span class="main">(</span>Parse.where_ |-- Parse.!!! Parse.term<span class="main">)</span>
        &gt;&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="entity">a</span><span class="main">,</span> <span class="entity">b</span><span class="main">)</span><span class="main">,</span> <span class="entity">c</span><span class="main">)</span><span class="main">,</span> <span class="entity">d</span><span class="main">)</span><span class="main">,</span> <span class="entity">e</span><span class="main">)</span><span class="main">,</span> <span class="entity">f</span><span class="main">)</span><span class="main">,</span> <span class="entity">g</span><span class="main">)</span><span class="main">,</span> <span class="entity">h</span><span class="main">)</span> <span class="main">=&gt;</span>
          <span class="entity">Toplevel.theory</span> <span class="main">(</span><span class="entity">circus_process_cmd</span> <span class="entity">a</span> <span class="entity">b</span> <span class="entity">c</span> <span class="entity">d</span> <span class="entity">e</span> <span class="entity">f</span> <span class="entity">g</span> <span class="entity">h</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Refinement">
<div class="head">
<h1>Theory Refinement</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Refinement and Simulation›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Refinement
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Denotational_Semantics.html">Denotational_Semantics</a> <a href="Circus_Syntax.html">Circus_Syntax</a> 
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the following, data (state) simulation and functional backwards simulation
 are defined. The simulation is defined as a function $S$, that corresponds to a state 
 abstraction function.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Simul</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> extend <span class="main">(</span>make <span class="main">(</span>ok <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">(</span>wait <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">(</span>tr <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">(</span>ref <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>more <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
<span class="entity">Simulation</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'θ</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'σ</span><span class="main">)</span> action <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'σ1</span> <span class="main">⇒</span> <span class="tfree">'σ</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'θ</span><span class="main">,</span> <span class="tfree">'σ1</span><span class="main">)</span> action <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">≼</span>_ _"</span><span class="main">)</span> 
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main"><span class="free">≼</span></span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>relation_of <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>Simul <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">a</span><span class="main">,</span> Simul <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">b</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Proofs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In order to simplify refinement proofs, some general refinement laws are 
defined to deal with the refinement of Circus actions at operators level and not at UTP level. 
Using these laws, and exploiting the advantages of a shallow embedding, the automated proof of
refinement becomes surprisingly simple.›</span></span>

<span class="keyword1" id="Refinement-Stop_Sim"><span class="command">lemma</span></span> Stop_Sim<span class="main">:</span> <span class="quoted"><span class="quoted">"Stop <span class="main">≼</span><span class="free">S</span> Stop"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def relation_of_Stop rp_defs design_defs Simul_def alpha_rp.defs 
         <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Refinement-Skip_Sim"><span class="command">lemma</span></span> Skip_Sim<span class="main">:</span> <span class="quoted"><span class="quoted">"Skip <span class="main">≼</span><span class="free">S</span> Skip"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def relation_of_Skip design_def rp_defs Simul_def alpha_rp.defs 
         <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Refinement-Chaos_Sim"><span class="command">lemma</span></span> Chaos_Sim<span class="main">:</span> <span class="quoted"><span class="quoted">"Chaos <span class="main">≼</span><span class="free">S</span> Chaos"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def relation_of_Chaos rp_defs design_defs Simul_def alpha_rp.defs 
         <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Refinement-Ndet_Sim"><span class="command">lemma</span></span> Ndet_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span>  <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P'</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">P'</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⊓</span> <span class="free">Q'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> A B<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def relation_of_Ndet<span class="main">)</span>

<span class="keyword1" id="Refinement-Det_Sim"><span class="command">lemma</span></span> Det_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span>  <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P'</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">P'</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="main">(</span><span class="free">Q</span> <span class="main">□</span> <span class="free">Q'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def relation_of_Det design_def rp_defs Simul_def alpha_rp.defs spec_def
         <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits
         <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def Simul_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span>
               B<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def Simul_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Refinement-Schema_Sim"><span class="command">lemma</span></span> Schema_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>Pre <span class="free">sc1</span><span class="main">)</span> <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>Pre <span class="free">sc2</span><span class="main">)</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span>Pre <span class="free">sc1</span> <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span> <span class="main">;</span> <span class="free">sc2</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">sc1</span> <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">,</span> <span class="free">S</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Schema <span class="free">sc1</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="main">(</span>Schema <span class="free">sc2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def Simul_def relation_of_Schema rp_defs design_defs alpha_rp.defs A B
         <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Refinement-SUb_Sim"><span class="command">lemma</span></span> SUb_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span>Pre <span class="free">sc1</span><span class="main">)</span> <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>Pre <span class="free">sc2</span><span class="main">)</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span>Pre <span class="free">sc1</span> <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span> <span class="main">;</span> <span class="free">sc2</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">sc1</span> <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">,</span> <span class="free">S</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>state_update_before <span class="free">sc1</span> <span class="free">P</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="main">(</span>state_update_before <span class="free">sc2</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def Simul_def relation_of_state_update_before rp_defs design_defs alpha_rp.defs A B
         <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> C<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A B Simul_def alpha_rp.defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> C<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A B Simul_def alpha_rp.defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"ok <span class="improper">aa</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> C<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A B Simul_def alpha_rp.defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> A<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"Pre <span class="free">sc1</span> <span class="main">(</span><span class="free">S</span> <span class="main">(</span>alpha_rp.more <span class="improper">aa</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> C<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A B Simul_def alpha_rp.defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> C<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A B Simul_def alpha_rp.defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-Seq_Sim"><span class="command">lemma</span></span> Seq_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P'</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">P'</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="main">(</span><span class="free">Q</span> <span class="main">`;`</span> <span class="free">Q'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def relation_of_Seq <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span>
                                                    B<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1" id="Refinement-Par_Sim"><span class="command">lemma</span></span> Par_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">P</span>  <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">P'</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q'</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span><span class="free">ns'2</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">ns2</span> <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span><span class="free">S</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">S</span> <span class="main">(</span><span class="free">ns'1</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">ns1</span> <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span><span class="free">S</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">ns1</span> <span class="main">|</span> <span class="free">cs</span> <span class="main">|</span> <span class="free">ns2</span> <span class="main">⟧</span> <span class="free">P'</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⟦</span> <span class="free">ns'1</span> <span class="main">|</span> <span class="free">cs</span> <span class="main">|</span> <span class="free">ns'2</span> <span class="main">⟧</span> <span class="free">Q'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def relation_of_Par fun_eq_iff rp_defs Simul_def design_defs spec_def
                    alpha_rp.defs
              <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def Simul_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> 
                    B<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def Simul_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tr <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simul_def alpha_rp.defs <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def Simul_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tr <span class="improper">bb</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">bb</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simul_def alpha_rp.defs <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> B<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def Simul_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tr <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simul_def alpha_rp.defs <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def Simul_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tr <span class="improper">bb</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">bb</span><span class="main">⦇</span>ok <span class="main">:=</span> False<span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simul_def alpha_rp.defs <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> B<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def Simul_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">s1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">s2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simul_def alpha_rp.defs 
              <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> B<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def Simul_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span>
                     A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def Simul_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span>
              <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_par_def alpha_rp.defs diff_tr_def fun_eq_iff ParMerge_def Simul_def
            <span class="quasi_keyword">split</span> <span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>ok <span class="main">=</span> ok <span class="improper">bb</span><span class="main">,</span> wait <span class="main">=</span> wait <span class="improper">bb</span><span class="main">,</span> tr <span class="main">=</span> tr <span class="improper">bb</span><span class="main">,</span> ref <span class="main">=</span> ref <span class="improper">bb</span><span class="main">,</span> 
              <span class="main">…</span> <span class="main">=</span> <span class="free">S</span> <span class="main">(</span>alpha_rp.more <span class="improper">bb</span><span class="main">)</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> D<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>alpha_rp.more <span class="free"><span class="free">s1</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>alpha_rp.more <span class="free"><span class="free">aa</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>alpha_rp.more <span class="free"><span class="free">s2</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>alpha_rp.more <span class="free"><span class="free">bb</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>ok <span class="main">=</span> ok <span class="improper">bb</span><span class="main">,</span> wait <span class="main">=</span> wait <span class="improper">bb</span><span class="main">,</span> tr <span class="main">=</span> tr <span class="improper">bb</span><span class="main">,</span> ref <span class="main">=</span> ref <span class="improper">bb</span><span class="main">,</span> 
              <span class="main">…</span> <span class="main">=</span> <span class="free">S</span> <span class="main">(</span>alpha_rp.more <span class="improper">bb</span><span class="main">)</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> D<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>alpha_rp.more <span class="free"><span class="free">s1</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>alpha_rp.more <span class="free"><span class="free">aa</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> C<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> a<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>alpha_rp.more <span class="free"><span class="free">s2</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>alpha_rp.more <span class="free"><span class="free">bb</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-Assign_Sim"><span class="command">lemma</span></span> Assign_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">A</span><span class="main">.</span> <span class="free">vy</span> <span class="bound">A</span> <span class="main">=</span> <span class="free">vx</span> <span class="main">(</span><span class="free">S</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">ff</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">y_update</span> <span class="bound">ff</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x_update</span> <span class="bound">ff</span> <span class="main">(</span><span class="free">S</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>x <span class="main">`:=`</span> <span class="free">vx</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="main">(</span>y <span class="main">`:=`</span> <span class="free">vy</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def relation_of_Assign update_def rp_defs design_defs Simul_def A B
                   alpha_rp.defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Refinement-Var_Sim"><span class="command">lemma</span></span> Var_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">ff</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="main">(</span>snd <span class="free">b</span><span class="main">)</span> <span class="bound">ff</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free">a</span><span class="main">)</span> <span class="bound">ff</span> <span class="main">(</span><span class="free">S</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Var <span class="free">a</span> <span class="free">P</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="main">(</span>Var <span class="free">b</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def relation_of_Var rp_defs design_defs fun_eq_iff Simul_def B
                    alpha_rp.defs increase_def decrease_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ab</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B alpha_rp.defs Simul_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_rp_eqE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">bb</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B alpha_rp.defs Simul_def 
              <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> alpha_rp_eqE <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Simulation_def Simul_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alpha_rp.defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alpha_rp.defs true_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> alpha_rp.defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-Guard_Sim"><span class="command">lemma</span></span> Guard_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">A</span><span class="main">.</span> <span class="free">h</span> <span class="bound">A</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">S</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">`&amp;`</span> <span class="free">P</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="main">(</span><span class="free">h</span> <span class="main">`&amp;`</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">(</span>alpha_rp.more <span class="improper">a</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="free">S</span> <span class="main">(</span>alpha_rp.more <span class="improper">a</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> true_Guard1 false_Guard1 Simul_def alpha_rp.defs Simulation_def B
            <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> Stop_Sim<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-Write0_Sim"><span class="command">lemma</span></span> Write0_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">→</span> <span class="free">P</span> <span class="main">≼</span><span class="free">S</span> <span class="free">a</span> <span class="main">→</span> <span class="free">Q</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span>   A
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def write0_def relation_of_Prefix0 design_defs rp_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simul_def alpha_rp.defs do_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-Read_Sim"><span class="command">lemma</span></span> Read_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">P</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">(</span><span class="free">S</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"a<span class="main">`?`</span><span class="free"><span class="free">c</span></span> <span class="main">→</span> <span class="free">P</span> <span class="main">≼</span><span class="free">S</span> a<span class="main">`?`</span><span class="free"><span class="free">d</span></span> <span class="main">→</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> A
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def read_def relation_of_iPrefix design_defs rp_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ca</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simul_def alpha_rp.defs do_I_def select_def B<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-Read1_Sim"><span class="command">lemma</span></span> Read1_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">P</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">(</span><span class="free">S</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"a<span class="main">`?`</span><span class="free"><span class="free">c</span></span><span class="main">`:`</span><span class="free">s</span> <span class="main">→</span> <span class="free">P</span> <span class="main">≼</span><span class="free">S</span> a<span class="main">`?`</span><span class="free"><span class="free">d</span></span><span class="main">`:`</span><span class="free">s</span> <span class="main">→</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> A
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def read1_def relation_of_iPrefix design_defs rp_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ca</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simul_def alpha_rp.defs do_I_def select_def B<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-Read1S_Sim"><span class="command">lemma</span></span> Read1S_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">P</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">(</span><span class="free">S</span> <span class="bound">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="free">s'</span> <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">(</span><span class="free">S</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"a<span class="main">`?`</span><span class="free"><span class="free">c</span></span><span class="main">`∈`</span><span class="free">s</span> <span class="main">→</span> <span class="free">P</span> <span class="main">≼</span><span class="free">S</span> a<span class="main">`?`</span><span class="free"><span class="free">d</span></span><span class="main">`∈`</span><span class="free">s'</span> <span class="main">→</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> A
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def read1_def relation_of_iPrefix design_defs rp_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ca</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simul_def alpha_rp.defs do_I_def select_def B C<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-Write_Sim"><span class="command">lemma</span></span> Write_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span> <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">(</span><span class="free">S</span> <span class="bound">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"a<span class="main">`!`</span><span class="free">c</span> <span class="main">→</span> <span class="free">P</span> <span class="main">≼</span><span class="free">S</span> a<span class="main">`!`</span><span class="free">d</span> <span class="main">→</span> <span class="free">Q</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> A
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def write1_def relation_of_oPrefix design_defs rp_defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ca</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simul_def alpha_rp.defs do_def select_def B<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-Hide_Sim"><span class="command">lemma</span></span> Hide_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">P</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">cs</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="main">(</span><span class="free">Q</span> \<span class="main">\</span> <span class="free">cs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def relation_of_Hide design_defs rp_defs Simul_def alpha_rp.defs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Simul <span class="free">S</span> <span class="improper">ba</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> comp_intro<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">split</span> cond_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simul_def alpha_rp.defs Simulation_def 
              <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> Skip_Sim<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> diff_tr_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-lfp_Siml"><span class="command">lemma</span></span> lfp_Siml<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">X</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">X</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lfp <span class="free">P</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> lfp_ordinal_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B A<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Simulation_def Sup_action relation_of_bot relation_of_Sup<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> CSP_is_rd<span class="main"><span class="main">[</span></span><span class="operator">OF</span> relation_of_CSP<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs fun_eq_iff Simul_def alpha_rp.defs decrease_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-Mu_Sim"><span class="command">lemma</span></span> Mu_Sim<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">X</span> <span class="main">≼</span><span class="free">S</span> <span class="bound">Y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="bound">X</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">Y</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lfp <span class="free">P</span><span class="main">)</span> <span class="main">≼</span><span class="free">S</span> <span class="main">(</span>lfp <span class="free">Q</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> lfp_Siml<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> A<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> lfp_unfold<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B C<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-bot_Sim"><span class="command">lemma</span></span> bot_Sim<span class="main">:</span> <span class="quoted"><span class="quoted">"bot <span class="main">≼</span><span class="free">S</span> bot"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Simulation_def rp_defs Simul_def relation_of_bot alpha_rp.defs <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>

<span class="keyword1" id="Refinement-sim_is_ref"><span class="command">lemma</span></span> sim_is_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">=</span> <span class="free">P</span> <span class="main">≼</span><span class="main">(</span>id<span class="main">)</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ref_def Simulation_def Simul_def alpha_rp.defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>ok <span class="main">=</span> ok <span class="improper">a</span><span class="main">,</span> wait <span class="main">=</span> wait <span class="improper">a</span><span class="main">,</span> tr <span class="main">=</span> tr <span class="improper">a</span><span class="main">,</span> ref <span class="main">=</span> ref <span class="improper">a</span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> alpha_rp.more <span class="improper">a</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>ok <span class="main">=</span> ok <span class="improper">b</span><span class="main">,</span> wait <span class="main">=</span> wait <span class="improper">b</span><span class="main">,</span> tr <span class="main">=</span> tr <span class="improper">b</span><span class="main">,</span> ref <span class="main">=</span> ref <span class="improper">b</span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> alpha_rp.more <span class="improper">b</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>ok <span class="main">=</span> ok <span class="improper">a</span><span class="main">,</span> wait <span class="main">=</span> wait <span class="improper">a</span><span class="main">,</span> tr <span class="main">=</span> tr <span class="improper">a</span><span class="main">,</span> ref <span class="main">=</span> ref <span class="improper">a</span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> alpha_rp.more <span class="improper">a</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span>ok <span class="main">=</span> ok <span class="improper">b</span><span class="main">,</span> wait <span class="main">=</span> wait <span class="improper">b</span><span class="main">,</span> tr <span class="main">=</span> tr <span class="improper">b</span><span class="main">,</span> ref <span class="main">=</span> ref <span class="improper">b</span><span class="main">,</span> <span class="main">…</span> <span class="main">=</span> alpha_rp.more <span class="improper">b</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-ref_eq"><span class="command">lemma</span></span> ref_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>ev_eq<span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> action<span class="main">)</span> <span class="main">=</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">&amp;</span> <span class="free">Q</span> <span class="main">⊑</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ref_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ref_def fun_eq_iff relation_of_inject<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement-rd_ref"><span class="command">lemma</span></span> rd_ref<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"R <span class="main">(</span><span class="free">P</span> <span class="main">⊢</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"R <span class="main">(</span><span class="free">P'</span> <span class="main">⊢</span> <span class="free">Q'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P'</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q'</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>action_of <span class="main">(</span>R <span class="main">(</span><span class="free">P</span> <span class="main">⊢</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span>action_of <span class="main">(</span>R <span class="main">(</span><span class="free">P'</span> <span class="main">⊢</span> <span class="free">Q'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ref_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> action_of_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> action_of_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rp_defs design_defs C D <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> cond_splits<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="Refinement-rd_impl"><span class="command">lemma</span></span> rd_impl<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"R <span class="main">(</span><span class="free">P</span> <span class="main">⊢</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"R <span class="main">(</span><span class="free">P'</span> <span class="main">⊢</span> <span class="free">Q'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> is_CSP_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P'</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> D<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">Q'</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"R <span class="main">(</span><span class="free">P'</span> <span class="main">⊢</span> <span class="free">Q'</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟶</span> R <span class="main">(</span><span class="free">P</span> <span class="main">⊢</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>ev_eq<span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> alpha_rp_scheme<span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> rd_ref<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P'</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q'</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> A B C D<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ref_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> action_of_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> action_of_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Refinement_Example">
<div class="head">
<h1>Theory Refinement_Example</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Concrete example›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Refinement_Example
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Refinement.html">Refinement</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section, we present a concrete example ofthe use of our environment.
We define two Circus processes FIG and DFIG, using our syntax. we give the proof of refinement 
(simulation) of the first processby the second one using the simulation function $Sim$.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Process definitions›</span></span>

<span class="keyword1"><span class="command">circus_process</span></span> <span class="entity"><span class="entity"><span class="entity"><span class="entity">FIG</span></span></span></span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">alphabet</span></span> <span class="main">=</span> <span class="main">[</span>v<span class="main">::</span><span class="quoted">nat</span><span class="main">,</span> x<span class="main">::</span><span class="quoted">nat</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">state</span></span> <span class="main">=</span> <span class="main">[</span>idS<span class="main">::</span><span class="quoted"><span class="quoted">"nat set"</span></span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">channel</span></span> <span class="main">=</span> <span class="main">[</span>out <span class="quoted">nat</span> <span class="main">,</span> req <span class="main">,</span> ret <span class="quoted">nat</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">schema</span></span> Init <span class="main">=</span> <span class="quoted"><span class="quoted">"idS' <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">schema</span></span> Out <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> v' <span class="main">=</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∉</span> idS <span class="main">∧</span> idS' <span class="main">=</span> idS <span class="main">∪</span> <span class="main">{</span>v'<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">schema</span></span> Remove <span class="main">=</span> <span class="quoted"><span class="quoted">"x <span class="main">∈</span> idS <span class="main">∧</span> idS' <span class="main">=</span> idS <span class="main">-</span> <span class="main">{</span>x<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">var</span> v <span class="main">∙</span> <span class="main">(</span>Schema FIG.Init<span class="main">`;`</span>
         <span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>req <span class="main">→</span> <span class="main">(</span>Schema FIG.Out<span class="main">)</span><span class="main">)</span><span class="main">`;`</span> out<span class="main">`!`</span><span class="main">(</span>hd <span class="keyword1">o</span> v<span class="main">)</span> <span class="main">→</span> Skip<span class="main">)</span><span class="main">)</span>
               <span class="main">□</span> <span class="main">(</span>ret<span class="main">`?`</span>x <span class="main">→</span> <span class="main">(</span>Schema FIG.Remove<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">`;`</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">circus_process</span></span> <span class="entity"><span class="entity"><span class="entity"><span class="entity">DFIG</span></span></span></span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">alphabet</span></span> <span class="main">=</span> <span class="main">[</span>v<span class="main">::</span><span class="quoted">nat</span><span class="main">,</span> x<span class="main">::</span><span class="quoted">nat</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">state</span></span> <span class="main">=</span> <span class="main">[</span>retidS<span class="main">::</span><span class="quoted"><span class="quoted">"nat set"</span></span><span class="main">,</span> max<span class="main">::</span><span class="quoted">nat</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">channel</span></span> <span class="main">=</span> <span class="quoted">FIG_channels</span>
  <span class="keyword2"><span class="keyword">schema</span></span> Init <span class="main">=</span> <span class="quoted"><span class="quoted">"retidS' <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> max' <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">schema</span></span> Out <span class="main">=</span> <span class="quoted"><span class="quoted">"v' <span class="main">=</span> max <span class="main">∧</span> max' <span class="main">=</span> <span class="main">(</span>max <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> retidS' <span class="main">=</span> retidS <span class="main">-</span> <span class="main">{</span>v'<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">schema</span></span> Remove <span class="main">=</span> <span class="quoted"><span class="quoted">"x <span class="main">&lt;</span> max <span class="main">∧</span> retidS' <span class="main">=</span> retidS <span class="main">∪</span> <span class="main">{</span>x<span class="main">}</span> <span class="main">∧</span> max' <span class="main">=</span> max"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">var</span> v <span class="main">∙</span> <span class="main">(</span>Schema DFIG.Init<span class="main">`;`</span>
         <span class="keyword1">μ</span> <span class="bound">X</span> <span class="main">∙</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>req <span class="main">→</span> <span class="main">(</span>Schema DFIG.Out<span class="main">)</span><span class="main">)</span><span class="main">`;`</span> <span class="main">(</span>out<span class="main">`!`</span><span class="main">(</span>hd <span class="keyword1">o</span> v<span class="main">)</span> <span class="main">→</span> Skip<span class="main">)</span><span class="main">)</span>
               <span class="main">□</span> <span class="main">(</span>ret<span class="main">`?`</span>x <span class="main">→</span> <span class="main">(</span>Schema DFIG.Remove<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">`;`</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Sim</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Sim</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> FIG_alphabet.make <span class="main">(</span>DFIG_alphabet.v <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>DFIG_alphabet.x <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>
   <span class="main">(</span><span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="main">(</span>DFIG_alphabet.max <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∉</span> <span class="main">(</span>DFIG_alphabet.retidS <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Simulation proofs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For the simulation proof, we give first proofs for simulation over the schema expressions.
The proof is then given over the main actions of the processes.›</span></span>

<span class="keyword1" id="Refinement_Example-SimInit"><span class="command">lemma</span></span> SimInit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Schema FIG.Init<span class="main">)</span> <span class="main">≼</span>Sim <span class="main">(</span>Schema DFIG.Init<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Sim_def Pre_def design_defs DFIG.Init_def FIG.Init_def rp_defs  alpha_rp.defs
                    DFIG_alphabet.defs FIG_alphabet.defs <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Schema_Sim<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⦇</span>max <span class="main">:=</span> <span class="main">0</span><span class="main">,</span> retidS <span class="main">:=</span> <span class="main">{}</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement_Example-SimOut"><span class="command">lemma</span></span> SimOut<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Schema FIG.Out<span class="main">)</span> <span class="main">≼</span>Sim <span class="main">(</span>Schema DFIG.Out<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Schema_Sim<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Pre_def DFIG_alphabet.defs FIG_alphabet.defs
                     alpha_rp.defs Sim_def FIG.Out_def DFIG.Out_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">⦇</span>v <span class="main">:=</span> <span class="main">[</span>DFIG_alphabet.max <span class="improper">a</span><span class="main">]</span><span class="main">,</span> max <span class="main">:=</span> <span class="main">(</span>Suc <span class="main">(</span>DFIG_alphabet.max <span class="improper">a</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                     retidS <span class="main">:=</span> retidS <span class="improper">a</span> <span class="main">-</span> <span class="main">{</span>DFIG_alphabet.max <span class="improper">a</span><span class="main">}</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">⦇</span>v <span class="main">:=</span> <span class="main">[</span>DFIG_alphabet.max <span class="improper">a</span><span class="main">]</span><span class="main">,</span> max <span class="main">:=</span> <span class="main">(</span>Suc <span class="main">(</span>DFIG_alphabet.max <span class="improper">a</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> 
                     retidS <span class="main">:=</span> retidS <span class="improper">a</span> <span class="main">-</span> <span class="main">{</span>DFIG_alphabet.max <span class="improper">a</span><span class="main">}</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Refinement_Example-SimRemove"><span class="command">lemma</span></span> SimRemove<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Schema FIG.Remove<span class="main">)</span> <span class="main">≼</span>Sim <span class="main">(</span>Schema DFIG.Remove<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Schema_Sim<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Pre_def DFIG_alphabet.defs FIG_alphabet.defs alpha_rp.defs Sim_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DFIG.Remove_def FIG.Remove_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">⦇</span>retidS <span class="main">:=</span> insert <span class="main">(</span>hd <span class="main">(</span>DFIG_alphabet.x <span class="improper">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>retidS <span class="improper">a</span><span class="main">)</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DFIG.Remove_def FIG.Remove_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"FIG.FIG <span class="main">≼</span>Sim DFIG.DFIG"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DFIG.DFIG_def FIG.FIG_def mono_Seq SimRemove SimOut SimInit Sim_def FIG_alphabet.defs
         <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>Var_Sim Seq_Sim Mu_Sim Det_Sim Write0_Sim Write_Sim Read_Sim Skip_Sim<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>