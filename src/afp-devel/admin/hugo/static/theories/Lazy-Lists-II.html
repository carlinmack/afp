<div id="LList2">
<div class="head">
<h1>Theory LList2</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      LList2.thy
    Author:     Stefan Friedrich
    Maintainer: Stefan Friedrich
    License:    LGPL

Llists over an alphabet.
Common operations on LLists (ltake, ldrop, lnth).
The prefix order of llists.
Safety and liveness.
*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹More on llists›</span></span>

<span class="keyword1"><span class="command">theory</span></span> LList2
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Coinductive/Coinductive_List.html">Coinductive.Coinductive_List</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  LCons  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">##</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  lappend  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">@@</span>"</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="keyword1">case</span> <span class="free">p</span> <span class="keyword1">of</span> <span class="keyword1">XCONST</span> LNil <span class="main">⇒</span> <span class="free">a</span> <span class="main">|</span> <span class="free">x</span> <span class="main">##</span> <span class="free">l</span> <span class="main">⇒</span> <span class="free">b</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> case_llist <span class="free">a</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span> <span class="free">l</span><span class="main">.</span> <span class="free">b</span><span class="main">)</span> <span class="free">p</span>"</span>
  <span class="quoted">"<span class="keyword1">case</span> <span class="free">p</span> <span class="keyword1">of</span> <span class="keyword1">XCONST</span> LNil <span class="main">::</span> <span class="tfree"><span class="free">'a</span></span> <span class="main">⇒</span> <span class="free">a</span> <span class="main">|</span> <span class="free">x</span> <span class="main">##</span> <span class="free">l</span> <span class="main">⇒</span> <span class="free">b</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="keyword1">CONST</span> case_llist <span class="free">a</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span> <span class="free">l</span><span class="main">.</span> <span class="free">b</span><span class="main">)</span> <span class="free">p</span>"</span>


<span class="keyword1"><span class="command">lemmas</span></span> llistE <span class="main">=</span> llist.exhaust

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Finite and infinite llists over an alphabet›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span>
  <span class="entity">finlsts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  LNil_fin <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"LNil <span class="main">∈</span>  <span class="free">A</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span>"</span></span>
<span class="main">|</span> LCons_fin <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">##</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>⋆</sup></span></span>"</span></span>

<span class="keyword1"><span class="command">coinductive_set</span></span>
  <span class="entity">alllsts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>∞</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  LNil_all <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"LNil <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∞</sup></span></span>"</span></span>
<span class="main">|</span> LCons_all <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∞</sup></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">##</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>∞</sup></span></span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> alllsts.cases <span class="main">[</span><span class="operator">case_names</span> LNil LCons<span class="main">,</span> <span class="operator">cases</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> alllsts<span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inflsts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist set"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="free"><span class="hidden">⇧</span><sup>ω</sup></span></span> <span class="main">≡</span>  <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">-</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fpslsts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist set"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>♣</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>♣</sup></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">-</span> <span class="main">{</span>LNil<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poslsts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist set"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>♠</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>♠</sup></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">-</span> <span class="main">{</span>LNil<span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Facts about all llists›</span></span>

<span class="keyword1" id="LList2-alllsts_UNIV"><span class="command">lemma</span></span> alllsts_UNIV <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">coinduct</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>alllsts <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-alllsts_empty"><span class="command">lemma</span></span> alllsts_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="main">{</span>LNil<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> alllsts.cases<span class="main">)</span>

<span class="keyword1" id="LList2-alllsts_mono"><span class="command">lemma</span></span> alllsts_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> asubb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">⊆</span> <span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">coinduct</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>alllsts <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> asubb <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> alllstsp_mono <span class="main">[</span><span class="operator">mono</span><span class="main">]</span> <span class="main">=</span> alllsts_mono <span class="main">[</span><span class="operator">to_pred</span> pred_subset_eq<span class="main">]</span>

<span class="keyword1" id="LList2-LConsE"><span class="command">lemma</span></span> LConsE <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">##</span><span class="free">xs</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> alllsts.cases<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Facts about non-empty (positive) llists›</span></span>

<span class="keyword1" id="LList2-poslsts_iff"><span class="command">lemma</span></span> poslsts_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>♠</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">∧</span> <span class="free">s</span> <span class="main">≠</span> LNil<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poslsts_def<span class="main">)</span>

<span class="keyword1" id="LList2-poslsts_UNIV"><span class="command">lemma</span></span> poslsts_UNIV <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>♠</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">≠</span> LNil<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-poslsts_empty"><span class="command">lemma</span></span> poslsts_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span><span class="main"><span class="hidden">⇧</span><sup>♠</sup></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-poslsts_mono"><span class="command">lemma</span></span> poslsts_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>♠</sup></span> <span class="main">⊆</span> <span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>♠</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> alllsts_mono<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Facts about finite llists›</span></span>

<span class="keyword1" id="LList2-finlsts_empty"><span class="command">lemma</span></span> finlsts_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">{</span>LNil<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> finlsts.cases<span class="main">)</span>

<span class="keyword1" id="LList2-finsubsetall"><span class="command">lemma</span></span> finsubsetall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finlsts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-finlsts_mono"><span class="command">lemma</span></span> finlsts_mono<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊆</span> <span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> finlsts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> finlstsp_mono <span class="main">[</span><span class="operator">mono</span><span class="main">]</span> <span class="main">=</span> finlsts_mono <span class="main">[</span><span class="operator">to_pred</span> pred_subset_eq<span class="main">]</span>

<span class="keyword1" id="LList2-finlsts_induct"><span class="command">lemma</span></span> finlsts_induct
  <span class="main">[</span><span class="operator">case_names</span> LNil_fin LCons_fin<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">set</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> finlsts<span class="main">,</span> <span class="operator">consumes</span> 1<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> lnil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">=</span> LNil <span class="main">⟹</span> <span class="free">P</span> <span class="bound">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> lcons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">l</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">l</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span> <span class="free">P</span> <span class="bound">l</span><span class="main">;</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span> <span class="main">##</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> xA <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> lnil lcons<span class="main">)</span>

<span class="keyword1" id="LList2-finite_lemma"><span class="command">lemma</span></span> finite_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> LCons_fin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">##</span><span class="skolem">l</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-fin_finite"><span class="command">lemma</span></span> fin_finite <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∉</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊆</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finlsts_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-finT_simp"><span class="command">lemma</span></span> finT_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="free">r</span><span class="main">∈</span>UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹A recursion operator for finite llists›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">finlsts_pred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> llist <span class="main">×</span> <span class="tfree">'a</span> llist<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">finlsts_pred</span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">##</span><span class="bound">r</span> <span class="main">=</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">finlsts_rec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'b</span><span class="main">,</span> <span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span> llist<span class="main">,</span> <span class="tfree">'b</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> llist <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finlsts_rec</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>
  <span class="keyword1">then</span> <span class="main">(</span>wfrec finlsts_pred <span class="main">(</span><span class="main">%</span><span class="bound">f</span><span class="main">.</span> case_llist <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span><span class="main">%</span><span class="bound">a</span> <span class="bound">r</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="bound">a</span> <span class="bound">r</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>
  <span class="keyword1">else</span> undefined"</span></span>

<span class="keyword1" id="LList2-finlsts_predI"><span class="command">lemma</span></span> finlsts_predI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">a</span><span class="main">##</span><span class="free">r</span><span class="main">)</span> <span class="main">∈</span> finlsts_pred"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finlsts_pred_def<span class="main">)</span>

<span class="keyword1" id="LList2-wf_finlsts_pred"><span class="command">lemma</span></span> wf_finlsts_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"wf finlsts_pred"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wfI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"UNIV<span class="main"><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finlsts_pred <span class="main">⊆</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">×</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finlsts_pred_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> finlsts.cases<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist <span class="main">⇒</span> bool"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> xfin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> H <span class="main">[</span><span class="operator">unfolded</span> finlsts_pred_def<span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> finlsts_pred <span class="main">⟶</span> <span class="skolem">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span>  xfin <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword1"><span class="command">with</span></span> H <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1"><span class="command">with</span></span> H <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-finlsts_rec_LNil"><span class="command">lemma</span></span> finlsts_rec_LNil<span class="main">:</span> <span class="quoted"><span class="quoted">"finlsts_rec <span class="free">c</span> <span class="free">d</span> LNil <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wf_finlsts_pred finlsts_rec_def wfrec<span class="main">)</span>

<span class="keyword1" id="LList2-finlsts_rec_LCons"><span class="command">lemma</span></span> finlsts_rec_LCons<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> finlsts_rec <span class="free">c</span> <span class="free">d</span> <span class="main">(</span><span class="free">a</span> <span class="main">##</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="free">a</span> <span class="free">r</span> <span class="main">(</span>finlsts_rec <span class="free">c</span> <span class="free">d</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wf_finlsts_pred finlsts_rec_def wfrec cut_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finlsts_predI<span class="main">)</span>

<span class="keyword1" id="LList2-finlsts_rec_LNil_def"><span class="command">lemma</span></span> finlsts_rec_LNil_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≡</span> finlsts_rec <span class="free">c</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">f</span> LNil <span class="main">=</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finlsts_rec_LNil<span class="main">)</span>

<span class="keyword1" id="LList2-finlsts_rec_LCons_def"><span class="command">lemma</span></span> finlsts_rec_LCons_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">f</span> <span class="main">≡</span> finlsts_rec <span class="free">c</span> <span class="free">d</span><span class="main">;</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">a</span> <span class="main">##</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span> <span class="free">a</span> <span class="free">r</span> <span class="main">(</span><span class="free">f</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finlsts_rec_LCons<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Facts about non-empty (positive) finite llists›</span></span>

<span class="keyword1" id="LList2-fpslsts_iff"><span class="command">lemma</span></span> fpslsts_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>♣</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∧</span> <span class="free">s</span> <span class="main">≠</span> LNil<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fpslsts_def<span class="main">)</span>

<span class="keyword1" id="LList2-fpslsts_empty"><span class="command">lemma</span></span> fpslsts_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span><span class="main"><span class="hidden">⇧</span><sup>♣</sup></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-fpslsts_mono"><span class="command">lemma</span></span> fpslsts_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>♣</sup></span> <span class="main">⊆</span> <span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>♣</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finlsts_mono<span class="main">)</span>

<span class="keyword1" id="LList2-fpslsts_cases"><span class="command">lemma</span></span> fpslsts_cases <span class="main">[</span><span class="operator">case_names</span> LCons<span class="main">,</span> <span class="operator">cases</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">set</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> fpslsts<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> rfps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>♣</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">rs</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">r</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">##</span> <span class="bound">rs</span><span class="main">;</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="bound">rs</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> rfps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> LNil"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> H<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Facts about infinite llists›</span></span>

<span class="keyword1" id="LList2-inflstsI"><span class="command">lemma</span></span> inflstsI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> False <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> inflsts_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

<span class="keyword1" id="LList2-inflstsE"><span class="command">lemma</span></span> inflstsE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">;</span> <span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">;</span> <span class="free">x</span> <span class="main">∉</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> inflsts_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-inflsts_empty"><span class="command">lemma</span></span> inflsts_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-infsubsetall"><span class="command">lemma</span></span> infsubsetall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_lemma finsubsetall<span class="main">)</span>

<span class="keyword1" id="LList2-inflsts_mono"><span class="command">lemma</span></span> inflsts_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⊆</span> <span class="free">B</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> alllsts_mono infsubsetall<span class="main">)</span>

<span class="keyword1" id="LList2-inflsts_cases"><span class="command">lemma</span></span> inflsts_cases <span class="main">[</span><span class="operator">case_names</span> LCons<span class="main">,</span> <span class="operator">cases</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">set</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> inflsts<span class="main">,</span> <span class="operator">consumes</span> 1<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sinf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">l</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">l</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">;</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">s</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">##</span> <span class="bound">l</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> sinf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∉</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">##</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">s</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> R<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-inflstsI2"><span class="command">lemma</span></span> inflstsI2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">##</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> finlsts.cases<span class="main">)</span>

<span class="keyword1" id="LList2-infT_simp"><span class="command">lemma</span></span> infT_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟹</span> <span class="free">r</span><span class="main">∈</span>UNIV<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-alllstsE"><span class="command">lemma</span></span>  alllstsE <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> finite infinite<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span><span class="main">∈</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="free">P</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_lemma <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inflsts_def<span class="main">)</span>


<span class="keyword1" id="LList2-fin_inf_cases"><span class="command">lemma</span></span> fin_inf_cases <span class="main">[</span><span class="operator">case_names</span> finite infinite<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">r</span><span class="main">∈</span>UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="free">P</span><span class="main">;</span> <span class="free">r</span> <span class="main">∈</span> UNIV<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-fin_Int_inf"><span class="command">lemma</span></span>  fin_Int_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∩</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   fin_Un_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∪</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">=</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_lemma finsubsetall<span class="main">)</span>

<span class="keyword1" id="LList2-notfin_inf"><span class="command">lemma</span></span> notfin_inf <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∉</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> UNIV<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-notinf_fin"><span class="command">lemma</span></span> notinf_fin <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∉</span> UNIV<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Lappend›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Simplification›</span></span>

<span class="keyword1" id="LList2-lapp_inf"><span class="command">lemma</span></span> lapp_inf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">@@</span> <span class="free">t</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inflsts_cases<span class="main">)</span>

<span class="keyword1" id="LList2-LNil_is_lappend_conv"><span class="command">lemma</span></span> LNil_is_lappend_conv <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span>LNil <span class="main">=</span> <span class="free">s</span> <span class="main">@@</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">=</span> LNil <span class="main">∧</span> <span class="free">t</span> <span class="main">=</span> LNil<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">s</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-lappend_is_LNil_conv"><span class="command">lemma</span></span> lappend_is_LNil_conv <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">@@</span> <span class="free">t</span> <span class="main">=</span> LNil<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">=</span> LNil <span class="main">∧</span> <span class="free">t</span> <span class="main">=</span> LNil<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">s</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-same_lappend_eq"><span class="command">lemma</span></span> same_lappend_eq <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">r</span> <span class="main">@@</span> <span class="free">s</span> <span class="main">=</span> <span class="free">r</span> <span class="main">@@</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">=</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> finlsts.induct<span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Typing rules›</span></span>

<span class="keyword1" id="LList2-lappT"><span class="command">lemma</span></span> lappT<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> sllist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> tllist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">@@</span><span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lappend <span class="free">s</span> <span class="free">t</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">u</span><span class="main">∈</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="main">⋃</span><span class="bound">v</span><span class="main">∈</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="main">{</span>lappend <span class="bound">u</span> <span class="bound">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">coinduct</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>alllsts <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> ullist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">∈</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vllist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> zapp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span><span class="skolem">u</span> <span class="main">@@</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> alllsts.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-lappfin_finT"><span class="command">lemma</span></span> lappfin_finT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span><span class="main">@@</span><span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finlsts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-lapp_fin_fin_lemma"><span class="command">lemma</span></span> lapp_fin_fin_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rsA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">@@</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> rsA
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="skolem">l</span><span class="main"><span class="main">≡</span></span><span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">@@</span><span class="free">s</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">a</span> <span class="skolem">l'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> LNil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">##</span><span class="skolem">l'</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">@@</span> <span class="free">s</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@@</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> LCons_fin LCons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-lapp_fin_fin_iff"><span class="command">lemma</span></span> lapp_fin_fin_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">@@</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∧</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> lappfin_finT lapp_fin_fin_lemma<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> rsA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">@@</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lapp_fin_fin_lemma<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">@@</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟶</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">r</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> finlsts.cases<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> rsA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-lapp_all_invT"><span class="command">lemma</span></span> lapp_all_invT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">@@</span><span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> rs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">r</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-lapp_fin_infT"><span class="command">lemma</span></span> lapp_fin_infT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">@@</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finlsts.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inflstsI2<span class="main">)</span>

<span class="keyword1" id="LList2-app_invT"><span class="command">lemma</span></span> app_invT<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">@@</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span> <span class="main">##</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">@@</span> <span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">##</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">@@</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">@@</span> <span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inflsts_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> LCons_fin <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-lapp_inv2T"><span class="command">lemma</span></span> lapp_inv2T<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rsinf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">@@</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∧</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">∨</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjCI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> rnotinf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∉</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> rsinf <span class="keyword1"><span class="command">have</span></span> rsall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">@@</span><span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lapp_all_invT<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rnotinf <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> alllstsE<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∧</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rsinf
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span>  <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> app_invT<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-lapp_infT"><span class="command">lemma</span></span> lapp_infT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">@@</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∧</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">∨</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lapp_inv2T <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> lapp_fin_infT<span class="main">)</span>

<span class="keyword1" id="LList2-lapp_allT_iff"><span class="command">lemma</span></span> lapp_allT_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">@@</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∧</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">∨</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> alllstsE<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lapp_infT <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finsubsetall<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finsubsetall <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> lappT<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Length, indexing, prefixes, and suffixes of llists›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">ll2f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> option"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">!!</span>"</span> 100<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main"><span class="free">!!</span></span><span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">of</span> LNil <span class="main">⇒</span> None <span class="main">|</span> <span class="bound">x</span> <span class="main">##</span> <span class="bound">xs</span> <span class="main">⇒</span> Some <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main"><span class="free">!!</span></span><span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">of</span> LNil <span class="main">⇒</span> None <span class="main">|</span> <span class="bound">x</span> <span class="main">##</span> <span class="bound">xs</span> <span class="main">⇒</span> <span class="bound">xs</span><span class="main"><span class="free">!!</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">ltake</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> llist"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↓</span>"</span> 110<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="main">0</span>     <span class="main">=</span> LNil"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main"><span class="free">↓</span></span> Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">of</span> LNil <span class="main">⇒</span> LNil <span class="main">|</span> <span class="bound">x</span> <span class="main">##</span> <span class="bound">xs</span> <span class="main">⇒</span> <span class="bound">x</span> <span class="main">##</span> <span class="free">ltake</span> <span class="bound">xs</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">ldrop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> llist"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">↑</span>"</span> 110<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main"><span class="free">↑</span></span> <span class="main">0</span>     <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main"><span class="free">↑</span></span> Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">of</span> LNil <span class="main">⇒</span> LNil <span class="main">|</span> <span class="bound">x</span> <span class="main">##</span> <span class="bound">xs</span> <span class="main">⇒</span> <span class="free">ldrop</span> <span class="bound">xs</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lset</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span> ran <span class="main">(</span>ll2f <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">llength</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">llength</span> <span class="main">≡</span> finlsts_rec <span class="main">0</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">a</span> <span class="bound">r</span> <span class="bound">n</span><span class="main">.</span> Suc <span class="bound">n</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">llast</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">llast</span> <span class="main">≡</span> finlsts_rec undefined <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">xs</span> <span class="bound">l</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">xs</span> <span class="main">=</span> LNil <span class="keyword1">then</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="bound">l</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lbutlast</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist <span class="main">⇒</span> <span class="tfree">'a</span> llist"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lbutlast</span> <span class="main">≡</span> finlsts_rec LNil <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">xs</span> <span class="bound">l</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">xs</span> <span class="main">=</span> LNil <span class="keyword1">then</span> LNil <span class="keyword1">else</span> <span class="bound">x</span><span class="main">##</span><span class="bound">l</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lrev</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist <span class="main">⇒</span> <span class="tfree">'a</span> llist"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lrev</span> <span class="main">≡</span> finlsts_rec LNil <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span> <span class="bound">xs</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">@@</span> <span class="bound">x</span> <span class="main">##</span> LNil<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> llength_LNil  <span class="main">=</span> llength_def <span class="main">[</span><span class="operator">THEN</span> finlsts_rec_LNil_def<span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span>  llength_LCons <span class="main">=</span> llength_def <span class="main">[</span><span class="operator">THEN</span> finlsts_rec_LCons_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> llength_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> llength_LNil llength_LCons

<span class="keyword1"><span class="command">lemmas</span></span> llast_LNil  <span class="main">=</span> llast_def <span class="main">[</span><span class="operator">THEN</span> finlsts_rec_LNil_def<span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span>  llast_LCons <span class="main">=</span> llast_def <span class="main">[</span><span class="operator">THEN</span> finlsts_rec_LCons_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> llast_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> llast_LNil llast_LCons

<span class="keyword1"><span class="command">lemmas</span></span> lbutlast_LNil <span class="main">=</span> lbutlast_def <span class="main">[</span><span class="operator">THEN</span> finlsts_rec_LNil_def<span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> lbutlast_LCons <span class="main">=</span> lbutlast_def <span class="main">[</span><span class="operator">THEN</span> finlsts_rec_LCons_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> lbutlast_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> lbutlast_LNil lbutlast_LCons

<span class="keyword1"><span class="command">lemmas</span></span> lrev_LNil <span class="main">=</span> lrev_def <span class="main">[</span><span class="operator">THEN</span> finlsts_rec_LNil_def<span class="main">]</span>
  <span class="keyword2"><span class="keyword">and</span></span> lrev_LCons <span class="main">=</span> lrev_def <span class="main">[</span><span class="operator">THEN</span> finlsts_rec_LCons_def<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> lrev_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> lrev_LNil lrev_LCons

<span class="keyword1" id="LList2-lrevT"><span class="command">lemma</span></span> lrevT <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> lrev <span class="free">xs</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finlsts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-lrev_lappend"><span class="command">lemma</span></span> lrev_lappend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lrev <span class="main">(</span><span class="free">xs</span> <span class="main">@@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>lrev <span class="free">ys</span><span class="main">)</span> <span class="main">@@</span> <span class="main">(</span>lrev <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fin
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lrev_LCons <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span> lappend_assoc<span class="main">)</span>

<span class="keyword1" id="LList2-lrev_lrev_ident"><span class="command">lemma</span></span> lrev_lrev_ident <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lrev <span class="main">(</span>lrev <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fin
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">##</span> LNil <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> LCons_fin
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="LList2-lrev_is_LNil_conv"><span class="command">lemma</span></span> lrev_is_LNil_conv <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="main">(</span>lrev <span class="free">xs</span> <span class="main">=</span> LNil<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">=</span> LNil<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finlsts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-LNil_is_lrev_conv"><span class="command">lemma</span></span> LNil_is_lrev_conv <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="main">(</span>LNil <span class="main">=</span> lrev <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">=</span> LNil<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finlsts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-lrev_is_lrev_conv"><span class="command">lemma</span></span> lrev_is_lrev_conv <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lrev <span class="free">xs</span> <span class="main">=</span> lrev <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lrev <span class="main">(</span>lrev <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> lrev <span class="main">(</span>lrev <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="LList2-lrev_induct"><span class="command">lemma</span></span> lrev_induct <span class="main">[</span><span class="operator">case_names</span> LNil snocl<span class="main">,</span> <span class="operator">consumes</span> 1<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> LNil"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">xs</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span> <span class="free">P</span> <span class="bound">xs</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">xs</span> <span class="main">@@</span> <span class="bound">x</span><span class="main">##</span>LNil<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> lrev <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> fin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>lrev <span class="skolem">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword1"><span class="command">with</span></span> init <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> step<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> fin l_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-finlsts_rev_cases"><span class="command">lemma</span></span> finlsts_rev_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tfin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>LNil<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> LNil"</span></span>
    <span class="main">|</span>    <span class="main">(</span>snocl<span class="main">)</span> <span class="free">a</span> <span class="free">l</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">l</span> <span class="main">@@</span> <span class="free">a</span> <span class="main">##</span> LNil"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> lrev_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-ll2f_LNil"><span class="command">lemma</span></span> ll2f_LNil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"LNil<span class="main">!!</span><span class="free">x</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-None_lfinite"><span class="command">lemma</span></span> None_lfinite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">!!</span><span class="free">i</span> <span class="main">=</span> None <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> LNil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons <span class="skolem">x</span> <span class="skolem">l'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">!!</span> <span class="skolem">n</span> <span class="main">=</span> None <span class="main">⟹</span> <span class="skolem">l'</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">!!</span> Suc <span class="skolem">n</span> <span class="main">=</span> None›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-infinite_Some"><span class="command">lemma</span></span> infinite_Some<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="free">t</span><span class="main">!!</span><span class="free">i</span> <span class="main">=</span> Some <span class="bound">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> None_lfinite<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> infinite_idx_SomeE <span class="main">=</span> exE <span class="main">[</span><span class="operator">OF</span> infinite_Some<span class="main">]</span>

<span class="keyword1" id="LList2-Least_True"><span class="command">lemma</span></span> Least_True <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="main">(</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> True<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Least_def<span class="main">)</span>

<span class="keyword1" id="LList2-ll2f_llength"><span class="command">lemma</span></span>  ll2f_llength <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="free">r</span><span class="main">!!</span><span class="main">(</span>llength <span class="free">r</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> finlsts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-llength_least_None"><span class="command">lemma</span></span> llength_least_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"llength <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">r</span><span class="main">!!</span><span class="bound">i</span> <span class="main">=</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> rA
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
  <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">##</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">!!</span> <span class="bound">i</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">=</span> llength <span class="main">(</span><span class="skolem">a</span> <span class="main">##</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ll2f_llength Least_Suc2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-ll2f_lem1"><span class="command">lemma</span></span> ll2f_lem1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">!!</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">x</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="free">t</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">=</span> Some <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> llist.splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> ll2f_Suc_Some <span class="main">=</span> ll2f_lem1 <span class="main">[</span><span class="operator">THEN</span> exE<span class="main">]</span>

<span class="keyword1" id="LList2-ll2f_None_Suc"><span class="command">lemma</span></span> ll2f_None_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">=</span> None <span class="main">⟹</span> <span class="free">t</span> <span class="main">!!</span> Suc <span class="free">i</span> <span class="main">=</span> None"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> llist.split<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-ll2f_None_le"><span class="command">lemma</span></span> ll2f_None_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">t</span><span class="main">!!</span><span class="free">j</span> <span class="main">=</span> None<span class="main">;</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">i</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span><span class="main">!!</span><span class="free">i</span> <span class="main">=</span> None"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> llist.split<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-ll2f_Some_le"><span class="command">lemma</span></span> ll2f_Some_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> jlei<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> tisome<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">!!</span> <span class="free">i</span> <span class="main">=</span> Some <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">y</span><span class="main">.</span> <span class="free">t</span> <span class="main">!!</span> <span class="free">j</span> <span class="main">=</span> Some <span class="bound">y</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="free">t</span> <span class="main">!!</span> <span class="free">j</span> <span class="main">=</span> Some <span class="bound">y</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">!!</span> <span class="free">j</span> <span class="main">=</span> None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> tisome jlei <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>  ll2f_None_le<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-ltake_LNil"><span class="command">lemma</span></span> ltake_LNil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"LNil <span class="main">↓</span> <span class="free">i</span> <span class="main">=</span> LNil"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-ltake_LCons_Suc"><span class="command">lemma</span></span> ltake_LCons_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">##</span> <span class="free">l</span><span class="main">)</span> <span class="main">↓</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">##</span> <span class="free">l</span> <span class="main">↓</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="LList2-take_fin"><span class="command">lemma</span></span> take_fin <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">⟹</span> <span class="free">t</span><span class="main">↓</span><span class="free">i</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-ltake_fin"><span class="command">lemma</span></span> ltake_fin <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">↓</span> <span class="free">i</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="LList2-llength_take"><span class="command">lemma</span></span> llength_take <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟹</span> llength <span class="main">(</span><span class="free">t</span><span class="main">↓</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟹</span> llength <span class="main">(</span><span class="bound">t</span> <span class="main">↓</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> llength_LCons <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-ltake_ldrop_id"><span class="command">lemma</span></span> ltake_ldrop_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">↓</span> <span class="free">i</span><span class="main">)</span> <span class="main">@@</span> <span class="main">(</span><span class="free">x</span> <span class="main">↑</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-ltake_ldrop"><span class="command">lemma</span></span> ltake_ldrop<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">↑</span> <span class="free">m</span><span class="main">)</span> <span class="main">↓</span> <span class="free">n</span> <span class="main">=</span><span class="main">(</span><span class="free">xs</span> <span class="main">↓</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">↑</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">m</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-ldrop_LNil"><span class="command">lemma</span></span> ldrop_LNil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"LNil <span class="main">↑</span> <span class="free">i</span> <span class="main">=</span> LNil"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-ldrop_add"><span class="command">lemma</span></span> ldrop_add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">↑</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">↑</span> <span class="free">i</span> <span class="main">↑</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">i</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="LList2-ldrop_fun"><span class="command">lemma</span></span> ldrop_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">↑</span> <span class="free">i</span> <span class="main">!!</span> <span class="free">j</span> <span class="main">=</span> <span class="free">t</span><span class="main">!!</span><span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-ldropT"><span class="command">lemma</span></span> ldropT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">↑</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-ldrop_finT"><span class="command">lemma</span></span> ldrop_finT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">↑</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">::</span><span class="tfree">'a</span> llist<span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">↑</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">↑</span> Suc <span class="skolem">n</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-ldrop_infT"><span class="command">lemma</span></span> ldrop_infT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">↑</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">↑</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-lapp_suff_llength"><span class="command">lemma</span></span> lapp_suff_llength<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">r</span><span class="main">@@</span><span class="free">s</span><span class="main">)</span> <span class="main">↑</span> llength <span class="free">r</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finlsts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-ltake_lappend_llength"><span class="command">lemma</span></span> ltake_lappend_llength <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">r</span> <span class="main">@@</span> <span class="free">s</span><span class="main">)</span> <span class="main">↓</span> llength <span class="free">r</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finlsts.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-ldrop_LNil_less"><span class="command">lemma</span></span> ldrop_LNil_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">j</span> <span class="main">≤</span> <span class="free">i</span><span class="main">;</span> <span class="free">t</span> <span class="main">↑</span> <span class="free">j</span> <span class="main">=</span> LNil<span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">↑</span> <span class="free">i</span> <span class="main">=</span> LNil"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-ldrop_inf_iffT"><span class="command">lemma</span></span> ldrop_inf_iffT <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">↑</span> <span class="free">i</span> <span class="main">∈</span> UNIV<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span>  <span class="main">=</span>  <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> UNIV<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">↑</span><span class="free">i</span> <span class="main">∈</span> UNIV<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> UNIV<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ldrop_finT<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-ldrop_fin_iffT"><span class="command">lemma</span></span> ldrop_fin_iffT <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">↑</span> <span class="free">i</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-drop_nonLNil"><span class="command">lemma</span></span> drop_nonLNil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">↑</span><span class="free">i</span> <span class="main">≠</span> LNil <span class="main">⟹</span> <span class="free">t</span> <span class="main">≠</span> LNil"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="LList2-llength_drop_take"><span class="command">lemma</span></span> llength_drop_take<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">↑</span><span class="free">i</span> <span class="main">≠</span> LNil <span class="main">⟹</span> llength <span class="main">(</span><span class="free">t</span><span class="main">↓</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> llength_LCons <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-fps_induct"><span class="command">lemma</span></span> fps_induct <span class="main">[</span><span class="operator">case_names</span> LNil LCons<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">set</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> fpslsts<span class="main">,</span> <span class="operator">consumes</span> 1<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>♣</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>    init<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span><span class="main">##</span>LNil<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>    step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">l</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">l</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>♣</sup></span><span class="main">;</span> <span class="free">P</span> <span class="bound">l</span><span class="main">;</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span> <span class="main">##</span> <span class="bound">l</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> fps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> LNil"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">cases</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> init step<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-lbutlast_lapp_llast"><span class="command">lemma</span></span> lbutlast_lapp_llast<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>♣</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> lbutlast <span class="free">l</span> <span class="main">@@</span> <span class="main">(</span>llast <span class="free">l</span> <span class="main">##</span> LNil<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-llast_snoc"><span class="command">lemma</span></span> llast_snoc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"llast <span class="main">(</span><span class="free">xs</span> <span class="main">@@</span> <span class="free">x</span> <span class="main">##</span> LNil<span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fin
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
  <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">##</span> LNil <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> LCons_fin <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> llast_LCons <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-lbutlast_snoc"><span class="command">lemma</span></span> lbutlast_snoc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lbutlast <span class="main">(</span><span class="free">xs</span> <span class="main">@@</span> <span class="free">x</span> <span class="main">##</span> LNil<span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fin
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
  <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">##</span> LNil <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> LCons_fin <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lbutlast_LCons <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-llast_lappend"><span class="command">lemma</span></span> llast_lappend <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟧</span> <span class="main">⟹</span> llast <span class="main">(</span><span class="free">x</span> <span class="main">@@</span> <span class="free">a</span> <span class="main">##</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> llast <span class="main">(</span><span class="free">a</span> <span class="main">##</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finlsts.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">l</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">@@</span> <span class="free">a</span> <span class="main">##</span> <span class="free">y</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> LCons_fin 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> llast_LCons <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-llast_llength"><span class="command">lemma</span></span> llast_llength<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tfin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≠</span> LNil <span class="main">⟹</span> <span class="free">t</span> <span class="main">!!</span> <span class="main">(</span>llength <span class="free">t</span> <span class="main">-</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span>llast <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tfin
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LNil_fin <span class="skolem">l</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> consal <span class="main">=</span> this <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> consal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">aa</span> <span class="skolem">la</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> consal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The constant llist›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lconst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> llist"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lconst</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> iterates <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1" id="LList2-lconst_unfold"><span class="command">lemma</span></span> lconst_unfold<span class="main">:</span> <span class="quoted"><span class="quoted">"lconst <span class="free">a</span> <span class="main">=</span> <span class="free">a</span> <span class="main">##</span> lconst <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lconst_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> iterates<span class="main">)</span>

<span class="keyword1" id="LList2-lconst_LNil"><span class="command">lemma</span></span> lconst_LNil <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"lconst <span class="free">a</span> <span class="main">≠</span> LNil"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span><span class="operator">frule</span> subst <span class="main"><span class="main">[</span></span><span class="operator">OF</span> lconst_unfold<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="LList2-lconstT"><span class="command">lemma</span></span> lconstT<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> aA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lconst <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inflstsI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lconst <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> alllsts.coinduct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">=</span></span> lconst <span class="free"><span class="free">a</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lconst <span class="free">a</span> <span class="main">=</span> <span class="free">a</span> <span class="main">##</span> lconst <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lconst_unfold<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> aA
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="bound">aa</span><span class="main">.</span> lconst <span class="free">a</span> <span class="main">=</span> <span class="bound">aa</span> <span class="main">##</span> <span class="bound">l</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">l</span> <span class="main">=</span> lconst <span class="free">a</span> <span class="main">∨</span> <span class="bound">l</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">)</span> <span class="main">∧</span> <span class="bound">aa</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">assume</span></span> lconst<span class="main">:</span> <span class="quoted"><span class="quoted">"lconst <span class="free">a</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> lconst <span class="free">a</span> <span class="main">≠</span> <span class="bound">l</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">∈</span>UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lconst <span class="free">a</span> <span class="main">≠</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finlsts_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a'</span> <span class="skolem">l'</span> <span class="keyword3"><span class="command">assume</span></span> 
        al'<span class="main">:</span> <span class="quoted"><span class="quoted">"lconst <span class="free">a</span> <span class="main">≠</span> <span class="skolem">l'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        l'A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> al' <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"lconst <span class="free">a</span> <span class="main">≠</span> <span class="skolem">a'</span> <span class="main">##</span> <span class="skolem">l'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> contrapos_np<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> notal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> lconst <span class="free">a</span> <span class="main">≠</span> <span class="skolem">a'</span> <span class="main">##</span> <span class="skolem">l'</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lconst <span class="free">a</span> <span class="main">=</span> <span class="skolem">a'</span> <span class="main">##</span> <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">##</span> lconst <span class="free">a</span> <span class="main">=</span> <span class="skolem">a'</span> <span class="main">##</span> <span class="skolem">l'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subst <span class="main"><span class="main">[</span></span><span class="operator">OF</span> lconst_unfold<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lconst <span class="free">a</span> <span class="main">=</span> <span class="skolem">l'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> aA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The prefix order of llists›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> llist <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  llist_le_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> llist<span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">d</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">@@</span> <span class="bound">d</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  llist_less_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">::</span> <span class="tfree">'a</span> llist<span class="main">)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="LList2-not_LCons_le_LNil"><span class="command">lemma</span></span> not_LCons_le_LNil <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">a</span><span class="main">##</span><span class="free">l</span><span class="main">)</span> <span class="main">≤</span> LNil"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> llist_le_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-LNil_le"><span class="command">lemma</span></span> LNil_le <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"LNil <span class="main">≤</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> llist_le_def<span class="main">)</span>

<span class="keyword1" id="LList2-le_LNil"><span class="command">lemma</span></span> le_LNil <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">≤</span> LNil<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">=</span> LNil<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> llist_le_def<span class="main">)</span>

<span class="keyword1" id="LList2-llist_inf_le"><span class="command">lemma</span></span> llist_inf_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>  <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">≤</span><span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span><span class="main">=</span><span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> llist_le_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-le_LCons"><span class="command">lemma</span></span> le_LCons <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="free">xs</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">##</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">≤</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> llist_le_def<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="LList2-llist_le_refl"><span class="command">lemma</span></span> llist_le_refl <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">::</span> <span class="tfree">'a</span> llist<span class="main">)</span> <span class="main">≤</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> llist_le_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"LNil"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="LList2-llist_le_trans"><span class="command">lemma</span></span> llist_le_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> llist_le_def lappend_assoc<span class="main">)</span>

<span class="keyword1" id="LList2-llist_le_anti_sym"><span class="command">lemma</span></span> llist_le_anti_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> alllstsE<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> finite
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span><span class="main">.</span>  <span class="free">s</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">⟶</span> <span class="free">s</span> <span class="main">=</span> <span class="bound">t</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finlsts.induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>      
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">l</span> <span class="skolem">a</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword1"><span class="command">from</span></span> LCons_fin <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">##</span> <span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="main">##</span> <span class="skolem">l</span> <span class="main">⟶</span> <span class="skolem">a</span> <span class="main">##</span> <span class="skolem">l</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> st ts <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> infinite <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> st <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> llist_inf_le<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-llist_less_le_not_le"><span class="command">lemma</span></span> llist_less_le_not_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">&lt;</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> llist_less_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> llist_le_anti_sym<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span>
    <span class="main">(</span><span class="operator">assumption</span> <span class="main"><span class="keyword3">|</span></span> <span class="operator">rule</span> llist_le_refl
      llist_le_trans llist_le_anti_sym llist_less_le_not_le<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Typing rules›</span></span>

<span class="keyword1" id="LList2-llist_le_finT"><span class="command">lemma</span></span> llist_le_finT <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">≤</span><span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">≤</span><span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sfin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> sfin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span><span class="main">≤</span><span class="free">s</span> <span class="main">⟶</span> <span class="bound">r</span><span class="main">∈</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">s</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span>  <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> ral<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="main">##</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LCons_fin
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> rs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-llist_less_finT"><span class="command">lemma</span></span> llist_less_finT <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">&lt;</span><span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_le<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹More simplification rules›</span></span>

<span class="keyword1" id="LList2-LNil_less_LCons"><span class="command">lemma</span></span> LNil_less_LCons <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"LNil <span class="main">&lt;</span> <span class="free">a</span> <span class="main">##</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le<span class="main">)</span>

<span class="keyword1" id="LList2-not_less_LNil"><span class="command">lemma</span></span> not_less_LNil <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">r</span> <span class="main">&lt;</span> LNil"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_le<span class="main">)</span>

<span class="keyword1" id="LList2-less_LCons"><span class="command">lemma</span></span> less_LCons <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">a</span> <span class="main">##</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">##</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_le<span class="main">)</span>

<span class="keyword1" id="LList2-llength_mono"><span class="command">lemma</span></span> llength_mono <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span><span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">&lt;</span><span class="free">r</span> <span class="main">⟹</span> llength <span class="free">s</span> <span class="main">&lt;</span> llength <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">r</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> llength_LCons <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-le_lappend"><span class="command">lemma</span></span> le_lappend <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">@@</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> llist_le_def<span class="main">)</span>

<span class="keyword1" id="LList2-take_inf_less"><span class="command">lemma</span></span> take_inf_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> UNIV<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">↓</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> inflsts_cases<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> UNIV<span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span> <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-lapp_take_less"><span class="command">lemma</span></span> lapp_take_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> iless<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> llength <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">@@</span> <span class="free">s</span><span class="main">)</span> <span class="main">↓</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> iless
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>›</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">j</span> <span class="main">&lt;</span> llength <span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">r</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span> <span class="skolem">j</span> <span class="main">&lt;</span> llength <span class="bound">r</span><span class="main">⟧</span> <span class="main">⟹</span> lappend <span class="bound">r</span> <span class="free">s</span> <span class="main">↓</span> <span class="skolem">j</span> <span class="main">&lt;</span> <span class="bound">r</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_inf_less<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Finite prefixes and infinite suffixes›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">finpref</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist <span class="main">⇒</span> <span class="tfree">'a</span> llist set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">finpref</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">suff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist <span class="main">⇒</span> <span class="tfree">'a</span> llist set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">suff</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span> <span class="bound">r</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">infsuff</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist <span class="main">⇒</span> <span class="tfree">'a</span> llist set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">infsuff</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span> <span class="bound">r</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prefix_closed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">prefix_closed</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">s</span></span> <span class="main">≤</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pprefix_closed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pprefix_closed</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≠</span> LNil <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">suffix_closed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">suffix_closed</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≤</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1" id="LList2-finpref_LNil"><span class="command">lemma</span></span> finpref_LNil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finpref <span class="free">A</span> LNil <span class="main">=</span> <span class="main">{</span>LNil<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finpref_def<span class="main">)</span>

<span class="keyword1" id="LList2-finpref_fin"><span class="command">lemma</span></span> finpref_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> finpref <span class="free">A</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finpref_def<span class="main">)</span>

<span class="keyword1" id="LList2-finpref_mono2"><span class="command">lemma</span></span> finpref_mono2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⟹</span> finpref <span class="free">A</span> <span class="free">s</span> <span class="main">⊆</span> finpref <span class="free">A</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> finpref_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> llist_le_trans<span class="main">)</span>

<span class="keyword1" id="LList2-suff_LNil"><span class="command">lemma</span></span> suff_LNil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"suff <span class="free">A</span> LNil <span class="main">=</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> suff_def<span class="main">)</span>

<span class="keyword1" id="LList2-suff_all"><span class="command">lemma</span></span> suff_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> suff <span class="free">A</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> suff_def<span class="main">)</span>

<span class="keyword1" id="LList2-suff_mono2"><span class="command">lemma</span></span> suff_mono2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⟹</span> suff <span class="free">A</span> <span class="free">t</span> <span class="main">⊆</span> suff <span class="free">A</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> suff_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> llist_le_trans<span class="main">)</span>

<span class="keyword1" id="LList2-suff_appE"><span class="command">lemma</span></span> suff_appE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  tsuff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> suff <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">r</span><span class="main">@@</span><span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> tsuff <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    tA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> trs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">r</span> <span class="main">@@</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> suff_def llist_le_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> rA trs tA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lapp_allT_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> trs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-LNil_suff"><span class="command">lemma</span></span> LNil_suff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>LNil <span class="main">∈</span> suff <span class="free">A</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">=</span> LNil<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> suff_def<span class="main">)</span>

<span class="keyword1" id="LList2-finpref_suff"><span class="command">lemma</span></span> finpref_suff <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">r</span> <span class="main">∈</span> finpref <span class="free">A</span> <span class="free">t</span><span class="main">;</span> <span class="free">t</span><span class="main">∈</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> suff <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finpref_def suff_def<span class="main">)</span>

<span class="keyword1" id="LList2-suff_finpref"><span class="command">lemma</span></span> suff_finpref<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> suff <span class="free">A</span> <span class="free">r</span><span class="main">;</span> <span class="free">r</span><span class="main">∈</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> finpref <span class="free">A</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finpref_def suff_def<span class="main">)</span>

<span class="keyword1" id="LList2-suff_finpref_iff"><span class="command">lemma</span></span> suff_finpref_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">r</span><span class="main">∈</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span> <span class="free">t</span><span class="main">∈</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">r</span> <span class="main">∈</span> finpref <span class="free">A</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> suff <span class="free">A</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finpref_def suff_def<span class="main">)</span>

<span class="keyword1" id="LList2-infsuff_LNil"><span class="command">lemma</span></span> infsuff_LNil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"infsuff <span class="free">A</span> LNil <span class="main">=</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infsuff_def<span class="main">)</span>

<span class="keyword1" id="LList2-infsuff_inf"><span class="command">lemma</span></span> infsuff_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> infsuff <span class="free">A</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> infsuff_def<span class="main">)</span>

<span class="keyword1" id="LList2-infsuff_mono2"><span class="command">lemma</span></span> infsuff_mono2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⟹</span> infsuff <span class="free">A</span> <span class="free">t</span> <span class="main">⊆</span> infsuff <span class="free">A</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> infsuff_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> llist_le_trans<span class="main">)</span>

<span class="keyword1" id="LList2-infsuff_appE"><span class="command">lemma</span></span> infsuff_appE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>   rA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> tinfsuff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> infsuff <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">r</span><span class="main">@@</span><span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> tinfsuff <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    tA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> trs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">r</span> <span class="main">@@</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> infsuff_def llist_le_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> rA trs tA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> app_invT<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> trs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-finpref_infsuff"><span class="command">lemma</span></span> finpref_infsuff <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">r</span> <span class="main">∈</span> finpref <span class="free">A</span> <span class="free">t</span><span class="main">;</span> <span class="free">t</span><span class="main">∈</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> infsuff <span class="free">A</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finpref_def infsuff_def<span class="main">)</span>

<span class="keyword1" id="LList2-infsuff_finpref"><span class="command">lemma</span></span> infsuff_finpref<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">t</span> <span class="main">∈</span> infsuff <span class="free">A</span> <span class="free">r</span><span class="main">;</span> <span class="free">r</span><span class="main">∈</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> finpref <span class="free">A</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finpref_def infsuff_def<span class="main">)</span>

<span class="keyword1" id="LList2-infsuff_finpref_iff"><span class="command">lemma</span></span> infsuff_finpref_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">r</span><span class="main">∈</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span> <span class="free">t</span><span class="main">∈</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> finpref <span class="free">A</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">∈</span> infsuff <span class="free">A</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finpref_def infsuff_def<span class="main">)</span>

<span class="keyword1" id="LList2-prefix_lemma"><span class="command">lemma</span></span> prefix_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xinf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> yinf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">∧</span> <span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span> <span class="main">∧</span> finpref <span class="free">A</span> <span class="bound">x</span> <span class="main">⊆</span> finpref <span class="free">A</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xinf yinf
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finpref_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> R<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">coinduct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> llist.coinduct_strong<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Eq_llist <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> ainf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> binf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pref<span class="main">:</span> <span class="quoted"><span class="quoted">"finpref <span class="free">A</span> <span class="skolem">a</span> <span class="main">⊆</span> finpref <span class="free">A</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ainf <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons <span class="skolem">a'</span> <span class="skolem">l'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> acons <span class="main">=</span> this <span class="keyword1"><span class="command">with</span></span> binf <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons <span class="skolem">b'</span> <span class="skolem">l''</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> acons pref <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> <span class="skolem">b'</span>"</span></span> <span class="quoted"><span class="quoted">"finpref <span class="free">A</span> <span class="skolem">l'</span> <span class="main">⊆</span> finpref <span class="free">A</span> <span class="skolem">l''</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finpref_def<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> acons LCons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="LList2-inf_neqE"><span class="command">lemma</span></span> inf_neqE<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span>  <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span><span class="main">;</span>
  <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">s</span><span class="main">∈</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">;</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">x</span><span class="main">;</span> <span class="main">¬</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prefix_lemma<span class="main">)</span>

<span class="keyword1" id="LList2-pref_locally_linear"><span class="command">lemma</span></span> pref_locally_linear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> llist"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>   tx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">∨</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>∞</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> alllstsE<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> infinite <span class="keyword1"><span class="command">with</span></span> sx tx <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> llist_inf_le<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> finite
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sx tx
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">s</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> LNil_fin <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons_fin <span class="skolem">a</span> <span class="skolem">l</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> alx <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">##</span> <span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">note</span></span> tx <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> disjCI<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> tal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">a</span> <span class="main">##</span> <span class="skolem">l</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"LCons <span class="skolem">a</span> <span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> LNil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> tal <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons <span class="skolem">b</span> <span class="skolem">ts</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> tcons <span class="main">=</span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> LNil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> alx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>LCons <span class="skolem">c</span> <span class="skolem">xs</span><span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> alx  LCons <span class="keyword1"><span class="command">have</span></span> ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lxs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">xs</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> tx tcons LCons <span class="keyword1"><span class="command">have</span></span> bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> tsxs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">≤</span> <span class="skolem">xs</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> tcons tal ac bc <span class="keyword1"><span class="command">have</span></span> tsl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">ts</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> LCons_fin lxs tsxs tsl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">ts</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> tcons ac bc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pfinpref</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist <span class="main">⇒</span> <span class="tfree">'a</span> llist set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pfinpref</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> finpref <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span> <span class="main">{</span>LNil<span class="main">}</span>"</span></span>

<span class="keyword1" id="LList2-pfinpref_iff"><span class="command">lemma</span></span> pfinpref_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> pfinpref <span class="free">A</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> finpref <span class="free">A</span> <span class="free">s</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> LNil<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pfinpref_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Safety and Liveness›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">infsafety</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">infsafety</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span> <span class="main">∈</span> finpref <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">.</span> <span class="bound">r</span> <span class="main">@@</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">infliveness</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">infliveness</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>ω</sup></span><span class="main">.</span> <span class="bound">t</span> <span class="main">@@</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">possafety</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">possafety</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>♠</sup></span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span> <span class="main">∈</span> pfinpref <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="bound">r</span> <span class="main">@@</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">posliveness</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">posliveness</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>♣</sup></span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="bound">t</span> <span class="main">@@</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">safety</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">safety</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span> <span class="main">∈</span> finpref <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="bound">r</span> <span class="main">@@</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">liveness</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> llist set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">liveness</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="bound">t</span> <span class="main">@@</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1" id="LList2-safetyI"><span class="command">lemma</span></span> safetyI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">t</span> <span class="main">∈</span>  <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">;</span> <span class="main">∀</span> <span class="bound">r</span> <span class="main">∈</span> finpref <span class="free">A</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="bound">r</span> <span class="main">@@</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span>
  <span class="main">⟹</span> safety <span class="free">A</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> safety_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="LList2-safetyD"><span class="command">lemma</span></span> safetyD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> safety <span class="free">A</span> <span class="free">P</span><span class="main">;</span>  <span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> finpref <span class="free">A</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="bound">r</span> <span class="main">@@</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">P</span>
  <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> safety_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="LList2-safetyE"><span class="command">lemma</span></span> safetyE<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> safety <span class="free">A</span> <span class="free">P</span><span class="main">;</span>
    <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span> <span class="main">∈</span> finpref <span class="free">A</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="bound">r</span> <span class="main">@@</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">R</span>
   <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> safety_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="LList2-safety_prefix_closed"><span class="command">lemma</span></span> safety_prefix_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"safety UNIV <span class="free">P</span> <span class="main">⟹</span> prefix_closed <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> safetyD
       <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefix_closed_def finpref_def llist_le_def lappend_assoc<span class="main">)</span>
    <span class="operator">blast</span>

<span class="keyword1" id="LList2-livenessI"><span class="command">lemma</span></span> livenessI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span><span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="bound">s</span> <span class="main">@@</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> liveness <span class="free">A</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> liveness_def<span class="main">)</span>

<span class="keyword1" id="LList2-livenessE"><span class="command">lemma</span></span> livenessE<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> liveness <span class="free">A</span> <span class="free">P</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span>  <span class="bound">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">;</span> <span class="free">s</span> <span class="main">@@</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span><span class="main">;</span> <span class="free">s</span> <span class="main">∉</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⟹</span> <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> liveness_def<span class="main">)</span>

<span class="keyword1" id="LList2-possafetyI"><span class="command">lemma</span></span> possafetyI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">t</span> <span class="main">∈</span>  <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>♠</sup></span><span class="main">;</span> <span class="main">∀</span> <span class="bound">r</span> <span class="main">∈</span> pfinpref <span class="free">A</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="bound">r</span> <span class="main">@@</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span>
  <span class="main">⟹</span> possafety <span class="free">A</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> possafety_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="LList2-possafetyD"><span class="command">lemma</span></span> possafetyD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> possafety <span class="free">A</span> <span class="free">P</span><span class="main">;</span>  <span class="free">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>♠</sup></span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> pfinpref <span class="free">A</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="bound">r</span> <span class="main">@@</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">P</span>
  <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> possafety_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="LList2-possafetyE"><span class="command">lemma</span></span> possafetyE<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> possafety <span class="free">A</span> <span class="free">P</span><span class="main">;</span>
    <span class="main">∀</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>♠</sup></span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">r</span> <span class="main">∈</span> pfinpref <span class="free">A</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="bound">r</span> <span class="main">@@</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟹</span> <span class="free">R</span>
   <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> possafety_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="LList2-possafety_pprefix_closed"><span class="command">lemma</span></span> possafety_pprefix_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> psafety<span class="main">:</span> <span class="quoted"><span class="quoted">"possafety UNIV <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pprefix_closed <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> pprefix_closed_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> ballI allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> tP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> spos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> LNil"</span></span>
  <span class="keyword1"><span class="command">from</span></span> psafety <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> possafetyD<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> spos <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> UNIV<span class="main"><span class="hidden">⇧</span><sup>♠</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> pfinpref UNIV <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> scons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">@@</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pfinpref_def finpref_def llist_le_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> st <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">@@</span> <span class="skolem">u</span> <span class="main">@@</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lappend_assoc llist_le_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> tP <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">∈</span>UNIV<span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="skolem">r</span> <span class="main">@@</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="LList2-poslivenessI"><span class="command">lemma</span></span> poslivenessI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span><span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>♣</sup></span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">.</span> <span class="bound">s</span> <span class="main">@@</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> posliveness <span class="free">A</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> posliveness_def<span class="main">)</span>

<span class="keyword1" id="LList2-poslivenessE"><span class="command">lemma</span></span> poslivenessE<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> posliveness <span class="free">A</span> <span class="free">P</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">⟦</span>  <span class="bound">t</span> <span class="main">∈</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>∞</sup></span><span class="main">;</span> <span class="free">s</span> <span class="main">@@</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span><span class="main">;</span> <span class="free">s</span> <span class="main">∉</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>♣</sup></span> <span class="main">⟹</span> <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> posliveness_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>