<div id="Boolean_Expression_Checkers">
<div class="head">
<h1>Theory Boolean_Expression_Checkers</h1>
</div>
<pre class="source"><span class="comment1">(*
  Boolean Expression Checkers Based on Binary Decision Trees
  Author: Tobias Nipkow
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Boolean_Expression_Checkers
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Mapping.html">HOL-Library.Mapping</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Tautology (etc) Checking via Binary Decision Trees›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Binary Decision Trees›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> ifex <span class="main">=</span> Trueif <span class="main">|</span> Falseif <span class="main">|</span> IF <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ifex"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ifex"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">val_ifex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ifex <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">val_ifex</span> Trueif <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">val_ifex</span> Falseif <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">val_ifex</span> <span class="main">(</span>IF <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="free">val_ifex</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">else</span> <span class="free">val_ifex</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Environment›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Environments are substitutions of values for variables:›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> env_bool <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> bool<span class="main">)</span> mapping"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">agree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> env_bool <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">agree</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">b</span><span class="main">.</span> Mapping.lookup <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="bound">x</span> <span class="main">=</span> Some <span class="bound">b</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">b</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Boolean_Expression_Checkers-agree_Nil"><span class="command">lemma</span></span> agree_Nil<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"agree <span class="free">s</span> Mapping.empty"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agree_def lookup_empty<span class="main">)</span>

<span class="keyword1" id="Boolean_Expression_Checkers-lookup_update_unfold"><span class="command">lemma</span></span> lookup_update_unfold<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Mapping.lookup <span class="main">(</span>Mapping.update <span class="free">k</span> <span class="free">v</span> <span class="free">m</span><span class="main">)</span> <span class="free">k'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k'</span> <span class="keyword1">then</span> Some <span class="free">v</span> <span class="keyword1">else</span> Mapping.lookup <span class="free">m</span> <span class="free">k'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lookup_update lookup_update_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Boolean_Expression_Checkers-agree_Cons"><span class="command">lemma</span></span> agree_Cons<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> Mapping.keys <span class="free">env</span> <span class="main">⟹</span> agree <span class="free">s</span> <span class="main">(</span>Mapping.update <span class="free">x</span> <span class="free">b</span> <span class="free">env</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">if</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="free">s</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="main">¬</span> <span class="free">s</span> <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> agree <span class="free">s</span> <span class="free">env</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agree_def lookup_update_unfold<span class="main"><span class="keyword3">;</span></span> <span class="operator">unfold</span> keys_is_none_rep lookup_update_unfold Option.is_none_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="Boolean_Expression_Checkers-agreeDT"><span class="command">lemma</span></span> agreeDT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"agree <span class="free">s</span> <span class="free">env</span> <span class="main">⟹</span> Mapping.lookup <span class="free">env</span> <span class="free">x</span> <span class="main">=</span> Some True <span class="main">⟹</span> <span class="free">s</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agree_def<span class="main">)</span>

<span class="keyword1" id="Boolean_Expression_Checkers-agreeDF"><span class="command">lemma</span></span> agreeDF<span class="main">:</span>
  <span class="quoted"><span class="quoted">"agree <span class="free">s</span> <span class="free">env</span> <span class="main">⟹</span> Mapping.lookup <span class="free">env</span> <span class="free">x</span> <span class="main">=</span> Some False <span class="main">⟹</span> <span class="main">¬</span><span class="free">s</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agree_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Recursive Tautology Checker›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Provided for completeness. However, it is recommend to use the checkers based on reduced trees.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">taut_test_rec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ifex <span class="main">⇒</span> <span class="tfree">'a</span> env_bool <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">taut_test_rec</span> Trueif <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> True"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">taut_test_rec</span> Falseif <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> False"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">taut_test_rec</span> <span class="main">(</span>IF <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> Mapping.lookup <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span>
  Some <span class="bound">b</span> <span class="main">⇒</span> <span class="free">taut_test_rec</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">b</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">|</span>
  None <span class="main">⇒</span> <span class="free">taut_test_rec</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">(</span>Mapping.update <span class="free"><span class="bound"><span class="entity">x</span></span></span> True <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">taut_test_rec</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">(</span>Mapping.update <span class="free"><span class="bound"><span class="entity">x</span></span></span> False <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Boolean_Expression_Checkers-taut_test_rec"><span class="command">lemma</span></span> taut_test_rec<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"taut_test_rec <span class="free">t</span> <span class="free">env</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> agree <span class="bound">s</span> <span class="free">env</span> <span class="main">⟶</span> val_ifex <span class="free">t</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">env</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Falseif
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"agree <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> the <span class="main">(</span>Mapping.lookup <span class="skolem">env</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">env</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> agree_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IF <span class="skolem">x</span> <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Mapping.lookup <span class="skolem">env</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None 
        <span class="keyword1"><span class="command">with</span></span> IF <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> is_none_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> agree_Cons keys_is_none_rep<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agree_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">taut_test_ifex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ifex <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">taut_test_ifex</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> taut_test_rec <span class="free"><span class="bound"><span class="entity">t</span></span></span> Mapping.empty"</span></span>

<span class="keyword1"><span class="command">corollary</span></span> taut_test_ifex<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"taut_test_ifex <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> val_ifex <span class="free">t</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> taut_test_ifex_def taut_test_rec agree_Nil<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Reduced Binary Decision Trees›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Normalisation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A normalisation avoiding duplicate variables and collapsing <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"If <span class="free"><span class="free">x</span></span> <span class="free"><span class="free">t</span></span> <span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mkIF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> ifex <span class="main">⇒</span> <span class="tfree">'a</span> ifex <span class="main">⇒</span> <span class="tfree">'a</span> ifex"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mkIF</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="keyword1">else</span> IF <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">reduce</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> env_bool <span class="main">⇒</span> <span class="tfree">'a</span> ifex <span class="main">⇒</span> <span class="tfree">'a</span> ifex"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reduce</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">(</span>IF <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> Mapping.lookup <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span>
     None <span class="main">⇒</span> mkIF <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free">reduce</span> <span class="main">(</span>Mapping.update <span class="free"><span class="bound"><span class="entity">x</span></span></span> True <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">reduce</span> <span class="main">(</span>Mapping.update <span class="free"><span class="bound"><span class="entity">x</span></span></span> False <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">|</span>
     Some <span class="bound">b</span> <span class="main">⇒</span> <span class="free">reduce</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">b</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">reduce</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">normif</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> env_bool <span class="main">⇒</span> <span class="tfree">'a</span> ifex <span class="main">⇒</span> <span class="tfree">'a</span> ifex <span class="main">⇒</span> <span class="tfree">'a</span> ifex <span class="main">⇒</span> <span class="tfree">'a</span> ifex"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">normif</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> Trueif <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">=</span> reduce <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">normif</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> Falseif <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">=</span> reduce <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">normif</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">(</span>IF <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t3</span></span></span> <span class="free"><span class="bound"><span class="entity">t4</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> Mapping.lookup <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span>
       None <span class="main">⇒</span> mkIF <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free">normif</span> <span class="main">(</span>Mapping.update <span class="free"><span class="bound"><span class="entity">x</span></span></span> True <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t3</span></span></span> <span class="free"><span class="bound"><span class="entity">t4</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">normif</span> <span class="main">(</span>Mapping.update <span class="free"><span class="bound"><span class="entity">x</span></span></span> False <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="free"><span class="bound"><span class="entity">t3</span></span></span> <span class="free"><span class="bound"><span class="entity">t4</span></span></span><span class="main">)</span> <span class="main">|</span>
       Some <span class="bound">b</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">b</span> <span class="keyword1">then</span> <span class="free">normif</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t3</span></span></span> <span class="free"><span class="bound"><span class="entity">t4</span></span></span> <span class="keyword1">else</span> <span class="free">normif</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="free"><span class="bound"><span class="entity">t3</span></span></span> <span class="free"><span class="bound"><span class="entity">t4</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Functional Correctness Proof›</span></span>

<span class="keyword1" id="Boolean_Expression_Checkers-val_mkIF"><span class="command">lemma</span></span> val_mkIF<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"val_ifex <span class="main">(</span>mkIF <span class="free">x</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> val_ifex <span class="main">(</span>IF <span class="free">x</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mkIF_def Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> val_reduce<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"agree <span class="free">s</span> <span class="free">env</span> <span class="main">⟹</span> val_ifex <span class="main">(</span>reduce <span class="free">env</span> <span class="free">t</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> val_ifex <span class="free">t</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">env</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_of_eq_None_iff val_mkIF agree_Cons Let_def keys_is_none_rep
           <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> agreeDT agreeDF <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span> 

<span class="keyword1" id="Boolean_Expression_Checkers-val_normif"><span class="command">lemma</span></span> val_normif<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"agree <span class="free">s</span> <span class="free">env</span> <span class="main">⟹</span> val_ifex <span class="main">(</span>normif <span class="free">env</span> <span class="free">t</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> val_ifex <span class="main">(</span><span class="keyword1">if</span> val_ifex <span class="free">t</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="free">t1</span> <span class="keyword1">else</span> <span class="free">t2</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t1</span></span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">env</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> val_reduce val_mkIF agree_Cons map_of_eq_None_iff keys_is_none_rep
           <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> agreeDT agreeDF <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>   

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Reduced If-Expressions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹An expression reduced iff no variable appears twice on any branch and there is no subexpression <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"IF <span class="free"><span class="free">x</span></span> <span class="free"><span class="free">t</span></span> <span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">reduced</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ifex <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">reduced</span> <span class="main">(</span>IF <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">∧</span> <span class="free">reduced</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">(</span>insert <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">reduced</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">(</span>insert <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">reduced</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>

<span class="keyword1" id="Boolean_Expression_Checkers-reduced_antimono"><span class="command">lemma</span></span> reduced_antimono<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span> <span class="main">⟹</span> reduced <span class="free">t</span> <span class="free">Y</span> <span class="main">⟹</span> reduced <span class="free">t</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">Y</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">metis</span> insert_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="Boolean_Expression_Checkers-reduced_mkIF"><span class="command">lemma</span></span> reduced_mkIF<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">X</span> <span class="main">⟹</span> reduced <span class="free">t1</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> reduced <span class="free">t2</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">X</span><span class="main">)</span> <span class="main">⟹</span> reduced <span class="main">(</span>mkIF <span class="free">x</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mkIF_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>reduced_antimono<span class="main">)</span>

<span class="keyword1" id="Boolean_Expression_Checkers-reduced_reduce"><span class="command">lemma</span></span> reduced_reduce<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reduced <span class="main">(</span>reduce <span class="free">env</span> <span class="free">t</span><span class="main">)</span> <span class="main">(</span>Mapping.keys <span class="free">env</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">env</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IF <span class="skolem">x</span> <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> IF.IH<span class="main">(</span>1<span class="main">)</span> IF.IH<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_of_eq_None_iff image_iff reduced_mkIF <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_none_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> keys_is_none_rep keys_update reduced_mkIF<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Boolean_Expression_Checkers-reduced_normif"><span class="command">lemma</span></span> reduced_normif<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reduced <span class="main">(</span>normif <span class="free">env</span> <span class="free">t</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">(</span>Mapping.keys <span class="free">env</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t1</span></span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="free">env</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IF <span class="skolem">x</span> <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> IF.IH
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reduced_mkIF map_of_eq_None_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_none_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> keys_is_none_rep keys_update reduced_mkIF<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reduced_reduce<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Checkers Based on Reduced Binary Decision Trees›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The checkers are parameterized over the translation function to binary decision trees. 
  They rely on the fact that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ifex_of</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> produces reduced trees›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">taut_test</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> ifex<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">taut_test</span> <span class="free"><span class="bound"><span class="entity">ifex_of</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ifex_of</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> Trueif<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sat_test</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> ifex<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sat_test</span> <span class="free"><span class="bound"><span class="entity">ifex_of</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ifex_of</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≠</span> Falseif<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">impl_test</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> ifex<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">impl_test</span> <span class="free"><span class="bound"><span class="entity">ifex_of</span></span></span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span> <span class="main">=</span> <span class="main">(</span>normif Mapping.empty <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ifex_of</span></span></span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ifex_of</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> Trueif <span class="main">=</span> Trueif<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">equiv_test</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> ifex<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">equiv_test</span> <span class="free"><span class="bound"><span class="entity">ifex_of</span></span></span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ifex_of</span></span></span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span><span class="main">;</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ifex_of</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span> 
    <span class="keyword1">in</span> Trueif <span class="main">=</span> normif Mapping.empty <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">(</span>normif Mapping.empty <span class="bound">t2</span> Falseif Trueif<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> reduced_bdt_checkers <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">ifex_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> ifex"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">val</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    val_ifex<span class="main">:</span> <span class="quoted"><span class="quoted">"val_ifex <span class="main">(</span><span class="free">ifex_of</span> <span class="free">b</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="free">val</span> <span class="free">b</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    reduced_ifex<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced <span class="main">(</span><span class="free">ifex_of</span> <span class="free">b</span><span class="main">)</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proof that reduced if-expressions are <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Trueif<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Falseif<span class="antiquote"><span class="antiquote">}</span></span></span></span>
or can evaluate to both <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> True<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> False<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Boolean_Expression_Checkers-same_val_if_reduced"><span class="command">lemma</span></span> same_val_if_reduced<span class="main">:</span>
  <span class="quoted"><span class="quoted">"reduced <span class="free">t</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">X</span> <span class="main">⟶</span> <span class="free">s1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">s2</span> <span class="bound">x</span> <span class="main">⟹</span> val_ifex <span class="free">t</span> <span class="free">s1</span> <span class="main">=</span> val_ifex <span class="free">t</span> <span class="free">s2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Boolean_Expression_Checkers-reduced_IF_depends"><span class="command">lemma</span></span> reduced_IF_depends<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> reduced <span class="free">t</span> <span class="free">X</span><span class="main">;</span> <span class="free">t</span> <span class="main">≠</span> Trueif<span class="main">;</span> <span class="free">t</span> <span class="main">≠</span> Falseif <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> val_ifex <span class="free">t</span> <span class="bound">s1</span> <span class="main">≠</span> val_ifex <span class="free">t</span> <span class="bound">s2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">X</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IF <span class="skolem">x</span> <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"IF <span class="skolem">x</span> <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced <span class="skolem">t1</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IF.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"reduced <span class="skolem">t2</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IF.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t1</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> Trueif
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t2</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Trueif <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> IF.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Falseif
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"val_ifex <span class="var">?t</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span> <span class="main">≠</span> val_ifex <span class="var">?t</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> False<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> IF
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"val_ifex <span class="skolem">t2</span> <span class="skolem">s1</span> <span class="main">≠</span> val_ifex <span class="skolem">t2</span> <span class="skolem">s2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IF.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> IF.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"val_ifex <span class="var">?t</span> <span class="main">(</span><span class="skolem">s1</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>False<span class="main">)</span><span class="main">)</span> <span class="main">≠</span> val_ifex <span class="var">?t</span> <span class="main">(</span><span class="skolem">s2</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>False<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> same_val_if_reduced<span class="main">[</span><span class="operator">OF</span> 2<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>False<span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">s1</span></span><span class="main">]</span>
          same_val_if_reduced<span class="main">[</span><span class="operator">OF</span> 2<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>False<span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">s2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> Falseif
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t2</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Falseif <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> IF.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Trueif
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"val_ifex <span class="var">?t</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span> <span class="main">≠</span> val_ifex <span class="var">?t</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> False<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> IF
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"val_ifex <span class="skolem">t2</span> <span class="skolem">s1</span> <span class="main">≠</span> val_ifex <span class="skolem">t2</span> <span class="skolem">s2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IF.IH<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> IF.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"val_ifex <span class="var">?t</span> <span class="main">(</span><span class="skolem">s1</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>False<span class="main">)</span><span class="main">)</span> <span class="main">≠</span> val_ifex <span class="var">?t</span> <span class="main">(</span><span class="skolem">s2</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>False<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> same_val_if_reduced<span class="main">[</span><span class="operator">OF</span> 2<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>False<span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">s1</span></span><span class="main">]</span>
          same_val_if_reduced<span class="main">[</span><span class="operator">OF</span> 2<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>False<span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">s2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> IF
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"val_ifex <span class="skolem">t1</span> <span class="skolem">s1</span> <span class="main">≠</span> val_ifex <span class="skolem">t1</span> <span class="skolem">s2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IF.IH<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> IF.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"val_ifex <span class="var">?t</span> <span class="main">(</span><span class="skolem">s1</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>True<span class="main">)</span><span class="main">)</span> <span class="main">≠</span> val_ifex <span class="var">?t</span> <span class="main">(</span><span class="skolem">s2</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>True<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> same_val_if_reduced<span class="main">[</span><span class="operator">OF</span> 1<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>True<span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">s1</span></span><span class="main">]</span>
          same_val_if_reduced<span class="main">[</span><span class="operator">OF</span> 1<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>True<span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">s2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> taut_test<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"taut_test <span class="free">ifex_of</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">val</span> <span class="free">b</span> <span class="bound">s</span><span class="main">)</span>"</span></span>    
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> taut_test_def reduced_IF_depends<span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduced_ifex<span class="main"><span class="main">]</span></span> val_ifex val_ifex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> sat_test<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"sat_test <span class="free">ifex_of</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="free">val</span> <span class="free">b</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sat_test_def reduced_IF_depends<span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduced_ifex<span class="main"><span class="main">]</span></span> val_ifex val_ifex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> impl_test<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"impl_test <span class="free">ifex_of</span> <span class="free">b1</span> <span class="free">b2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">val</span> <span class="free">b1</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">val</span> <span class="free">b2</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"impl_test <span class="free">ifex_of</span> <span class="free">b1</span> <span class="free">b2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> val_ifex <span class="main">(</span>normif Mapping.empty <span class="main">(</span><span class="free">ifex_of</span> <span class="free">b1</span><span class="main">)</span> <span class="main">(</span><span class="free">ifex_of</span> <span class="free">b2</span><span class="main">)</span> Trueif<span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reduced_IF_depends<span class="main">[</span><span class="operator">OF</span> reduced_normif<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span>  <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> impl_test_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> val_ifex <span class="main">(</span>normif Mapping.empty <span class="main">(</span><span class="free">ifex_of</span> <span class="free">b1</span><span class="main">)</span> <span class="main">(</span><span class="free">ifex_of</span> <span class="free">b2</span><span class="main">)</span> Trueif<span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">val</span> <span class="free">b1</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">val</span> <span class="free">b2</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reduced_IF_depends<span class="main">[</span><span class="operator">OF</span> reduced_ifex<span class="main">]</span> val_ifex <span class="keyword1"><span class="command">unfolding</span></span> val_normif<span class="main">[</span><span class="operator">OF</span> agree_Nil<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> equiv_test<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"equiv_test <span class="free">ifex_of</span> <span class="free">b1</span> <span class="free">b2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">val</span> <span class="free">b1</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">val</span> <span class="free">b2</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"equiv_test <span class="free">ifex_of</span> <span class="free">b1</span> <span class="free">b2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> val_ifex <span class="main">(</span><span class="keyword1">let</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">ifex_of</span> <span class="free">b1</span><span class="main">;</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free">ifex_of</span> <span class="free">b2</span> <span class="keyword1">in</span> normif Mapping.empty <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">(</span>normif Mapping.empty <span class="bound">t2</span> Falseif Trueif<span class="main">)</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equiv_test_def Let_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> reduced_IF_depends<span class="main"><span class="main">[</span></span><span class="operator">OF</span> reduced_normif<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"val_ifex <span class="main">(</span><span class="keyword1">let</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">ifex_of</span> <span class="free">b1</span><span class="main">;</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free">ifex_of</span> <span class="free">b2</span> <span class="keyword1">in</span> normif Mapping.empty <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">(</span>normif Mapping.empty <span class="bound">t2</span> Falseif Trueif<span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>
      <span class="main">=</span> <span class="main">(</span><span class="free">val</span> <span class="free">b1</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">val</span> <span class="free">b2</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> val_ifex <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def val_normif<span class="main"><span class="main">[</span></span><span class="operator">OF</span> agree_Nil<span class="main"><span class="main">]</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Boolean Expressions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is the simplified interface to the tautology checker. If you have your own type of Boolean 
expressions you can either define your own translation to reduced binary decision trees or you can just 
translate into this type.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> bool_expr <span class="main">=</span>
  Const_bool_expr <span class="quoted">bool</span> <span class="main">|</span>
  Atom_bool_expr <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">|</span>
  Neg_bool_expr <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_expr"</span></span> <span class="main">|</span>
  And_bool_expr <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_expr"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_expr"</span></span> <span class="main">|</span>
  Or_bool_expr <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_expr"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_expr"</span></span> <span class="main">|</span>
  Imp_bool_expr <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_expr"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_expr"</span></span> <span class="main">|</span>
  Iff_bool_expr <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_expr"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_expr"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">val_bool_expr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_expr <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">val_bool_expr</span> <span class="main">(</span>Const_bool_expr <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">val_bool_expr</span> <span class="main">(</span>Atom_bool_expr <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">val_bool_expr</span> <span class="main">(</span>Neg_bool_expr <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">val_bool_expr</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">val_bool_expr</span> <span class="main">(</span>And_bool_expr <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">val_bool_expr</span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="free">val_bool_expr</span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">val_bool_expr</span> <span class="main">(</span>Or_bool_expr <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">val_bool_expr</span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∨</span> <span class="free">val_bool_expr</span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">val_bool_expr</span> <span class="main">(</span>Imp_bool_expr <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">val_bool_expr</span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟶</span> <span class="free">val_bool_expr</span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">val_bool_expr</span> <span class="main">(</span>Iff_bool_expr <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">val_bool_expr</span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free">val_bool_expr</span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ifex_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bool_expr <span class="main">⇒</span> <span class="tfree">'a</span> ifex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ifex_of</span> <span class="main">(</span>Const_bool_expr <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> Trueif <span class="keyword1">else</span> Falseif<span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ifex_of</span> <span class="main">(</span>Atom_bool_expr <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>   <span class="main">=</span> IF <span class="free"><span class="bound"><span class="entity">x</span></span></span> Trueif Falseif"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ifex_of</span> <span class="main">(</span>Neg_bool_expr <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>   <span class="main">=</span> normif Mapping.empty <span class="main">(</span><span class="free">ifex_of</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> Falseif Trueif"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ifex_of</span> <span class="main">(</span>And_bool_expr <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> <span class="main">=</span> normif Mapping.empty <span class="main">(</span><span class="free">ifex_of</span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">ifex_of</span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> Falseif"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ifex_of</span> <span class="main">(</span>Or_bool_expr <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> <span class="main">=</span> normif Mapping.empty <span class="main">(</span><span class="free">ifex_of</span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span><span class="main">)</span> Trueif <span class="main">(</span><span class="free">ifex_of</span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ifex_of</span> <span class="main">(</span>Imp_bool_expr <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> <span class="main">=</span> normif Mapping.empty <span class="main">(</span><span class="free">ifex_of</span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">ifex_of</span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> Trueif"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">ifex_of</span> <span class="main">(</span>Iff_bool_expr <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">t1</span> <span class="main">=</span> <span class="free">ifex_of</span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span><span class="main">;</span> <span class="bound">t2</span> <span class="main">=</span> <span class="free">ifex_of</span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span> <span class="keyword1">in</span>
   normif Mapping.empty <span class="bound">t1</span> <span class="bound">t2</span> <span class="main">(</span>normif Mapping.empty <span class="bound">t2</span> Falseif Trueif<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> val_ifex<span class="main">:</span>
  <span class="quoted"><span class="quoted">"val_ifex <span class="main">(</span>ifex_of <span class="free">b</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> val_bool_expr <span class="free">b</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> val_normif agree_Nil Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> reduced_ifex<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"reduced <span class="main">(</span>ifex_of <span class="free">b</span><span class="main">)</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> keys_empty reduced_normif<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">bool_taut_test</span> <span class="main">≡</span> taut_test ifex_of"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">bool_sat_test</span> <span class="main">≡</span> sat_test ifex_of"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">bool_impl_test</span> <span class="main">≡</span> impl_test ifex_of"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">bool_equiv_test</span> <span class="main">≡</span> equiv_test ifex_of"</span></span>

<span class="keyword1" id="Boolean_Expression_Checkers-bool_tests"><span class="command">lemma</span></span> bool_tests<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bool_taut_test <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> val_bool_expr <span class="free">b</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"bool_sat_test <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> val_bool_expr <span class="free">b</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"bool_impl_test <span class="free">b1</span> <span class="free">b2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> val_bool_expr <span class="free">b1</span> <span class="bound">s</span> <span class="main">⟶</span> val_bool_expr <span class="free">b2</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?t3</span></span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"bool_equiv_test <span class="free">b1</span> <span class="free">b2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> val_bool_expr <span class="free">b1</span> <span class="bound">s</span> <span class="main">⟷</span> val_bool_expr <span class="free">b2</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?t4</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> reduced_bdt_checkers <span class="quoted">ifex_of</span> <span class="quoted">val_bool_expr</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> val_ifex reduced_ifex<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span> <span class="var"><span class="quoted"><span class="var">?t3</span></span></span> <span class="var"><span class="quoted"><span class="var">?t4</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bool_taut_test_def bool_sat_test_def bool_impl_test_def bool_equiv_test_def taut_test sat_test impl_test equiv_test<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Boolean_Expression_Checkers_AList_Mapping">
<div class="head">
<h1>Theory Boolean_Expression_Checkers_AList_Mapping</h1>
</div>
<pre class="source"><span class="comment1">(*
  Boolean Expression Checkers Based on Binary Decision Trees
  Author: Tobias Nipkow
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Boolean_Expression_Checkers_AList_Mapping
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/AList_Mapping.html">HOL-Library.AList_Mapping</a>"</span> <a href="Boolean_Expression_Checkers.html">Boolean_Expression_Checkers</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Tweaks for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> AList_Mapping.Mapping<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
                                                       
<span class="comment1">― ‹If mappings are implemented by <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> AList_Mapping.Mapping<span class="antiquote">}</span></span>, the functions <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> reduce<span class="antiquote">}</span></span> and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> normif<span class="antiquote">}</span></span> 
    search for x twice. The following code equations remove this redundant operation›</span>

<span class="keyword1" id="Boolean_Expression_Checkers_AList_Mapping-AList_Mapping_update"><span class="command">lemma</span></span> AList_Mapping_update<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"map_of <span class="free">m</span> <span class="free">k</span> <span class="main">=</span> None <span class="main">⟹</span> Mapping.update <span class="free">k</span> <span class="free">v</span> <span class="main">(</span>AList_Mapping.Mapping <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> AList_Mapping.Mapping <span class="main">(</span><span class="main">(</span><span class="free">k</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Mapping.abs_eq map_of.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> update_Mapping update_conv'<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">reduce_alist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">*</span> bool<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> ifex <span class="main">⇒</span> <span class="tfree">'a</span> ifex"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reduce_alist</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span>IF <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> map_of <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span>
     None <span class="main">⇒</span> mkIF <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free">reduce_alist</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> True<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">reduce_alist</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> False<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="main">|</span>
     Some <span class="bound">b</span> <span class="main">⇒</span> <span class="free">reduce_alist</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">b</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">reduce_alist</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">normif_alist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">*</span> bool<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> ifex <span class="main">⇒</span> <span class="tfree">'a</span> ifex <span class="main">⇒</span> <span class="tfree">'a</span> ifex <span class="main">⇒</span> <span class="tfree">'a</span> ifex"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">normif_alist</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> Trueif <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">=</span> reduce_alist <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">normif_alist</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> Falseif <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">=</span> reduce_alist <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">normif_alist</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span>IF <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t3</span></span></span> <span class="free"><span class="bound"><span class="entity">t4</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> map_of <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span>
    None <span class="main">⇒</span> mkIF <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free">normif_alist</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> True<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t3</span></span></span> <span class="free"><span class="bound"><span class="entity">t4</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">normif_alist</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> False<span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="free"><span class="bound"><span class="entity">t3</span></span></span> <span class="free"><span class="bound"><span class="entity">t4</span></span></span><span class="main">)</span> <span class="main">|</span>
    Some <span class="bound">b</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">b</span> <span class="keyword1">then</span> <span class="free">normif_alist</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t3</span></span></span> <span class="free"><span class="bound"><span class="entity">t4</span></span></span> <span class="keyword1">else</span> <span class="free">normif_alist</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="free"><span class="bound"><span class="entity">t3</span></span></span> <span class="free"><span class="bound"><span class="entity">t4</span></span></span><span class="main">)</span>"</span></span>
   
<span class="keyword1" id="Boolean_Expression_Checkers_AList_Mapping-reduce_alist_code"><span class="command">lemma</span></span> reduce_alist_code <span class="main">[</span><span class="operator">code</span><span class="main">,</span> <span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"reduce <span class="main">(</span>AList_Mapping.Mapping <span class="free">xs</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> reduce_alist <span class="free">xs</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> AList_Mapping_update <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>  

<span class="keyword1" id="Boolean_Expression_Checkers_AList_Mapping-normif_alist_code"><span class="command">lemma</span></span> normif_alist_code <span class="main">[</span><span class="operator">code</span><span class="main">,</span> <span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"normif <span class="main">(</span>AList_Mapping.Mapping <span class="free">xs</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> normif_alist <span class="free">xs</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> AList_Mapping_update reduce_alist_code <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> empty_Mapping <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Boolean_Expression_Example">
<div class="head">
<h1>Theory Boolean_Expression_Example</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Boolean_Expression_Example
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Boolean_Expression_Checkers.html">Boolean_Expression_Checkers</a> <a href="Boolean_Expression_Checkers_AList_Mapping.html">Boolean_Expression_Checkers_AList_Mapping</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Example›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Example usage of checkers. We have our own type of Boolean expressions with its own evaluation function:›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> bexp <span class="main">=</span>
  Const <span class="quoted">bool</span> <span class="main">|</span>
  Atom <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">|</span>
  Neg <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bexp"</span></span> <span class="main">|</span>
  And <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bexp"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bexp"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bval</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bval</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">bval</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">bval</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">bval</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">bval</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">bval</span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="free">bval</span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Indirect Translation using the Boolean Expression Interface›</span></span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we translate into <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">datatype</span></span> bool_expr<span class="antiquote"><span class="antiquote">}</span></span></span></span> provided by the checkers interface and show that the 
  semantics remains the same:›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bool_expr_of_bexp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bexp <span class="main">⇒</span> <span class="tfree">'a</span> bool_expr"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bool_expr_of_bexp</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> Const_bool_expr <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bool_expr_of_bexp</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> Atom_bool_expr <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bool_expr_of_bexp</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> Neg_bool_expr<span class="main">(</span><span class="free">bool_expr_of_bexp</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bool_expr_of_bexp</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> <span class="main">=</span> And_bool_expr <span class="main">(</span><span class="free">bool_expr_of_bexp</span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">bool_expr_of_bexp</span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Boolean_Expression_Example-val_preservation"><span class="command">lemma</span></span> val_preservation<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"val_bool_expr <span class="main">(</span>bool_expr_of_bexp <span class="free">b</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> bval <span class="free">b</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">my_taut_test_bool</span> <span class="main">=</span> bool_taut_test <span class="keyword1">o</span> bool_expr_of_bexp"</span></span>

<span class="keyword1"><span class="command">corollary</span></span> my_taut_test<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"my_taut_test_bool <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> bval <span class="free">b</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> my_taut_test_bool_def val_preservation bool_tests<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Direct Translation into Reduced Binary Decision Trees›</span></span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we translate into a reduced binary decision tree, show that the semantics remains the same and 
  the tree is reduced:›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ifex_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bexp <span class="main">⇒</span> <span class="tfree">'a</span> ifex"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ifex_of</span> <span class="main">(</span>Const <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> Trueif <span class="keyword1">else</span> Falseif<span class="main">)</span>"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ifex_of</span> <span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> IF <span class="free"><span class="bound"><span class="entity">a</span></span></span> Trueif Falseif"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ifex_of</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>   <span class="main">=</span> normif Mapping.empty <span class="main">(</span><span class="free">ifex_of</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> Falseif Trueif"</span></span> 
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ifex_of</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> <span class="main">=</span> normif Mapping.empty <span class="main">(</span><span class="free">ifex_of</span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">ifex_of</span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span> Falseif"</span></span>

<span class="keyword1" id="Boolean_Expression_Example-val_ifex"><span class="command">lemma</span></span> val_ifex<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"val_ifex <span class="main">(</span>ifex_of <span class="free">b</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> bval <span class="free">b</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> agree_Nil val_normif<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> reduced_ifex<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"reduced <span class="main">(</span>ifex_of <span class="free">b</span><span class="main">)</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> keys_empty reduced_normif<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">my_taut_test_ifex</span> <span class="main">=</span> taut_test ifex_of"</span></span>

<span class="keyword1"><span class="command">corollary</span></span> my_taut_test_ifex<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"my_taut_test_ifex <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> bval <span class="free">b</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> reduced_bdt_checkers <span class="quoted">ifex_of</span> <span class="quoted">bval</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">insert</span> val_ifex reduced_ifex<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> my_taut_test_ifex_def taut_test<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Test: Pigeonhole Formulas›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Or</span> <span class="free"><span class="bound"><span class="entity">b1</span></span></span> <span class="free"><span class="bound"><span class="entity">b2</span></span></span> <span class="main">==</span> Neg <span class="main">(</span>And <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">b1</span></span></span><span class="main">)</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">b2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ors</span> <span class="main">=</span> foldl Or <span class="main">(</span>Const False<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ands</span> <span class="main">=</span> foldl And <span class="main">(</span>Const True<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">pc</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> ands<span class="main">[</span>ors<span class="main">[</span>Atom<span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> j <span class="main">&lt;-</span> <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">]</span><span class="main">]</span><span class="main">.</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">nc</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> ands<span class="main">[</span>Or <span class="main">(</span>Neg<span class="main">(</span>Atom<span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Neg<span class="main">(</span>Atom<span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> k <span class="main">&lt;-</span> <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">]</span><span class="main">,</span> i <span class="main">&lt;-</span> <span class="main">[</span><span class="main">1</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">]</span><span class="main">,</span> j <span class="main">&lt;-</span> <span class="main">[</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="numeral">2</span><span class="main">]</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">php</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> Neg<span class="main">(</span>And <span class="main">(</span>pc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>nc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Takes about 5 secs each; with 7 instead of 6 it takes about 4 mins (2015).›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"my_taut_test_bool <span class="main">(</span>php <span class="numeral">6</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"my_taut_test_ifex <span class="main">(</span>php <span class="numeral">6</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> 

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>