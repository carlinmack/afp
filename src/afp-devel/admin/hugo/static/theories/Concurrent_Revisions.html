<div id="Data">
<div class="head"><h1>Theory Data</h1>
<span class="command">theory</span> <span class="name">Data</span><br/>
<span class="keyword">imports</span> <a href="../../HOL/HOL/Main.html"><span class="name">Main</span></a><br/>
</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Data›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹This theory defines the data types and notations, and some preliminary results about them.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>Data</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>Main</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Function notations›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>ε</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'a ⇀ 'b"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ε ≡ λx. None"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>combine</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('a ⇀ 'b) ⇒ ('a  ⇀ 'b) ⇒ ('a ⇀ 'b)"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"_;;_"</span></span></span><span> </span><span>20</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"(f ;; g) x = (if g x = None then f x else g x)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dom_combination_dom_union</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"dom (τ;;τ') = dom τ ∪ dom τ'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Values, expressions and execution contexts›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">datatype</span></span><span> </span><span>const</span><span> </span><span class="delimiter">=</span><span> </span><span>Unit</span><span> </span><span class="delimiter">|</span><span> </span><span>F</span><span> </span><span class="delimiter">|</span><span> </span><span>T</span><span>
</span><span>
</span><span class="keyword1"><span class="command">datatype</span></span><span> </span><span class="delimiter">(</span><span>RID<span class="hidden">⇩</span><sub>V</sub></span><span class="delimiter">:</span><span> </span><span class="tfree">'r</span><span class="delimiter">,</span><span> </span><span>LID<span class="hidden">⇩</span><sub>V</sub></span><span class="delimiter">:</span><span> </span><span class="tfree">'l</span><span class="delimiter">,</span><span class="tfree">'v</span><span class="delimiter">)</span><span> </span><span>val</span><span> </span><span class="delimiter">=</span><span> 
</span><span>  </span><span>CV</span><span> </span><span>const</span><span>
</span><span class="delimiter">|</span><span> </span><span>Var</span><span> </span><span class="tfree">'v</span><span>
</span><span class="delimiter">|</span><span> </span><span>Loc</span><span> </span><span class="tfree">'l</span><span>
</span><span class="delimiter">|</span><span> </span><span>Rid</span><span> </span><span class="tfree">'r</span><span>
</span><span class="delimiter">|</span><span> </span><span>Lambda</span><span> </span><span class="tfree">'v</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="delimiter">(</span><span>RID<span class="hidden">⇩</span><sub>E</sub></span><span class="delimiter">:</span><span> </span><span class="tfree">'r</span><span class="delimiter">,</span><span> </span><span>LID<span class="hidden">⇩</span><sub>E</sub></span><span class="delimiter">:</span><span> </span><span class="tfree">'l</span><span class="delimiter">,</span><span class="tfree">'v</span><span class="delimiter">)</span><span> </span><span>expr</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>VE</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) val"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>Apply</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>Ite</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>Ref</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>Read</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>Assign</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>Rfork</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>Rjoin</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">datatype</span></span><span> </span><span class="delimiter">(</span><span>RID<span class="hidden">⇩</span><sub>C</sub></span><span class="delimiter">:</span><span> </span><span class="tfree">'r</span><span class="delimiter">,</span><span> </span><span>LID<span class="hidden">⇩</span><sub>C</sub></span><span class="delimiter">:</span><span> </span><span class="tfree">'l</span><span class="delimiter">,</span><span class="tfree">'v</span><span class="delimiter">)</span><span> </span><span>cntxt</span><span> </span><span class="delimiter">=</span><span> 
</span><span>  </span><span>Hole</span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"□"</span></span></span><span class="delimiter">)</span><span>
</span><span class="delimiter">|</span><span> </span><span>ApplyL<span class="hidden">⇩</span><sub>ℰ</sub></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) cntxt"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span> 
</span><span class="delimiter">|</span><span> </span><span>ApplyR<span class="hidden">⇩</span><sub>ℰ</sub></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) val"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) cntxt"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>Ite<span class="hidden">⇩</span><sub>ℰ</sub></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) cntxt"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>Ref<span class="hidden">⇩</span><sub>ℰ</sub></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) cntxt"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>Read<span class="hidden">⇩</span><sub>ℰ</sub></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) cntxt"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>AssignL<span class="hidden">⇩</span><sub>ℰ</sub></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) cntxt"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>AssignR<span class="hidden">⇩</span><sub>ℰ</sub></span><span> </span><span class="tfree">'l</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) cntxt"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>Rjoin<span class="hidden">⇩</span><sub>ℰ</sub></span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) cntxt"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Plugging and decomposing›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>plug</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) cntxt ⇒ ('r,'l,'v) expr ⇒ ('r,'l,'v) expr"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">infix</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"⊲"</span></span></span><span> </span><span>60</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"□ ⊲ e = e"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"ApplyL<span class="hidden">⇩</span><sub>ℰ</sub> ℰ e1 ⊲ e = Apply (ℰ ⊲ e) e1"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"ApplyR<span class="hidden">⇩</span><sub>ℰ</sub> val ℰ ⊲ e = Apply (VE val) (ℰ ⊲ e)"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"Ite<span class="hidden">⇩</span><sub>ℰ</sub> ℰ e1 e2 ⊲ e = Ite (ℰ ⊲ e) e1 e2"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"Ref<span class="hidden">⇩</span><sub>ℰ</sub> ℰ ⊲ e = Ref (ℰ ⊲ e)"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"Read<span class="hidden">⇩</span><sub>ℰ</sub> ℰ ⊲ e = Read (ℰ ⊲ e)"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"AssignL<span class="hidden">⇩</span><sub>ℰ</sub> ℰ e1 ⊲ e = Assign (ℰ ⊲ e) e1"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"AssignR<span class="hidden">⇩</span><sub>ℰ</sub> l ℰ ⊲ e = Assign (VE (Loc l)) (ℰ ⊲ e)"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"Rjoin<span class="hidden">⇩</span><sub>ℰ</sub> ℰ ⊲ e = Rjoin (ℰ ⊲ e)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">translations</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℰ[x]"</span></span></span><span> </span><span class="delimiter">⇌</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℰ ⊲ x"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>injective_cntxt</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(ℰ[e1] = ℰ[e2]) = (e1 = e2)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induction</span><span> </span><span>ℰ</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>VE_empty_cntxt</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(VE v = ℰ[e]) = (ℰ = □ ∧ VE v = e)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>ℰ</span><span class="delimiter">,</span><span> </span><span>auto</span><span class="delimiter">)</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>redex</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>app</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex (Apply (VE (Lambda x e)) (VE v))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>iteTrue</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex (Ite (VE (CV T)) e1 e2)"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>iteFalse</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex (Ite (VE (CV F)) e1 e2)"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>ref</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex (Ref (VE v))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>read</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex (Read (VE (Loc l)))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>assign</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex (Assign (VE (Loc l)) (VE v))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>rfork</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex (Rfork e)"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>rjoin</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex (Rjoin (VE (Rid r)))"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive_simps</span></span><span> </span><span>redex_simps</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex e"</span></span></span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>redexE</span><span> </span><span class="delimiter">[</span><span>elim</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex e"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>plugged_redex_not_val</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex r ⟹ (ℰ ⊲ r) ≠ (VE t)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>ℰ</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>decompose</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr ⇒ ('r,'l,'v) cntxt ⇒ ('r,'l,'v) expr ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>top_redex</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex e ⟹ decompose e □ e"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>lapply</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ ¬redex (Apply e<span class="hidden">⇩</span><sub>1</sub> e<span class="hidden">⇩</span><sub>2</sub>); decompose e<span class="hidden">⇩</span><sub>1</sub> ℰ r ⟧ ⟹ decompose (Apply e<span class="hidden">⇩</span><sub>1</sub> e<span class="hidden">⇩</span><sub>2</sub>) (ApplyL<span class="hidden">⇩</span><sub>ℰ</sub> ℰ e<span class="hidden">⇩</span><sub>2</sub>) r"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>rapply</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ ¬redex (Apply (VE v) e); decompose e ℰ r ⟧ ⟹ decompose (Apply (VE v) e) (ApplyR<span class="hidden">⇩</span><sub>ℰ</sub> v ℰ) r"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>ite</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ ¬redex (Ite e<span class="hidden">⇩</span><sub>1</sub> e<span class="hidden">⇩</span><sub>2</sub> e<span class="hidden">⇩</span><sub>3</sub>); decompose e<span class="hidden">⇩</span><sub>1</sub> ℰ r ⟧ ⟹ decompose (Ite e<span class="hidden">⇩</span><sub>1</sub> e<span class="hidden">⇩</span><sub>2</sub> e<span class="hidden">⇩</span><sub>3</sub>) (Ite<span class="hidden">⇩</span><sub>ℰ</sub> ℰ e<span class="hidden">⇩</span><sub>2</sub> e<span class="hidden">⇩</span><sub>3</sub>) r"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>ref</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ ¬redex (Ref e); decompose e ℰ r ⟧ ⟹ decompose (Ref e) (Ref<span class="hidden">⇩</span><sub>ℰ</sub> ℰ) r"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>read</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ ¬redex (Read e); decompose e ℰ r ⟧ ⟹ decompose (Read e) (Read<span class="hidden">⇩</span><sub>ℰ</sub> ℰ) r"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>lassign</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ ¬redex (Assign e<span class="hidden">⇩</span><sub>1</sub> e<span class="hidden">⇩</span><sub>2</sub>); decompose e<span class="hidden">⇩</span><sub>1</sub> ℰ r ⟧ ⟹ decompose (Assign e<span class="hidden">⇩</span><sub>1</sub> e<span class="hidden">⇩</span><sub>2</sub>) (AssignL<span class="hidden">⇩</span><sub>ℰ</sub> ℰ e<span class="hidden">⇩</span><sub>2</sub>) r"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>rassign</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ ¬redex (Assign (VE (Loc l)) e<span class="hidden">⇩</span><sub>2</sub>); decompose e<span class="hidden">⇩</span><sub>2</sub> ℰ r ⟧ ⟹ decompose (Assign (VE (Loc l)) e<span class="hidden">⇩</span><sub>2</sub>) (AssignR<span class="hidden">⇩</span><sub>ℰ</sub> l ℰ) r"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>rjoin</span><span class="delimiter">:</span><span>  </span><span class="string"><span class="delete"><span class="delete">"⟦ ¬redex (Rjoin e); decompose e ℰ r ⟧ ⟹ decompose (Rjoin e) (Rjoin<span class="hidden">⇩</span><sub>ℰ</sub> ℰ) r"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>decomposeE</span><span> </span><span class="delimiter">[</span><span>elim</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"decompose e ℰ r"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>plug_decomposition_equivalence</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex r ⟹ decompose e ℰ r = (ℰ[r] = e)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>x</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"decompose e ℰ r"</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ℰ[r] = e"</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>x</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹induct rule: decompose.induct›</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>top_redex</span><span> </span><span>e</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"□[e] = e"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>lapply</span><span> </span><span>e<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>e<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>ℰ</span><span> </span><span>r</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(ApplyL<span class="hidden">⇩</span><sub>ℰ</sub> ℰ e<span class="hidden">⇩</span><sub>2</sub>) [r] = Apply (ℰ[r]) e<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = Apply e<span class="hidden">⇩</span><sub>1</sub> e<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹ℰ[r] = e<span class="hidden">⇩</span><sub>1</sub>›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>red</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex r"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℰ[r] = e"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"decompose (ℰ[r]) ℰ r"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>ℰ</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>red</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto intro: decompose.intros›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"decompose e ℰ r"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eq</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>unique_decomposition</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"decompose e ℰ<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>1</sub> ⟹ decompose e ℰ<span class="hidden">⇩</span><sub>2</sub> r<span class="hidden">⇩</span><sub>2</sub> ⟹ ℰ<span class="hidden">⇩</span><sub>1</sub> = ℰ<span class="hidden">⇩</span><sub>2</sub> ∧ r<span class="hidden">⇩</span><sub>1</sub> = r<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>ℰ<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>decompose.induct</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>completion_eq</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>red_e</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex r"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>red_e'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"redex r'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(ℰ[r] = ℰ'[r']) = (ℰ = ℰ' ∧ r = r')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ℰ[r] = ℰ'[r'] ⟹ ℰ = ℰ' ∧ r = r'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>conjI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℰ[r] = ℰ'[r']"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"decompose (ℰ[r]) ℰ r"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>plug_decomposition_equivalence</span><span> </span><span>red_e</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>fst_decomp</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">"decompose (ℰ'[r']) ℰ r"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eq</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>snd_decomp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"decompose (ℰ'[r']) ℰ' r'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>plug_decomposition_equivalence</span><span> </span><span>red_e'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>cntxts_eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℰ = ℰ'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_decomp</span><span> </span><span>snd_decomp</span><span> </span><span>unique_decomposition</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r = r'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cntxts_eq</span><span> </span><span>eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Stores and states›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="delimiter">(</span><span class="tfree">'r</span><span class="delimiter">,</span><span class="tfree">'l</span><span class="delimiter">,</span><span class="tfree">'v</span><span class="delimiter">)</span><span> </span><span>store</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"'l ⇀ ('r,'l,'v) val"</span></span></span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="delimiter">(</span><span class="tfree">'r</span><span class="delimiter">,</span><span class="tfree">'l</span><span class="delimiter">,</span><span class="tfree">'v</span><span class="delimiter">)</span><span> </span><span>local_state</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) store × ('r,'l,'v) store × ('r,'l,'v) expr"</span></span></span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="delimiter">(</span><span class="tfree">'r</span><span class="delimiter">,</span><span class="tfree">'l</span><span class="delimiter">,</span><span class="tfree">'v</span><span class="delimiter">)</span><span> </span><span>global_state</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"'r ⇀ ('r,'l,'v) local_state"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>doms</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) local_state ⇒ 'l set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"doms (σ,τ,e) = dom σ ∪ dom τ"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>LID_snapshot</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) local_state ⇒ ('r,'l,'v) store"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"_<span class="hidden">⇩</span><sub>σ</sub>"</span></span></span><span> </span><span>200</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"LID_snapshot (σ,τ,e) = σ"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>LID_local_store</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) local_state ⇒ ('r,'l,'v) store"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"_<span class="hidden">⇩</span><sub>τ</sub>"</span></span></span><span> </span><span>200</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"LID_local_store (σ,τ,e) = τ"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>LID_expression</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) local_state ⇒ ('r,'l,'v) expr"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"_<span class="hidden">⇩</span><sub>e</sub>"</span></span></span><span> </span><span>200</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"LID_expression (σ,τ,e) = e"</span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>
</div>
</div><div id="Occurrences">
<div class="head"><h1>Theory Occurrences</h1>
<span class="command">theory</span> <span class="name">Occurrences</span><br/>
<span class="keyword">imports</span> <a href="Data.html"><span class="name">Data</span></a><br/>
</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span> </span><span>Occurrences</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹This theory contains all of the definitions and laws required for reasoning about
  identifiers that occur in the data structures of the concurrent revisions model.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>Occurrences</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>Data</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span>Definitions</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Revision identifiers›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>RID<span class="hidden">⇩</span><sub>S</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) store ⇒ 'r set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>S</sub> σ ≡ ⋃ (RID<span class="hidden">⇩</span><sub>V</sub> ` ran σ)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>RID<span class="hidden">⇩</span><sub>L</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) local_state ⇒ 'r set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>L</sub> s ≡ case s of (σ, τ, e) ⇒ RID<span class="hidden">⇩</span><sub>S</sub> σ ∪ RID<span class="hidden">⇩</span><sub>S</sub> τ ∪ RID<span class="hidden">⇩</span><sub>E</sub> e"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) global_state ⇒ 'r set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>G</sub> s ≡ dom s ∪ ⋃ (RID<span class="hidden">⇩</span><sub>L</sub> ` ran s)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Location identifiers›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) store ⇒ 'l set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> σ ≡ dom σ ∪ ⋃ (LID<span class="hidden">⇩</span><sub>V</sub> ` ran σ)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>LID<span class="hidden">⇩</span><sub>L</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) local_state ⇒ 'l set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>L</sub> s ≡ case s of (σ, τ, e) ⇒ LID<span class="hidden">⇩</span><sub>S</sub> σ ∪ LID<span class="hidden">⇩</span><sub>S</sub> τ ∪ LID<span class="hidden">⇩</span><sub>E</sub> e"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>LID<span class="hidden">⇩</span><sub>G</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) global_state ⇒ 'l set"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>G</sub> s ≡ ⋃ (LID<span class="hidden">⇩</span><sub>L</sub> ` ran s)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Inference rules›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Introduction and elimination rules›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>RID<span class="hidden">⇩</span><sub>S</sub>I</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"σ l = Some v ⟹ r ∈ RID<span class="hidden">⇩</span><sub>V</sub> v ⟹ r ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>RID<span class="hidden">⇩</span><sub>S</sub>_def</span><span> </span><span>ran_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>RID<span class="hidden">⇩</span><sub>S</sub>E</span><span> </span><span class="delimiter">[</span><span>elim</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ ⟹ (⋀l v. σ l = Some v ⟹ r ∈ RID<span class="hidden">⇩</span><sub>V</sub> v ⟹ P) ⟹ P"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>RID<span class="hidden">⇩</span><sub>S</sub>_def</span><span> </span><span>ran_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>RID<span class="hidden">⇩</span><sub>L</sub>I</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">,</span><span> </span><span>consumes</span><span> </span><span>1</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s = (σ, τ, e)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ ⟹ r ∈ RID<span class="hidden">⇩</span><sub>L</sub> s"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> τ ⟹ r ∈ RID<span class="hidden">⇩</span><sub>L</sub> s"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>E</sub> e ⟹ r ∈ RID<span class="hidden">⇩</span><sub>L</sub> s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>RID<span class="hidden">⇩</span><sub>L</sub>_def</span><span> </span><span>assms</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>RID<span class="hidden">⇩</span><sub>L</sub>E</span><span> </span><span class="delimiter">[</span><span>elim</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"⟦ r ∈ RID<span class="hidden">⇩</span><sub>L</sub> s; (⋀σ τ e. s = (σ, τ, e) ⟹ (r ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ ⟹ P) ⟹ (r ∈ RID<span class="hidden">⇩</span><sub>S</sub> τ ⟹ P) ⟹ (r ∈ RID<span class="hidden">⇩</span><sub>E</sub> e ⟹ P) ⟹ P) ⟹ P ⟧ ⟹ P"</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>s</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>RID<span class="hidden">⇩</span><sub>L</sub>_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>I</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"s r = Some v ⟹ r ∈ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"s r' = Some ls ⟹ r ∈ RID<span class="hidden">⇩</span><sub>L</sub> ls ⟹ r ∈ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>_def</span><span> </span><span>domI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>_def</span><span> </span><span>UN_I</span><span> </span><span>UnI2</span><span> </span><span>ranI</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>E</span><span> </span><span class="delimiter">[</span><span>elim</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ∈ dom s ⟹ P"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"⋀r' ls. s r' = Some ls ⟹ r ∈ RID<span class="hidden">⇩</span><sub>L</sub> ls ⟹ P"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span>P</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>_def</span><span> </span><span>ran_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>I</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"σ l = Some v ⟹ l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"σ l' = Some v ⟹ l ∈ LID<span class="hidden">⇩</span><sub>V</sub> v ⟹ l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>_def</span><span> </span><span>ran_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>E</span><span> </span><span class="delimiter">[</span><span>elim</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom σ ⟹ P"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"⋀l' v. σ l' = Some v ⟹ l ∈ LID<span class="hidden">⇩</span><sub>V</sub> v ⟹ P"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span>P</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>_def</span><span> </span><span>ran_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>LID<span class="hidden">⇩</span><sub>L</sub>I</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s = (σ, τ, e)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ ⟹ r ∈ LID<span class="hidden">⇩</span><sub>L</sub> s"</span></span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ∈ LID<span class="hidden">⇩</span><sub>S</sub> τ ⟹ r ∈ LID<span class="hidden">⇩</span><sub>L</sub> s"</span></span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ∈ LID<span class="hidden">⇩</span><sub>E</sub> e ⟹ r ∈ LID<span class="hidden">⇩</span><sub>L</sub> s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>LID<span class="hidden">⇩</span><sub>L</sub>_def</span><span> </span><span>assms</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>LID<span class="hidden">⇩</span><sub>L</sub>E</span><span> </span><span class="delimiter">[</span><span>elim</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"⟦ l ∈ LID<span class="hidden">⇩</span><sub>L</sub> s; (⋀σ τ e. s = (σ, τ, e) ⟹ (l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ ⟹ P) ⟹ (l ∈ LID<span class="hidden">⇩</span><sub>S</sub> τ ⟹ P) ⟹ (l ∈ LID<span class="hidden">⇩</span><sub>E</sub> e ⟹ P) ⟹ P) ⟹ P ⟧ ⟹ P"</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>s</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>LID<span class="hidden">⇩</span><sub>L</sub>_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>LID<span class="hidden">⇩</span><sub>G</sub>I</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some ls ⟹ l ∈ LID<span class="hidden">⇩</span><sub>L</sub> ls ⟹ l ∈ LID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>LID<span class="hidden">⇩</span><sub>G</sub>_def</span><span> </span><span>LID<span class="hidden">⇩</span><sub>L</sub>_def</span><span> </span><span>ran_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>LID<span class="hidden">⇩</span><sub>G</sub>E</span><span> </span><span class="delimiter">[</span><span>elim</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> s ⟹ (⋀r ls. s r = Some ls ⟹ l ∈ LID<span class="hidden">⇩</span><sub>L</sub> ls ⟹ P) ⟹ P"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>LID<span class="hidden">⇩</span><sub>G</sub>_def</span><span> </span><span>ran_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Distributive laws›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ID_distr_completion</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>E</sub> (ℰ[e]) = RID<span class="hidden">⇩</span><sub>C</sub> ℰ ∪ RID<span class="hidden">⇩</span><sub>E</sub> e"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>E</sub> (ℰ[e]) = LID<span class="hidden">⇩</span><sub>C</sub> ℰ ∪ LID<span class="hidden">⇩</span><sub>E</sub> e"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>plug.induct</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ID_restricted_store_subset_store</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>S</sub> (σ(l := None)) ⊆ RID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (σ(l := None)) ⊆ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>S</sub> (σ(l := None)) ⊆ RID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsetI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>r</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (σ(l := None))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>l'</span><span> </span><span>v</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(σ(l := None)) l' = Some v"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>r_v</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ≠ l"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹(σ(l := None)) l' = Some v›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"σ l' = Some v"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹(σ(l := None)) l' = Some v›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r_v</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (σ(l := None)) ⊆ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsetI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l'</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> (σ(l := None))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ dom (σ(l := None)) ∨ (∃l'' v. (σ(l := None)) l'' = Some v ∧ l' ∈ LID<span class="hidden">⇩</span><sub>V</sub> v)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>disjE</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ dom (σ(l := None))"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∃l'' v. (σ(l := None)) l'' = Some v ∧ l' ∈ LID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>l''</span><span> </span><span>v</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(σ(l := None)) l'' = Some v"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>l'_in_v</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"σ l'' = Some v"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"l = l''"</span></span></span><span class="delimiter">,</span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l'_in_v</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>in_restricted_store_in_unrestricted_store</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (σ(l := None)) ⟹ r ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> (σ(l := None)) ⟹ l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>contra_subsetD</span><span> </span><span>ID_restricted_store_subset_store</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>in_restricted_store_in_updated_store</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (σ(l := None)) ⟹ r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (σ(l ↦ v))"</span></span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> (σ(l := None)) ⟹ l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> (σ(l ↦ v))"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (σ(l := None))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (σ |` (- {l}))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>restrict_complement_singleton_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (σ(l ↦ v) |` (- {l}))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (σ(l := Some v, l := None))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>restrict_complement_singleton_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (σ(l ↦ v))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> (σ(l := None))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> (σ |` (- {l}))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>restrict_complement_singleton_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> (σ(l ↦ v) |` (- {l}))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> (σ(l := Some v, l := None))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>restrict_complement_singleton_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> (σ(l ↦ v))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ID_distr_store</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>S</sub> (τ(l ↦ v)) = RID<span class="hidden">⇩</span><sub>S</sub> (τ(l := None)) ∪ RID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (τ(l ↦ v)) = insert l (LID<span class="hidden">⇩</span><sub>S</sub> (τ(l := None)) ∪ LID<span class="hidden">⇩</span><sub>V</sub> v)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>S</sub> (τ(l ↦ v)) = RID<span class="hidden">⇩</span><sub>S</sub> (τ(l := None)) ∪ RID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>set_eqI</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>r</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (τ(l ↦ v))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>l'</span><span> </span><span>v'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(τ(l ↦ v)) l' = Some v'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>V</sub> v'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (τ(l := None)) ∪ RID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"l' = l"</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (τ(l ↦ v)) = insert l (LID<span class="hidden">⇩</span><sub>S</sub> (τ(l := None)) ∪ LID<span class="hidden">⇩</span><sub>V</sub> v)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>set_eqI</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l'</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> (τ(l ↦ v))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ dom (τ(l ↦ v)) ∨ (∃l'' v'. (τ(l ↦ v)) l'' = Some v' ∧ l' ∈ LID<span class="hidden">⇩</span><sub>V</sub> v')"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ insert l (LID<span class="hidden">⇩</span><sub>S</sub> (τ(l := None)) ∪ LID<span class="hidden">⇩</span><sub>V</sub> v)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>disjE</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ dom (τ(l ↦ v))"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ insert l (LID<span class="hidden">⇩</span><sub>S</sub> (τ(l := None)) ∪ LID<span class="hidden">⇩</span><sub>V</sub> v)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"l' = l"</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∃l'' v'. (τ(l ↦ v)) l'' = Some v' ∧ l' ∈ LID<span class="hidden">⇩</span><sub>V</sub> v'"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>l''</span><span> </span><span>v'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(τ(l ↦ v)) l'' = Some v'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>V</sub> v'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ insert l (LID<span class="hidden">⇩</span><sub>S</sub> (τ(l := None)) ∪ LID<span class="hidden">⇩</span><sub>V</sub> v)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"l = l''"</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ID_distr_local</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>L</sub> (σ,τ,e) = LID<span class="hidden">⇩</span><sub>S</sub> σ ∪ LID<span class="hidden">⇩</span><sub>S</sub> τ ∪ LID<span class="hidden">⇩</span><sub>E</sub> e"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>L</sub> (σ,τ,e) = RID<span class="hidden">⇩</span><sub>S</sub> σ ∪ RID<span class="hidden">⇩</span><sub>S</sub> τ ∪ RID<span class="hidden">⇩</span><sub>E</sub> e"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>LID<span class="hidden">⇩</span><sub>L</sub>_def</span><span> </span><span>RID<span class="hidden">⇩</span><sub>L</sub>_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ID_restricted_global_subset_unrestricted</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ⊆ LID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ⊆ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ⊆ LID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsetI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>r''</span><span> </span><span>ls</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(s(r := None)) r'' = Some ls"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>l_in_ls</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ≠ r "</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹(s(r := None)) r'' = Some ls›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s r'' = Some ls"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹(s(r := None)) r'' = Some ls›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_in_ls</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ⊆ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsetI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>r'</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ dom (s(r := None)) ∨ (∃r'' ls. (s(r := None)) r'' = Some ls ∧ r' ∈ RID<span class="hidden">⇩</span><sub>L</sub> ls)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>disjE</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∃r'' ls. (s(r := None)) r'' = Some ls ∧ r' ∈ RID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>r''</span><span> </span><span>ls</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(s(r := None)) r'' = Some ls"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>r'_in_ls</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>neq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ≠ r"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹(s(r := None)) r'' = Some ls›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s r'' = Some ls"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹(s(r := None)) r'' = Some ls›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r'_in_ls</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>in_restricted_global_in_unrestricted_global</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ⟹ r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ⟹ l ∈ LID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ID_restricted_global_subset_unrestricted</span><span> </span><span>rev_subsetD</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>in_restricted_global_in_updated_global</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ⟹ r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls))"</span></span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ⟹ l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls))"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> (s |` (- {r}))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>restrict_complement_singleton_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls) |` (- {r}))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> (s(r := Some ls, r := None))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>restrict_complement_singleton_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (s |` (- {r}))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>restrict_complement_singleton_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls) |` (- {r}))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (s(r := Some ls, r := None))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>restrict_complement_singleton_eq</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ID_distr_global</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls)) = insert r (RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ∪ RID<span class="hidden">⇩</span><sub>L</sub> ls)"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls)) = LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ∪ LID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls)) = LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ∪ LID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>set_eqI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls))) = (l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ∪ LID<span class="hidden">⇩</span><sub>L</sub> ls)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>r'</span><span> </span><span>ls'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(s(r ↦ ls)) r' = Some ls'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>L</sub> ls'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ∪ LID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"r = r'"</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls)) = insert r (RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ∪ RID<span class="hidden">⇩</span><sub>L</sub> ls)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>set_eqI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>r'</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls))) = (r' ∈ insert r (RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ∪ RID<span class="hidden">⇩</span><sub>L</sub> ls))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">,</span><span> </span><span>clarsimp</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r'_g</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ ls))"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>neq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ≠ r"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>r'_l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∉ RID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>E</span><span class="delimiter">[</span><span>OF</span><span> </span><span>r'_g</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ dom (s(r ↦ ls))"</span></span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>_def</span><span> </span><span>neq</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>ls'</span><span> </span><span>r''</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r'_in_range</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">"(s(r ↦ ls)) r'' = Some ls'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>L</sub> ls'"</span></span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' = r"</span></span></span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>neq</span><span> </span><span>r'_l</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>restrictions_inwards</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"x ≠ x' ⟹ f(x := Some y, x' := None) = (f(x':= None, x := Some y))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>fun_upd_twist</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Miscellaneous laws›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ID_combination_subset_union</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>S</sub> (σ;;τ) ⊆ RID<span class="hidden">⇩</span><sub>S</sub> σ ∪ RID<span class="hidden">⇩</span><sub>S</sub> τ"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (σ;;τ) ⊆ LID<span class="hidden">⇩</span><sub>S</sub> σ ∪ LID<span class="hidden">⇩</span><sub>S</sub> τ"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>S</sub> (σ;;τ) ⊆ RID<span class="hidden">⇩</span><sub>S</sub> σ ∪ RID<span class="hidden">⇩</span><sub>S</sub> τ"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsetI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>r</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (σ;;τ)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>l</span><span> </span><span>v</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(σ;;τ) l = Some v"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ ∪ RID<span class="hidden">⇩</span><sub>S</sub> τ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom τ"</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (σ;;τ) ⊆ LID<span class="hidden">⇩</span><sub>S</sub> σ ∪ LID<span class="hidden">⇩</span><sub>S</sub> τ"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsetI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>S</sub> (σ;;τ)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom (σ;;τ) ∨ (∃l' v. (σ;;τ) l' = Some v ∧ l ∈ LID<span class="hidden">⇩</span><sub>V</sub> v)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ ∪ LID<span class="hidden">⇩</span><sub>S</sub> τ"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>disjE</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom (σ;;τ)"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ ∪ LID<span class="hidden">⇩</span><sub>S</sub> τ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom τ"</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∃l' v. (σ;;τ) l' = Some v ∧ l ∈ LID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>l'</span><span> </span><span>v</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(σ;;τ) l' = Some v"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ ∪ LID<span class="hidden">⇩</span><sub>S</sub> τ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ dom τ"</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>in_combination_in_component</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (σ;;τ) ⟹ r ∉ RID<span class="hidden">⇩</span><sub>S</sub> σ ⟹ r ∈ RID<span class="hidden">⇩</span><sub>S</sub> τ"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (σ;;τ) ⟹ r ∉ RID<span class="hidden">⇩</span><sub>S</sub> τ ⟹ r ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>S</sub> (σ;;τ) ⟹ l ∉ LID<span class="hidden">⇩</span><sub>S</sub> σ ⟹ l ∈ LID<span class="hidden">⇩</span><sub>S</sub> τ"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>S</sub> (σ;;τ) ⟹ l ∉ LID<span class="hidden">⇩</span><sub>S</sub> τ ⟹ l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Un_iff</span><span> </span><span>ID_combination_subset_union</span><span> </span><span>subsetCE</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>in_mapped_in_component_of_combination</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>    </span><span>maps_to_v</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(σ;;τ) l = Some v"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>l'_in_v</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∈ LID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"l' ∉ LID<span class="hidden">⇩</span><sub>S</sub> τ ⟹ l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"l' ∉ LID<span class="hidden">⇩</span><sub>S</sub> σ ⟹ l' ∈ LID<span class="hidden">⇩</span><sub>S</sub> τ"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>I</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>combine.simps</span><span> </span><span>l'_in_v</span><span> </span><span>maps_to_v</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>elim_trivial_restriction</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>S</sub> τ ⟹ (τ(l := None)) = τ"</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>_def</span><span> </span><span>domIff</span><span> </span><span>fun_upd_idem</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"s r = Some ls ⟹ RID<span class="hidden">⇩</span><sub>G</sub> s = insert r (RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ∪ RID<span class="hidden">⇩</span><sub>L</sub> ls)"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"s r = Some ls ⟹ LID<span class="hidden">⇩</span><sub>G</sub> s = LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ∪ LID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some ls"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>s_as_upd</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s = (s(r ↦ ls))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>fun_upd_idem</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>G</sub> s = insert r (RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ∪ RID<span class="hidden">⇩</span><sub>L</sub> ls)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>s_as_upd</span><span class="delimiter">,</span><span> </span><span>simp</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>G</sub> s = LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ∪ LID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>s_as_upd</span><span class="delimiter">,</span><span> </span><span>simp</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>
</div>
</div><div id="Renaming">
<div class="head"><h1>Theory Renaming</h1>
<span class="command">theory</span> <span class="name">Renaming</span><br/>
<span class="keyword">imports</span> <a href="Occurrences.html"><span class="name">Occurrences</span></a><br/>
</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span> </span><span>Renaming</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Similar to the bound variables of lambda calculus, location and revision identifiers are meaningless
  names. This theory contains all of the definitions and results required for renaming data structures
  and proving renaming-equivalence.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>Renaming</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>Occurrences</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span>Definitions</span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>rename_val</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r ⇒ 'r) ⇒ ('l ⇒ 'l) ⇒ ('r,'l,'v) val ⇒ ('r,'l,'v) val"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>V</sub>"</span></span></span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>V</sub> α β v ≡ map_val α β id v"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>rename_expr</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r ⇒ 'r) ⇒ ('l ⇒ 'l) ⇒ ('r,'l,'v) expr ⇒ ('r,'l,'v) expr"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>E</sub>"</span></span></span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>E</sub> α β e ≡ map_expr α β id e"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>rename_cntxt</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r ⇒ 'r) ⇒ ('l ⇒ 'l) ⇒ ('r,'l,'v) cntxt ⇒ ('r,'l,'v) cntxt"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>C</sub>"</span></span></span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>C</sub> α β ℰ ≡ map_cntxt α β id ℰ"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>is_store_renaming</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r ⇒ 'r) ⇒ ('l ⇒ 'l) ⇒ ('r,'l,'v) store ⇒ ('r,'l,'v) store ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"is_store_renaming α β σ σ' ≡ ∀l. case σ l of None ⇒ σ' (β l) = None | Some v ⇒ σ' (β l) = Some (ℛ<span class="hidden">⇩</span><sub>V</sub> α β v)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">notation</span></span><span> </span><span>Option.bind</span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">infixl</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"⤜"</span></span></span><span> </span><span>80</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>S</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r ⇒ 'r) ⇒ ('l ⇒ 'l) ⇒ ('r,'l,'v) store ⇒ ('r,'l,'v) store"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ l = σ (inv β l) ⤜ (λv. Some (ℛ<span class="hidden">⇩</span><sub>V</sub> α β v))"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>S</sub>_implements_renaming</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij β ⟹ is_store_renaming α β σ (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"bij β"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"inj β"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bij_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>is_store_renaming_def</span><span> </span><span>option.case_eq_if</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>L</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r ⇒ 'r) ⇒ ('l ⇒ 'l) ⇒ ('r,'l,'v) local_state ⇒ ('r,'l,'v) local_state"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>L</sub> α β (σ,τ,e) = (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ, ℛ<span class="hidden">⇩</span><sub>S</sub> α β τ, ℛ<span class="hidden">⇩</span><sub>E</sub> α β e)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>is_global_renaming</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r ⇒ 'r) ⇒ ('l ⇒ 'l) ⇒ ('r,'l,'v) global_state ⇒ ('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"is_global_renaming α β s s' ≡ ∀r. case s r of None ⇒ s' (α r) = None | Some ls ⇒ s' (α r) = Some (ℛ<span class="hidden">⇩</span><sub>L</sub> α β ls)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>G</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r ⇒ 'r) ⇒ ('l ⇒ 'l) ⇒ ('r,'l,'v) global_state ⇒ ('r,'l,'v) global_state"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> α β s r = s (inv α r) ⤜ (λls. Some (ℛ<span class="hidden">⇩</span><sub>L</sub> α β ls))"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>G</sub>_implements_renaming</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij α ⟹ is_global_renaming α β s (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"bij α"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"inj α"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bij_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>is_global_renaming_def</span><span> </span><span>option.case_eq_if</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Introduction rules›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>S</sub>I</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>bij_β</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij β"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>none_case</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⋀l. σ l = None ⟹ σ' (β l) = None"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>some_case</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⋀l v. σ l = Some v ⟹ σ' (β l) = Some (ℛ<span class="hidden">⇩</span><sub>V</sub> α β v)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ = σ'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ext</span><span class="delimiter">,</span><span> </span><span>subst</span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>S</sub>.simps</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"σ (inv β l) ⤜ (λv. Some (ℛ<span class="hidden">⇩</span><sub>V</sub> α β v)) = σ' l"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?lhs = σ' l"</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"σ (inv β l) = None"</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lhs_none</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?lhs = None"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>True</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"σ' (β (inv β l)) = None"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>none_case</span><span> </span><span>True</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>rhs_none</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"σ' l = None"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_β</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_right</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lhs_none</span><span> </span><span>rhs_none</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>v</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>is_some</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"σ (inv β l) = Some v"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>lhs_some</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?lhs = Some (ℛ<span class="hidden">⇩</span><sub>V</sub> α β v)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"σ' (β (inv β l)) = Some (ℛ<span class="hidden">⇩</span><sub>V</sub> α β v)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>is_some</span><span> </span><span>some_case</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>rhs_some</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"σ' l = Some (ℛ<span class="hidden">⇩</span><sub>V</sub> α β v)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_β</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_right</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lhs_some</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>G</sub>I</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>bij_α</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij α"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>none_case</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⋀r. s r = None ⟹ s' (α r) = None"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>some_case</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⋀r σ τ e. s r = Some (σ,τ,e) ⟹ s' (α r) = Some (ℛ<span class="hidden">⇩</span><sub>L</sub> α β (σ,τ,e))"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> α β s = s'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ext</span><span class="delimiter">,</span><span> </span><span>subst</span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>G</sub>.simps</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>r</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s (inv α r) ⤜ (λls. Some (ℛ<span class="hidden">⇩</span><sub>L</sub> α β ls)) = s' r"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?lhs = s' r"</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"s (inv α r) = None"</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lhs_none</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?lhs = None"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>True</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s' (α (inv α r)) = None"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>none_case</span><span> </span><span>True</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>rhs_none</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' r = None"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_α</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_right</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lhs_none</span><span> </span><span>rhs_none</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ls</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s (inv α r) = Some ls"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>is_some</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s (inv α r) = Some (σ, τ, e)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>ls</span><span class="delimiter">)</span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>lhs_some</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?lhs = Some (ℛ<span class="hidden">⇩</span><sub>L</sub> α β (σ, τ, e))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s' (α (inv α r)) = Some (ℛ<span class="hidden">⇩</span><sub>L</sub> α β (σ, τ, e))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>is_some</span><span> </span><span>some_case</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>rhs_some</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' r = Some (ℛ<span class="hidden">⇩</span><sub>L</sub> α β (σ, τ, e))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_α</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_right</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lhs_some</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Renaming-equivalence›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span>Identity</span><span>
</span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>val.map_id</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>expr.map_id</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>cntxt.map_id</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>S</sub>_id</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> id id σ = σ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>L</sub>_id</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>L</sub> id id ls = ls"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>ls</span><span class="delimiter">)</span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>G</sub>_id</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> id id s = s"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span>Composition</span><span>
</span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>val.map_comp</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>expr.map_comp</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>cntxt.map_comp</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>S</sub>_comp</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ bij β; bij β' ⟧ ⟹ ℛ<span class="hidden">⇩</span><sub>S</sub> α' β' (ℛ<span class="hidden">⇩</span><sub>S</sub> α β s) = ℛ<span class="hidden">⇩</span><sub>S</sub> (α' ∘ α) (β' ∘ β) s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>o_inv_distrib</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>L</sub>_comp</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ bij β; bij β' ⟧ ⟹ ℛ<span class="hidden">⇩</span><sub>L</sub> α' β' (ℛ<span class="hidden">⇩</span><sub>L</sub> α β ls) = ℛ<span class="hidden">⇩</span><sub>L</sub> (α' ∘ α) (β' ∘ β) ls"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>ls</span><span class="delimiter">)</span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>G</sub>_comp</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ bij α; bij α'; bij β; bij β' ⟧ ⟹ ℛ<span class="hidden">⇩</span><sub>G</sub> α' β' (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s) = ℛ<span class="hidden">⇩</span><sub>G</sub> (α' ∘ α) (β' ∘ β) s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ext</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>o_inv_distrib</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span>Inverse</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>V</sub>_inv</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ bij α; bij β ⟧ ⟹ (ℛ<span class="hidden">⇩</span><sub>V</sub> (inv α) (inv β) v' = v) = (ℛ<span class="hidden">⇩</span><sub>V</sub> α β v = v')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_comp_right</span><span> </span><span>bijection.inv_comp_left</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>E</sub>_inv</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ bij α; bij β ⟧ ⟹ (ℛ<span class="hidden">⇩</span><sub>E</sub> (inv α) (inv β) e' = e) = (ℛ<span class="hidden">⇩</span><sub>E</sub> α β e = e')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_comp_right</span><span> </span><span>bijection.inv_comp_left</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>C</sub>_inv</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ bij α; bij β ⟧ ⟹ (ℛ<span class="hidden">⇩</span><sub>C</sub> (inv α) (inv β) ℰ' = ℰ) = (ℛ<span class="hidden">⇩</span><sub>C</sub> α β ℰ = ℰ')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_comp_right</span><span> </span><span>bijection.inv_comp_left</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>S</sub>_inv</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ bij α; bij β ⟧ ⟹ (ℛ<span class="hidden">⇩</span><sub>S</sub> (inv α) (inv β) σ' = σ) = (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ = σ')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_imp_bij_inv</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_comp_right</span><span> </span><span>bijection.inv_comp_left</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>L</sub>_inv</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ bij α; bij β ⟧ ⟹ (ℛ<span class="hidden">⇩</span><sub>L</sub> (inv α) (inv β) ls' = ls) = (ℛ<span class="hidden">⇩</span><sub>L</sub> α β ls = ls')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_imp_bij_inv</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_comp_right</span><span> </span><span>bijection.inv_comp_left</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>G</sub>_inv</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⟦ bij α; bij β ⟧ ⟹ (ℛ<span class="hidden">⇩</span><sub>G</sub> (inv α) (inv β) s' = s) = (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s = s')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_imp_bij_inv</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_comp_right</span><span> </span><span>bijection.inv_comp_left</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span>Equivalence</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>eq_states</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) global_state ⇒ ('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"_ ≈ _"</span></span></span><span> </span><span class="delimiter">[</span><span>100</span><span class="delimiter">,</span><span> </span><span>100</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"s ≈ s' ≡ ∃α β. bij α ∧ bij β ∧ ℛ<span class="hidden">⇩</span><sub>G</sub> α β s = s'"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eq_statesI</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> α β s = s' ⟹ bij α ⟹ bij β ⟹ s ≈ s'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eq_states_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eq_statesE</span><span> </span><span class="delimiter">[</span><span>elim</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"s ≈ s' ⟹ (⋀α β. ℛ<span class="hidden">⇩</span><sub>G</sub> α β s = s' ⟹ bij α ⟹ bij β ⟹ P) ⟹ P"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eq_states_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>αβ_refl</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s ≈ s"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>eq_statesI</span><span class="delimiter">[</span><span>of</span><span> </span><span>id</span><span> </span><span>id</span><span> </span><span>s</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span> 
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>αβ_trans</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s ≈ s' ⟹ s' ≈ s'' ⟹ s ≈ s''"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s ≈ s'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>α</span><span> </span><span>β</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s_s'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij α"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"bij β"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> α β s = s'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s' ≈ s''"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>α'</span><span> </span><span>β'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s'_s''</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij α'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"bij β'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> α' β' s' = s''"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s ≈ s''"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>eq_statesI</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">"α' ∘ α"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"β' ∘ β"</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>s_s'</span><span> </span><span>s'_s''</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: bij_comp›</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>αβ_sym</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s ≈ s' ⟹ s' ≈ s"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s ≈ s'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>α</span><span> </span><span>β</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s_s'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij α"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"bij β"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> α β s = s'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s' ≈ s"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>eq_statesI</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">"inv α"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"inv β"</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>s_s'</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: bij_imp_bij_inv›</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Distributive laws›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span>Expression</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>renaming_distr_completion</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>E</sub> α β (ℰ[e]) = ((ℛ<span class="hidden">⇩</span><sub>C</sub> α β ℰ)[ℛ<span class="hidden">⇩</span><sub>E</sub> α β e])"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>ℰ</span><span class="delimiter">)</span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span>Store</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>renaming_distr_combination</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> α β (σ;;τ) = (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ;;ℛ<span class="hidden">⇩</span><sub>S</sub> α β τ)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ext</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>renaming_distr_store</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"bij β ⟹ ℛ<span class="hidden">⇩</span><sub>S</sub> α β (σ(l ↦ v)) = ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ(β l ↦ ℛ<span class="hidden">⇩</span><sub>V</sub> α β v)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_left_eq_iff</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* distribution law for local follows from the definition *)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span>Global</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>renaming_distr_global</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"bij α ⟹ ℛ<span class="hidden">⇩</span><sub>G</sub> α β (s(r ↦ ls)) = ℛ<span class="hidden">⇩</span><sub>G</sub> α β s(α r ↦ ℛ<span class="hidden">⇩</span><sub>L</sub> α β ls)"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"bij α ⟹ ℛ<span class="hidden">⇩</span><sub>G</sub> α β (s(r := None)) = (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)(α r := None)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_left_eq_iff</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Miscellaneous laws›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rename_empty</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> α β ε = ε"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> α β ε = ε"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span>Swaps</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>swap_bij</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"bij (id(x := x', x' := x))"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"bij ?f"</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>bijI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"inj ?f"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>inj_on_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"surj ?f"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"UNIV ⊆ range (id(x := x', x' := x))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsetI</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>y</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"y ∈ (UNIV :: 'a set)"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"y ∈ range (id(x := x', x' := x))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"y = x"</span></span></span><span class="delimiter">;</span><span> </span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"y = x'"</span></span></span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>id_trivial_update</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"id(x := x) = id"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* for solving trivial peaks *)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eliminate_renaming_val_expr</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span>
</span><span>    </span><span>v</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) val"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>e</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>V</sub> v ⟹ ℛ<span class="hidden">⇩</span><sub>V</sub> α (β(l := l')) v = ℛ<span class="hidden">⇩</span><sub>V</sub> α β v"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>E</sub> e ⟹ ℛ<span class="hidden">⇩</span><sub>E</sub> α (β(l := l')) e = ℛ<span class="hidden">⇩</span><sub>E</sub> α β e"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ∉ RID<span class="hidden">⇩</span><sub>V</sub> v ⟹ ℛ<span class="hidden">⇩</span><sub>V</sub> (α(r := r')) β v = ℛ<span class="hidden">⇩</span><sub>V</sub> α β v"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ∉ RID<span class="hidden">⇩</span><sub>E</sub> e ⟹ ℛ<span class="hidden">⇩</span><sub>E</sub> (α(r := r')) β e = ℛ<span class="hidden">⇩</span><sub>E</sub> α β e"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(∀α β r r'. r ∉ RID<span class="hidden">⇩</span><sub>V</sub> v ⟶ ℛ<span class="hidden">⇩</span><sub>V</sub> (α(r := r')) β v = ℛ<span class="hidden">⇩</span><sub>V</sub> α β v) ∧
    (∀α β r r'. r ∉ RID<span class="hidden">⇩</span><sub>E</sub> e ⟶ ℛ<span class="hidden">⇩</span><sub>E</sub> (α(r := r')) β e = ℛ<span class="hidden">⇩</span><sub>E</sub> α β e)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>val_expr.induct</span><span class="delimiter">)</span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ∉ RID<span class="hidden">⇩</span><sub>V</sub> v ⟹ ℛ<span class="hidden">⇩</span><sub>V</sub> (α(r := r')) β v = ℛ<span class="hidden">⇩</span><sub>V</sub> α β v"</span></span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ∉ RID<span class="hidden">⇩</span><sub>E</sub> e ⟹ ℛ<span class="hidden">⇩</span><sub>E</sub> (α(r := r')) β e = ℛ<span class="hidden">⇩</span><sub>E</sub> α β e"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(∀α β l l'. l ∉ LID<span class="hidden">⇩</span><sub>V</sub> v ⟶ ℛ<span class="hidden">⇩</span><sub>V</sub> α (β(l := l')) v = ℛ<span class="hidden">⇩</span><sub>V</sub> α β v) ∧
    (∀α β l l'. l ∉ LID<span class="hidden">⇩</span><sub>E</sub> e ⟶ ℛ<span class="hidden">⇩</span><sub>E</sub> α (β(l := l')) e = ℛ<span class="hidden">⇩</span><sub>E</sub> α β e)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>val_expr.induct</span><span class="delimiter">)</span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>V</sub> v ⟹ ℛ<span class="hidden">⇩</span><sub>V</sub> α (β(l := l')) v = ℛ<span class="hidden">⇩</span><sub>V</sub> α β v"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>E</sub> e ⟹ ℛ<span class="hidden">⇩</span><sub>E</sub> α (β(l := l')) e = ℛ<span class="hidden">⇩</span><sub>E</sub> α β e"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eliminate_renaming_cntxt</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"r ∉ RID<span class="hidden">⇩</span><sub>C</sub> ℰ ⟹ ℛ<span class="hidden">⇩</span><sub>C</sub> (α(r := r')) β ℰ = ℛ<span class="hidden">⇩</span><sub>C</sub> α β ℰ"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>C</sub> ℰ ⟹ ℛ<span class="hidden">⇩</span><sub>C</sub> α (β(l := l')) ℰ = ℛ<span class="hidden">⇩</span><sub>C</sub> α β ℰ"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>ℰ</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>cntxt.induct</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eliminate_swap_val</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"r ∉ RID<span class="hidden">⇩</span><sub>V</sub> v ⟹ r' ∉ RID<span class="hidden">⇩</span><sub>V</sub> v ⟹ ℛ<span class="hidden">⇩</span><sub>V</sub> (id(r := r', r' := r)) id v = v"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>V</sub> v ⟹ l' ∉ LID<span class="hidden">⇩</span><sub>V</sub> v ⟹ ℛ<span class="hidden">⇩</span><sub>V</sub> id (id(l := l', l' := l)) v = v"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eliminate_swap_expr</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"r ∉ RID<span class="hidden">⇩</span><sub>E</sub> e ⟹ r' ∉ RID<span class="hidden">⇩</span><sub>E</sub> e ⟹ ℛ<span class="hidden">⇩</span><sub>E</sub> (id(r := r', r' := r)) id e = e"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>E</sub> e ⟹ l' ∉ LID<span class="hidden">⇩</span><sub>E</sub> e ⟹ ℛ<span class="hidden">⇩</span><sub>E</sub> id (id(l := l', l' := l)) e = e"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eliminate_swap_cntxt</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"r ∉ RID<span class="hidden">⇩</span><sub>C</sub> ℰ ⟹ r' ∉ RID<span class="hidden">⇩</span><sub>C</sub> ℰ ⟹ ℛ<span class="hidden">⇩</span><sub>C</sub> (id(r := r', r' := r)) id ℰ = ℰ"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>C</sub> ℰ ⟹ l' ∉ LID<span class="hidden">⇩</span><sub>C</sub> ℰ ⟹ ℛ<span class="hidden">⇩</span><sub>C</sub> id (id(l := l', l' := l)) ℰ = ℰ"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eliminate_swap_store_rid</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"r ∉ RID<span class="hidden">⇩</span><sub>S</sub> σ ⟹ r' ∉ RID<span class="hidden">⇩</span><sub>S</sub> σ ⟹ ℛ<span class="hidden">⇩</span><sub>S</sub> (id(r := r', r' := r)) id σ = σ"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>S</sub>I</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>swap_bij</span><span> </span><span>RID<span class="hidden">⇩</span><sub>S</sub>_def</span><span> </span><span>domIff</span><span> </span><span>ranI</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eliminate_swap_store_lid</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>S</sub> σ ⟹ l' ∉ LID<span class="hidden">⇩</span><sub>S</sub> σ ⟹ ℛ<span class="hidden">⇩</span><sub>S</sub> id (id(l := l', l' := l)) σ = σ"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>S</sub>I</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>swap_bij</span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>_def</span><span> </span><span>domIff</span><span> </span><span>ranI</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eliminate_swap_global_rid</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"r ∉ RID<span class="hidden">⇩</span><sub>G</sub> s ⟹ r' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s ⟹ ℛ<span class="hidden">⇩</span><sub>G</sub> (id(r := r', r' := r)) id s = s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>G</sub>I</span><span class="delimiter">[</span><span>OF</span><span> </span><span>swap_bij</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span class="delimiter">(</span><span class="delimiter">(</span><span>rule</span><span> </span><span>sym</span><span class="delimiter">,</span><span> </span><span>auto</span><span class="delimiter">)</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>eliminate_swap_global_lid</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">,</span><span> </span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s ⟹ l' ∉ LID<span class="hidden">⇩</span><sub>G</sub> s ⟹ ℛ<span class="hidden">⇩</span><sub>G</sub> id (id(l := l', l' := l)) s = s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>G</sub>I</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>
</div>
</div><div id="Substitution">
<div class="head"><h1>Theory Substitution</h1>
<span class="command">theory</span> <span class="name">Substitution</span><br/>
<span class="keyword">imports</span> <a href="Renaming.html"><span class="name">Renaming</span></a><br/>
</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span> </span><span>Substitution</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹This theory introduces the substitution operation using a locale, and provides two models.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>Substitution</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>Renaming</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span>Definition</span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>substitution</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>subst</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr ⇒ 'v ⇒ ('r,'l,'v) expr ⇒ ('r,'l,'v) expr"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>    </span><span>renaming_distr_subst</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>E</sub> α β (subst e x e') = subst (ℛ<span class="hidden">⇩</span><sub>E</sub> α β e) x (ℛ<span class="hidden">⇩</span><sub>E</sub> α β e')"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* needed in mimicking *)</span></span></span></span></span><span>
</span><span>    </span><span>subst_introduces_no_rids</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>E</sub> (subst e x e') ⊆ RID<span class="hidden">⇩</span><sub>E</sub> e ∪ RID<span class="hidden">⇩</span><sub>E</sub> e'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>subst_introduces_no_lids</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>E</sub> (subst e x e') ⊆ LID<span class="hidden">⇩</span><sub>E</sub> e ∪ LID<span class="hidden">⇩</span><sub>E</sub> e'"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rid_substE</span><span> </span><span class="delimiter">[</span><span>dest</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>E</sub> (subst (VE v) x e) ⟹ r ∉ RID<span class="hidden">⇩</span><sub>E</sub> e ⟹ r ∈ RID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>subst_introduces_no_rids</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lid_substE</span><span> </span><span class="delimiter">[</span><span>dest</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>E</sub> (subst (VE v) x e) ⟹ l ∉ LID<span class="hidden">⇩</span><sub>E</sub> e ⟹ l ∈ LID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>subst_introduces_no_lids</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* substitution locale *)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Trivial model›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>constant_function</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr ⇒ 'v ⇒ ('r,'l,'v) expr ⇒ ('r,'l,'v) expr"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"constant_function e x e' = VE (CV Unit)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>constant_function_models_substitution</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"substitution constant_function"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>substitution_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Example model›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span>Preliminaries</span><span>
</span><span>
</span><span class="keyword1"><span class="command">notation</span></span><span> </span><span>set3_val</span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"𝒱<span class="hidden">⇩</span><sub>V</sub>"</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">notation</span></span><span> </span><span>set3_expr</span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"𝒱<span class="hidden">⇩</span><sub>E</sub>"</span></span></span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>rename_vars_val</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('v ⇒ 'v) ⇒ ('r,'l,'v) val ⇒ ('r,'l,'v) val"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"ℛ𝒱<span class="hidden">⇩</span><sub>V</sub>"</span></span></span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℛ𝒱<span class="hidden">⇩</span><sub>V</sub> ζ ≡ map_val id id ζ"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>rename_vars_expr</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('v ⇒ 'v) ⇒ ('r,'l,'v) expr ⇒ ('r,'l,'v) expr"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"ℛ𝒱<span class="hidden">⇩</span><sub>E</sub>"</span></span></span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> ζ ≡ map_expr id id ζ"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>var_renaming_preserves_size</span><span class="delimiter">:</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* for termination proof *)</span></span></span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> 
</span><span>    </span><span>v</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) val"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>e</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>α</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'r ⇒ 'r'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>β</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'l ⇒ 'l'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>ζ</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'v ⇒ 'v'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"size (map_val α β ζ v) = size v"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"size (map_expr α β ζ e) = size e"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(∀(α :: 'r ⇒ 'r') (β :: 'l ⇒ 'l') (ζ :: 'v ⇒ 'v'). size (map_val α β ζ v) = size v) ∧ 
        (∀(α :: 'r ⇒ 'r') (β :: 'l ⇒ 'l') (ζ :: 'v ⇒ 'v'). size (map_expr α β ζ e) = size e)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>val_expr.induct</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"size (map_val α β ζ v) = size v"</span></span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"size (map_expr α β ζ e) = size e"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span>Definition</span><span>
</span><span>
</span><span class="keyword1"><span class="command">function</span></span><span>
</span><span>  </span><span>nat_subst<span class="hidden">⇩</span><sub>V</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,nat) expr ⇒ nat ⇒ ('r,'l,nat) val ⇒ ('r,'l,nat) expr"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span>nat_subst<span class="hidden">⇩</span><sub>E</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,nat) expr ⇒ nat ⇒ ('r,'l,nat) expr ⇒ ('r,'l,nat) expr"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"nat_subst<span class="hidden">⇩</span><sub>V</sub> e x (CV const) = VE (CV const)"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"nat_subst<span class="hidden">⇩</span><sub>V</sub> e x (Var x') = (if x = x' then e else VE (Var x'))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"nat_subst<span class="hidden">⇩</span><sub>V</sub> e x (Loc l) = VE (Loc l)"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"nat_subst<span class="hidden">⇩</span><sub>V</sub> e x (Rid r) = VE (Rid r)"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"nat_subst<span class="hidden">⇩</span><sub>V</sub> e x (Lambda y e') = VE (
  if x = y then 
    Lambda y e' 
  else 
    let z = Suc (Max (𝒱<span class="hidden">⇩</span><sub>E</sub> e' ∪ 𝒱<span class="hidden">⇩</span><sub>E</sub> e)) in
    Lambda z (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> (id(y := z)) e')))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (VE v') = nat_subst<span class="hidden">⇩</span><sub>V</sub> e x v'"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (Apply l r) = Apply (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x l) (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x r)"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (Ite e1 e2 e3) = Ite (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x e1) (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x e2) (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x e3)"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (Ref e') = Ref (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x e')"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (Read e') = Read (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x e')"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (Assign l r) = Assign (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x l) (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x r)"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (Rfork e') = Rfork (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x e')"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span class="string"><span class="delete"><span class="delete">"nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (Rjoin e')  = Rjoin (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x e')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>pat_completeness</span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">termination</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>relation</span><span> </span><span class="string"><span class="delete"><span class="delete">"measure (λx. case x of Inl (e,x,v) ⇒ size v | Inr (e,x,e') ⇒ size e')"</span></span></span><span class="delimiter">)</span><span>
</span><span>     </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>var_renaming_preserves_size</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Proof obligations›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>nat_subst<span class="hidden">⇩</span><sub>E</sub>_distr</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>e</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,nat) expr"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>E</sub> α β (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x e') = nat_subst<span class="hidden">⇩</span><sub>E</sub> (ℛ<span class="hidden">⇩</span><sub>E</sub> α β e) x (ℛ<span class="hidden">⇩</span><sub>E</sub> α β e')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>v'</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,nat) val"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"(∀α β x e ζ. ℛ<span class="hidden">⇩</span><sub>E</sub> α β (nat_subst<span class="hidden">⇩</span><sub>V</sub> e x (ℛ𝒱<span class="hidden">⇩</span><sub>V</sub> ζ v')) = nat_subst<span class="hidden">⇩</span><sub>V</sub> (ℛ<span class="hidden">⇩</span><sub>E</sub> α β e) x (ℛ<span class="hidden">⇩</span><sub>V</sub> α β (ℛ𝒱<span class="hidden">⇩</span><sub>V</sub> ζ v'))) ∧
     (∀α β x e ζ. ℛ<span class="hidden">⇩</span><sub>E</sub> α β (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> ζ e')) = nat_subst<span class="hidden">⇩</span><sub>E</sub> (ℛ<span class="hidden">⇩</span><sub>E</sub> α β e) x (ℛ<span class="hidden">⇩</span><sub>E</sub> α β (ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> ζ e')))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>val_expr.induct</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>expr.set_map</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>fun.map_ident</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>E</sub> α β (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> id e')) = nat_subst<span class="hidden">⇩</span><sub>E</sub> (ℛ<span class="hidden">⇩</span><sub>E</sub> α β e) x (ℛ<span class="hidden">⇩</span><sub>E</sub> α β (ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> id e'))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>nat_subst<span class="hidden">⇩</span><sub>E</sub>_introduces_no_rids</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>e'</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,nat) expr"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>E</sub> (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x e') ⊆ RID<span class="hidden">⇩</span><sub>E</sub> e ∪ RID<span class="hidden">⇩</span><sub>E</sub> e'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>v'</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,nat) val"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"(∀x e. ∀ζ. RID<span class="hidden">⇩</span><sub>E</sub> (nat_subst<span class="hidden">⇩</span><sub>V</sub> e x (ℛ𝒱<span class="hidden">⇩</span><sub>V</sub> ζ v')) ⊆ RID<span class="hidden">⇩</span><sub>E</sub> e ∪ RID<span class="hidden">⇩</span><sub>V</sub> (ℛ𝒱<span class="hidden">⇩</span><sub>V</sub> ζ v')) ∧
     (∀x e. ∀ζ. RID<span class="hidden">⇩</span><sub>E</sub> (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> ζ e')) ⊆ RID<span class="hidden">⇩</span><sub>E</sub> e ∪ RID<span class="hidden">⇩</span><sub>E</sub> (ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> ζ e'))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>val_expr.induct</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>0</span><span> </span><span>4</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>expr.set_map</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>E</sub> (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> id e')) ⊆ RID<span class="hidden">⇩</span><sub>E</sub> e ∪ RID<span class="hidden">⇩</span><sub>E</sub> (ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> id e')"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>nat_subst<span class="hidden">⇩</span><sub>E</sub>_introduces_no_lids</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>e'</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,nat) expr"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>E</sub> (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x e') ⊆ LID<span class="hidden">⇩</span><sub>E</sub> e ∪ LID<span class="hidden">⇩</span><sub>E</sub> e'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>v'</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,nat) val"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"(∀x e. ∀ζ. LID<span class="hidden">⇩</span><sub>E</sub> (nat_subst<span class="hidden">⇩</span><sub>V</sub> e x (ℛ𝒱<span class="hidden">⇩</span><sub>V</sub> ζ v')) ⊆ LID<span class="hidden">⇩</span><sub>E</sub> e ∪ LID<span class="hidden">⇩</span><sub>V</sub> (ℛ𝒱<span class="hidden">⇩</span><sub>V</sub> ζ v')) ∧
     (∀x e. ∀ζ. LID<span class="hidden">⇩</span><sub>E</sub> (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> ζ e')) ⊆ LID<span class="hidden">⇩</span><sub>E</sub> e ∪ LID<span class="hidden">⇩</span><sub>E</sub> (ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> ζ e'))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>val_expr.induct</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>0</span><span> </span><span>4</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>expr.set_map</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>E</sub> (nat_subst<span class="hidden">⇩</span><sub>E</sub> e x (ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> id e')) ⊆ LID<span class="hidden">⇩</span><sub>E</sub> e ∪ LID<span class="hidden">⇩</span><sub>E</sub> (ℛ𝒱<span class="hidden">⇩</span><sub>E</sub> id e')"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>nat_subst<span class="hidden">⇩</span><sub>E</sub>_models_substitution</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"substitution nat_subst<span class="hidden">⇩</span><sub>E</sub>"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>nat_subst<span class="hidden">⇩</span><sub>E</sub>_distr</span><span> </span><span>nat_subst<span class="hidden">⇩</span><sub>E</sub>_introduces_no_lids</span><span> </span><span>nat_subst<span class="hidden">⇩</span><sub>E</sub>_introduces_no_rids</span><span> </span><span>substitution_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>
</div>
</div><div id="OperationalSemantics">
<div class="head"><h1>Theory OperationalSemantics</h1>
<span class="command">theory</span> <span class="name">OperationalSemantics</span><br/>
<span class="keyword">imports</span> <a href="Substitution.html"><span class="name">Substitution</span></a><br/>
</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Operational Semantics›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹This theory defines the operational semantics of the concurrent revisions model. It also
  introduces a relaxed formulation of the operational semantics, and proves the main result required
  for establishing their equivalence.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>OperationalSemantics</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>Substitution</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">context</span></span><span> </span><span>substitution</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span>Definition</span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>revision_step</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'r ⇒ ('r,'l,'v) global_state ⇒ ('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>app</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Apply (VE (Lambda x e)) (VE v)]) ⟹ revision_step r s (s(r ↦ (σ, τ, ℰ[subst (VE v) x e])))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>ifTrue</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Ite (VE (CV T)) e1 e2]) ⟹ revision_step r s (s(r ↦ (σ, τ, ℰ[e1])))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>ifFalse</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Ite (VE (CV F)) e1 e2]) ⟹ revision_step r s (s(r ↦ (σ, τ, ℰ[e2])))"</span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* store operations *)</span></span></span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>new</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Ref (VE v)]) ⟹ l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s ⟹ revision_step r s (s(r ↦ (σ, τ(l ↦ v), ℰ[VE (Loc l)])))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>get</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Read (VE (Loc l))]) ⟹ l ∈ dom (σ;;τ) ⟹ revision_step r s (s(r ↦ (σ, τ, ℰ[VE (the ((σ;;τ) l))])))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>set</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Assign (VE (Loc l)) (VE v)]) ⟹ l ∈ dom (σ;;τ) ⟹ revision_step r s (s(r ↦ (σ, τ(l ↦ v), ℰ[VE (CV Unit)])))"</span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* synchronization operations *)</span></span></span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>fork</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Rfork e]) ⟹ r' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s ⟹ revision_step r s (s(r ↦ (σ, τ, ℰ[VE (Rid r')]), r' ↦ (σ;;τ, ε, e)))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>join</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Rjoin (VE (Rid r'))]) ⟹ s r' = Some (σ', τ', VE v) ⟹ revision_step r s (s(r := Some (σ, (τ;;τ'), ℰ[VE (CV Unit)]), r' := None))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Rjoin (VE (Rid r'))]) ⟹ s r' = None ⟹ revision_step r s ε"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>revision_stepE</span><span> </span><span class="delimiter">[</span><span>elim</span><span class="delimiter">,</span><span> </span><span>consumes</span><span> </span><span>1</span><span class="delimiter">,</span><span> </span><span>case_names</span><span> </span><span>app</span><span> </span><span>ifTrue</span><span> </span><span>ifFalse</span><span> </span><span>new</span><span> </span><span>get</span><span> </span><span>set</span><span> </span><span>fork</span><span> </span><span>join</span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s'"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Introduction lemmas for identifiers›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_new_introduces_lids</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">,</span><span> </span><span>dest</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>    </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>not_new</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⋀σ τ ℰ v. s r ≠ Some (σ,τ,ℰ[Ref (VE v)])"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>G</sub> s' ⊆ LID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>step</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>fork</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>fun_upd_twist</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>join</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>r'</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>fun_upd_twist</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>in_combination_in_component</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>not_new</span><span> </span><span>fun_upd_twist</span><span> </span><span>ID_distr_global_conditional</span><span> </span><span>dest</span><span class="delimiter">:</span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>I</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_fork_introduces_rids</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">,</span><span> </span><span>dest</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>    </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>not_fork</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⋀σ τ ℰ e. s r ≠ Some (σ,τ,ℰ[Rfork e])"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>G</sub> s' ⊆ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>step</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>get</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>fork</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>not_fork</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>join</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span>r'</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>fun_upd_twist</span><span> </span><span>dest</span><span class="delimiter">!</span><span class="delimiter">:</span><span> </span><span>in_combination_in_component</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_fork_introduces_rids'</span><span> </span><span class="delimiter">[</span><span>dest</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>    </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>not_fork</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⋀σ τ ℰ e. s r ≠ Some (σ,τ,ℰ[Rfork e])"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s ⟹ r' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>only_new_introduces_lids'</span><span> </span><span class="delimiter">[</span><span>dest</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>    </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>not_new</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⋀σ τ ℰ v. s r ≠ Some (σ,τ,ℰ[Ref (VE v)])"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s ⟹ l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Domain subsumption›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span>Definitions</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>domains_subsume</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) local_state ⇒ bool"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"𝒮"</span></span></span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"𝒮 ls = (LID<span class="hidden">⇩</span><sub>L</sub> ls ⊆ doms ls)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>domains_subsume_globally</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"𝒮<span class="hidden">⇩</span><sub>G</sub>"</span></span></span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"𝒮<span class="hidden">⇩</span><sub>G</sub> s = (∀r ls. s r = Some ls ⟶ 𝒮 ls)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>domains_subsume_globallyI</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"(⋀r σ τ e. s r = Some (σ,τ,e) ⟹ 𝒮 (σ,τ,e)) ⟹ domains_subsume_globally s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>domains_subsume_globally_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>subsumes_accessible</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'r ⇒ 'r ⇒ ('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"𝒜"</span></span></span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s = (r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>)) ⟶ (LID<span class="hidden">⇩</span><sub>S</sub> ((the (s r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))))"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>subsumes_accessibleI</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"(r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>)) ⟹ LID<span class="hidden">⇩</span><sub>S</sub> ((the (s r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))) ⟹ 𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>subsumes_accessible_globally</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"𝒜<span class="hidden">⇩</span><sub>G</sub>"</span></span></span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"𝒜<span class="hidden">⇩</span><sub>G</sub> s = (∀r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub>. r<span class="hidden">⇩</span><sub>1</sub> ∈ dom s ⟶ r<span class="hidden">⇩</span><sub>2</sub> ∈ dom s ⟶ 𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>subsumes_accessible_globallyI</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"(⋀r<span class="hidden">⇩</span><sub>1</sub> σ<span class="hidden">⇩</span><sub>1</sub> τ<span class="hidden">⇩</span><sub>1</sub> e<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> σ<span class="hidden">⇩</span><sub>2</sub> τ<span class="hidden">⇩</span><sub>2</sub> e<span class="hidden">⇩</span><sub>2</sub>. s r<span class="hidden">⇩</span><sub>1</sub> = Some (σ<span class="hidden">⇩</span><sub>1</sub>,τ<span class="hidden">⇩</span><sub>1</sub>,e<span class="hidden">⇩</span><sub>1</sub>) ⟹ s r<span class="hidden">⇩</span><sub>2</sub> = Some (σ<span class="hidden">⇩</span><sub>2</sub>,τ<span class="hidden">⇩</span><sub>2</sub>,e<span class="hidden">⇩</span><sub>2</sub>) ⟹ 𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s) ⟹ 𝒜<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>subsumes_accessible_globally_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹The theorem›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_imp_𝒜_refl</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>    </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>r_in_dom</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ dom s"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r r s"</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>step_preserves_𝒮<span class="hidden">⇩</span><sub>G</sub>_and_𝒜<span class="hidden">⇩</span><sub>G</sub></span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>    </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮<span class="hidden">⇩</span><sub>G</sub> s'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜<span class="hidden">⇩</span><sub>G</sub> s'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮<span class="hidden">⇩</span><sub>G</sub> s'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>domains_subsume_globallyI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>r'</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>e</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>s'_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' r' = Some (σ,τ,e)"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮 (σ,τ,e)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' r' = s r'"</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>s'_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>r'_was_updated</span><span class="delimiter">:</span><span> </span><span>False</span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>step</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>app</span><span> </span><span>σ'</span><span> </span><span>τ'</span><span> </span><span>ℰ'</span><span> </span><span>_</span><span> </span><span>e'</span><span> </span><span>v'</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r = r'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_apply</span><span> </span><span>app</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r'_was_updated</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>L</sub> (the (s' r)) ⊆ LID<span class="hidden">⇩</span><sub>S</sub> σ' ∪ LID<span class="hidden">⇩</span><sub>S</sub> τ' ∪ LID<span class="hidden">⇩</span><sub>C</sub> ℰ' ∪ LID<span class="hidden">⇩</span><sub>E</sub> e' ∪ LID<span class="hidden">⇩</span><sub>V</sub> v'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>app</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = LID<span class="hidden">⇩</span><sub>L</sub> (the (s r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>app</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r))"</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>local.app</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.sel</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = doms (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>app</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮 (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>domains_subsume_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r = r'›</span></span></span><span> </span><span>s'_r</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>ifTrue</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r = r'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_apply</span><span> </span><span>ifTrue</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r'_was_updated</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>L</sub> (the (s' r)) ⊆ LID<span class="hidden">⇩</span><sub>L</sub> (the (s r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ifTrue</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r))"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>ifTrue</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.sel</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = doms (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ifTrue</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮 (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>domains_subsume_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r = r'›</span></span></span><span> </span><span>s'_r</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>ifFalse</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r = r'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_apply</span><span> </span><span>ifFalse</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r'_was_updated</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>L</sub> (the (s' r)) ⊆ LID<span class="hidden">⇩</span><sub>L</sub> (the (s r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ifFalse</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r))"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>ifFalse</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.sel</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = doms (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ifFalse</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮 (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>domains_subsume_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r = r'›</span></span></span><span> </span><span>s'_r</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>new</span><span> </span><span>σ'</span><span> </span><span>τ'</span><span> </span><span>ℰ'</span><span> </span><span>v'</span><span> </span><span>l'</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r = r'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_apply</span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r'_was_updated</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>L</sub> (the (s' r)) = insert l' (LID<span class="hidden">⇩</span><sub>S</sub> σ' ∪ LID<span class="hidden">⇩</span><sub>S</sub> τ' ∪ LID<span class="hidden">⇩</span><sub>V</sub> v' ∪ LID<span class="hidden">⇩</span><sub>C</sub> ℰ')"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∉ LID<span class="hidden">⇩</span><sub>S</sub> τ'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new</span><span class="delimiter">(</span><span>2</span><span>-</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = insert l' (LID<span class="hidden">⇩</span><sub>L</sub> (the (s r)))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ insert l' (doms (the (s r)))"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>insert_mono</span><span> </span><span>new</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.sel</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = doms (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮 (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>domains_subsume_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r = r'›</span></span></span><span> </span><span>s'_r</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>get</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r = r'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_apply</span><span> </span><span>get</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r'_was_updated</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>L</sub> (the (s' r)) = LID<span class="hidden">⇩</span><sub>L</sub> (the (s r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r))"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>get</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.sel</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = doms (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>get</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮 (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>domains_subsume_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r = r'›</span></span></span><span> </span><span>s'_r</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>set</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r = r'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_apply</span><span> </span><span>set</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r'_was_updated</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>L</sub> (the (s' r)) ⊆ LID<span class="hidden">⇩</span><sub>L</sub> (the (s r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>set</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r))"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>set</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.sel</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>set</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮 (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>domains_subsume_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r = r'›</span></span></span><span> </span><span>s'_r</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>fork</span><span> </span><span>σ'</span><span> </span><span>τ'</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>r''</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r = r' ∨ r'' = r'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span> </span><span>r'_was_updated</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>disjE</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r = r'"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>L</sub> (the (s' r)) ⊆ LID<span class="hidden">⇩</span><sub>L</sub> (the (s r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r))"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.sel</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = doms (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮 (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>domains_subsume_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r = r'›</span></span></span><span> </span><span>s'_r</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' = r'"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>L</sub> (the (s' r'')) ⊆ LID<span class="hidden">⇩</span><sub>L</sub> (the (s r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r))"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.sel</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = dom σ' ∪ dom τ'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = dom (σ';;τ')"</span></span></span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dom_combination_dom_union</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = doms (the (s' r''))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮 (the (s' r''))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>domains_subsume_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r'' = r'›</span></span></span><span> </span><span>s'_r</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>join</span><span> </span><span>σ'</span><span> </span><span>τ'</span><span> </span><span>_</span><span> </span><span>r''</span><span> </span><span>σ''</span><span> </span><span>τ''</span><span> </span><span>_</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' = r"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_def</span><span> </span><span>join</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>option.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>r'_was_updated</span><span> </span><span>s'_r</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>L</sub> (the (s' r)) ⊆ LID<span class="hidden">⇩</span><sub>L</sub> (the (s r)) ∪ LID<span class="hidden">⇩</span><sub>S</sub> τ''"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r)) ∪ LID<span class="hidden">⇩</span><sub>S</sub> τ''"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Un_mono</span><span> </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>join</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.sel</span><span> </span><span>subset_refl</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r)) ∪ LID<span class="hidden">⇩</span><sub>L</sub> (the (s r''))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r)) ∪ doms (the (s r''))"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Un_absorb</span><span> </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>join</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>option.sel</span><span> </span><span>sup.orderI</span><span> </span><span>sup_mono</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = dom σ' ∪ dom τ' ∪ dom σ'' ∪ dom τ''"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ dom σ' ∪ dom τ' ∪ LID<span class="hidden">⇩</span><sub>S</sub> σ'' ∪ dom τ''"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ dom σ' ∪ dom τ' ∪ dom σ' ∪ dom τ' ∪ dom τ''"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r_r''</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r r'' s"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>join</span><span class="delimiter">(</span><span>2</span><span>-</span><span>3</span><span class="delimiter">)</span><span> </span><span>subsumes_accessible_globally_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r_accesses_r''</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> σ'' ⊆ dom σ' ∪ dom τ'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span> </span><span>subsumes_accessible_def</span><span> </span><span>r_r''</span><span> </span><span>r_accesses_r''</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = dom σ' ∪ dom τ' ∪ dom τ''"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = dom σ' ∪ dom (τ';;τ'')"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dom_combination_dom_union</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = doms (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮 (the (s' r))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>domains_subsume_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r' = r›</span></span></span><span> </span><span>s'_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s'_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜<span class="hidden">⇩</span><sub>G</sub> s'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessible_globallyI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>σ<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>τ<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>e<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>σ<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>τ<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>e<span class="hidden">⇩</span><sub>2</sub></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> 
</span><span>      </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' r<span class="hidden">⇩</span><sub>1</sub> = Some (σ<span class="hidden">⇩</span><sub>1</sub>, τ<span class="hidden">⇩</span><sub>1</sub>, e<span class="hidden">⇩</span><sub>1</sub>)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>      </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' r<span class="hidden">⇩</span><sub>2</sub> = Some (σ<span class="hidden">⇩</span><sub>2</sub>, τ<span class="hidden">⇩</span><sub>2</sub>, e<span class="hidden">⇩</span><sub>2</sub>)"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>𝒮<span class="hidden">⇩</span><sub>G</sub>_imp_𝒜_refl</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒮<span class="hidden">⇩</span><sub>G</sub> s'›</span></span></span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_neq_r<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span>False</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_nor_r<span class="hidden">⇩</span><sub>2</sub>_updated_implies_thesis</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' r<span class="hidden">⇩</span><sub>1</sub> = s r<span class="hidden">⇩</span><sub>1</sub> ⟹ s' r<span class="hidden">⇩</span><sub>2</sub> = s r<span class="hidden">⇩</span><sub>2</sub> ⟹ ?thesis"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_unchanged</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' r<span class="hidden">⇩</span><sub>1</sub> = s r<span class="hidden">⇩</span><sub>1</sub>"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_unchanged</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' r<span class="hidden">⇩</span><sub>2</sub> = s r<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domIff</span><span> </span><span>option.discI</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_unchanged</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_unchanged</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_unchanged</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_unchanged</span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_or_r<span class="hidden">⇩</span><sub>2</sub>_updated_implies_thesis</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' r<span class="hidden">⇩</span><sub>1</sub> ≠ s r<span class="hidden">⇩</span><sub>1</sub> ∨ s' r<span class="hidden">⇩</span><sub>2</sub> ≠ s r<span class="hidden">⇩</span><sub>2</sub> ⟹ ?thesis"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_or_r<span class="hidden">⇩</span><sub>2</sub>_updated</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' r<span class="hidden">⇩</span><sub>1</sub> ≠ s r<span class="hidden">⇩</span><sub>1</sub> ∨ s' r<span class="hidden">⇩</span><sub>2</sub> ≠ s r<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>step</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>app</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r ∨ r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_other</span><span> </span><span>app</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_or_r<span class="hidden">⇩</span><sub>2</sub>_updated</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>disjE</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> ((the (s' r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>) ⊆ LID<span class="hidden">⇩</span><sub>S</sub> ((the (s r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>app</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>app</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domI</span><span> </span><span>fun_upd_other</span><span> </span><span>app</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>app</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) = LID<span class="hidden">⇩</span><sub>S</sub> (the (s r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>app</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>app</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_neq_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domIff</span><span> </span><span>fun_upd_other</span><span> </span><span>app</span><span> </span><span>option.discI</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>app</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>ifTrue</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r ∨ r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_other</span><span> </span><span>ifTrue</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_or_r<span class="hidden">⇩</span><sub>2</sub>_updated</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>disjE</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> ((the (s' r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>) ⊆ LID<span class="hidden">⇩</span><sub>S</sub> ((the (s r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ifTrue</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ifTrue</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domI</span><span> </span><span>fun_upd_other</span><span> </span><span>ifTrue</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ifTrue</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) = LID<span class="hidden">⇩</span><sub>S</sub> (the (s r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ifTrue</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ifTrue</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_neq_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domIff</span><span> </span><span>fun_upd_other</span><span> </span><span>ifTrue</span><span> </span><span>option.discI</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ifTrue</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>ifFalse</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r ∨ r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_other</span><span> </span><span>ifFalse</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_or_r<span class="hidden">⇩</span><sub>2</sub>_updated</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>disjE</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> ((the (s' r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>) ⊆ LID<span class="hidden">⇩</span><sub>S</sub> ((the (s r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ifFalse</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ifFalse</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domI</span><span> </span><span>fun_upd_other</span><span> </span><span>ifFalse</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ifFalse</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) = LID<span class="hidden">⇩</span><sub>S</sub> (the (s r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ifFalse</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ifFalse</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_neq_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domIff</span><span> </span><span>fun_upd_other</span><span> </span><span>ifFalse</span><span> </span><span>option.discI</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ifFalse</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>new</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r ∨ r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_other</span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_or_r<span class="hidden">⇩</span><sub>2</sub>_updated</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>disjE</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> ((the (s' r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>) ⊆ LID<span class="hidden">⇩</span><sub>S</sub> ((the (s r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domI</span><span> </span><span>fun_upd_other</span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) = LID<span class="hidden">⇩</span><sub>S</sub> (the (s r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_neq_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domIff</span><span> </span><span>fun_upd_other</span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.discI</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>new</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>get</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r ∨ r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_other</span><span> </span><span>get</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_or_r<span class="hidden">⇩</span><sub>2</sub>_updated</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>disjE</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> ((the (s' r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>) ⊆ LID<span class="hidden">⇩</span><sub>S</sub> ((the (s r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>RID<span class="hidden">⇩</span><sub>S</sub>I</span><span class="delimiter">)</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* by (auto 1 3) *)</span></span></span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domI</span><span> </span><span>fun_upd_other</span><span> </span><span>get</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) = LID<span class="hidden">⇩</span><sub>S</sub> (the (s r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_neq_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domIff</span><span> </span><span>fun_upd_other</span><span> </span><span>get</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.discI</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>get</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>set</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r ∨ r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_other</span><span> </span><span>set</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_or_r<span class="hidden">⇩</span><sub>2</sub>_updated</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>disjE</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> ((the (s' r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>) ⊆ LID<span class="hidden">⇩</span><sub>S</sub> ((the (s r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>set</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>set</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domI</span><span> </span><span>fun_upd_other</span><span> </span><span>set</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_eq_r</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>set</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) = LID<span class="hidden">⇩</span><sub>S</sub> (the (s r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>set</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>set</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_neq_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>domIff</span><span> </span><span>fun_upd_other</span><span> </span><span>set</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.discI</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_eq_r</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>set</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>fork</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>ℰ</span><span> </span><span>e</span><span> </span><span>r'</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s'_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' r = Some (σ, τ, ℰ [VE (Rid r')])"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s'_r'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' r' = Some (σ;;τ, ε, e)"</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>local.fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>case1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r ⟹ r<span class="hidden">⇩</span><sub>2</sub> ≠ r ⟹ r<span class="hidden">⇩</span><sub>2</sub> ≠ r' ⟹ ?thesis"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ≠ r"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ≠ r'"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> ((the (s' r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>) ⊆ LID<span class="hidden">⇩</span><sub>S</sub> ((the (s r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>2</sub> ≠ r'›</span></span></span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>2</sub> ≠ r'›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>s'_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>2</sub> ≠ r'›</span></span></span><span> </span><span>domIff</span><span> </span><span>fun_upd_other</span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.discI</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>s'_r</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>case2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> ≠ r ⟹ r<span class="hidden">⇩</span><sub>1</sub> ≠ r' ⟹ r<span class="hidden">⇩</span><sub>2</sub> = r ⟹ ?thesis"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> ≠ r"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> ≠ r'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> ((the (s' r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>) ⊆ LID<span class="hidden">⇩</span><sub>S</sub> ((the (s r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> ≠ r'›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> ≠ r›</span></span></span><span> </span><span>fork</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> ≠ r'›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> ≠ r›</span></span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> ≠ r'›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>2</sub> = r›</span></span></span><span> </span><span>domIff</span><span> </span><span>fun_upd_other</span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.discI</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> ≠ r'›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> ≠ r›</span></span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>case3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r' ⟹ r<span class="hidden">⇩</span><sub>2</sub> ≠ r ⟹ r<span class="hidden">⇩</span><sub>2</sub> ≠ r' ⟹ ?thesis"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ≠ r"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ≠ r'"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>RID<span class="hidden">⇩</span><sub>L</sub>I</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r'›</span></span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>s'_r'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s r<span class="hidden">⇩</span><sub>2</sub> = s' r<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>2</sub> ≠ r'›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>2</sub> ≠ r›</span></span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s r))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r))›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s r<span class="hidden">⇩</span><sub>2</sub> = s' r<span class="hidden">⇩</span><sub>2</sub>›</span></span></span><span> </span><span>subsumes_accessible_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = dom σ ∪ dom τ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = dom (σ;;τ)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dom_combination_dom_union</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = doms (the (s' r'))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s'_r'</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r'›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>case4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> ≠ r ⟹ r<span class="hidden">⇩</span><sub>1</sub> ≠ r' ⟹ r<span class="hidden">⇩</span><sub>2</sub> = r' ⟹ ?thesis"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> ≠ r"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> ≠ r'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> = r'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∉ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> ≠ r'›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> ≠ r›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>2</sub> = r'›</span></span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">,</span><span>3</span><span class="delimiter">)</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∉ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> ≠ r'›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> ≠ r›</span></span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>case5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r ⟹ r<span class="hidden">⇩</span><sub>2</sub> = r' ⟹ ?thesis"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> = r'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> ((the (s' r<span class="hidden">⇩</span><sub>2</sub>))<span class="hidden">⇩</span><sub>σ</sub>) = LID<span class="hidden">⇩</span><sub>S</sub> (σ;;τ)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>2</sub> = r'›</span></span></span><span> </span><span>s'_r'</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ LID<span class="hidden">⇩</span><sub>S</sub> σ ∪ LID<span class="hidden">⇩</span><sub>S</sub> τ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ LID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span> </span><span>s'_r</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒮<span class="hidden">⇩</span><sub>G</sub> s'›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>option.sel</span><span> </span><span>s'_r</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>case6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r' ⟹ r<span class="hidden">⇩</span><sub>2</sub> = r ⟹ ?thesis"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ LID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>subsetI</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>2</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒮<span class="hidden">⇩</span><sub>G</sub> s'›</span></span></span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = dom σ ∪ dom τ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>2</sub> = r›</span></span></span><span> </span><span>s'_r</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = dom (σ;;τ)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dom_combination_dom_union</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">" LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r'›</span></span></span><span> </span><span>s'_r'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>case1</span><span> </span><span>case2</span><span> </span><span>case3</span><span> </span><span>case4</span><span> </span><span>case5</span><span> </span><span>case6</span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_neq_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_nor_r<span class="hidden">⇩</span><sub>2</sub>_updated_implies_thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>join</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>ℰ</span><span> </span><span>r'</span><span> </span><span>σ'</span><span> </span><span>τ'</span><span> </span><span>v</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r ∨ r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fun_upd_def</span><span> </span><span>join</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>option.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_or_r<span class="hidden">⇩</span><sub>2</sub>_updated</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>disjE</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>1</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>S</sub> τ'"</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_τ'</span><span class="delimiter">:</span><span> </span><span>True</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) = LID<span class="hidden">⇩</span><sub>S</sub> (the (s r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span> </span><span>fun_upd_def</span><span> </span><span>join</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>option.distinct</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_neq_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r'))"</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r'))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>join</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_τ'</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r' r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span> </span><span>domI</span><span> </span><span>fun_upd_def</span><span> </span><span>join</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>join</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_neq_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r' r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r'</span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = dom σ' ∪ dom τ'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>join</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ LID<span class="hidden">⇩</span><sub>S</sub> σ' ∪ dom τ'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ dom σ ∪ dom τ ∪ dom τ'"</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>join</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r r' s"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span>join</span><span class="delimiter">(</span><span>2</span><span>-</span><span>3</span><span class="delimiter">)</span><span> </span><span>subsumes_accessible_globally_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r r' s›</span></span></span><span> </span><span>join</span><span class="delimiter">(</span><span>2</span><span>-</span><span>3</span><span class="delimiter">)</span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = dom σ ∪ dom (τ;;τ')"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dom_combination_dom_union</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_nin_τ'</span><span class="delimiter">:</span><span> </span><span>False</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) = LID<span class="hidden">⇩</span><sub>S</sub> (the (s r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span> </span><span>fun_upd_def</span><span> </span><span>join</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>option.distinct</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_neq_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r))"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>)) = RID<span class="hidden">⇩</span><sub>S</sub> σ ∪ RID<span class="hidden">⇩</span><sub>S</sub> (τ;;τ') ∪ RID<span class="hidden">⇩</span><sub>C</sub> ℰ"</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>ID_distr_completion</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>ID_distr_local</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span> </span><span>expr.simps</span><span class="delimiter">(</span><span>153</span><span class="delimiter">)</span><span> </span><span>fun_upd_apply</span><span> </span><span>local.join</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>option.discI</span><span> </span><span>option.sel</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>sup_bot.right_neutral</span><span> </span><span>val.simps</span><span class="delimiter">(</span><span>66</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ ∪ RID<span class="hidden">⇩</span><sub>S</sub> τ ∪ RID<span class="hidden">⇩</span><sub>C</sub> ℰ"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_nin_τ'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>join</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span> </span><span>join</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>domIff</span><span> </span><span>fun_upd_def</span><span> </span><span>option.discI</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = dom σ ∪ dom τ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span> </span><span>join</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ dom σ ∪ dom (τ;;τ')"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dom_combination_dom_union</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>1</sub> = r›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessibleI</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) = LID<span class="hidden">⇩</span><sub>S</sub> (the (s r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>)"</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>LID_snapshot.simps</span><span> </span><span>fun_upd_apply</span><span> </span><span>join</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.discI</span><span> </span><span>option.sel</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> ∈ RID<span class="hidden">⇩</span><sub>L</sub> (the (s r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>2</sub> = r›</span></span></span><span> </span><span>fun_upd_apply</span><span> </span><span>local.join</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>option.discI</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_neq_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>𝒜<span class="hidden">⇩</span><sub>G</sub>_s</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>2</sub> = r›</span></span></span><span> </span><span>domIff</span><span> </span><span>fun_upd_apply</span><span> </span><span>join</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>option.discI</span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_globally_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s›</span></span></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub>_in_s_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>subsumes_accessible_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r<span class="hidden">⇩</span><sub>2</sub> = r›</span></span></span><span> </span><span>eq_refl</span><span> </span><span>fun_upd_def</span><span> </span><span>local.join</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>option.distinct</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_neq_r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> (the (s' r<span class="hidden">⇩</span><sub>2</sub>)<span class="hidden">⇩</span><sub>σ</sub>) ⊆ doms (the (s' r<span class="hidden">⇩</span><sub>1</sub>))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span>
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s'_r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_nor_r<span class="hidden">⇩</span><sub>2</sub>_updated_implies_thesis</span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub>_or_r<span class="hidden">⇩</span><sub>2</sub>_updated_implies_thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Relaxed definition of the operational semantics›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>revision_step_relaxed</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'r ⇒ ('r,'l,'v) global_state ⇒ ('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>app</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Apply (VE (Lambda x e)) (VE v)]) ⟹ revision_step_relaxed r s (s(r ↦ (σ, τ, ℰ[subst (VE v) x e])))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>ifTrue</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Ite (VE (CV T)) e1 e2]) ⟹ revision_step_relaxed r s (s(r ↦ (σ, τ, ℰ[e1])))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>ifFalse</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Ite (VE (CV F)) e1 e2]) ⟹ revision_step_relaxed r s (s(r ↦ (σ, τ, ℰ[e2])))"</span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* store operations *)</span></span></span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>new</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Ref (VE v)]) ⟹ l ∉ ⋃ { doms ls | ls. ls ∈ ran s } ⟹ revision_step_relaxed r s (s(r ↦ (σ, τ(l ↦ v), ℰ[VE (Loc l)])))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>get</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Read (VE (Loc l))]) ⟹ revision_step_relaxed r s (s(r ↦ (σ, τ, ℰ[VE (the ((σ;;τ) l))])))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>set</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Assign (VE (Loc l)) (VE v)]) ⟹ revision_step_relaxed r s (s(r ↦ (σ, τ(l ↦ v), ℰ[VE (CV Unit)])))"</span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* synchronization operations *)</span></span></span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>fork</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Rfork e]) ⟹ r' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s ⟹ revision_step_relaxed r s (s(r ↦ (σ, τ, ℰ[VE (Rid r')]), r' ↦ (σ;;τ, ε, e)))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>join</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Rjoin (VE (Rid r'))]) ⟹ s r' = Some (σ', τ', VE v) ⟹ revision_step_relaxed r s (s(r := Some (σ, (τ;;τ'), ℰ[VE (CV Unit)]), r' := None))"</span></span></span><span>
</span><span class="delimiter">|</span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ[Rjoin (VE (Rid r'))]) ⟹ s r' = None ⟹ revision_step_relaxed r s ε"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span> </span><span>revision_step_relaxedE</span><span> </span><span class="delimiter">[</span><span>elim</span><span class="delimiter">,</span><span> </span><span>consumes</span><span> </span><span>1</span><span class="delimiter">,</span><span> </span><span>case_names</span><span> </span><span>app</span><span> </span><span>ifTrue</span><span> </span><span>ifFalse</span><span> </span><span>new</span><span> </span><span>get</span><span> </span><span>set</span><span> </span><span>fork</span><span> </span><span>join</span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"revision_step_relaxed r s s'"</span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* substitution locale *)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* theory *)</span></span></span></span></span><span>
</span></pre>
</div>
</div><div id="Executions">
<div class="head"><h1>Theory Executions</h1>
<span class="command">theory</span> <span class="name">Executions</span><br/>
<span class="keyword">imports</span> <a href="OperationalSemantics.html"><span class="name">OperationalSemantics</span></a><br/>
</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span> </span><span>Executions</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹This section contains all definitions required for reasoning about executions in the concurrent
  revisions model. It also contains a number of proofs for inductive variants. One of these
  proves the equivalence of the two definitions of the operational semantics. The others are
  required for proving determinacy.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>Executions</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>OperationalSemantics</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">context</span></span><span> </span><span>substitution</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Generalizing the original transition›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span>Definition</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>steps</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) global_state rel"</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">"[↝]"</span></span></span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"steps = { (s,s') | s s'. ∃r. revision_step r s s' }"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>valid_step</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) global_state ⇒ ('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">infix</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"↝"</span></span></span><span> </span><span>60</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"s ↝ s' ≡ (s,s') ∈ [↝]"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>valid_stepI</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s' ⟹ s ↝ s'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>steps_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>valid_stepE</span><span> </span><span class="delimiter">[</span><span>dest</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"s ↝ s' ⟹ ∃r. revision_step r s s'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>steps_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span>Closures</span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>refl_trans_step_rel</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) global_state ⇒ ('r,'l,'v) global_state ⇒ bool"</span></span></span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">infix</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"↝<span class="hidden">⇧</span><sup>*</sup>"</span></span></span><span> </span><span>60</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"s ↝<span class="hidden">⇧</span><sup>*</sup> s' ≡ (s,s') ∈ [↝]<span class="hidden">⇧</span><sup>*</sup>"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>refl_step_rel</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) global_state ⇒ ('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">infix</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"↝<span class="hidden">⇧</span><sup>=</sup>"</span></span></span><span> </span><span>60</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"s ↝<span class="hidden">⇧</span><sup>=</sup> s' ≡ (s,s') ∈ [↝]<span class="hidden">⇧</span><sup>=</sup>"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>refl_rewritesI</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s ↝ s' ⟹ s ↝<span class="hidden">⇧</span><sup>=</sup> s'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span>Properties</span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>program_expr</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"program_expr e ≡ LID<span class="hidden">⇩</span><sub>E</sub> e = {} ∧ RID<span class="hidden">⇩</span><sub>E</sub> e = {}"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>initializes</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) global_state ⇒ ('r,'l,'v) expr ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"initializes s e ≡ ∃r. s = (ε(r ↦(ε,ε,e))) ∧ program_expr e"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">abbreviation</span></span><span> </span><span>initial_state</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"initial_state s ≡ ∃e. initializes s e"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>execution</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr ⇒ ('r,'l,'v) global_state ⇒ ('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"execution e s s' ≡ initializes s e ∧ s ↝<span class="hidden">⇧</span><sup>*</sup> s'"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>maximal_execution</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr ⇒ ('r,'l,'v) global_state ⇒ ('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"maximal_execution e s s' ≡ execution e s s' ∧ (∄s''. s' ↝ s'')"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>reachable</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"reachable s ≡ ∃e s'. execution e s' s"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>terminates_in</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr ⇒ ('r,'l,'v) global_state ⇒ bool"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">infix</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"↓"</span></span></span><span> </span><span>60</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"e ↓ s' ≡ ∃s. maximal_execution e s s'"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span>Invariants</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Inductive invariance›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>inductive_invariant</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"(('r,'l,'v) global_state ⇒ bool) ⇒ bool"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"inductive_invariant P ≡ (∀s. initial_state s ⟶ P s) ∧ (∀s s'. s ↝ s' ⟶ P s ⟶ P s')"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>inductive_invariantI</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"(⋀s. initial_state s ⟹ P s) ⟹ (⋀s s'. s ↝ s' ⟹ P s ⟹ P s') ⟹ inductive_invariant P"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>inductive_invariant_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>inductive_invariant_is_execution_invariant</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable s ⟹ inductive_invariant P ⟹ P s"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable s"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ind_inv</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"inductive_invariant P"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span>initial</span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>initializes</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"initializes initial e"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>trace</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(initial,s) ∈ [↝]^^n"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>execution_def</span><span> </span><span>reachable_def</span><span> </span><span>rtrancl_power</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"P s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>n</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>s</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"initial = s"</span></span></span><span>   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"0.prems"</span></span></span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"initial_state s"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>initializes</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ind_inv</span><span> </span><span>inductive_invariant_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>nfold</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(initial, s') ∈ [↝]^^n"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' ↝ s"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"P s'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>nfold</span><span> </span><span>initializes</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ind_inv</span><span> </span><span>step</span><span> </span><span>inductive_invariant_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Subsumption is invariant›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>nice_ind_inv_is_inductive_invariant</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"inductive_invariant (λs. 𝒮<span class="hidden">⇩</span><sub>G</sub> s ∧ 𝒜<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>inductive_invariantI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"initial_state s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span>r</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s = ε(r ↦ (ε, ε, e))"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>prog_expr_e</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"program_expr e"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮<span class="hidden">⇩</span><sub>G</sub> s ∧ 𝒜<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>conjI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>domains_subsume_globallyI</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>r'</span><span> </span><span>σ'</span><span> </span><span>τ'</span><span> </span><span>e'</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>s_r'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r' = Some (σ',τ',e')"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' = r"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s</span><span> </span><span>s_r'</span><span> </span><span>prog_expr_e</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>domI</span><span> </span><span>domIff</span><span> </span><span>fun_upd_other</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>L</sub> (σ',τ',e') = LID<span class="hidden">⇩</span><sub>L</sub> (ε, ε, e)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s</span><span> </span><span>s_r'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = {}"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prog_expr_e</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">also</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"... = dom σ' ∪ dom τ'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r' = r›</span></span></span><span> </span><span>s</span><span> </span><span>s_r'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">finally</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮 (σ', τ', e')"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>domains_subsume_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>subsumes_accessible_globallyI</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>r<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>σ<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>τ<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>e<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>r<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>σ<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>τ<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>e<span class="hidden">⇩</span><sub>2</sub></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>s_r1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r<span class="hidden">⇩</span><sub>1</sub> = Some (σ<span class="hidden">⇩</span><sub>1</sub>, τ<span class="hidden">⇩</span><sub>1</sub>, e<span class="hidden">⇩</span><sub>1</sub>)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s_r2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r<span class="hidden">⇩</span><sub>2</sub> = Some (σ<span class="hidden">⇩</span><sub>2</sub>, τ<span class="hidden">⇩</span><sub>2</sub>, e<span class="hidden">⇩</span><sub>2</sub>)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r<span class="hidden">⇩</span><sub>2</sub> = r"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s</span><span> </span><span>s_r2</span><span> </span><span>prog_expr_e</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>domI</span><span> </span><span>domIff</span><span> </span><span>fun_upd_other</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"σ<span class="hidden">⇩</span><sub>2</sub> = ε"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s</span><span> </span><span>s_r2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>S</sub> σ<span class="hidden">⇩</span><sub>2</sub> = {}"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒜 r<span class="hidden">⇩</span><sub>1</sub> r<span class="hidden">⇩</span><sub>2</sub> s"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s_r2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>step_preserves_𝒮<span class="hidden">⇩</span><sub>G</sub>_and_𝒜<span class="hidden">⇩</span><sub>G</sub></span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">corollary</span></span><span> </span><span>reachable_imp_𝒮<span class="hidden">⇩</span><sub>G</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable s ⟹ 𝒮<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮<span class="hidden">⇩</span><sub>G</sub> s ∧ 𝒜<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>inductive_invariant_is_execution_invariant</span><span class="delimiter">[</span><span>OF</span><span> </span><span>reach</span><span> </span><span>nice_ind_inv_is_inductive_invariant</span><span class="delimiter">]</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>transition_relations_equivalent</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable s ⟹ revision_step r s s' = revision_step_relaxed r s s'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>doms_sub_local</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"𝒮<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>reachable_imp_𝒮<span class="hidden">⇩</span><sub>G</sub></span><span class="delimiter">[</span><span>OF</span><span> </span><span>reach</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s' = revision_step_relaxed r s s'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s'"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step_relaxed r s s'"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>step</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹induct rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>new</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>ℰ</span><span> </span><span>v</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step_relaxed r s (s(r ↦ (σ, τ(l ↦ v), ℰ [VE (Loc l)])))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>revision_step_relaxed.new</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ ⋃ { doms ls | ls. ls ∈ ran s}"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ ⋃ { doms ls | ls. ls ∈ ran s}"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ls</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>in_ran</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ls ∈ ran s"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>in_doms</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ doms ls"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>in_doms</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>ls</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ls ∈ {ls. ∃r. s r = Some ls}"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>full_types</span><span class="delimiter">)</span><span> </span><span>in_ran</span><span> </span><span>ran_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹l ∈ LID<span class="hidden">⇩</span><sub>L</sub> ls›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>new.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>revision_step_relaxed.intros</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step_relaxed r s s'"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s'"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>step</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹induct rule: revision_step_relaxedE›</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>new</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>ℰ</span><span> </span><span>v</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s (s(r ↦ (σ, τ(l ↦ v), ℰ [VE (Loc l)])))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>revision_step.new</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ [Ref (VE v)])"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>new.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>r'</span><span> </span><span>σ'</span><span> </span><span>τ'</span><span> </span><span>e'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s_r'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r' = Some (σ',τ',e')"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>l_in_local</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>L</sub> (σ',τ',e')"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom σ' ∪ dom τ'"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>doms.simps</span><span> </span><span>doms_sub_local</span><span> </span><span>rev_subsetD</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>s_r'</span><span> </span><span>new.hyps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>ranI</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>get</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>ℰ</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s (s(r ↦ (σ, τ, ℰ [VE (the ((σ;;τ) l))])))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>       </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ [Read (VE (Loc l))])"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>get.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom (σ;;τ)"</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>L</sub> (σ, τ, ℰ [Read (VE (Loc l))])"</span></span></span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>         </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom σ ∪ dom τ"</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>doms_sub_local</span><span> </span><span>get.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom (σ;;τ)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dom_combination_dom_union</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>set</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>ℰ</span><span> </span><span>l</span><span> </span><span>v</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s (s(r ↦ (σ, τ(l ↦ v), ℰ [VE (CV Unit)])))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>       </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ [Assign (VE (Loc l)) (VE v)])"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>set.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom (σ;;τ)"</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>         </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>L</sub> (σ, τ, ℰ [Assign (VE (Loc l)) (VE v)])"</span></span></span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>         </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom σ ∪ dom τ"</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>domains_subsume_def</span><span> </span><span>domains_subsume_globally_def</span><span> </span><span>doms_sub_local</span><span> </span><span>set.hyps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>         </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom (σ;;τ)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>dom_combination_dom_union</span><span class="delimiter">)</span><span>
</span><span>       </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>set.hyps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>revision_step.intros</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Finitude is invariant›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>finite_occurrences_val_expr</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> 
</span><span>    </span><span>v</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) val"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>e</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"('r,'l,'v) expr"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>V</sub> v)"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>E</sub> e)"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>V</sub> v)"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>E</sub> e)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(finite (RID<span class="hidden">⇩</span><sub>V</sub> v) ∧ finite (LID<span class="hidden">⇩</span><sub>V</sub> v)) ∧ finite (RID<span class="hidden">⇩</span><sub>E</sub> e) ∧ finite (LID<span class="hidden">⇩</span><sub>E</sub> e)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>val_expr.induct</span><span class="delimiter">)</span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span>  
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>V</sub> v)"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>E</sub> e)"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>V</sub> v)"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>E</sub> e)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>store_finite_upd</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>S</sub> τ) ⟹ finite (RID<span class="hidden">⇩</span><sub>S</sub> (τ(l := None)))"</span></span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>S</sub> τ) ⟹ finite (LID<span class="hidden">⇩</span><sub>S</sub> (τ(l := None)))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>ID_restricted_store_subset_store</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>finite_subset</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ID_restricted_store_subset_store</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>rev_finite_subset</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>finite_state_imp_restriction_finite</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>G</sub> s) ⟹ finite (RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)))"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>G</sub> s) ⟹ finite (LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)))"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>infinite_super</span><span> </span><span>ID_restricted_global_subset_unrestricted</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>fin</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)) ⊆ LID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None)))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fin</span><span> </span><span>finite_subset</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>local_state_of_finite_restricted_global_state_is_finite</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"s r' = Some ls ⟹ finite (RID<span class="hidden">⇩</span><sub>G</sub> (s(r := None))) ⟹ r ≠ r' ⟹ finite (RID<span class="hidden">⇩</span><sub>L</sub> ls)"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"s r' = Some ls ⟹ finite (LID<span class="hidden">⇩</span><sub>G</sub> (s(r := None))) ⟹ r ≠ r' ⟹ finite (LID<span class="hidden">⇩</span><sub>L</sub> ls)"</span></span></span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>ID_distr_global</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>finite_Un</span><span> </span><span>finite_insert</span><span> </span><span>fun_upd_triv</span><span> </span><span>fun_upd_twist</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>ID_distr_global</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>finite_Un</span><span> </span><span>fun_upd_triv</span><span> </span><span>fun_upd_twist</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>empty_map_finite</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>S</sub> ε)"</span></span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>S</sub> ε)"</span></span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>G</sub> ε)"</span></span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>G</sub> ε)"</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>RID<span class="hidden">⇩</span><sub>S</sub>_def</span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>_def</span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>_def</span><span> </span><span>LID<span class="hidden">⇩</span><sub>G</sub>_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>finite_combination</span><span> </span><span class="delimiter">[</span><span>intro</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>S</sub> σ) ⟹ finite (RID<span class="hidden">⇩</span><sub>S</sub> τ) ⟹ finite (RID<span class="hidden">⇩</span><sub>S</sub> (σ;;τ))"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>S</sub> σ) ⟹ finite (LID<span class="hidden">⇩</span><sub>S</sub> τ) ⟹ finite (LID<span class="hidden">⇩</span><sub>S</sub> (σ;;τ))"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>finite_UnI</span><span> </span><span>rev_finite_subset</span><span> </span><span>ID_combination_subset_union</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>_finite_invariant</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>fin</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>G</sub> s')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>step</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>join</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>ℰ</span><span> </span><span>r'</span><span> </span><span>σ'</span><span> </span><span>τ'</span><span> </span><span>v</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>ID_distr_global</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>ID_distr_local</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>fin</span><span> </span><span>finite_Un</span><span> </span><span>finite_combination</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>finite_insert</span><span> </span><span>finite_occurrences_val_expr</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>finite_state_imp_restriction_finite</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>join</span><span> </span><span>local_state_of_finite_restricted_global_state_is_finite</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>fin</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: ID_distr_global_conditional›</span></span></span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>RID<span class="hidden">⇩</span><sub>L</sub>_finite_invariant</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>fin</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>G</sub> s')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>step</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>join</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>ℰ</span><span> </span><span>r'</span><span> </span><span>σ'</span><span> </span><span>τ'</span><span> </span><span>v</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span> </span><span>assms</span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>ID_distr_global</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>ID_distr_local</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>fin</span><span> </span><span>finite_Un</span><span> </span><span>finite_combination</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>finite_occurrences_val_expr</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>finite_state_imp_restriction_finite</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>join</span><span> </span><span>local_state_of_finite_restricted_global_state_is_finite</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>fin</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: ID_distr_global_conditional›</span></span></span><span class="delimiter">)</span><span>
</span><span> 
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>reachable_imp_identifiers_finite</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable s"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>reach</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span>r</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>exec</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"execution e (ε(r ↦ (ε,ε,e))) s"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>reachable_def</span><span> </span><span>execution_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>prog_exp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"program_expr e"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>execution_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>n_reachable</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(ε(r ↦ (ε,ε,e)), s) ∈ [↝]^^n"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>exec</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>execution_def</span><span> </span><span>rtrancl_imp_relpow</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>G</sub> s) ∧ finite (LID<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>n</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>s</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s = ε(r ↦ (ε, ε, e))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>rid_dom</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"dom s = {r}"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>rid_ran</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⋃ (RID<span class="hidden">⇩</span><sub>L</sub> ` ran s) = {}"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>prog_exp</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>rids</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"RID<span class="hidden">⇩</span><sub>G</sub> s = {r}"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>unfold</span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>_def</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>rid_dom</span><span> </span><span>rid_ran</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>lid_ran</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"⋃ (LID<span class="hidden">⇩</span><sub>L</sub> ` ran s) = {}"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>prog_exp</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>lids</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"LID<span class="hidden">⇩</span><sub>G</sub> s = {}"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>unfold</span><span> </span><span>LID<span class="hidden">⇩</span><sub>G</sub>_def</span><span class="delimiter">,</span><span> </span><span>simp</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rids</span><span> </span><span>lids</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>      </span><span>n_steps</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(ε(r ↦ (ε, ε, e)), s') ∈ [↝]^^n"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>      </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s' ↝ s"</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>relpow_Suc_E</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fin_rid</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>G</sub> s')"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc.hyps</span><span> </span><span>n_steps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>fin_lid</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>G</sub> s')"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc.hyps</span><span> </span><span>n_steps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>_finite_invariant</span><span> </span><span>RID<span class="hidden">⇩</span><sub>L</sub>_finite_invariant</span><span> </span><span>fin_rid</span><span> </span><span>local.step</span><span> </span><span>valid_stepE</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"finite (RID<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"finite (LID<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>reachable_imp_identifiers_available</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"reachable (s :: ('r,'l,'v) global_state)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'r set) ⟹ ∃r. r ∉ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'l set) ⟹ ∃l. l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assms</span><span> </span><span>ex_new_if_finite</span><span> </span><span>reachable_imp_identifiers_finite</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Reachability is invariant›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>initial_state_reachable</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"program_expr e"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable (ε(r ↦ (ε,ε,e)))"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"initializes (ε(r ↦ (ε,ε,e))) e"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"execution e (ε(r ↦ (ε,ε,e))) (ε(r ↦ (ε,ε,e)))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>execution_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>reachable_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>reachability_closed_under_execution_step</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable s"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable s'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>init</span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>exec</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"execution e init s"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>reach</span><span> </span><span>reachable_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>init_s</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">"init ↝<span class="hidden">⇧</span><sup>*</sup> s"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>execution_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s_s'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s ↝ s'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"init ↝<span class="hidden">⇧</span><sup>*</sup> s'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>init_s</span><span> </span><span>s_s'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"execution e init s'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>exec</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>execution_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>reachable_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>reachability_closed_under_execution</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable s ⟹ s ↝<span class="hidden">⇧</span><sup>*</sup> s' ⟹ reachable s'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable s"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s ↝<span class="hidden">⇧</span><sup>*</sup> s'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(s, s') ∈ [↝]^^n"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtrancl_imp_relpow</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable s'"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>n</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>s'</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>reach</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s''</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(s,s'') ∈ [↝]^^n"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s'' ↝ s'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc.prems</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable s''"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc.hyps</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹(s, s'') ∈ [↝]^^n›</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s'' ↝ s'›</span></span></span><span> </span><span>reachability_closed_under_execution_step</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* substitution locale *)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* theory *)</span></span></span></span></span><span>
</span></pre>
</div>
</div><div id="Determinacy">
<div class="head"><h1>Theory Determinacy</h1>
<span class="command">theory</span> <span class="name">Determinacy</span><br/>
<span class="keyword">imports</span> <a href="Executions.html"><span class="name">Executions</span></a><br/>
</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span> </span><span>Determinacy</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹This section proves that the concurrent revisions model is determinate modulo renaming-equivalence.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>Determinacy</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>Executions</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">context</span></span><span> </span><span>substitution</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Rule determinism›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>app_deterministic</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ [Apply (VE (Lambda x e)) (VE v)])"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(revision_step r s s') = (s' = (s(r ↦ (σ, τ, ℰ [subst (VE v) x e]))))"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?l = ?r"</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="var">?l</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>revision_stepE</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>s_r</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s_r</span><span> </span><span>revision_step.app</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ifTrue_deterministic</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ [Ite (VE (CV T)) e1 e2])"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(revision_step r s s') = (s' = (s(r ↦ (σ, τ, ℰ [e1]))))"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?l = ?r"</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="var">?l</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>revision_stepE</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>s_r</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s_r</span><span> </span><span>revision_step.ifTrue</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ifFalse_deterministic</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ [Ite (VE (CV F)) e1 e2])"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(revision_step r s s') = (s' = (s(r ↦ (σ, τ, ℰ [e2]))))"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?l = ?r"</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="var">?l</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>revision_stepE</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>s_r</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s_r</span><span> </span><span>revision_step.ifFalse</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>new_pseudodeterministic</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ [Ref (VE v)])"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(revision_step r s s') = (∃l. l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s ∧ s' = (s(r ↦ (σ, τ(l ↦ v), ℰ [VE (Loc l)]))))"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?l = ?r"</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="var">?l</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>revision_stepE</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>s_r</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s_r</span><span> </span><span>revision_step.new</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>get_deterministic</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ [Read (VE (Loc l))])"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(revision_step r s s') = (l ∈ dom (σ;;τ) ∧ s' = (s(r ↦ (σ, τ, ℰ [VE (the ((σ;;τ) l))]))))"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?l = ?r"</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="var">?l</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>revision_stepE</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>s_r</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>revision_step.get</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: s_r›</span></span></span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>set_deterministic</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ [Assign (VE (Loc l)) (VE v)])"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(revision_step r s s') = (l ∈ dom (σ;;τ) ∧ s' = (s(r ↦ (σ, τ(l ↦ v), ℰ [VE (CV Unit)]))))"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?l = ?r"</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="var">?l</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>revision_stepE</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>s_r</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s_r</span><span> </span><span>revision_step.set</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>fork_pseudodeterministic</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ [Rfork e])"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(revision_step r s s') = (∃r'. r' ∉ RID<span class="hidden">⇩</span><sub>G</sub> (s(r ↦ (σ, τ, ℰ [Rfork e]))) ∧ s' = (s(r ↦ (σ, τ, ℰ [VE (Rid r')]), r' ↦ (σ;;τ, ε, e))))"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?l = ?r"</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>step</span><span class="delimiter">:</span><span> </span><span class="var">?l</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?r</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>step</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>fork</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>ℰ</span><span> </span><span>e</span><span> </span><span>r'</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span>r'</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>fork</span><span> </span><span>s_r</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s_r</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s_r</span><span> </span><span>revision_step.fork</span><span> </span><span>map_upd_triv</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rjoin_deterministic</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ [Rjoin (VE (Rid r'))])"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s_r'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r' = Some (σ', τ', VE v)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(revision_step r s s') = (s' = (s(r := Some (σ, τ;;τ', ℰ [VE (CV Unit)]), r' := None)))"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?l = ?r"</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>step</span><span class="delimiter">:</span><span> </span><span class="var">?l</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>revision_stepE</span><span class="delimiter">[</span><span>OF</span><span> </span><span>step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>s_r</span><span> </span><span>s_r'</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>s_r</span><span> </span><span>s_r'</span><span> </span><span>revision_step.join</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rjoin<span class="hidden">⇩</span><sub>ε</sub>_deterministic</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r = Some (σ, τ, ℰ [Rjoin (VE (Rid r'))])"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s_r'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s r' = None"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(revision_step r s s') = (s' = ε)"</span></span></span><span> </span><span class="delimiter">(</span><span class="keyword2"><span class="keyword">is</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?l = ?r"</span></span></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>step</span><span class="delimiter">:</span><span> </span><span class="var">?l</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>revision_stepE</span><span class="delimiter">[</span><span>OF</span><span> </span><span>step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>s_r</span><span> </span><span>s_r'</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>revision_step.join<span class="hidden">⇩</span><sub>ε</sub></span><span> </span><span>s_r</span><span> </span><span>s_r'</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Strong local confluence›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Local determinism›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>local_determinism</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> ≈ s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>left</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹induct rule:revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>new</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>ℰ</span><span> </span><span>v</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>new</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>right</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>l'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>    </span><span>side</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>1</sub>"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>1</sub>(r ↦ (σ, τ(l' ↦ v), ℰ[VE (Loc l')]))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?β"</span></span></span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"id(l := l', l' := l)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>bij_β</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij ?β"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>swap_bij</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>renaming</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> id ?β s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>new</span><span> </span><span>side</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>'</span><span> </span><span>bij_β</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: ID_distr_global_conditional›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>eq_statesI</span><span class="delimiter">[</span><span>OF</span><span> </span><span>renaming</span><span> </span><span>bij_id</span><span> </span><span>bij_β</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>fork</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>ℰ</span><span> </span><span>e</span><span> </span><span>r'</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>right</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>r''</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>    </span><span>side</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>1</sub>"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>1</sub>(r ↦ (σ, τ, ℰ [VE (Rid r'')]), r'' ↦ (σ;;τ, ε, e))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?α"</span></span></span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"id(r' := r'', r'' := r')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>bij_α</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij ?α"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>swap_bij</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>renaming</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> ?α id s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>fork</span><span> </span><span>side</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>'</span><span> </span><span>bij_α</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: ID_distr_global_conditional›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>eq_statesI</span><span class="delimiter">[</span><span>OF</span><span> </span><span>renaming</span><span> </span><span>bij_α</span><span> </span><span>bij_id</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span class="delimiter">(</span><span>rule</span><span> </span><span>eq_statesI</span><span class="delimiter">[</span><span>of</span><span> </span><span>id</span><span> </span><span>id</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>assms</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹General principles›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>SLC_sym</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub>' s<span class="hidden">⇩</span><sub>3</sub>. s<span class="hidden">⇩</span><sub>3</sub>' ≈ s<span class="hidden">⇩</span><sub>3</sub> ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>') ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>) ⟹
   ∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>αβ_sym</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>SLC_commute</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"⟦ s<span class="hidden">⇩</span><sub>3</sub> = s<span class="hidden">⇩</span><sub>3</sub>'; revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub>; revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ⟧ ⟹ 
  s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>αβ_refl</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Case join-epsilon›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>SLC_join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> r = Some (σ, τ, ℰ[Rjoin (VE (Rid r''))])"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> = ε"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>side</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> r'' = None"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>neq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>right_collapsed_case</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' = ε ⟹ ?thesis"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span>ε</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span>ε</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left_step_still_available_case</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' ≠ ε ⟹ s<span class="hidden">⇩</span><sub>2</sub>' r = s<span class="hidden">⇩</span><sub>1</sub> r ⟹ s<span class="hidden">⇩</span><sub>2</sub>' r'' = None ⟹ ?thesis"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span>ε</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span>ε</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>assms</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>right</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>join</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>right_joinee</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r_unchanged_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' r = s<span class="hidden">⇩</span><sub>1</sub> r"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r'_unchanged_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' r'' = None"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"right_joinee ≠ r'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span class="delimiter">(</span><span>2</span><span>-</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>'_nonempty</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' ≠ ε"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>join</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>fun_upd_twist</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>left_step_still_available_case</span><span class="delimiter">[</span><span>OF</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>'_nonempty</span><span> </span><span>r_unchanged_left</span><span> </span><span>r'_unchanged_right</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>right_collapsed_case</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">(</span><span>2</span><span>-</span><span>3</span><span class="delimiter">)</span><span> </span><span>right</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span class="delimiter">(</span><span>rule</span><span> </span><span>left_step_still_available_case</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>side</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>right</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Case join›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>join_and_local_commute</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>1</sub>(r := Some (σ, τ;;τ', ℰ[VE (CV Unit)]), r'' := None)"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>1</sub>(r' ↦ ls)"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r' ≠ r''"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>2</sub> (s<span class="hidden">⇩</span><sub>1</sub>(r := Some (σ, τ;;τ', ℰ[VE (CV Unit)]), r'' := None, r' := Some ls))"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' r = Some (σ, τ, ℰ [Rjoin (VE (Rid r''))])"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' r'' = Some (σ', τ', VE v)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub>(r := Some (σ, τ;;τ', ℰ[VE (CV Unit)]), r'' := None, r' := Some ls)"</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub>(r' := Some ls, r := Some (σ, τ;;τ', ℰ[VE (CV Unit)]), r'' := None)"</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_commute</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>assms</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>SLC_join</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> r = Some (σ, τ, ℰ[Rjoin (VE (Rid r''))])"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> = (s<span class="hidden">⇩</span><sub>1</sub>(r := Some (σ, (τ;;τ'), ℰ[VE (CV Unit)]), r'' := None))"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>side</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> r'' = Some (σ', τ', VE v)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>    </span><span>right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>neq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left_step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r'_not_joined</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ≠ r''"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>right</span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>right</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>new</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_new_introduces_lids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>new</span><span> </span><span>right</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>join_and_local_commute</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>assms</span><span> </span><span>r'_not_joined</span><span> </span><span>new</span><span> </span><span>l_fresh_left</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>fork</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>r'''</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r'_unchanged_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> r' = s<span class="hidden">⇩</span><sub>1</sub> r'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r'''_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r''' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>left_step</span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>only_fork_introduces_rids'</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r_unchanged_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' r = s<span class="hidden">⇩</span><sub>1</sub> r"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r''_unchanged_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' r'' = s<span class="hidden">⇩</span><sub>1</sub> r''"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span> </span><span>assms</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub>"</span></span></span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>(r' := s<span class="hidden">⇩</span><sub>2</sub>' r', r''' := s<span class="hidden">⇩</span><sub>2</sub>' r''')"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>'(r := s<span class="hidden">⇩</span><sub>2</sub> r, r'' := None)"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub>"</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_commute</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub> = ?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>neq</span><span> </span><span>r'_not_joined</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>2</sub> ?s<span class="hidden">⇩</span><sub>3</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>r'_unchanged_left</span><span> </span><span>r'''_fresh_left</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>2</sub>' ?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r''_unchanged_right</span><span> </span><span>r_unchanged_right</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>join</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>r'''</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r'_unchanged_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> r' = s<span class="hidden">⇩</span><sub>1</sub> r'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>neq</span><span> </span><span>r'_not_joined</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r_unchanged_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' r = s<span class="hidden">⇩</span><sub>1</sub> r"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span class="delimiter">(</span><span>1</span><span class="delimiter">,</span><span>3</span><span class="delimiter">)</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' = r'''"</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r'''_none_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> r''' = None"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>True</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r''_none_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' r'' = None"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>True</span><span> </span><span>join</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span>ε</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span>ε</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_commute</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ε = ε"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>refl</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>2</sub> ε"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r'_unchanged_left</span><span> </span><span>r'''_none_left</span><span> </span><span>join</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>2</sub>' ε"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r_unchanged_right</span><span> </span><span>r''_none_right</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r'''_unchanged_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> r''' = s<span class="hidden">⇩</span><sub>1</sub> r'''"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>False</span><span> </span><span>join</span><span class="delimiter">(</span><span>1</span><span class="delimiter">,</span><span>3</span><span class="delimiter">)</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r_unchanged_right</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r''_unchanged_right'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' r'' = s<span class="hidden">⇩</span><sub>1</sub> r''"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>False</span><span> </span><span>join</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>r'_not_joined</span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub>"</span></span></span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>(r' := s<span class="hidden">⇩</span><sub>2</sub>' r', r''' := None)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>'(r := s<span class="hidden">⇩</span><sub>2</sub> r, r'' := None)"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub>"</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_commute</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub> = ?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>join</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>neq</span><span> </span><span>r'_not_joined</span><span> </span><span>r_unchanged_right</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>2</sub> ?s<span class="hidden">⇩</span><sub>3</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>join</span><span> </span><span>r'''_unchanged_left</span><span> </span><span>r'_unchanged_left</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>2</sub>' ?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r''_unchanged_right'</span><span> </span><span>r_unchanged_right</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>side</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>left_step</span><span> </span><span>neq</span><span> </span><span>right</span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span class="delimiter">(</span><span>rule</span><span> </span><span>join_and_local_commute</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>assms</span><span> </span><span>r'_not_joined</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Case local›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>local_steps_commute</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>1</sub>(r ↦ x)"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>1</sub>(r' ↦ y)"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"revision_step r' (s<span class="hidden">⇩</span><sub>1</sub>(r ↦ x)) (s<span class="hidden">⇩</span><sub>1</sub>(r ↦ x, r' ↦ y))"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"revision_step r (s<span class="hidden">⇩</span><sub>1</sub>(r' ↦ y)) (s<span class="hidden">⇩</span><sub>1</sub>(r' ↦ y, r ↦ x))"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>assms</span><span> </span><span>fun_upd_twist</span><span> </span><span>fun_upd_upd</span><span> </span><span>local_determinism</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>local_and_fork_commute</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>1</sub>(r ↦ x)"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>1</sub>(r' ↦ (σ, τ, ℰ [VE (Rid r'')]), r'' ↦ (σ;;τ, ε, e))"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> r' = Some (σ, τ, ℰ[Rfork e])"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>2</sub>' (s<span class="hidden">⇩</span><sub>1</sub>(r' ↦ (σ, τ, ℰ [VE (Rid r'')]), r'' ↦ (σ;;τ, ε, e), r ↦ x))"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"r ≠ r''"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. (s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>') ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub>(r ↦ x, r' ↦ (σ, τ, ℰ [VE (Rid r'')]), r'' ↦ (σ;;τ, ε, e))"</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span>
</span><span>        </span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub>(r' ↦ (σ, τ, ℰ [VE (Rid r'')]), r'' ↦ (σ;;τ, ε, e), r ↦ x)"</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span>
</span><span>        </span><span>rule</span><span> </span><span>SLC_commute</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub>(r ↦ x, r' ↦ (σ, τ, ℰ [VE (Rid r'')]), r'' ↦ (σ;;τ, ε, e)) = 
    s<span class="hidden">⇩</span><sub>1</sub>(r' ↦ (σ, τ, ℰ [VE (Rid r'')]), r'' ↦ (σ;;τ, ε, e), r ↦ x)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>revision_step.fork</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>2</sub> (s<span class="hidden">⇩</span><sub>1</sub>(r ↦ x, r' ↦ (σ, τ, ℰ [VE (Rid r'')]), r'' ↦ (σ;;τ, ε, e)))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>assms</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>assms</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>revision_step.fork</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>2</sub>' (s<span class="hidden">⇩</span><sub>1</sub>(r' ↦ (σ, τ, ℰ [VE (Rid r'')]), r'' ↦ (σ;;τ, ε, e), r ↦ x))"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span> 
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>SLC_app</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> r = Some (σ, τ, ℰ[Apply (VE (Lambda x e)) (VE v)])"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>1</sub>(r ↦ (σ, τ, ℰ[subst (VE v) x e]))"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>neq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left_step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>right</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>new</span><span class="delimiter">:</span><span> </span><span class="delimiter">(</span><span>new</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_new_introduces_lids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>new</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_steps_commute</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>new</span><span> </span><span>l_fresh_left</span><span> </span><span>assms</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>fork</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>r''</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r''_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_fork_introduces_rids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_and_fork_commute</span><span class="delimiter">[</span><span>OF</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>fork</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r''_fresh_left</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join</span><span> </span><span>left_step</span><span> </span><span>right</span><span> </span><span>neq</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span> </span><span>left_step</span><span> </span><span>right</span><span> </span><span>neq</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_steps_commute</span><span class="delimiter">[</span><span>OF</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>assms</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>SLC_ifTrue</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> r = Some (σ, τ, ℰ[Ite (VE (CV T)) e1 e2])"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>1</sub>(r ↦ (σ, τ, ℰ[e1]))"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>neq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left_step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>right</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>new</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_new_introduces_lids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>new</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_steps_commute</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>new</span><span> </span><span>l_fresh_left</span><span> </span><span>assms</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>fork</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>r''</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r''_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_fork_introduces_rids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_and_fork_commute</span><span class="delimiter">[</span><span>OF</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>fork</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r''_fresh_left</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join</span><span> </span><span>left_step</span><span> </span><span>right</span><span> </span><span>neq</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span> </span><span>left_step</span><span> </span><span>right</span><span> </span><span>neq</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_steps_commute</span><span class="delimiter">[</span><span>OF</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>assms</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>SLC_ifFalse</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> r = Some (σ, τ, ℰ[Ite (VE (CV F)) e1 e2])"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>1</sub>(r ↦ (σ, τ, ℰ[e2]))"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>neq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left_step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>right</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>new</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_new_introduces_lids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>new</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_steps_commute</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>new</span><span> </span><span>l_fresh_left</span><span> </span><span>assms</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>fork</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>r''</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r''_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_fork_introduces_rids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_and_fork_commute</span><span class="delimiter">[</span><span>OF</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>fork</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r''_fresh_left</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join</span><span> </span><span>left_step</span><span> </span><span>right</span><span> </span><span>neq</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span> </span><span>left_step</span><span> </span><span>right</span><span> </span><span>neq</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_steps_commute</span><span class="delimiter">[</span><span>OF</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>assms</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>SLC_set</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> r = Some (σ, τ, ℰ[Assign (VE (Loc l)) (VE v)])"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>1</sub>(r ↦ (σ, τ(l ↦ v), ℰ[VE (CV Unit)]))"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>side</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom (σ;;τ)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>neq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left_step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>right</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>new</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_new_introduces_lids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>new</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_steps_commute</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>new</span><span> </span><span>l_fresh_left</span><span> </span><span>assms</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>fork</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>r''</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r''_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_fork_introduces_rids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_and_fork_commute</span><span class="delimiter">[</span><span>OF</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>fork</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r''_fresh_left</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>side</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join</span><span> </span><span>left_step</span><span> </span><span>neq</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span> </span><span>left_step</span><span> </span><span>neq</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_steps_commute</span><span class="delimiter">[</span><span>OF</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>assms</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>SLC_get</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> r = Some (σ, τ, ℰ [Read (VE (Loc l))])"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>1</sub>(r ↦ (σ, τ, ℰ[VE (the ((σ;;τ) l))]))"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>side</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom (σ;;τ)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>neq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left_step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>right</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>new</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_new_introduces_lids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>new</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_steps_commute</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>new</span><span> </span><span>l_fresh_left</span><span> </span><span>assms</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>fork</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>r''</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r''_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_fork_introduces_rids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_and_fork_commute</span><span class="delimiter">[</span><span>OF</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>fork</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r''_fresh_left</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>side</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join</span><span> </span><span>left_step</span><span> </span><span>neq</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span> </span><span>left_step</span><span> </span><span>neq</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_steps_commute</span><span class="delimiter">[</span><span>OF</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>assms</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Case new›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>SLC_new</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> r = Some (σ, τ, ℰ[Ref (VE v)])"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>1</sub>(r ↦ (σ, τ(l ↦ v), ℰ [VE (Loc l)]))"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>side</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>1</sub>"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>neq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable (s<span class="hidden">⇩</span><sub>1</sub> :: ('r,'l,'v) global_state)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>lid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'l set)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left_step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>right</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>app</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_app</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>app</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>ifTrue</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_ifTrue</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>ifTrue</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>ifFalse</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_ifFalse</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>ifFalse</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>new</span><span> </span><span>σ'</span><span> </span><span>τ'</span><span> </span><span>ℰ'</span><span> </span><span>v'</span><span> </span><span>l'</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r'_unchanged_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> r' = s<span class="hidden">⇩</span><sub>1</sub> r'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r_unchanged_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' r = s<span class="hidden">⇩</span><sub>1</sub> r"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"l = l'"</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>l''</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l''_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l'' ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>ex_new_if_finite</span><span> </span><span>left_step</span><span> </span><span>lid_inf</span><span> </span><span>reach</span><span> </span><span>RID<span class="hidden">⇩</span><sub>L</sub>_finite_invariant</span><span> </span><span>reachable_imp_identifiers_finite</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>l_l''</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ≠ l''"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l'' ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>1</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>True</span><span> </span><span>new</span><span> </span><span>l''_fresh_left</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>l''_fresh_right'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l'' ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span>l_l''</span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?β"</span></span></span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"id(l := l'', l'' := l)"</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>bij_β</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij ?β"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>swap_bij</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub>"</span></span></span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>(r' ↦ (σ', τ'(l'' ↦ v'), ℰ' [VE (Loc l'')]))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left_convergence</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>2</sub> ?s<span class="hidden">⇩</span><sub>3</sub>"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l''_fresh_left</span><span> </span><span>new</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>r'_unchanged_left</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>'(r ↦ (σ, τ(l'' ↦ v), ℰ [VE (Loc l'')]))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>right_convergence</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>2</sub>' ?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l''_fresh_right'</span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>equiv</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub> ≈ ?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>eq_statesI</span><span class="delimiter">[</span><span>of</span><span> </span><span>id</span><span> </span><span class="var">?β</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> id ?β ?s<span class="hidden">⇩</span><sub>3</sub> = ?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> id ?β s<span class="hidden">⇩</span><sub>1</sub> = s<span class="hidden">⇩</span><sub>1</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>σ</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> id ?β σ = σ"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ℰ</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>C</sub> id ?β ℰ = ℰ"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>C</sub> ℰ"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l'' ∉ LID<span class="hidden">⇩</span><sub>C</sub> ℰ"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l''_fresh_left</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>τlv</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> id (id(l := l'', l'' := l)) (τ(l ↦ v)) = (τ(l'' ↦ v))"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>τ</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> id ?β τ = τ"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>v</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>V</sub> id ?β v = v"</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l'' ∉ LID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>τ</span><span> </span><span>v</span><span> </span><span>bij_β</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>σ'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> id ?β σ' = σ'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>new</span><span class="delimiter">(</span><span>2</span><span>-</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>True</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ℰ'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>C</sub> id ?β ℰ' = ℰ'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>new</span><span class="delimiter">(</span><span>2</span><span>-</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>True</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>τl''v</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> id (id(l := l'', l'' := l)) (τ'(l'' ↦ v')) = (τ'(l ↦ v'))"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>τ'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> id ?β τ' = τ'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new</span><span class="delimiter">(</span><span>2</span><span>-</span><span>3</span><span class="delimiter">)</span><span> </span><span>l''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>True</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>v'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>V</sub> id ?β v' = v'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>new</span><span class="delimiter">(</span><span>2</span><span>-</span><span>3</span><span class="delimiter">)</span><span> </span><span>l''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>True</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>τ'</span><span> </span><span>v'</span><span> </span><span>bij_β</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>σ</span><span> </span><span>ℰ</span><span> </span><span>τlv</span><span> </span><span>σ'</span><span> </span><span>ℰ'</span><span> </span><span>τl''v</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>l_l''</span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_β</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>left_convergence</span><span> </span><span>right_convergence</span><span> </span><span>equiv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>revision_stepE</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>False</span><span> </span><span>side</span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: s<span class="hidden">⇩</span><sub>1</sub>_r›</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l'_fresh_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l' ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>revision_stepE</span><span class="delimiter">[</span><span>OF</span><span> </span><span>right</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>False</span><span> </span><span>new</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: new(2)›</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_steps_commute</span><span class="delimiter">[</span><span>OF</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>new</span><span> </span><span>assms</span><span> </span><span>l_fresh_left</span><span> </span><span>l'_fresh_right</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>get</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_get</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>get</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>set</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_set</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>set</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>fork</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>r''</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r''_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_fork_introduces_rids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_fresh_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_new_introduces_lids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>right</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>side</span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>local_and_fork_commute</span><span class="delimiter">[</span><span>OF</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>l_fresh_right</span><span> </span><span>r''_fresh_left</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join</span><span> </span><span>left_step</span><span> </span><span>neq</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span> </span><span>left_step</span><span> </span><span>neq</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Case fork›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>SLC_fork</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> r = Some (σ, τ, ℰ [Rfork e])"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> = (s<span class="hidden">⇩</span><sub>1</sub>(r ↦ (σ, τ, ℰ[VE (Rid left_forkee)]), left_forkee ↦ (σ;;τ, ε, e)))"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>side</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"left_forkee ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>1</sub>"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>neq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ r'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable (s<span class="hidden">⇩</span><sub>1</sub> :: ('r,'l,'v) global_state)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>rid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'r set)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left_step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>right</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>app</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_app</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span>app</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: ID_distr_global_conditional›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>ifTrue</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_ifTrue</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span>ifTrue</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: ID_distr_global_conditional›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>ifFalse</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_ifFalse</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span>ifFalse</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: ID_distr_global_conditional›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>new</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>l</span><span class="delimiter">)</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* symmetry is intentionally not exploited: this would require the lid_inf assumption *)</span></span></span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>l_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∉ LID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_new_introduces_lids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>left_step</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>new</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r''_fresh_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"left_forkee ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>only_fork_introduces_rids'</span><span class="delimiter">[</span><span>OF</span><span> </span><span>right</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>side</span><span> </span><span>new</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>local_and_fork_commute</span><span class="delimiter">[</span><span>OF</span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>new</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>r''_fresh_right</span><span> </span><span>l_fresh_left</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>get</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_get</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span>get</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: ID_distr_global_conditional›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>set</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_set</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>assms</span><span class="delimiter">(</span><span>1</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span>set</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹auto simp add: ID_distr_global_conditional›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>fork</span><span> </span><span>σ'</span><span> </span><span>τ'</span><span> </span><span>ℰ'</span><span> </span><span>e'</span><span> </span><span>right_forkee</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r'_unchanged_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> r' = s<span class="hidden">⇩</span><sub>1</sub> r'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>side</span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r_unchanged_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' r = s<span class="hidden">⇩</span><sub>1</sub> r"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">,</span><span>3</span><span class="delimiter">)</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ left_forkee"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ≠ right_forkee"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ≠ left_forkee"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r' ≠ right_forkee"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"left_forkee = right_forkee"</span></span></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>r''</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>r''_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>_finite_invariant</span><span> </span><span>ex_new_if_finite</span><span> </span><span>left_step</span><span> </span><span>reach</span><span> </span><span>reachable_imp_identifiers_finite</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>rid_inf</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ≠ left_forkee"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ≠ r"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r''_fresh_left</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ≠ r'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>r''_fresh_left</span><span> </span><span>r'_unchanged_left</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> (s<span class="hidden">⇩</span><sub>1</sub>(r ↦ (σ, τ, ℰ[VE (Rid left_forkee)])))"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>_def</span><span> </span><span>True</span><span> </span><span>UnI1</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r ≠ right_forkee›</span></span></span><span> </span><span>domIff</span><span> </span><span>fun_upd_other</span><span> </span><span>fun_upd_triv</span><span> </span><span>in_restricted_global_in_updated_global</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>r''_fresh_left</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> (s<span class="hidden">⇩</span><sub>1</sub>(r := None))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>1</sub>"</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r ≠ left_forkee›</span></span></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r''_fresh_left</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r'' ≠ r›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> (s<span class="hidden">⇩</span><sub>1</sub>(r := None))›</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r''_fresh_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r'' ≠ left_forkee›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r' ≠ right_forkee›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r'' ≠ r'›</span></span></span><span> </span><span>r''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>r''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>ID_distr_global_conditional</span><span> </span><span>fun_upd_twist</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?α</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"id(left_forkee := r'', r'' := left_forkee)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>bij_α</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij ?α"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>swap_bij</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub>"</span></span></span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>(r' ↦ (σ', τ', ℰ' [VE (Rid r'')]), r'' ↦ (σ';;τ', ε, e'))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left_convergence</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>2</sub> ?s<span class="hidden">⇩</span><sub>3</sub>"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>r''_fresh_left</span><span> </span><span>r'_unchanged_left</span><span> </span><span>revision_step.fork</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>'(r ↦ (σ, τ, ℰ[VE (Rid r'')]), r'' ↦ (σ;;τ, ε, e))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>right_convergence</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>2</sub>' ?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r''_fresh_right</span><span> </span><span>r_unchanged_right</span><span> </span><span>revision_step.fork</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>equiv</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"?s<span class="hidden">⇩</span><sub>3</sub> ≈ ?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>eq_statesI</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?α</span><span> </span><span>id</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> ?α id ?s<span class="hidden">⇩</span><sub>3</sub> = ?s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> ?α id s<span class="hidden">⇩</span><sub>1</sub> = s<span class="hidden">⇩</span><sub>1</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>σ</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> ?α id σ = σ"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>True</span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>τ</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> ?α id τ = τ"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>True</span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ℰ</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>C</sub> ?α id ℰ = ℰ"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"left_forkee ∉ RID<span class="hidden">⇩</span><sub>C</sub> ℰ"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>C</sub> ℰ"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r ≠ right_forkee›</span></span></span><span> </span><span>r''_fresh_left</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>E</sub> ?α id e = e"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"left_forkee ∉ RID<span class="hidden">⇩</span><sub>E</sub> e"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>E</sub> e"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r ≠ right_forkee›</span></span></span><span> </span><span>r''_fresh_left</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>σ'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> ?α id σ' = σ'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>r''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>τ'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> ?α id τ' = τ'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>r''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ℰ'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>C</sub> ?α id ℰ' = ℰ'"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"left_forkee ∉ RID<span class="hidden">⇩</span><sub>C</sub> ℰ'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>C</sub> ℰ'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>r''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>E</sub> ?α id e' = e'"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"left_forkee ∉ RID<span class="hidden">⇩</span><sub>E</sub> e'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>side</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r'' ∉ RID<span class="hidden">⇩</span><sub>E</sub> e'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>r''_fresh_s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>True</span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>neq</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>ℰ</span><span> </span><span>e</span><span>  </span><span>σ'</span><span> </span><span>τ'</span><span> </span><span>ℰ'</span><span> </span><span>e'</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span>
</span><span>            </span><span>bij_α</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r'' ≠ left_forkee›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r' ≠ left_forkee›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r ≠ left_forkee›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r'' ≠ r›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r'' ≠ r'›</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_α</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>equiv</span><span> </span><span>left_convergence</span><span> </span><span>right_convergence</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>False</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>right_forkee_fresh_left</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"right_forkee ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>False</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r ≠ left_forkee›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r ≠ right_forkee›</span></span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>ID_distr_global_conditional</span><span class="delimiter">,</span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>left_forkee_fresh_right</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"left_forkee ∉ RID<span class="hidden">⇩</span><sub>G</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>False</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r' ≠ right_forkee›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r' ≠ left_forkee›</span></span></span><span> </span><span>side</span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>ID_distr_global_conditional</span><span> </span><span>fun_upd_twist</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>(r' := s<span class="hidden">⇩</span><sub>2</sub>' r', right_forkee := s<span class="hidden">⇩</span><sub>2</sub>' right_forkee)"</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span>
</span><span>            </span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>'(r := s<span class="hidden">⇩</span><sub>2</sub> r, left_forkee := s<span class="hidden">⇩</span><sub>2</sub> left_forkee)"</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span>
</span><span>            </span><span>rule</span><span> </span><span>SLC_commute</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>(r' := s<span class="hidden">⇩</span><sub>2</sub>' r', right_forkee := s<span class="hidden">⇩</span><sub>2</sub>' right_forkee) = s<span class="hidden">⇩</span><sub>2</sub>'(r := s<span class="hidden">⇩</span><sub>2</sub> r, left_forkee := s<span class="hidden">⇩</span><sub>2</sub> left_forkee)"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>False</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r ≠ right_forkee›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r' ≠ left_forkee›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r' ≠ right_forkee›</span></span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>neq</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>2</sub> (s<span class="hidden">⇩</span><sub>2</sub>(r' := s<span class="hidden">⇩</span><sub>2</sub>' r', right_forkee := s<span class="hidden">⇩</span><sub>2</sub>' right_forkee))"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span> </span><span>r'_unchanged_left</span><span> </span><span>revision_step.fork</span><span> </span><span>right_forkee_fresh_left</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>2</sub>' (s<span class="hidden">⇩</span><sub>2</sub>'(r := s<span class="hidden">⇩</span><sub>2</sub> r, left_forkee := s<span class="hidden">⇩</span><sub>2</sub> left_forkee))"</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>left_forkee_fresh_right</span><span> </span><span>r_unchanged_right</span><span> </span><span>revision_step.fork</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_r</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join</span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join</span><span> </span><span>left_step</span><span> </span><span>assms</span><span class="delimiter">(</span><span>3</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>SLC_sym</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>SLC_join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">,</span><span> </span><span>use</span><span> </span><span>join<span class="hidden">⇩</span><sub>ε</sub></span><span> </span><span>left_step</span><span> </span><span>assms</span><span class="delimiter">(</span><span>3</span><span>-</span><span>5</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>auto</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹The theorem›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>strong_local_confluence</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>    </span><span>l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable (s<span class="hidden">⇩</span><sub>1</sub> :: ('r,'l,'v) global_state)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>lid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'l set)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>rid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'r set)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ (revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>) ∧ (revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">"r = r'"</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>True</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>l</span><span> </span><span>local_determinism</span><span> </span><span>r</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>neq</span><span class="delimiter">:</span><span> </span><span>False</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>rule</span><span class="delimiter">:</span><span> </span><span>revision_stepE</span><span class="delimiter">[</span><span>OF</span><span> </span><span>l</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assms</span><span> </span><span>SLC_app</span><span> </span><span>SLC_ifTrue</span><span>
</span><span>    </span><span>SLC_ifFalse</span><span> </span><span>SLC_new</span><span> </span><span>SLC_get</span><span> </span><span>SLC_set</span><span> </span><span>SLC_fork</span><span> </span><span>SLC_join</span><span> </span><span>SLC_join<span class="hidden">⇩</span><sub>ε</sub></span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Diagram Tiling›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Strong local confluence diagrams›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>SLC</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ↝ s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ↝ s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable (s<span class="hidden">⇩</span><sub>1</sub> :: ('r,'l,'v) global_state)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>lid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'l set)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>rid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'r set)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ s<span class="hidden">⇩</span><sub>2</sub> ↝<span class="hidden">⇧</span><sup>=</sup> s<span class="hidden">⇩</span><sub>3</sub> ∧ s<span class="hidden">⇩</span><sub>2</sub>' ↝<span class="hidden">⇧</span><sup>=</sup> s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>r</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>l</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub>'</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>r'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>r</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>3</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>3</sub>'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>3</sub>_eq_s<span class="hidden">⇩</span><sub>3</sub>'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>l_join</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r' s<span class="hidden">⇩</span><sub>2</sub> s<span class="hidden">⇩</span><sub>3</sub> ∨ s<span class="hidden">⇩</span><sub>2</sub> = s<span class="hidden">⇩</span><sub>3</sub>"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>r_join</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>2</sub>' s<span class="hidden">⇩</span><sub>3</sub>' ∨ s<span class="hidden">⇩</span><sub>2</sub>' = s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l</span><span> </span><span>r</span><span> </span><span>reach</span><span> </span><span>lid_inf</span><span> </span><span>rid_inf</span><span> </span><span>strong_local_confluence</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>s<span class="hidden">⇩</span><sub>3</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> ↝<span class="hidden">⇧</span><sup>=</sup> s<span class="hidden">⇩</span><sub>3</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_join</span><span> </span><span>steps_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>'s<span class="hidden">⇩</span><sub>3</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' ↝<span class="hidden">⇧</span><sup>=</sup> s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r_join</span><span> </span><span>steps_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>'s<span class="hidden">⇩</span><sub>3</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>s<span class="hidden">⇩</span><sub>3</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>3</sub>_eq_s<span class="hidden">⇩</span><sub>3</sub>'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>SLC_top_relaxed</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ↝<span class="hidden">⇧</span><sup>=</sup> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ↝ s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable (s<span class="hidden">⇩</span><sub>1</sub> :: ('r,'l,'v) global_state)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>lid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'l set)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>rid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'r set)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ s<span class="hidden">⇩</span><sub>2</sub> ↝<span class="hidden">⇧</span><sup>=</sup> s<span class="hidden">⇩</span><sub>3</sub> ∧ s<span class="hidden">⇩</span><sub>2</sub>' ↝<span class="hidden">⇧</span><sup>=</sup> s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ↝ s<span class="hidden">⇩</span><sub>2</sub> ⟹ s<span class="hidden">⇩</span><sub>1</sub> ↝ s<span class="hidden">⇩</span><sub>2</sub>' ⟹ ?thesis"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>SLC</span><span> </span><span>lid_inf</span><span> </span><span>reach</span><span> </span><span>rid_inf</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> = s<span class="hidden">⇩</span><sub>2</sub> ⟹ s<span class="hidden">⇩</span><sub>1</sub> ↝ s<span class="hidden">⇩</span><sub>2</sub>' ⟹ ?thesis"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>αβ_refl</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assms</span><span> </span><span>1</span><span> </span><span>2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Mimicking diagrams›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>bind_eq_None_conv</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>bind_eq_Some_conv</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>in_renamed_in_unlabelled_val</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"bij α ⟹ (α r ∈ RID<span class="hidden">⇩</span><sub>V</sub> (ℛ<span class="hidden">⇩</span><sub>V</sub> α β v)) = (r ∈ RID<span class="hidden">⇩</span><sub>V</sub> v)"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"bij β ⟹ (β l ∈ LID<span class="hidden">⇩</span><sub>V</sub> (ℛ<span class="hidden">⇩</span><sub>V</sub> α β v)) = (l ∈ LID<span class="hidden">⇩</span><sub>V</sub> v)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_is_inj</span><span> </span><span>inj_image_mem_iff</span><span> </span><span>val.set_map</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>in_renamed_in_unlabelled_expr</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"bij α ⟹ (α r ∈ RID<span class="hidden">⇩</span><sub>E</sub> (ℛ<span class="hidden">⇩</span><sub>E</sub> α β v)) = (r ∈ RID<span class="hidden">⇩</span><sub>E</sub> v)"</span></span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">"bij β ⟹ (β l ∈ LID<span class="hidden">⇩</span><sub>E</sub> (ℛ<span class="hidden">⇩</span><sub>E</sub> α β v)) = (l ∈ LID<span class="hidden">⇩</span><sub>E</sub> v)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_is_inj</span><span> </span><span>inj_image_mem_iff</span><span> </span><span>expr.set_map</span><span class="delimiter">(</span><span>1</span><span>-</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>in_renamed_in_unlabelled_store</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>    </span><span>bij_α</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij α"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bij_β</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij β"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"(α r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ)) = (r ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ)"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"(β l ∈ LID<span class="hidden">⇩</span><sub>S</sub> (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ)) = (l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(α r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ)) = (r ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"α r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ)"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>RID<span class="hidden">⇩</span><sub>S</sub>E</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span> </span><span>v</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>map</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ l = Some v"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>αr</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"α r ∈ RID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"σ (inv β l) = Some (ℛ<span class="hidden">⇩</span><sub>V</sub> (inv α) (inv β) v)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_is_inj</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>V</sub> (ℛ<span class="hidden">⇩</span><sub>V</sub> (inv α) (inv β) v)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span>αr</span><span> </span><span>map</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_is_inj</span><span> </span><span>in_renamed_in_unlabelled_val</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹σ (inv β l) = Some (ℛ<span class="hidden">⇩</span><sub>V</sub> (inv α) (inv β) v)›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹r ∈ RID<span class="hidden">⇩</span><sub>V</sub> (ℛ<span class="hidden">⇩</span><sub>V</sub> (inv α) (inv β) v)›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"α r ∈ RID<span class="hidden">⇩</span><sub>S</sub> (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ)"</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>RID<span class="hidden">⇩</span><sub>S</sub>E</span><span> </span><span>RID<span class="hidden">⇩</span><sub>S</sub>I</span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span>fun_upd_same</span><span> </span><span>fun_upd_triv</span><span> 
</span><span>      </span><span>in_renamed_in_unlabelled_val</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>renaming_distr_store</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(β l ∈ LID<span class="hidden">⇩</span><sub>S</sub> (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ)) = (l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"β l ∈ LID<span class="hidden">⇩</span><sub>S</sub> (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ)"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>E</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"β l ∈ dom (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ)"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>I</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>bij_β</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_left</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>v</span><span> </span><span>l'</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ l' = Some v"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"β l ∈ LID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bij_β</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>I</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>in_renamed_in_unlabelled_val</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>S</sub> σ"</span></span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"β l ∈ LID<span class="hidden">⇩</span><sub>S</sub> (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>E</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ dom σ"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∃σ' v. σ = (σ'(l ↦ v))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"β l ∈ dom (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bij_β</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"β l ∈ LID<span class="hidden">⇩</span><sub>S</sub> (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>v</span><span> </span><span>l'</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"σ l' = Some v"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>l_in_v</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>V</sub> v"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∃σ'. σ = (σ'(l' ↦ v))"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"β l ∈ LID<span class="hidden">⇩</span><sub>S</sub> (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ)"</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>l_in_v</span><span> </span><span>bij_β</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>LID<span class="hidden">⇩</span><sub>S</sub>I</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>in_renamed_in_unlabelled_val</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>in_renamed_in_unlabelled_local</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>bij_α</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij α"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bij_β</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij β"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"(α r ∈ RID<span class="hidden">⇩</span><sub>L</sub> (ℛ<span class="hidden">⇩</span><sub>L</sub> α β ls)) = (r ∈ RID<span class="hidden">⇩</span><sub>L</sub> ls)"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"(β l ∈ LID<span class="hidden">⇩</span><sub>L</sub> (ℛ<span class="hidden">⇩</span><sub>L</sub> α β ls)) = (l ∈ LID<span class="hidden">⇩</span><sub>L</sub> ls)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>cases</span><span> </span><span>ls</span><span class="delimiter">,</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assms</span><span> </span><span>in_renamed_in_unlabelled_expr</span><span> </span><span>in_renamed_in_unlabelled_store</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>in_renamed_in_unlabelled_global</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>bij_α</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij α"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bij_β</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij β"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"(α r ∈ RID<span class="hidden">⇩</span><sub>G</sub> (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)) = (r ∈ RID<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">"(β l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)) = (l ∈ LID<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(α r ∈ RID<span class="hidden">⇩</span><sub>G</sub> (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)) = (r ∈ RID<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"α r ∈ RID<span class="hidden">⇩</span><sub>G</sub> (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>E</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"α r ∈ dom (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ dom s"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>bij_α</span><span> </span><span>domIff</span><span> </span><span>fun_upd_same</span><span> </span><span>fun_upd_triv</span><span> </span><span>renaming_distr_global</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>r'</span><span> </span><span>ls</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>ℛsr'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> α β s r' = Some ls"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>αr</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"α r ∈ RID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s_inv_αr'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s (inv α r') = Some (ℛ<span class="hidden">⇩</span><sub>L</sub> (inv α) (inv β) ls)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"inv α r' ∈ dom s"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ℛsr'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ls'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s_inv_αr</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s (inv α r') = Some ls'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> α β s r' = Some (ℛ<span class="hidden">⇩</span><sub>L</sub> α β ls')"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ls = (ℛ<span class="hidden">⇩</span><sub>L</sub> α β ls')"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ℛsr'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>L</sub>_inv</span><span> </span><span>s_inv_αr</span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r_in</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>L</sub> (ℛ<span class="hidden">⇩</span><sub>L</sub> (inv α) (inv β) ls)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span>bij_imp_bij_inv</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_left</span><span> </span><span>in_renamed_in_unlabelled_local</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>αr</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r_in</span><span> </span><span>s_inv_αr'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"α r ∈ RID<span class="hidden">⇩</span><sub>G</sub> (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>RID<span class="hidden">⇩</span><sub>G</sub>E</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ dom s"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"α r ∈ dom (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>bij_α</span><span> </span><span>domD</span><span> </span><span>domI</span><span> </span><span>fun_upd_same</span><span> </span><span>fun_upd_triv</span><span> </span><span>renaming_distr_global</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"α r ∈ RID<span class="hidden">⇩</span><sub>G</sub> (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>r'</span><span> </span><span>ls</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s r' = Some ls"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"r ∈ RID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"α r ∈ RID<span class="hidden">⇩</span><sub>G</sub> (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)"</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>ID_distr_global</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>UnI2</span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span>fun_upd_triv</span><span> </span><span>in_renamed_in_unlabelled_local</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>insertI2</span><span> </span><span>renaming_distr_global</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(β l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)) = (l ∈ LID<span class="hidden">⇩</span><sub>G</sub> s)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>iffI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"β l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>r</span><span> </span><span>ls</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>Rs_ls</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> α β s r = Some ls"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>βl_in_ls</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"β l ∈ LID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>L</sub> (ℛ<span class="hidden">⇩</span><sub>L</sub> (inv α) (inv β) ls)"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span>bij_imp_bij_inv</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_left</span><span> </span><span>in_renamed_in_unlabelled_local</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (ℛ<span class="hidden">⇩</span><sub>G</sub> (inv α) (inv β) (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>LID<span class="hidden">⇩</span><sub>G</sub>I</span><span> </span><span>Rs_ls</span><span> </span><span>bij_α</span><span> </span><span>bij_imp_bij_inv</span><span> </span><span>fun_upd_idem_iff</span><span> </span><span>renaming_distr_global</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>ℛ<span class="hidden">⇩</span><sub>G</sub>_inv</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>G</sub> s"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>r</span><span> </span><span>s'</span><span> </span><span>ls</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s = (s'(r ↦ ls))"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"l ∈ LID<span class="hidden">⇩</span><sub>L</sub> ls"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>LID<span class="hidden">⇩</span><sub>G</sub>E</span><span> </span><span>fun_upd_triv</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"β l ∈ LID<span class="hidden">⇩</span><sub>G</sub> (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span>in_renamed_in_unlabelled_local</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>mimicking</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s s'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bij_α</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij α"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bij_β</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij β"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step (α r) (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s) (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s')"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>step</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹cases rule: revision_stepE›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>app</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_left</span><span> </span><span>renaming_distr_subst</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>new</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>_</span><span> </span><span>l</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>βl_fresh</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"β l ∉ LID<span class="hidden">⇩</span><sub>G</sub> (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span>in_renamed_in_unlabelled_global</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>new</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>βl_fresh</span><span> </span><span>new</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_left</span><span class="delimiter">)</span><span>   
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>fork</span><span> </span><span>σ</span><span> </span><span>τ</span><span> </span><span>ℰ</span><span> </span><span>e</span><span> </span><span>r'</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>αr'_fresh</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"α r' ∉ RID<span class="hidden">⇩</span><sub>G</sub> (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s)"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span>in_renamed_in_unlabelled_global</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>fork</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s_r_as_upd</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s = (s(r ↦ (σ, τ, ℰ [Rfork e])))"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fork</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>src</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> α β s (α r) = Some (ℛ<span class="hidden">⇩</span><sub>S</sub> α β σ, ℛ<span class="hidden">⇩</span><sub>S</sub> α β τ, (ℛ<span class="hidden">⇩</span><sub>C</sub> α β ℰ) [Rfork (ℛ<span class="hidden">⇩</span><sub>E</sub> α β e)])"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>subst</span><span> </span><span>s_r_as_upd</span><span class="delimiter">,</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_α</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>αr'_fresh</span><span> </span><span>src</span><span> </span><span>revision_step.fork</span><span> </span><span>fork</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>bij_α</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span>bijection.intro</span><span> </span><span>bijection.inv_left</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>mimic_single_step</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>1</sub>'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ≈ s<span class="hidden">⇩</span><sub>1</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ↝ s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>2</sub>'. (s<span class="hidden">⇩</span><sub>2</sub> ≈ s<span class="hidden">⇩</span><sub>2</sub>') ∧ s<span class="hidden">⇩</span><sub>1</sub>' ↝ s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>1</sub>'</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>α</span><span> </span><span>β</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> 
</span><span>    </span><span>bij_α</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij α"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> 
</span><span>    </span><span>bij_β</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij β"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>R</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> α β s<span class="hidden">⇩</span><sub>1</sub> = s<span class="hidden">⇩</span><sub>1</sub>'"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>r</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step r s<span class="hidden">⇩</span><sub>1</sub> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>mirrored_step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"revision_step (α r) s<span class="hidden">⇩</span><sub>1</sub>' (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s<span class="hidden">⇩</span><sub>2</sub>)"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>R</span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span>step</span><span> </span><span>mimicking</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> ≈ (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s<span class="hidden">⇩</span><sub>2</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bij_α</span><span> </span><span>bij_β</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>'s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub>' ↝ (ℛ<span class="hidden">⇩</span><sub>G</sub> α β s<span class="hidden">⇩</span><sub>2</sub>)"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>mirrored_step</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>eq</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>'s<span class="hidden">⇩</span><sub>2</sub>'</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>mimic_trans</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>_eq_s<span class="hidden">⇩</span><sub>1</sub>'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ≈ s<span class="hidden">⇩</span><sub>1</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>2</sub>'. s<span class="hidden">⇩</span><sub>2</sub> ≈ s<span class="hidden">⇩</span><sub>2</sub>' ∧ s<span class="hidden">⇩</span><sub>1</sub>' ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_eq_s<span class="hidden">⇩</span><sub>1</sub>'</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>α</span><span> </span><span>β</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>    </span><span>bij_α</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij α"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>bij_β</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij β"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>R</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> α β s<span class="hidden">⇩</span><sub>1</sub> = s<span class="hidden">⇩</span><sub>1</sub>'"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(s<span class="hidden">⇩</span><sub>1</sub>,s<span class="hidden">⇩</span><sub>2</sub>) ∈ [↝]^^n"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtrancl_power</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>n</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>    </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>_eq_s<span class="hidden">⇩</span><sub>1</sub>'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>x</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>n_steps</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(s<span class="hidden">⇩</span><sub>1</sub>, x) ∈ [↝]^^n"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>step</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"x ↝ s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc.prems</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>x'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x_eq_x'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"x ≈ x'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>'x</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub>' ↝<span class="hidden">⇧</span><sup>*</sup> x'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc.hyps</span><span> </span><span>n_steps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>_eq_s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> ≈ s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x's<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"x' ↝ s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>step</span><span> </span><span>mimic_single_step</span><span> </span><span>x_eq_x'</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>'x</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>_eq_s<span class="hidden">⇩</span><sub>2</sub>'</span><span> </span><span>trancl_into_rtrancl</span><span> </span><span>x's<span class="hidden">⇩</span><sub>2</sub>'</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Strip diagram›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>strip_lemma</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ↝<span class="hidden">⇧</span><sup>=</sup> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable (s<span class="hidden">⇩</span><sub>1</sub> :: ('r,'l,'v) global_state)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>lid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'l set)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>rid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'r set)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ s<span class="hidden">⇩</span><sub>2</sub> ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>3</sub> ∧ s<span class="hidden">⇩</span><sub>2</sub>' ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(s<span class="hidden">⇩</span><sub>1</sub>, s<span class="hidden">⇩</span><sub>2</sub>) ∈ [↝]^^n"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rtrancl_power</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>reach</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub>'</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>n</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> = s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"0.prems"</span></span></span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span>s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span>s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>use</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>s<span class="hidden">⇩</span><sub>2</sub>'</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹simp add: αβ_refl›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>a</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ↝ a"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>as<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(a, s<span class="hidden">⇩</span><sub>2</sub>) ∈ [↝]^^n"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>relpow_Suc_D2</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>b</span><span> </span><span>c</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"b ≈ c"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"a ↝<span class="hidden">⇧</span><sup>=</sup> b"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' ↝<span class="hidden">⇧</span><sup>=</sup> c"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>SLC_top_relaxed</span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>αβ_sym</span><span> </span><span>lid_inf</span><span> </span><span>rid_inf</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>a</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>d</span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"d ≈ e"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> ↝<span class="hidden">⇧</span><sup>*</sup> d"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"b ↝<span class="hidden">⇧</span><sup>*</sup> e"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Suc.hyps</span><span> </span><span>Suc.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹a ↝<span class="hidden">⇧</span><sup>=</sup> b›</span></span></span><span> </span><span>as<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>reachability_closed_under_execution_step</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>a</span><span> </span><span>valid_stepE</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>f</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"c ↝<span class="hidden">⇧</span><sup>*</sup> f"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"e ≈ f"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span>  </span><span class="cartouche"><span class="delete"><span class="delete">‹b ≈ c›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹b ↝<span class="hidden">⇧</span><sup>*</sup> e›</span></span></span><span> </span><span>mimic_trans</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"d ≈ f"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>αβ_trans</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹d ≈ e›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹e ≈ f›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹c ↝<span class="hidden">⇧</span><sup>*</sup> f›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s<span class="hidden">⇩</span><sub>2</sub> ↝<span class="hidden">⇧</span><sup>*</sup> d›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s<span class="hidden">⇩</span><sub>2</sub>' ↝<span class="hidden">⇧</span><sup>=</sup> c›</span></span></span><span> </span><span>r_into_rtrancl</span><span> </span><span>rtrancl_reflcl</span><span> </span><span>rtrancl_trans</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Confluence diagram›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>confluence_modulo_equivalence</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub>' ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>2</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>equiv</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ≈ s<span class="hidden">⇩</span><sub>1</sub>'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable (s<span class="hidden">⇩</span><sub>1</sub> :: ('r,'l,'v) global_state)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>lid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'l set)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>rid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'r set)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∃s<span class="hidden">⇩</span><sub>3</sub> s<span class="hidden">⇩</span><sub>3</sub>'. s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>' ∧ s<span class="hidden">⇩</span><sub>2</sub> ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>3</sub> ∧ s<span class="hidden">⇩</span><sub>2</sub>' ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"(s<span class="hidden">⇩</span><sub>1</sub>, s<span class="hidden">⇩</span><sub>2</sub>) ∈ [↝]^^n"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>rtrancl_power</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>reach</span><span> </span><span>equiv</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>s<span class="hidden">⇩</span><sub>2</sub>'</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>induct</span><span> </span><span>n</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>'</span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>base</span><span class="delimiter">:</span><span> </span><span>0</span><span>
</span><span>    </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> = s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>2</sub>''</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>1</sub> ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>2</sub>''"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' ≈ s<span class="hidden">⇩</span><sub>2</sub>''"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>αβ_sym</span><span> </span><span>base.prems</span><span class="delimiter">(</span><span>2</span><span class="delimiter">,</span><span>3</span><span class="delimiter">)</span><span> </span><span>mimic_trans</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>2</sub>''"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s<span class="hidden">⇩</span><sub>1</sub> = s<span class="hidden">⇩</span><sub>2</sub>›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s<span class="hidden">⇩</span><sub>1</sub> ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>2</sub>''›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span>s<span class="hidden">⇩</span><sub>2</sub>''</span><span class="delimiter">]</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>exI</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">=</span><span>s<span class="hidden">⇩</span><sub>2</sub>'</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="delimiter">(</span><span>auto</span><span> </span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>αβ_sym</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s<span class="hidden">⇩</span><sub>2</sub> ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>2</sub>''›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s<span class="hidden">⇩</span><sub>2</sub>' ≈ s<span class="hidden">⇩</span><sub>2</sub>''›</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>step</span><span class="delimiter">:</span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>a</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(s<span class="hidden">⇩</span><sub>1</sub>, a) ∈ [↝]^^n"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>as<span class="hidden">⇩</span><sub>2</sub></span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"a ↝ s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step.prems</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable a"</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>reachability_closed_under_execution</span><span> </span><span>relpow_imp_rtrancl</span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>a</span><span> </span><span>step.prems</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>b</span><span> </span><span>c</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"a ↝<span class="hidden">⇧</span><sup>*</sup> b"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub>' ↝<span class="hidden">⇧</span><sup>*</sup> c"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"b ≈ c"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>1</sub>a</span><span> </span><span>step.hyps</span><span> </span><span>step.prems</span><span class="delimiter">(</span><span>1</span><span>-</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"a ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>2</sub>"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>as<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>r_into_rtrancl</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>3</sub></span><span> </span><span>d</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>3</sub> ≈ d"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>2</sub> ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>3</sub>"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"b ↝<span class="hidden">⇧</span><sup>*</sup> d"</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>αβ_sym</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹a ↝<span class="hidden">⇧</span><sup>*</sup> b›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹reachable a›</span></span></span><span> </span><span>as<span class="hidden">⇩</span><sub>2</sub></span><span> </span><span>lid_inf</span><span> </span><span>refl_rewritesI</span><span> </span><span>rid_inf</span><span> </span><span>strip_lemma</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s<span class="hidden">⇩</span><sub>3</sub>'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"c ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>3</sub>'"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>αβ_trans</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹b ≈ c›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹b ↝<span class="hidden">⇧</span><sup>*</sup> d›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s<span class="hidden">⇩</span><sub>3</sub> ≈ d›</span></span></span><span> </span><span>mimic_trans</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹c ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>3</sub>'›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s<span class="hidden">⇩</span><sub>2</sub> ↝<span class="hidden">⇧</span><sup>*</sup> s<span class="hidden">⇩</span><sub>3</sub>›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s<span class="hidden">⇩</span><sub>2</sub>' ↝<span class="hidden">⇧</span><sup>*</sup> c›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s<span class="hidden">⇩</span><sub>3</sub> ≈ s<span class="hidden">⇩</span><sub>3</sub>'›</span></span></span><span> </span><span>transD</span><span> </span><span>trans_rtrancl</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Determinacy›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>determinacy</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> 
</span><span>    </span><span>prog_expr</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"program_expr e"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>e_terminates_in_s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"e ↓ s"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>e_terminates_in_s'</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"e ↓ s'"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>lid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'l set)"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>    </span><span>rid_inf</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"infinite (UNIV :: 'r set)"</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s ≈ s'"</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>r</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>x</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(ε(r ↦ (ε,ε,e))) ↝<span class="hidden">⇧</span><sup>*</sup> s"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>e_terminates_in_s</span><span> </span><span>execution_def</span><span> </span><span>maximal_execution_def</span><span> </span><span>terminates_in_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>r'</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>y</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(ε(r' ↦ (ε,ε,e))) ↝<span class="hidden">⇧</span><sup>*</sup> s'"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>e_terminates_in_s'</span><span> </span><span>execution_def</span><span> </span><span>maximal_execution_def</span><span> </span><span>terminates_in_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"?α"</span></span></span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">"id(r := r', r' := r)"</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>bij_α</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"bij ?α"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>swap_bij</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>equiv</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"(ε(r ↦ (ε,ε,e))) ≈ (ε(r' ↦ (ε,ε,e)))"</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>eq_statesI</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?α</span><span> </span><span>id</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"ℛ<span class="hidden">⇩</span><sub>G</sub> ?α id (ε(r ↦ (ε, ε, e))) = ε(r' ↦ (ε, ε, e))"</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>bij_α</span><span> </span><span>prog_expr</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>bij_α</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>reach</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"reachable (ε(r ↦ (ε,ε,e)))"</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>initial_state_reachable</span><span> </span><span>prog_expr</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"∃a b. (a ≈ b) ∧ s ↝<span class="hidden">⇧</span><sup>*</sup> a ∧ s' ↝<span class="hidden">⇧</span><sup>*</sup> b"</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>rule</span><span> </span><span>confluence_modulo_equivalence</span><span class="delimiter">[</span><span>OF</span><span> </span><span>x</span><span> </span><span>y</span><span> </span><span>equiv</span><span> </span><span>reach</span><span> </span><span>lid_inf</span><span> </span><span>rid_inf</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>this</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a</span><span> </span><span>b</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s ↝<span class="hidden">⇧</span><sup>*</sup> a"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s' ↝<span class="hidden">⇧</span><sup>*</sup> b"</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">"a ≈ b"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s = a"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s ↝<span class="hidden">⇧</span><sup>*</sup> a›</span></span></span><span> </span><span>e_terminates_in_s</span><span> </span><span>maximal_execution_def</span><span> </span><span>rtranclD</span><span> </span><span>terminates_in_def</span><span> </span><span>tranclD</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"s' = b"</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s' ↝<span class="hidden">⇧</span><sup>*</sup> b›</span></span></span><span> </span><span>converse_rtranclE</span><span> </span><span>e_terminates_in_s'</span><span> </span><span>maximal_execution_def</span><span> </span><span>terminates_in_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹a ≈ b›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s = a›</span></span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹s' = b›</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* substitution locale *)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>
</div>
</div>