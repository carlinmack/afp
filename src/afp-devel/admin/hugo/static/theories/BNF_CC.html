<div id="Preliminaries">
<div class="head">
<h1>Theory Preliminaries</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Andreas Lochbihler, ETH Zurich
   Author: Joshua Schneider, ETH Zurich *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Preliminaries <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">alias</span></span> Grp <span class="main">=</span> BNF_Def.Grp
<span class="keyword1"><span class="command">alias</span></span> vimage2p <span class="main">=</span> BNF_Def.vimage2p

<span class="keyword1"><span class="command">lemma</span></span> Domainp_conversep<span class="main">:</span> <span class="quoted"><span class="quoted">"Domainp <span class="free">R</span><span class="main">¯¯</span> <span class="main">=</span> Rangep <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Grp_apply<span class="main">:</span> <span class="quoted"><span class="quoted">"Grp <span class="free">A</span> <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Grp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conversep_Grp_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Grp <span class="free">A</span> id<span class="main">)</span><span class="main">¯¯</span> <span class="main">=</span> Grp <span class="free">A</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff Grp_apply<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eq_onp_compp_Grp<span class="main">:</span> <span class="quoted"><span class="quoted">"eq_onp <span class="free">P</span> <span class="keyword1">OO</span> Grp <span class="free">A</span> <span class="free">f</span> <span class="main">=</span> Grp <span class="main">(</span>Collect <span class="free">P</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff eq_onp_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> GrpE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> GrpI<span class="main">)</span>


<span class="keyword1"><span class="command">consts</span></span> relcompp_witness <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>

<span class="keyword1"><span class="command">specification</span></span> <span class="main">(</span><span class="quoted">relcompp_witness</span><span class="main">)</span>
  relcompp_witness1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">OO</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>fst <span class="free">xy</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">xy</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">(</span>fst <span class="free">xy</span><span class="main">)</span> <span class="main">(</span>relcompp_witness <span class="free">A</span> <span class="free">B</span> <span class="free">xy</span><span class="main">)</span>"</span></span>
  relcompp_witness2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">OO</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>fst <span class="free">xy</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">xy</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">(</span>relcompp_witness <span class="free">A</span> <span class="free">B</span> <span class="free">xy</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">xy</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> all_conj_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> choice allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> relcompp_witness<span class="main">[</span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">y</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="free"><span class="free">x</span></span> <span class="free"><span class="free">y</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="main">=</span> relcompp_witness1 relcompp_witness2

<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> relcompp_witness1 relcompp_witness2

<span class="keyword1"><span class="command">lemma</span></span> relcompp_witness_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"relcompp_witness <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> relcompp_witness<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(=)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(=)</span>"</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_OO<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> Quotient_equiv_abs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Quotient <span class="free">R</span> <span class="free">Abs</span> <span class="free">Rep</span> <span class="free">T</span><span class="main">;</span> <span class="free">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="free">x</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Quotient_alt_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> Quotient_equiv_abs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Quotient <span class="free">R</span> <span class="free">Abs</span> <span class="free">Rep</span> <span class="free">T</span><span class="main">;</span> <span class="free">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">T</span> <span class="free">y</span> <span class="main">(</span><span class="free">Abs</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Quotient_alt_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> Quotient_rep_equiv1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Quotient <span class="free">R</span> <span class="free">Abs</span> <span class="free">Rep</span> <span class="free">T</span><span class="main">;</span> <span class="free">T</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span> <span class="free">a</span> <span class="main">(</span><span class="free">Rep</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Quotient_alt_def3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> Quotient_rep_equiv2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Quotient <span class="free">R</span> <span class="free">Abs</span> <span class="free">Rep</span> <span class="free">T</span><span class="main">;</span> <span class="free">T</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">R</span> <span class="main">(</span><span class="free">Rep</span> <span class="free">b</span><span class="main">)</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Quotient_alt_def3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Axiomatised_BNF_CC">
<div class="head">
<h1>Theory Axiomatised_BNF_CC</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Andreas Lochbihler, ETH Zurich
   Author: Joshua Schneider, ETH Zurich *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Axiomatisation›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Axiomatised_BNF_CC <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Preliminaries.html">Preliminaries</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Rewrite.html">HOL-Library.Rewrite</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">unbundle</span></span> cardinal_syntax

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This theory axiomatises two \BNFCC{}s, which will be used to demonstrate the closedness of \BNFCC{}s
  under various operations.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹First abstract \BNFCC{}›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Axioms and basic definitions›</span></span>

<span class="keyword1"><span class="command">typedecl</span></span> <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> F<span class="antiquote"><span class="antiquote">}</span></span></span></span> has each three live, co-, and contravariant parameters, and one fixed parameter.›</span></span>

<span class="keyword1"><span class="command">consts</span></span>
  rel_F <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l3</span> <span class="main">⇒</span> <span class="tfree">'l3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co3</span> <span class="main">⇒</span> <span class="tfree">'co3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra3</span> <span class="main">⇒</span> <span class="tfree">'contra3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1'</span><span class="main">,</span> <span class="tfree">'l2'</span><span class="main">,</span> <span class="tfree">'l3'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'co3'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'contra3'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F <span class="main">⇒</span> bool"</span></span>
  map_F <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l3</span> <span class="main">⇒</span> <span class="tfree">'l3'</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co3</span> <span class="main">⇒</span> <span class="tfree">'co3'</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra3'</span> <span class="main">⇒</span> <span class="tfree">'contra3</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1'</span><span class="main">,</span> <span class="tfree">'l2'</span><span class="main">,</span> <span class="tfree">'l3'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'co3'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'contra3'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  rel_F_mono <span class="main">[</span><span class="operator">mono</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L1'</span> <span class="bound">L2</span> <span class="bound">L2'</span> <span class="bound">L3</span> <span class="bound">L3'</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Co3</span> <span class="bound">Co3'</span>
    <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">Contra3</span> <span class="bound">Contra3'</span><span class="main">.</span>
    <span class="main">⟦</span> <span class="bound">L1</span> <span class="main">≤</span> <span class="bound">L1'</span><span class="main">;</span> <span class="bound">L2</span> <span class="main">≤</span> <span class="bound">L2'</span><span class="main">;</span> <span class="bound">L3</span> <span class="main">≤</span> <span class="bound">L3'</span><span class="main">;</span> <span class="bound">Co1</span> <span class="main">≤</span> <span class="bound">Co1'</span><span class="main">;</span> <span class="bound">Co2</span> <span class="main">≤</span> <span class="bound">Co2'</span><span class="main">;</span> <span class="bound">Co3</span> <span class="main">≤</span> <span class="bound">Co3'</span><span class="main">;</span>
      <span class="bound">Contra1'</span> <span class="main">≤</span> <span class="bound">Contra1</span><span class="main">;</span> <span class="bound">Contra2'</span> <span class="main">≤</span> <span class="bound">Contra2</span><span class="main">;</span> <span class="bound">Contra3'</span> <span class="main">≤</span> <span class="bound">Contra3</span> <span class="main">⟧</span> <span class="main">⟹</span>
    rel_F <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="bound">Co1</span> <span class="bound">Co2</span> <span class="bound">Co3</span> <span class="bound">Contra1</span> <span class="bound">Contra2</span> <span class="bound">Contra3</span> <span class="main">≤</span>
    rel_F <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="bound">L3'</span> <span class="bound">Co1'</span> <span class="bound">Co2'</span> <span class="bound">Co3'</span> <span class="bound">Contra1'</span> <span class="bound">Contra2'</span> <span class="bound">Contra3'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rel_F_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_F <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rel_F_conversep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="bound">Co1</span> <span class="bound">Co2</span> <span class="bound">Co3</span> <span class="bound">Contra1</span> <span class="bound">Contra2</span> <span class="bound">Contra3</span><span class="main">.</span>
    rel_F <span class="bound">L1</span><span class="main">¯¯</span> <span class="bound">L2</span><span class="main">¯¯</span> <span class="bound">L3</span><span class="main">¯¯</span> <span class="bound">Co1</span><span class="main">¯¯</span> <span class="bound">Co2</span><span class="main">¯¯</span> <span class="bound">Co3</span><span class="main">¯¯</span> <span class="bound">Contra1</span><span class="main">¯¯</span> <span class="bound">Contra2</span><span class="main">¯¯</span> <span class="bound">Contra3</span><span class="main">¯¯</span> <span class="main">=</span>
    <span class="main">(</span>rel_F <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="bound">Co1</span> <span class="bound">Co2</span> <span class="bound">Co3</span> <span class="bound">Contra1</span> <span class="bound">Contra2</span> <span class="bound">Contra3</span><span class="main">)</span><span class="main">¯¯</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  map_F_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"map_F id id id id id id id id id <span class="main">=</span> id"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  map_F_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l1</span> <span class="bound">l1'</span> <span class="bound">l2</span> <span class="bound">l2'</span> <span class="bound">l3</span> <span class="bound">l3'</span> <span class="bound">co1</span> <span class="bound">co1'</span> <span class="bound">co2</span> <span class="bound">co2'</span> <span class="bound">co3</span> <span class="bound">co3'</span>
    <span class="bound">contra1</span> <span class="bound">contra1'</span> <span class="bound">contra2</span> <span class="bound">contra2'</span> <span class="bound">contra3</span> <span class="bound">contra3'</span><span class="main">.</span>
    map_F <span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">l3</span> <span class="bound">co1</span> <span class="bound">co2</span> <span class="bound">co3</span> <span class="bound">contra1</span> <span class="bound">contra2</span> <span class="bound">contra3</span> <span class="main">∘</span>
      map_F <span class="bound">l1'</span> <span class="bound">l2'</span> <span class="bound">l3'</span> <span class="bound">co1'</span> <span class="bound">co2'</span> <span class="bound">co3'</span> <span class="bound">contra1'</span> <span class="bound">contra2'</span> <span class="bound">contra3'</span> <span class="main">=</span>
    map_F <span class="main">(</span><span class="bound">l1</span> <span class="main">∘</span> <span class="bound">l1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">l2</span> <span class="main">∘</span> <span class="bound">l2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">l3</span> <span class="main">∘</span> <span class="bound">l3'</span><span class="main">)</span> <span class="main">(</span><span class="bound">co1</span> <span class="main">∘</span> <span class="bound">co1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">co2</span> <span class="main">∘</span> <span class="bound">co2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">co3</span> <span class="main">∘</span> <span class="bound">co3'</span><span class="main">)</span>
      <span class="main">(</span><span class="bound">contra1'</span> <span class="main">∘</span> <span class="bound">contra1</span><span class="main">)</span> <span class="main">(</span><span class="bound">contra2'</span> <span class="main">∘</span> <span class="bound">contra2</span><span class="main">)</span> <span class="main">(</span><span class="bound">contra3'</span> <span class="main">∘</span> <span class="bound">contra3</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  map_F_parametric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L1'</span> <span class="bound">L2</span> <span class="bound">L2'</span> <span class="bound">L3</span> <span class="bound">L3'</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Co3</span> <span class="bound">Co3'</span>
    <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">Contra3</span> <span class="bound">Contra3'</span><span class="main">.</span>
    rel_fun <span class="main">(</span>rel_fun <span class="bound">L1</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="bound">L2</span> <span class="bound">L2'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="bound">L3</span> <span class="bound">L3'</span><span class="main">)</span>
      <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="bound">Co1</span> <span class="bound">Co1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="bound">Co2</span> <span class="bound">Co2'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="bound">Co3</span> <span class="bound">Co3'</span><span class="main">)</span>
      <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="bound">Contra1'</span> <span class="bound">Contra1</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="bound">Contra2'</span> <span class="bound">Contra2</span><span class="main">)</span>
      <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="bound">Contra3'</span> <span class="bound">Contra3</span><span class="main">)</span>
      <span class="main">(</span>rel_fun <span class="main">(</span>rel_F <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="bound">Co1</span> <span class="bound">Co2</span> <span class="bound">Co3</span> <span class="bound">Contra1</span> <span class="bound">Contra2</span> <span class="bound">Contra3</span><span class="main">)</span>
      <span class="main">(</span>rel_F <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="bound">L3'</span> <span class="bound">Co1'</span> <span class="bound">Co2'</span> <span class="bound">Co3'</span> <span class="bound">Contra1'</span> <span class="bound">Contra2'</span> <span class="bound">Contra3'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> map_F map_F"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_F_pos_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co3</span> <span class="main">⇒</span> <span class="tfree">'co3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co3'</span> <span class="main">⇒</span> <span class="tfree">'co3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra3</span> <span class="main">⇒</span> <span class="tfree">'contra3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra3'</span> <span class="main">⇒</span> <span class="tfree">'contra3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'l3</span> <span class="main">×</span> <span class="tfree">'l3'</span> <span class="main">×</span> <span class="tfree">'l3''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_F_pos_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span>
    <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L2</span> <span class="main">::</span> <span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L2'</span> <span class="main">::</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L3</span> <span class="main">::</span> <span class="tfree">'l3</span> <span class="main">⇒</span> <span class="tfree">'l3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L3'</span> <span class="main">::</span> <span class="tfree">'l3'</span> <span class="main">⇒</span> <span class="tfree">'l3''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    <span class="main">(</span>rel_F <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="main">::</span>
      <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_F <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="bound">L3'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="main">≤</span>
    rel_F <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L2</span> <span class="keyword1">OO</span> <span class="bound">L2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L3</span> <span class="keyword1">OO</span> <span class="bound">L3'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_F_neg_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co3</span> <span class="main">⇒</span> <span class="tfree">'co3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co3'</span> <span class="main">⇒</span> <span class="tfree">'co3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra3</span> <span class="main">⇒</span> <span class="tfree">'contra3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra3'</span> <span class="main">⇒</span> <span class="tfree">'contra3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'l3</span> <span class="main">×</span> <span class="tfree">'l3'</span> <span class="main">×</span> <span class="tfree">'l3''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_F_neg_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span>
    <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L2</span> <span class="main">::</span> <span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L2'</span> <span class="main">::</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L3</span> <span class="main">::</span> <span class="tfree">'l3</span> <span class="main">⇒</span> <span class="tfree">'l3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L3'</span> <span class="main">::</span> <span class="tfree">'l3'</span> <span class="main">⇒</span> <span class="tfree">'l3''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    rel_F <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L2</span> <span class="keyword1">OO</span> <span class="bound">L2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L3</span> <span class="keyword1">OO</span> <span class="bound">L3'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span><span class="main">)</span> <span class="main">≤</span>
    <span class="main">(</span>rel_F <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="main">::</span>
      <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_F <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="bound">L3'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  rel_F_pos_distr_cond_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tytok</span><span class="main">.</span> rel_F_pos_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="bound">tytok</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
  rel_F_neg_distr_cond_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tytok</span><span class="main">.</span> rel_F_neg_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="bound">tytok</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Restrictions to live variables.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rell_F</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">L3</span></span></span> <span class="main">=</span> rel_F <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">L3</span></span></span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mapl_F</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">l3</span></span></span> <span class="main">=</span> map_F <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">l3</span></span></span> id id id id id id"</span></span>

<span class="keyword1"><span class="command">typedecl</span></span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> Fbd

<span class="keyword1"><span class="command">consts</span></span>
  set1_F <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F <span class="main">⇒</span> <span class="tfree">'l1</span> set"</span></span>
  set2_F <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F <span class="main">⇒</span> <span class="tfree">'l2</span> set"</span></span>
  set3_F <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F <span class="main">⇒</span> <span class="tfree">'l3</span> set"</span></span>
  bd_F <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> Fbd rel"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  set1_F_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">l3</span><span class="main">.</span> set1_F <span class="main">∘</span> mapl_F <span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">l3</span> <span class="main">=</span> image <span class="bound">l1</span> <span class="main">∘</span> set1_F"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  set2_F_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">l3</span><span class="main">.</span> set2_F <span class="main">∘</span> mapl_F <span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">l3</span> <span class="main">=</span> image <span class="bound">l2</span> <span class="main">∘</span> set2_F"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  set3_F_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">l3</span><span class="main">.</span> set3_F <span class="main">∘</span> mapl_F <span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">l3</span> <span class="main">=</span> image <span class="bound">l3</span> <span class="main">∘</span> set3_F"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  bd_F_card_order<span class="main">:</span> <span class="quoted"><span class="quoted">"card_order bd_F"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  bd_F_cinfinite<span class="main">:</span> <span class="quoted"><span class="quoted">"cinfinite bd_F"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  set1_F_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F<span class="main">.</span>
    card_of <span class="main">(</span>set1_F <span class="bound">x</span><span class="main">)</span> <span class="keyword1">≤o</span> <span class="main">(</span>bd_F <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> Fbd rel<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  set2_F_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F<span class="main">.</span>
    card_of <span class="main">(</span>set2_F <span class="bound">x</span><span class="main">)</span> <span class="keyword1">≤o</span> <span class="main">(</span>bd_F <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> Fbd rel<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  set3_F_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F<span class="main">.</span>
    card_of <span class="main">(</span>set3_F <span class="bound">x</span><span class="main">)</span> <span class="keyword1">≤o</span> <span class="main">(</span>bd_F <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> Fbd rel<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  mapl_F_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l1</span> <span class="bound">l1'</span> <span class="bound">l2</span> <span class="bound">l2'</span> <span class="bound">l3</span> <span class="bound">l3'</span> <span class="bound">x</span><span class="main">.</span>
    <span class="main">⟦</span> <span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set1_F <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">l1</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">l1'</span> <span class="bound">z</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set2_F <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">l2</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">l2'</span> <span class="bound">z</span><span class="main">;</span>
      <span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set3_F <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">l3</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">l3'</span> <span class="bound">z</span> <span class="main">⟧</span> <span class="main">⟹</span>
    mapl_F <span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">l3</span> <span class="bound">x</span> <span class="main">=</span> mapl_F <span class="bound">l1'</span> <span class="bound">l2'</span> <span class="bound">l3'</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rell_F_mono_strong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L1'</span> <span class="bound">L2</span> <span class="bound">L2'</span> <span class="bound">L3</span> <span class="bound">L3'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span>
    <span class="main">⟦</span> rell_F <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">;</span>
      <span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set1_F <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set1_F <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">L1</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">L1'</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span>
      <span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set2_F <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set2_F <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">L2</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">L2'</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span>
      <span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set3_F <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set3_F <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">L3</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">L3'</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟧</span> <span class="main">⟹</span>
    rell_F <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="bound">L3'</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Derived rules›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> rel_F_mono' <span class="main">=</span> rel_F_mono<span class="main">[</span><span class="operator">THEN</span> predicate2D<span class="main">,</span> <span class="operator">rotated</span> -1<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_F_eq_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_F <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_F_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_F_id<span class="main">:</span> <span class="quoted"><span class="quoted">"map_F id id id id id id id id id <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_F_id0<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> map_F_rel_cong <span class="main">=</span> map_F_parametric<span class="main">[</span><span class="operator">unfolded</span> rel_fun_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">rotated</span> -1<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> rell_F_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">L1</span> <span class="main">≤</span> <span class="free">L1'</span><span class="main">;</span> <span class="free">L2</span> <span class="main">≤</span> <span class="free">L2'</span><span class="main">;</span> <span class="free">L3</span> <span class="main">≤</span> <span class="free">L3'</span> <span class="main">⟧</span> <span class="main">⟹</span> rell_F <span class="free">L1</span> <span class="free">L2</span> <span class="free">L3</span> <span class="main">≤</span> rell_F <span class="free">L1'</span> <span class="free">L2'</span> <span class="free">L3'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rell_F_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_F_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"mapl_F id id id <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_F_def <span class="keyword1"><span class="command">using</span></span> map_F_id0 <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_F_id<span class="main">:</span> <span class="quoted"><span class="quoted">"mapl_F id id id <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapl_F_id0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_F_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"mapl_F <span class="free">l1</span> <span class="free">l2</span> <span class="free">l3</span> <span class="main">∘</span> mapl_F <span class="free">l1'</span> <span class="free">l2'</span> <span class="free">l3'</span> <span class="main">=</span> mapl_F <span class="main">(</span><span class="free">l1</span> <span class="main">∘</span> <span class="free">l1'</span><span class="main">)</span> <span class="main">(</span><span class="free">l2</span> <span class="main">∘</span> <span class="free">l2'</span><span class="main">)</span> <span class="main">(</span><span class="free">l3</span> <span class="main">∘</span> <span class="free">l3'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_F_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_F_comp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_F_mapl_F<span class="main">:</span> <span class="quoted"><span class="quoted">"map_F <span class="free">l1</span> <span class="free">l2</span> <span class="free">l3</span> <span class="free">co1</span> <span class="free">co2</span> <span class="free">co3</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="free">contra3</span> <span class="free">x</span> <span class="main">=</span>
  map_F id id id <span class="free">co1</span> <span class="free">co2</span> <span class="free">co3</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="free">contra3</span> <span class="main">(</span>mapl_F <span class="free">l1</span> <span class="free">l2</span> <span class="free">l3</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_F_def map_F_comp<span class="main">[</span><span class="operator">THEN</span> fun_cong<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_F_map_F<span class="main">:</span> <span class="quoted"><span class="quoted">"mapl_F <span class="free">l1</span> <span class="free">l2</span> <span class="free">l3</span> <span class="main">(</span>map_F id id id <span class="free">co1</span> <span class="free">co2</span> <span class="free">co3</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="free">contra3</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span>
  map_F <span class="free">l1</span> <span class="free">l2</span> <span class="free">l3</span> <span class="free">co1</span> <span class="free">co2</span> <span class="free">co3</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="free">contra3</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_F_def map_F_comp<span class="main">[</span><span class="operator">THEN</span> fun_cong<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Parametric mappers are unique:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_F_Grp_weak<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_F <span class="main">(</span>Grp UNIV <span class="free">l1</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">l2</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">l3</span><span class="main">)</span>
    <span class="main">(</span>Grp UNIV <span class="free">co1</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">co2</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">co3</span><span class="main">)</span>
    <span class="main">(</span>Grp UNIV <span class="free">contra1</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">(</span>Grp UNIV <span class="free">contra2</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">(</span>Grp UNIV <span class="free">contra3</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">=</span>
  Grp UNIV <span class="main">(</span>map_F <span class="free">l1</span> <span class="free">l2</span> <span class="free">l3</span> <span class="free">co1</span> <span class="free">co2</span> <span class="free">co3</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="free">contra3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> GrpI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">_</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_F_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rel_F_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> map_F_rel_cong<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Grp_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> UNIV_I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> GrpE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hypsubst</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_F <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_F_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_F_rel_cong<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_eq_refl<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Grp_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span>
  rel_F_pos_distr <span class="main">=</span> rel_F_pos_distr_cond_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
  rel_F_neg_distr <span class="main">=</span> rel_F_neg_distr_cond_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> rell_F_compp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rell_F <span class="main">(</span><span class="free">L1</span> <span class="keyword1">OO</span> <span class="free">L1'</span><span class="main">)</span> <span class="main">(</span><span class="free">L2</span> <span class="keyword1">OO</span> <span class="free">L2'</span><span class="main">)</span> <span class="main">(</span><span class="free">L3</span> <span class="keyword1">OO</span> <span class="free">L3'</span><span class="main">)</span> <span class="main">=</span> rell_F <span class="free">L1</span> <span class="free">L2</span> <span class="free">L3</span> <span class="keyword1">OO</span> rell_F <span class="free">L1'</span> <span class="free">L2'</span> <span class="free">L3'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rell_F_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_neg_distr<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_neg_distr_cond_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_OO<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_pos_distr<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_pos_distr_cond_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_OO<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹F is a BNF›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rell_F_eq_onp<span class="main">:</span> <span class="quoted"><span class="quoted">"rell_F <span class="main">(</span>eq_onp <span class="free">P1</span><span class="main">)</span> <span class="main">(</span>eq_onp <span class="free">P2</span><span class="main">)</span> <span class="main">(</span>eq_onp <span class="free">P3</span><span class="main">)</span> <span class="main">=</span>
  eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>set1_F <span class="bound">x</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>set2_F <span class="bound">x</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>set3_F <span class="bound">x</span><span class="main">.</span> <span class="free">P3</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rel_eq_onp</span> <span class="main">=</span> <span class="var">?eq_onp_pred</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rel_eq_onp</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rell_F <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rell_F_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_F_mono' <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rell_F_def rel_F_eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?true</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?label</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">P</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rell_F <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(</span>mapl_F <span class="var">?true</span> <span class="var">?true</span> <span class="var">?true</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="main">(</span>mapl_F <span class="main">(</span><span class="var">?label</span> <span class="free">P1</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P2</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P3</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rell_F_def mapl_F_def <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> map_F_rel_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"mapl_F <span class="var">?true</span> <span class="var">?true</span> <span class="var">?true</span> <span class="skolem">x</span> <span class="main">=</span> mapl_F <span class="main">(</span><span class="var">?label</span> <span class="free">P1</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P2</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P3</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rell_F_def rel_F_eq <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">from</span></span> *
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set1_F <span class="main">(</span>mapl_F <span class="var">?true</span> <span class="var">?true</span> <span class="var">?true</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> set1_F <span class="main">(</span>mapl_F <span class="main">(</span><span class="var">?label</span> <span class="free">P1</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P2</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P3</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?true</span> <span class="main">`</span> set1_F <span class="skolem">x</span> <span class="main">=</span> <span class="var">?label</span> <span class="free">P1</span> <span class="main">`</span> set1_F <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set1_F_map<span class="main">[</span><span class="operator">THEN</span> fun_cong<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>set1_F <span class="skolem">x</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">from</span></span> *
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set2_F <span class="main">(</span>mapl_F <span class="var">?true</span> <span class="var">?true</span> <span class="var">?true</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> set2_F <span class="main">(</span>mapl_F <span class="main">(</span><span class="var">?label</span> <span class="free">P1</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P2</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P3</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?true</span> <span class="main">`</span> set2_F <span class="skolem">x</span> <span class="main">=</span> <span class="var">?label</span> <span class="free">P2</span> <span class="main">`</span> set2_F <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set2_F_map<span class="main">[</span><span class="operator">THEN</span> fun_cong<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>set2_F <span class="skolem">x</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">from</span></span> *
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set3_F <span class="main">(</span>mapl_F <span class="var">?true</span> <span class="var">?true</span> <span class="var">?true</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> set3_F <span class="main">(</span>mapl_F <span class="main">(</span><span class="var">?label</span> <span class="free">P1</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P2</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P3</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?true</span> <span class="main">`</span> set3_F <span class="skolem">x</span> <span class="main">=</span> <span class="var">?label</span> <span class="free">P3</span> <span class="main">`</span> set3_F <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set3_F_map<span class="main">[</span><span class="operator">THEN</span> fun_cong<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>set3_F <span class="skolem">x</span><span class="main">.</span> <span class="free">P3</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?eq_onp_pred</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> eq_onp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?eq_onp_pred</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rell_F <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rell_F_def rel_F_eq eq_onp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rel_eq_onp</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq_onp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rell_F_mono_strong <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rell_F_Grp<span class="main">:</span> <span class="quoted"><span class="quoted">"rell_F <span class="main">(</span>Grp <span class="free">A1</span> <span class="free">f1</span><span class="main">)</span> <span class="main">(</span>Grp <span class="free">A2</span> <span class="free">f2</span><span class="main">)</span> <span class="main">(</span>Grp <span class="free">A3</span> <span class="free">f3</span><span class="main">)</span> <span class="main">=</span>
  Grp <span class="main">{</span><span class="bound">x</span><span class="main">.</span> set1_F <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A1</span> <span class="main">∧</span> set2_F <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A2</span> <span class="main">∧</span> set3_F <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A3</span><span class="main">}</span> <span class="main">(</span>mapl_F <span class="free">f1</span> <span class="free">f2</span> <span class="free">f3</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rell_F <span class="main">(</span>Grp <span class="free">A1</span> <span class="free">f1</span><span class="main">)</span> <span class="main">(</span>Grp <span class="free">A2</span> <span class="free">f2</span><span class="main">)</span> <span class="main">(</span>Grp <span class="free">A3</span> <span class="free">f3</span><span class="main">)</span> <span class="main">=</span> rell_F <span class="main">(</span>eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A1</span><span class="main">)</span> <span class="keyword1">OO</span> Grp UNIV <span class="free">f1</span><span class="main">)</span>
    <span class="main">(</span>eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A2</span><span class="main">)</span> <span class="keyword1">OO</span> Grp UNIV <span class="free">f2</span><span class="main">)</span> <span class="main">(</span>eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A3</span><span class="main">)</span> <span class="keyword1">OO</span> Grp UNIV <span class="free">f3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_compp_Grp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rell_F <span class="main">(</span>eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">OO</span>
    rell_F <span class="main">(</span>Grp UNIV <span class="free">f1</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">f2</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">f3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rell_F_compp <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> set1_F <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A1</span> <span class="main">∧</span> set2_F <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A2</span> <span class="main">∧</span> set3_F <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A3</span><span class="main">)</span> <span class="keyword1">OO</span>
    rell_F <span class="main">(</span>Grp UNIV <span class="free">f1</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">f2</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">f3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rell_F_eq_onp subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> set1_F <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A1</span> <span class="main">∧</span> set2_F <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A2</span> <span class="main">∧</span> set3_F <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A3</span><span class="main">)</span> <span class="keyword1">OO</span>
    Grp UNIV <span class="main">(</span>mapl_F <span class="free">f1</span> <span class="free">f2</span> <span class="free">f3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rell_F_def mapl_F_def
      rel_F_Grp_weak<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted">id</span> <span class="quoted">id</span> <span class="quoted">id</span> <span class="quoted">id</span> <span class="quoted">id</span> <span class="quoted">id</span><span class="main">,</span> <span class="operator">folded</span> eq_alt<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Grp <span class="main">{</span><span class="bound">x</span><span class="main">.</span> set1_F <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A1</span> <span class="main">∧</span> set2_F <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A2</span> <span class="main">∧</span> set3_F <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A3</span><span class="main">}</span> <span class="main">(</span>mapl_F <span class="free">f1</span> <span class="free">f2</span> <span class="free">f3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_compp_Grp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rell_F_compp_Grp<span class="main">:</span> <span class="quoted"><span class="quoted">"rell_F <span class="free">L1</span> <span class="free">L2</span> <span class="free">L3</span> <span class="main">=</span>
  <span class="main">(</span>Grp <span class="main">{</span><span class="bound">x</span><span class="main">.</span> set1_F <span class="bound">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∧</span> set2_F <span class="bound">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∧</span> set3_F <span class="bound">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L3</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main">}</span>
    <span class="main">(</span>mapl_F fst fst fst<span class="main">)</span><span class="main">)</span><span class="main">¯¯</span> <span class="keyword1">OO</span>
  Grp <span class="main">{</span><span class="bound">x</span><span class="main">.</span> set1_F <span class="bound">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∧</span> set2_F <span class="bound">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∧</span> set3_F <span class="bound">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L3</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main">}</span>
    <span class="main">(</span>mapl_F snd snd snd<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> rell_F_Grp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> rell_F_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_F_conversep<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> rell_F_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rell_F_compp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Grp_fst_snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> F_in_rell<span class="main">:</span> <span class="quoted"><span class="quoted">"rell_F <span class="free">L1</span> <span class="free">L2</span> <span class="free">L3</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span>set1_F <span class="bound">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∧</span>
  set2_F <span class="bound">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∧</span> set3_F <span class="bound">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L3</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span>
  mapl_F fst fst fst <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> mapl_F snd snd snd <span class="bound">z</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rell_F_compp_Grp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OO_Grp_alt<span class="main">)</span>

<span class="keyword1"><span class="command">bnf</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F"</span></span>
  map<span class="main">:</span> <span class="quoted">mapl_F</span>
  sets<span class="main">:</span> <span class="quoted">set1_F</span> <span class="quoted">set2_F</span> <span class="quoted">set3_F</span>
  bd<span class="main">:</span> <span class="quoted"><span class="quoted">"bd_F <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> Fbd rel"</span></span>
  rel<span class="main">:</span> <span class="quoted">rell_F</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> mapl_F_id0 mapl_F_comp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mapl_F_cong set1_F_map set2_F_map set3_F_map
    bd_F_card_order bd_F_cinfinite set1_F_bound set2_F_bound set3_F_bound
    rell_F_compp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> eq_refl<span class="main"><span class="main">]</span></span> F_in_rell<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Composition witness›</span></span>

<span class="keyword1"><span class="command">consts</span></span>
  rel_F_witness <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l3</span> <span class="main">⇒</span> <span class="tfree">'l3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co3</span> <span class="main">⇒</span> <span class="tfree">'co3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co3'</span> <span class="main">⇒</span> <span class="tfree">'co3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra3</span> <span class="main">⇒</span> <span class="tfree">'contra3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra3'</span> <span class="main">⇒</span> <span class="tfree">'contra3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F <span class="main">×</span>
    <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="tfree">'l3''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'co3''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'contra3''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="tfree">'l3</span> <span class="main">×</span> <span class="tfree">'l3''</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'co3'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'contra3'</span><span class="main">,</span>
      <span class="tfree">'f</span><span class="main">)</span> F"</span></span>

<span class="keyword1"><span class="command">specification</span></span> <span class="main">(</span><span class="quoted">rel_F_witness</span><span class="main">)</span>
  rel_F_witness1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Co3</span> <span class="bound">Co3'</span>
    <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">Contra3</span> <span class="bound">Contra3'</span>
    <span class="main">(</span><span class="bound">tytok</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span>
      <span class="tfree">'l3</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l3</span> <span class="main">×</span> <span class="tfree">'l3''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l3''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself<span class="main">)</span>
    <span class="main">(</span><span class="bound">x</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F<span class="main">)</span>
    <span class="main">(</span><span class="bound">y</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="tfree">'l3''</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F<span class="main">)</span><span class="main">.</span>
    <span class="main">⟦</span> rel_F_neg_distr_cond <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Co3</span> <span class="bound">Co3'</span>
        <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">Contra3</span> <span class="bound">Contra3'</span> <span class="bound">tytok</span><span class="main">;</span>
      rel_F <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="main">(</span><span class="bound">Co1</span> <span class="keyword1">OO</span> <span class="bound">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Co2</span> <span class="keyword1">OO</span> <span class="bound">Co2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Co3</span> <span class="keyword1">OO</span> <span class="bound">Co3'</span><span class="main">)</span>
          <span class="main">(</span><span class="bound">Contra1</span> <span class="keyword1">OO</span> <span class="bound">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra2</span> <span class="keyword1">OO</span> <span class="bound">Contra2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra3</span> <span class="keyword1">OO</span> <span class="bound">Contra3'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span>
    rel_F <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">L3</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">Co1</span> <span class="bound">Co2</span> <span class="bound">Co3</span> <span class="bound">Contra1</span> <span class="bound">Contra2</span> <span class="bound">Contra3</span> <span class="bound">x</span>
    <span class="main">(</span>rel_F_witness <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Co3</span> <span class="bound">Co3'</span>
      <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">Contra3</span> <span class="bound">Contra3'</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  rel_F_witness2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Co3</span> <span class="bound">Co3'</span>
    <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">Contra3</span> <span class="bound">Contra3'</span>
    <span class="main">(</span><span class="bound">tytok</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span>
      <span class="tfree">'l3</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l3</span> <span class="main">×</span> <span class="tfree">'l3''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l3''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself<span class="main">)</span>
    <span class="main">(</span><span class="bound">x</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F<span class="main">)</span>
    <span class="main">(</span><span class="bound">y</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="tfree">'l3''</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> F<span class="main">)</span><span class="main">.</span>
    <span class="main">⟦</span> rel_F_neg_distr_cond <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Co3</span> <span class="bound">Co3'</span>
        <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">Contra3</span> <span class="bound">Contra3'</span> <span class="bound">tytok</span><span class="main">;</span>
      rel_F <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="main">(</span><span class="bound">Co1</span> <span class="keyword1">OO</span> <span class="bound">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Co2</span> <span class="keyword1">OO</span> <span class="bound">Co2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Co3</span> <span class="keyword1">OO</span> <span class="bound">Co3'</span><span class="main">)</span>
          <span class="main">(</span><span class="bound">Contra1</span> <span class="keyword1">OO</span> <span class="bound">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra2</span> <span class="keyword1">OO</span> <span class="bound">Contra2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra3</span> <span class="keyword1">OO</span> <span class="bound">Contra3'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span>
    rel_F <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>
    <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">L3</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">Co1'</span> <span class="bound">Co2'</span> <span class="bound">Co3'</span> <span class="bound">Contra1'</span> <span class="bound">Contra2'</span> <span class="bound">Contra3'</span>
    <span class="main">(</span>rel_F_witness <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Co3</span> <span class="bound">Co3'</span>
       <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">Contra3</span> <span class="bound">Contra3'</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">L1</span></span> <span class="bound"><span class="bound">L2</span></span> <span class="bound"><span class="bound">L3</span></span> <span class="bound"><span class="bound">Co1</span></span> <span class="bound"><span class="bound">Co1'</span></span> <span class="bound"><span class="bound">Co2</span></span> <span class="bound"><span class="bound">Co2'</span></span> <span class="bound"><span class="bound">Co3</span></span> <span class="bound"><span class="bound">Co3'</span></span>
     <span class="bound"><span class="bound">Contra1</span></span> <span class="bound"><span class="bound">Contra1'</span></span> <span class="bound"><span class="bound">Contra2</span></span> <span class="bound"><span class="bound">Contra2'</span></span> <span class="bound"><span class="bound">Contra3</span></span> <span class="bound"><span class="bound">Contra3'</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">SOME</span></span> <span class="bound"><span class="bound">z</span></span><span class="main"><span class="main">.</span></span>
     rel_F <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L3</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span>
      <span class="bound"><span class="bound">Co1</span></span> <span class="bound"><span class="bound">Co2</span></span> <span class="bound"><span class="bound">Co3</span></span> <span class="bound"><span class="bound">Contra1</span></span> <span class="bound"><span class="bound">Contra2</span></span> <span class="bound"><span class="bound">Contra3</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">z</span></span> <span class="main"><span class="main">∧</span></span>
     rel_F <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L3</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span>
      <span class="bound"><span class="bound">Co1'</span></span> <span class="bound"><span class="bound">Co2'</span></span> <span class="bound"><span class="bound">Co3'</span></span> <span class="bound"><span class="bound">Contra1'</span></span> <span class="bound"><span class="bound">Contra2'</span></span> <span class="bound"><span class="bound">Contra3'</span></span> <span class="bound"><span class="bound">z</span></span> <span class="bound"><span class="bound">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> all_conj_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> imp_conjR<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> L1 L2 L3 Co1 Co1' Co2 Co2' Co3 Co3' Contra1 Contra1' Contra2 Contra2' Contra3 Contra3' x y
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> rel_F_neg_distr<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span>
          <span class="var">?L1.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?L1'.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y'</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span>
          <span class="var">?L2.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?L2'.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y'</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span>
          <span class="var">?L3.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L3</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?L3'.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L3</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> predicate2D<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_F_mono<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> predicate2D<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fastforce</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> relcomppE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Second abstract \BNFCC{}›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Axioms and basic definitions›</span></span>

<span class="keyword1"><span class="command">typedecl</span></span> <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> G<span class="antiquote"><span class="antiquote">}</span></span></span></span> has each two live, co, and contravariant parameters, and one fixed parameter.›</span></span>

<span class="keyword1"><span class="command">consts</span></span>
  rel_G <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1'</span><span class="main">,</span> <span class="tfree">'l2'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G <span class="main">⇒</span> bool"</span></span>
  map_G <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1'</span><span class="main">,</span> <span class="tfree">'l2'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  rel_G_mono <span class="main">[</span><span class="operator">mono</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L1'</span> <span class="bound">L2</span> <span class="bound">L2'</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span><span class="main">.</span>
    <span class="main">⟦</span> <span class="bound">L1</span> <span class="main">≤</span> <span class="bound">L1'</span><span class="main">;</span> <span class="bound">L2</span> <span class="main">≤</span> <span class="bound">L2'</span><span class="main">;</span> <span class="bound">Co1</span> <span class="main">≤</span> <span class="bound">Co1'</span><span class="main">;</span> <span class="bound">Co2</span> <span class="main">≤</span> <span class="bound">Co2'</span><span class="main">;</span> <span class="bound">Contra1'</span> <span class="main">≤</span> <span class="bound">Contra1</span><span class="main">;</span> <span class="bound">Contra2'</span> <span class="main">≤</span> <span class="bound">Contra2</span> <span class="main">⟧</span> <span class="main">⟹</span>
    rel_G <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">Co1</span> <span class="bound">Co2</span> <span class="bound">Contra1</span> <span class="bound">Contra2</span> <span class="main">≤</span> rel_G <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="bound">Co1'</span> <span class="bound">Co2'</span> <span class="bound">Contra1'</span> <span class="bound">Contra2'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rel_G_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_G <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rel_G_conversep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">Co1</span> <span class="bound">Co2</span> <span class="bound">Contra1</span> <span class="bound">Contra2</span><span class="main">.</span>
    rel_G <span class="bound">L1</span><span class="main">¯¯</span> <span class="bound">L2</span><span class="main">¯¯</span> <span class="bound">Co1</span><span class="main">¯¯</span> <span class="bound">Co2</span><span class="main">¯¯</span> <span class="bound">Contra1</span><span class="main">¯¯</span> <span class="bound">Contra2</span><span class="main">¯¯</span> <span class="main">=</span> <span class="main">(</span>rel_G <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">Co1</span> <span class="bound">Co2</span> <span class="bound">Contra1</span> <span class="bound">Contra2</span><span class="main">)</span><span class="main">¯¯</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  map_G_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"map_G id id id id id id <span class="main">=</span> id"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  map_G_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l1</span> <span class="bound">l1'</span> <span class="bound">l2</span> <span class="bound">l2'</span> <span class="bound">co1</span> <span class="bound">co1'</span> <span class="bound">co2</span> <span class="bound">co2'</span> <span class="bound">contra1</span> <span class="bound">contra1'</span> <span class="bound">contra2</span> <span class="bound">contra2'</span><span class="main">.</span>
    map_G <span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">co1</span> <span class="bound">co2</span> <span class="bound">contra1</span> <span class="bound">contra2</span> <span class="main">∘</span> map_G <span class="bound">l1'</span> <span class="bound">l2'</span> <span class="bound">co1'</span> <span class="bound">co2'</span> <span class="bound">contra1'</span> <span class="bound">contra2'</span> <span class="main">=</span>
      map_G <span class="main">(</span><span class="bound">l1</span> <span class="main">∘</span> <span class="bound">l1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">l2</span> <span class="main">∘</span> <span class="bound">l2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">co1</span> <span class="main">∘</span> <span class="bound">co1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">co2</span> <span class="main">∘</span> <span class="bound">co2'</span><span class="main">)</span>
      <span class="main">(</span><span class="bound">contra1'</span> <span class="main">∘</span> <span class="bound">contra1</span><span class="main">)</span> <span class="main">(</span><span class="bound">contra2'</span> <span class="main">∘</span> <span class="bound">contra2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  map_G_parametric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L1'</span> <span class="bound">L2</span> <span class="bound">L2'</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span><span class="main">.</span>
    rel_fun <span class="main">(</span>rel_fun <span class="bound">L1</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="bound">L2</span> <span class="bound">L2'</span><span class="main">)</span>
      <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="bound">Co1</span> <span class="bound">Co1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="bound">Co2</span> <span class="bound">Co2'</span><span class="main">)</span>
      <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="bound">Contra1'</span> <span class="bound">Contra1</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="bound">Contra2'</span> <span class="bound">Contra2</span><span class="main">)</span>
      <span class="main">(</span>rel_fun <span class="main">(</span>rel_G <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">Co1</span> <span class="bound">Co2</span> <span class="bound">Contra1</span> <span class="bound">Contra2</span><span class="main">)</span>
      <span class="main">(</span>rel_G <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="bound">Co1'</span> <span class="bound">Co2'</span> <span class="bound">Contra1'</span> <span class="bound">Contra2'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      map_G map_G"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_G_pos_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_G_pos_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L2</span> <span class="main">::</span> <span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L2'</span> <span class="main">::</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    <span class="main">(</span>rel_G <span class="bound">L1</span> <span class="bound">L2</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_G <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main">≤</span>
    rel_G <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L2</span> <span class="keyword1">OO</span> <span class="bound">L2'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_G_neg_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_G_neg_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L2</span> <span class="main">::</span> <span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L2'</span> <span class="main">::</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    rel_G <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L2</span> <span class="keyword1">OO</span> <span class="bound">L2'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> <span class="main">≤</span>
    <span class="main">(</span>rel_G <span class="bound">L1</span> <span class="bound">L2</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_G <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  rel_G_pos_distr_cond_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tytok</span><span class="main">.</span> rel_G_pos_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="bound">tytok</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rel_G_neg_distr_cond_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tytok</span><span class="main">.</span> rel_G_neg_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="bound">tytok</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Restrictions to live variables.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rell_G</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="main">=</span> rel_G <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mapl_G</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">=</span> map_G <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> id id id id"</span></span>

<span class="keyword1"><span class="command">typedecl</span></span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> Gbd

<span class="keyword1"><span class="command">consts</span></span>
  set1_G <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G <span class="main">⇒</span> <span class="tfree">'l1</span> set"</span></span>
  set2_G <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G <span class="main">⇒</span> <span class="tfree">'l2</span> set"</span></span>
  bd_G <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> Gbd rel"</span></span>
  wit_G <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l2</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G"</span></span>
    <span class="comment1">― ‹non-emptiness witness for least fixpoint›</span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  set1_G_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l1</span> <span class="bound">l2</span><span class="main">.</span> set1_G <span class="main">∘</span> mapl_G <span class="bound">l1</span> <span class="bound">l2</span> <span class="main">=</span> image <span class="bound">l1</span> <span class="main">∘</span> set1_G"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  set2_G_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l1</span> <span class="bound">l2</span><span class="main">.</span> set2_G <span class="main">∘</span> mapl_G <span class="bound">l1</span> <span class="bound">l2</span> <span class="main">=</span> image <span class="bound">l2</span> <span class="main">∘</span> set2_G"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  bd_G_card_order<span class="main">:</span> <span class="quoted"><span class="quoted">"card_order bd_G"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  bd_G_cinfinite<span class="main">:</span> <span class="quoted"><span class="quoted">"cinfinite bd_G"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  set1_G_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G<span class="main">.</span>
    card_of <span class="main">(</span>set1_G <span class="bound">x</span><span class="main">)</span> <span class="keyword1">≤o</span> <span class="main">(</span>bd_G <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> Gbd rel<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  set2_G_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G<span class="main">.</span>
    card_of <span class="main">(</span>set2_G <span class="bound">x</span><span class="main">)</span> <span class="keyword1">≤o</span> <span class="main">(</span>bd_G <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> Gbd rel<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  mapl_G_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l1</span> <span class="bound">l1'</span> <span class="bound">l2</span> <span class="bound">l2'</span> <span class="bound">l3</span> <span class="bound">l3'</span> <span class="bound">x</span><span class="main">.</span>
    <span class="main">⟦</span> <span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set1_G <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">l1</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">l1'</span> <span class="bound">z</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set2_G <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">l2</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">l2'</span> <span class="bound">z</span> <span class="main">⟧</span> <span class="main">⟹</span>
    mapl_G <span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">x</span> <span class="main">=</span> mapl_G <span class="bound">l1'</span> <span class="bound">l2'</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  rell_G_mono_strong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L1'</span> <span class="bound">L2</span> <span class="bound">L2'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span>
    <span class="main">⟦</span> rell_G <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">;</span>
      <span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set1_G <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set1_G <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">L1</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">L1'</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span>
      <span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set2_G <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set2_G <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">L2</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">L2'</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟧</span> <span class="main">⟹</span>
    rell_G <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  wit_G_set1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l2</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set1_G <span class="main">(</span>wit_G <span class="bound">l2</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  wit_G_set2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l2</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set2_G <span class="main">(</span>wit_G <span class="bound">l2</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">l2</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Derived rules›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> rel_G_mono' <span class="main">=</span> rel_G_mono<span class="main">[</span><span class="operator">THEN</span> predicate2D<span class="main">,</span> <span class="operator">rotated</span> -1<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_G_eq_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_G <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_G_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_G_id<span class="main">:</span> <span class="quoted"><span class="quoted">"map_G id id id id id id <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_G_id0<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> map_G_rel_cong <span class="main">=</span> map_G_parametric<span class="main">[</span><span class="operator">unfolded</span> rel_fun_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">rotated</span> -1<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> rell_G_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">L1</span> <span class="main">≤</span> <span class="free">L1'</span><span class="main">;</span> <span class="free">L2</span> <span class="main">≤</span> <span class="free">L2'</span> <span class="main">⟧</span> <span class="main">⟹</span> rell_G <span class="free">L1</span> <span class="free">L2</span> <span class="main">≤</span> rell_G <span class="free">L1'</span> <span class="free">L2'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rell_G_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_G_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"mapl_G id id <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_G_def <span class="keyword1"><span class="command">using</span></span> map_G_id0 <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_G_id<span class="main">:</span> <span class="quoted"><span class="quoted">"mapl_G id id <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapl_G_id0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_G_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"mapl_G <span class="free">l1</span> <span class="free">l2</span> <span class="main">∘</span> mapl_G <span class="free">l1'</span> <span class="free">l2'</span> <span class="main">=</span> mapl_G <span class="main">(</span><span class="free">l1</span> <span class="main">∘</span> <span class="free">l1'</span><span class="main">)</span> <span class="main">(</span><span class="free">l2</span> <span class="main">∘</span> <span class="free">l2'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_G_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> trans<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_G_comp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_G_mapl_G<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_G <span class="free">l1</span> <span class="free">l2</span> <span class="free">co1</span> <span class="free">co2</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="free">x</span> <span class="main">=</span> map_G id id <span class="free">co1</span> <span class="free">co2</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="main">(</span>mapl_G <span class="free">l1</span> <span class="free">l2</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_G_def map_G_comp<span class="main">[</span><span class="operator">THEN</span> fun_cong<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_G_map_G<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mapl_G <span class="free">l1</span> <span class="free">l2</span> <span class="main">(</span>map_G id id <span class="free">co1</span> <span class="free">co2</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> map_G <span class="free">l1</span> <span class="free">l2</span> <span class="free">co1</span> <span class="free">co2</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_G_def map_G_comp<span class="main">[</span><span class="operator">THEN</span> fun_cong<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Parametric mappers are unique:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_G_Grp_weak<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_G <span class="main">(</span>Grp UNIV <span class="free">l1</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">l2</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">co1</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">co2</span><span class="main">)</span>
  <span class="main">(</span>Grp UNIV <span class="free">contra1</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">(</span>Grp UNIV <span class="free">contra2</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">=</span> Grp UNIV <span class="main">(</span>map_G <span class="free">l1</span> <span class="free">l2</span> <span class="free">co1</span> <span class="free">co2</span> <span class="free">contra1</span> <span class="free">contra2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> GrpI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">_</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_G_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rel_G_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> map_G_rel_cong<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Grp_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> UNIV_I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> GrpE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> sym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hypsubst</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_G <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_G_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_G_rel_cong<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_eq_refl<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Grp_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span>
  rel_G_pos_distr <span class="main">=</span> rel_G_pos_distr_cond_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
  rel_G_neg_distr <span class="main">=</span> rel_G_neg_distr_cond_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> rell_G_compp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rell_G <span class="main">(</span><span class="free">L1</span> <span class="keyword1">OO</span> <span class="free">L1'</span><span class="main">)</span> <span class="main">(</span><span class="free">L2</span> <span class="keyword1">OO</span> <span class="free">L2'</span><span class="main">)</span> <span class="main">=</span> rell_G <span class="free">L1</span> <span class="free">L2</span> <span class="keyword1">OO</span> rell_G <span class="free">L1'</span> <span class="free">L2'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rell_G_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_neg_distr<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_neg_distr_cond_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_OO<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_pos_distr<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_pos_distr_cond_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_OO<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹G is a BNF›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rell_G_eq_onp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rell_G <span class="main">(</span>eq_onp <span class="free">P1</span><span class="main">)</span> <span class="main">(</span>eq_onp <span class="free">P2</span><span class="main">)</span> <span class="main">=</span> eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>set1_G <span class="bound">x</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>set2_G <span class="bound">x</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rel_eq_onp</span> <span class="main">=</span> <span class="var">?eq_onp_pred</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rel_eq_onp</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rell_G <span class="main">(=)</span> <span class="main">(=)</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rell_G_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_G_mono' <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rell_G_def rel_G_eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?true</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?label</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">P</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rell_G <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(</span>mapl_G <span class="var">?true</span> <span class="var">?true</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>mapl_G <span class="main">(</span><span class="var">?label</span> <span class="free">P1</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rell_G_def mapl_G_def <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> map_G_rel_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"mapl_G <span class="var">?true</span> <span class="var">?true</span> <span class="skolem">x</span> <span class="main">=</span> mapl_G <span class="main">(</span><span class="var">?label</span> <span class="free">P1</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P2</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rell_G_def rel_G_eq <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">from</span></span> *
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set1_G <span class="main">(</span>mapl_G <span class="var">?true</span> <span class="var">?true</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> set1_G <span class="main">(</span>mapl_G <span class="main">(</span><span class="var">?label</span> <span class="free">P1</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?true</span> <span class="main">`</span> set1_G <span class="skolem">x</span> <span class="main">=</span> <span class="var">?label</span> <span class="free">P1</span> <span class="main">`</span> set1_G <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set1_G_map<span class="main">[</span><span class="operator">THEN</span> fun_cong<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>set1_G <span class="skolem">x</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">from</span></span> *
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set2_G <span class="main">(</span>mapl_G <span class="var">?true</span> <span class="var">?true</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> set2_G <span class="main">(</span>mapl_G <span class="main">(</span><span class="var">?label</span> <span class="free">P1</span><span class="main">)</span> <span class="main">(</span><span class="var">?label</span> <span class="free">P2</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?true</span> <span class="main">`</span> set2_G <span class="skolem">x</span> <span class="main">=</span> <span class="var">?label</span> <span class="free">P2</span> <span class="main">`</span> set2_G <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set2_G_map<span class="main">[</span><span class="operator">THEN</span> fun_cong<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">∈</span>set2_G <span class="skolem">x</span><span class="main">.</span> <span class="free">P2</span> <span class="bound">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?eq_onp_pred</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> eq_onp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?eq_onp_pred</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rell_G <span class="main">(=)</span> <span class="main">(=)</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rell_G_def rel_G_eq eq_onp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rel_eq_onp</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq_onp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rell_G_mono_strong <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rell_G_Grp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rell_G <span class="main">(</span>Grp <span class="free">A1</span> <span class="free">f1</span><span class="main">)</span> <span class="main">(</span>Grp <span class="free">A2</span> <span class="free">f2</span><span class="main">)</span> <span class="main">=</span> Grp <span class="main">{</span><span class="bound">x</span><span class="main">.</span> set1_G <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A1</span> <span class="main">∧</span> set2_G <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A2</span><span class="main">}</span> <span class="main">(</span>mapl_G <span class="free">f1</span> <span class="free">f2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rell_G <span class="main">(</span>Grp <span class="free">A1</span> <span class="free">f1</span><span class="main">)</span> <span class="main">(</span>Grp <span class="free">A2</span> <span class="free">f2</span><span class="main">)</span> <span class="main">=</span> rell_G <span class="main">(</span>eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A1</span><span class="main">)</span> <span class="keyword1">OO</span> Grp UNIV <span class="free">f1</span><span class="main">)</span>
    <span class="main">(</span>eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A2</span><span class="main">)</span> <span class="keyword1">OO</span> Grp UNIV <span class="free">f2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_compp_Grp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rell_G <span class="main">(</span>eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">OO</span>
    rell_G <span class="main">(</span>Grp UNIV <span class="free">f1</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">f2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rell_G_compp <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> set1_G <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A1</span> <span class="main">∧</span> set2_G <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A2</span><span class="main">)</span> <span class="keyword1">OO</span>
    rell_G <span class="main">(</span>Grp UNIV <span class="free">f1</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">f2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rell_G_eq_onp subset_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> eq_onp <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> set1_G <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A1</span> <span class="main">∧</span> set2_G <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A2</span><span class="main">)</span> <span class="keyword1">OO</span> Grp UNIV <span class="main">(</span>mapl_G <span class="free">f1</span> <span class="free">f2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rell_G_def mapl_G_def
      rel_G_Grp_weak<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted">id</span> <span class="quoted">id</span> <span class="quoted">id</span> <span class="quoted">id</span><span class="main">,</span> <span class="operator">folded</span> eq_alt<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
    <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Grp <span class="main">{</span><span class="bound">x</span><span class="main">.</span> set1_G <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A1</span> <span class="main">∧</span> set2_G <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A2</span><span class="main">}</span> <span class="main">(</span>mapl_G <span class="free">f1</span> <span class="free">f2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_compp_Grp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rell_G_compp_Grp<span class="main">:</span> <span class="quoted"><span class="quoted">"rell_G <span class="free">L1</span> <span class="free">L2</span> <span class="main">=</span>
  <span class="main">(</span>Grp <span class="main">{</span><span class="bound">x</span><span class="main">.</span> set1_G <span class="bound">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∧</span> set2_G <span class="bound">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main">}</span> <span class="main">(</span>mapl_G fst fst<span class="main">)</span><span class="main">)</span><span class="main">¯¯</span> <span class="keyword1">OO</span>
  Grp <span class="main">{</span><span class="bound">x</span><span class="main">.</span> set1_G <span class="bound">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∧</span> set2_G <span class="bound">x</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main">}</span> <span class="main">(</span>mapl_G snd snd<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> rell_G_Grp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> rell_G_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_G_conversep<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> rell_G_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rell_G_compp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Grp_fst_snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> G_in_rell<span class="main">:</span> <span class="quoted"><span class="quoted">"rell_G <span class="free">L1</span> <span class="free">L2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span>set1_G <span class="bound">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∧</span>
  set2_G <span class="bound">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> mapl_G fst fst <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> mapl_G snd snd <span class="bound">z</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rell_G_compp_Grp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> OO_Grp_alt<span class="main">)</span>

<span class="keyword1"><span class="command">bnf</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G"</span></span>
  map<span class="main">:</span> <span class="quoted">mapl_G</span>
  sets<span class="main">:</span> <span class="quoted">set1_G</span> <span class="quoted">set2_G</span>
  bd<span class="main">:</span> <span class="quoted"><span class="quoted">"bd_G <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> Gbd rel"</span></span>
  wits<span class="main">:</span> <span class="quoted">wit_G</span>
  rel<span class="main">:</span> <span class="quoted">rell_G</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> mapl_G_id0 mapl_G_comp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mapl_G_cong set1_G_map set2_G_map
    bd_G_card_order bd_G_cinfinite set1_G_bound set2_G_bound rell_G_compp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> eq_refl<span class="main"><span class="main">]</span></span>
    G_in_rell wit_G_set1 wit_G_set2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Composition witness›</span></span>

<span class="keyword1"><span class="command">consts</span></span>
  rel_G_witness <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G <span class="main">×</span>
    <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G"</span></span>

<span class="keyword1"><span class="command">specification</span></span> <span class="main">(</span><span class="quoted">rel_G_witness</span><span class="main">)</span>
  rel_G_witness1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span>
    <span class="main">(</span><span class="bound">tytok</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself<span class="main">)</span>
    <span class="main">(</span><span class="bound">x</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G<span class="main">)</span> <span class="main">(</span><span class="bound">y</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G<span class="main">)</span><span class="main">.</span>
    <span class="main">⟦</span> rel_G_neg_distr_cond <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">tytok</span><span class="main">;</span>
      rel_G <span class="bound">L1</span> <span class="bound">L2</span> <span class="main">(</span><span class="bound">Co1</span> <span class="keyword1">OO</span> <span class="bound">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Co2</span> <span class="keyword1">OO</span> <span class="bound">Co2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra1</span> <span class="keyword1">OO</span> <span class="bound">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra2</span> <span class="keyword1">OO</span> <span class="bound">Contra2'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span>
    rel_G <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">Co1</span> <span class="bound">Co2</span> <span class="bound">Contra1</span> <span class="bound">Contra2</span> <span class="bound">x</span>
    <span class="main">(</span>rel_G_witness <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  rel_G_witness2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span>
    <span class="main">(</span><span class="bound">tytok</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself<span class="main">)</span>
    <span class="main">(</span><span class="bound">x</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G<span class="main">)</span> <span class="main">(</span><span class="bound">y</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G<span class="main">)</span><span class="main">.</span>
    <span class="main">⟦</span> rel_G_neg_distr_cond <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">tytok</span><span class="main">;</span>
      rel_G <span class="bound">L1</span> <span class="bound">L2</span> <span class="main">(</span><span class="bound">Co1</span> <span class="keyword1">OO</span> <span class="bound">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Co2</span> <span class="keyword1">OO</span> <span class="bound">Co2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra1</span> <span class="keyword1">OO</span> <span class="bound">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra2</span> <span class="keyword1">OO</span> <span class="bound">Contra2'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span>
    rel_G <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">Co1'</span> <span class="bound">Co2'</span> <span class="bound">Contra1'</span> <span class="bound">Contra2'</span>
    <span class="main">(</span>rel_G_witness <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">L1</span></span> <span class="bound"><span class="bound">L2</span></span> <span class="bound"><span class="bound">Co1</span></span> <span class="bound"><span class="bound">Co1'</span></span> <span class="bound"><span class="bound">Co2</span></span> <span class="bound"><span class="bound">Co2'</span></span> <span class="bound"><span class="bound">Contra1</span></span> <span class="bound"><span class="bound">Contra1'</span></span> <span class="bound"><span class="bound">Contra2</span></span> <span class="bound"><span class="bound">Contra2'</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">SOME</span></span> <span class="bound"><span class="bound">z</span></span><span class="main"><span class="main">.</span></span>
     rel_G <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">Co1</span></span> <span class="bound"><span class="bound">Co2</span></span> <span class="bound"><span class="bound">Contra1</span></span> <span class="bound"><span class="bound">Contra2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">z</span></span> <span class="main"><span class="main">∧</span></span>
     rel_G <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">Co1'</span></span> <span class="bound"><span class="bound">Co2'</span></span> <span class="bound"><span class="bound">Contra1'</span></span> <span class="bound"><span class="bound">Contra2'</span></span> <span class="bound"><span class="bound">z</span></span> <span class="bound"><span class="bound">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> all_conj_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> imp_conjR<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> L1 L2 Co1 Co1' Co2 Co2' Contra1 Contra1' Contra2 Contra2' x y
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> rel_G_neg_distr<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span>
          <span class="var">?L1.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?L1'.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y'</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span>
          <span class="var">?L2.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?L2'.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> predicate2D<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_G_mono<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> predicate2D<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fastforce</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> relcomppE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Composition">
<div class="head">
<h1>Theory Composition</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Andreas Lochbihler, ETH Zurich
   Author: Joshua Schneider, ETH Zurich *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Simple operations: demotion, merging, composition›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Composition <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Axiomatised_BNF_CC.html">Axiomatised_BNF_CC</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We illustrate the composition of \BNFCC{}s with one example for each kind of parameters
  (live/co-/contravariant/fixed). We do not show demotion and merging in isolation, as the
  examples for composition use these operations, too.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Composition in a live position›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span>
  <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGl <span class="main">=</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G<span class="main">,</span>
    <span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> F"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The type variables <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'l1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'co1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'contra1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> have each been merged.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel_FGl</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">L3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="main">=</span>
  rel_F <span class="main">(</span>rel_G <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">map_FGl</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">l3</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span> <span class="free"><span class="bound"><span class="entity">co3</span></span></span> <span class="free"><span class="bound"><span class="entity">co4</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">contra4</span></span></span> <span class="main">=</span>
  map_F <span class="main">(</span>map_G <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l3</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co3</span></span></span> <span class="free"><span class="bound"><span class="entity">co4</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">contra4</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGl_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">L1</span> <span class="main">≤</span> <span class="free">L1'</span><span class="main">;</span> <span class="free">L2</span> <span class="main">≤</span> <span class="free">L2'</span><span class="main">;</span> <span class="free">L3</span> <span class="main">≤</span> <span class="free">L3'</span><span class="main">;</span> <span class="free">Co1</span> <span class="main">≤</span> <span class="free">Co1'</span><span class="main">;</span> <span class="free">Co2</span> <span class="main">≤</span> <span class="free">Co2'</span><span class="main">;</span> <span class="free">Co3</span> <span class="main">≤</span> <span class="free">Co3'</span><span class="main">;</span> <span class="free">Co4</span> <span class="main">≤</span> <span class="free">Co4'</span><span class="main">;</span>
     <span class="free">Contra1'</span> <span class="main">≤</span> <span class="free">Contra1</span><span class="main">;</span> <span class="free">Contra2'</span> <span class="main">≤</span> <span class="free">Contra2</span><span class="main">;</span> <span class="free">Contra3'</span> <span class="main">≤</span> <span class="free">Contra3</span><span class="main">;</span> <span class="free">Contra4'</span> <span class="main">≤</span> <span class="free">Contra4</span> <span class="main">⟧</span> <span class="main">⟹</span>
  rel_FGl <span class="free">L1</span> <span class="free">L2</span> <span class="free">L3</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Co3</span> <span class="free">Co4</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">Contra3</span> <span class="free">Contra4</span> <span class="main">≤</span>
  rel_FGl <span class="free">L1'</span> <span class="free">L2'</span> <span class="free">L3'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Co3'</span> <span class="free">Co4'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span> <span class="free">Contra3'</span> <span class="free">Contra4'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGl_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_mono<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_mono<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGl_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_FGl <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGl_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_F_eq rel_G_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGl_conversep<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_FGl <span class="free">L1</span><span class="main">¯¯</span> <span class="free">L2</span><span class="main">¯¯</span> <span class="free">L3</span><span class="main">¯¯</span> <span class="free">Co1</span><span class="main">¯¯</span> <span class="free">Co2</span><span class="main">¯¯</span> <span class="free">Co3</span><span class="main">¯¯</span> <span class="free">Co4</span><span class="main">¯¯</span> <span class="free">Contra1</span><span class="main">¯¯</span> <span class="free">Contra2</span><span class="main">¯¯</span> <span class="free">Contra3</span><span class="main">¯¯</span> <span class="free">Contra4</span><span class="main">¯¯</span> <span class="main">=</span>
  <span class="main">(</span>rel_FGl <span class="free">L1</span> <span class="free">L2</span> <span class="free">L3</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Co3</span> <span class="free">Co4</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">Contra3</span> <span class="free">Contra4</span><span class="main">)</span><span class="main">¯¯</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGl_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_F_conversep rel_G_conversep<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_FGl_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"map_FGl id id id id id id id id id id id <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> map_FGl_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_F_id0 map_G_id0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_FGl_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"map_FGl <span class="free">l1</span> <span class="free">l2</span> <span class="free">l3</span> <span class="free">co1</span> <span class="free">co2</span> <span class="free">co3</span> <span class="free">co4</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="free">contra3</span> <span class="free">contra4</span> <span class="main">∘</span>
  map_FGl <span class="free">l1'</span> <span class="free">l2'</span> <span class="free">l3'</span> <span class="free">co1'</span> <span class="free">co2'</span> <span class="free">co3'</span> <span class="free">co4'</span> <span class="free">contra1'</span> <span class="free">contra2'</span> <span class="free">contra3'</span> <span class="free">contra4'</span> <span class="main">=</span>
  map_FGl <span class="main">(</span><span class="free">l1</span> <span class="main">∘</span> <span class="free">l1'</span><span class="main">)</span> <span class="main">(</span><span class="free">l2</span> <span class="main">∘</span> <span class="free">l2'</span><span class="main">)</span> <span class="main">(</span><span class="free">l3</span> <span class="main">∘</span> <span class="free">l3'</span><span class="main">)</span> <span class="main">(</span><span class="free">co1</span> <span class="main">∘</span> <span class="free">co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">co2</span> <span class="main">∘</span> <span class="free">co2'</span><span class="main">)</span> <span class="main">(</span><span class="free">co3</span> <span class="main">∘</span> <span class="free">co3'</span><span class="main">)</span> <span class="main">(</span><span class="free">co4</span> <span class="main">∘</span> <span class="free">co4'</span><span class="main">)</span>
    <span class="main">(</span><span class="free">contra1'</span> <span class="main">∘</span> <span class="free">contra1</span><span class="main">)</span> <span class="main">(</span><span class="free">contra2'</span> <span class="main">∘</span> <span class="free">contra2</span><span class="main">)</span> <span class="main">(</span><span class="free">contra3'</span> <span class="main">∘</span> <span class="free">contra3</span><span class="main">)</span> <span class="main">(</span><span class="free">contra4'</span> <span class="main">∘</span> <span class="free">contra4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> map_FGl_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_F_comp map_G_comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_FGl_parametric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_fun <span class="main">(</span>rel_fun <span class="free">L1</span> <span class="free">L1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">L2</span> <span class="free">L2'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">L3</span> <span class="free">L3'</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co1</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co2</span> <span class="free">Co2'</span><span class="main">)</span>
    <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co3</span> <span class="free">Co3'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co4</span> <span class="free">Co4'</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra1'</span> <span class="free">Contra1</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra2'</span> <span class="free">Contra2</span><span class="main">)</span>
    <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra3'</span> <span class="free">Contra3</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra4'</span> <span class="free">Contra4</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_FGl <span class="free">L1</span> <span class="free">L2</span> <span class="free">L3</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Co3</span> <span class="free">Co4</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">Contra3</span> <span class="free">Contra4</span><span class="main">)</span>
  <span class="main">(</span>rel_FGl <span class="free">L1'</span> <span class="free">L2'</span> <span class="free">L3'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Co3'</span> <span class="free">Co4'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span> <span class="free">Contra3'</span> <span class="free">Contra4'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  map_FGl map_FGl"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGl_def map_FGl_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_funI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> map_F_rel_cong map_G_rel_cong<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_FGl_pos_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co3</span> <span class="main">⇒</span> <span class="tfree">'co3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co3'</span> <span class="main">⇒</span> <span class="tfree">'co3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co4</span> <span class="main">⇒</span> <span class="tfree">'co4'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co4'</span> <span class="main">⇒</span> <span class="tfree">'co4''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra3</span> <span class="main">⇒</span> <span class="tfree">'contra3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra3'</span> <span class="main">⇒</span> <span class="tfree">'contra3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra4</span> <span class="main">⇒</span> <span class="tfree">'contra4'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra4'</span> <span class="main">⇒</span> <span class="tfree">'contra4''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'l3</span> <span class="main">×</span> <span class="tfree">'l3'</span> <span class="main">×</span> <span class="tfree">'l3''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_FGl_pos_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span>
    <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L2</span> <span class="main">::</span> <span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L2'</span> <span class="main">::</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L3</span> <span class="main">::</span> <span class="tfree">'l3</span> <span class="main">⇒</span> <span class="tfree">'l3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L3'</span> <span class="main">::</span> <span class="tfree">'l3'</span> <span class="main">⇒</span> <span class="tfree">'l3''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    <span class="main">(</span>rel_FGl <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="main">::</span>
      <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGl <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_FGl <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="bound">L3'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span> <span class="main">≤</span>
    rel_FGl <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L2</span> <span class="keyword1">OO</span> <span class="bound">L2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L3</span> <span class="keyword1">OO</span> <span class="bound">L3'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_FGl_neg_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co3</span> <span class="main">⇒</span> <span class="tfree">'co3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co3'</span> <span class="main">⇒</span> <span class="tfree">'co3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co4</span> <span class="main">⇒</span> <span class="tfree">'co4'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co4'</span> <span class="main">⇒</span> <span class="tfree">'co4''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra3</span> <span class="main">⇒</span> <span class="tfree">'contra3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra3'</span> <span class="main">⇒</span> <span class="tfree">'contra3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra4</span> <span class="main">⇒</span> <span class="tfree">'contra4'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra4'</span> <span class="main">⇒</span> <span class="tfree">'contra4''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'l3</span> <span class="main">×</span> <span class="tfree">'l3'</span> <span class="main">×</span> <span class="tfree">'l3''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_FGl_neg_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span>
    <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L2</span> <span class="main">::</span> <span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L2'</span> <span class="main">::</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L3</span> <span class="main">::</span> <span class="tfree">'l3</span> <span class="main">⇒</span> <span class="tfree">'l3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L3'</span> <span class="main">::</span> <span class="tfree">'l3'</span> <span class="main">⇒</span> <span class="tfree">'l3''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    rel_FGl <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L2</span> <span class="keyword1">OO</span> <span class="bound">L2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L3</span> <span class="keyword1">OO</span> <span class="bound">L3'</span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span><span class="main">)</span> <span class="main">≤</span>
    <span class="main">(</span>rel_FGl <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">L3</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="main">::</span>
      <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGl <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_FGl <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="bound">L3'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sufficient conditions for subdistributivity over relation composition.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGl_pos_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G <span class="main">×</span>
      <span class="main">(</span><span class="tfree">'l1'</span><span class="main">,</span> <span class="tfree">'l2'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G <span class="main">×</span>
      <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G <span class="main">×</span>
      <span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l3</span> <span class="main">×</span> <span class="tfree">'l3'</span> <span class="main">×</span> <span class="tfree">'l3''</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f1</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_FGl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'l3</span> <span class="main">×</span> <span class="tfree">'l3'</span> <span class="main">×</span> <span class="tfree">'l3''</span> <span class="main">×</span>
      <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_F_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co3</span> <span class="free">Co3'</span> <span class="free">Co4</span> <span class="free">Co4'</span>
      <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra3</span> <span class="free">Contra3'</span> <span class="free">Contra4</span> <span class="free">Contra4'</span> <span class="free">tytok_F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rel_G_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGl_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Co3</span> <span class="free">Co3'</span> <span class="free">Co4</span> <span class="free">Co4'</span>
    <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">Contra3</span> <span class="free">Contra3'</span> <span class="free">Contra4</span> <span class="free">Contra4'</span> <span class="free">tytok_FGl</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGl_pos_distr_cond_def rel_FGl_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_pos_distr<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_mono<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_pos_distr<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGl_neg_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G <span class="main">×</span>
      <span class="main">(</span><span class="tfree">'l1'</span><span class="main">,</span> <span class="tfree">'l2'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G <span class="main">×</span>
      <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G <span class="main">×</span>
      <span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l3</span> <span class="main">×</span> <span class="tfree">'l3'</span> <span class="main">×</span> <span class="tfree">'l3''</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f1</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_FGl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'l3</span> <span class="main">×</span> <span class="tfree">'l3'</span> <span class="main">×</span> <span class="tfree">'l3''</span> <span class="main">×</span>
      <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_F_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co3</span> <span class="free">Co3'</span> <span class="free">Co4</span> <span class="free">Co4'</span>
      <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra3</span> <span class="free">Contra3'</span> <span class="free">Contra4</span> <span class="free">Contra4'</span> <span class="free">tytok_F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rel_G_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGl_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Co3</span> <span class="free">Co3'</span> <span class="free">Co4</span> <span class="free">Co4'</span>
    <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">Contra3</span> <span class="free">Contra3'</span> <span class="free">Contra4</span> <span class="free">Contra4'</span> <span class="free">tytok_FGl</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGl_neg_distr_cond_def rel_FGl_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_neg_distr<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_mono<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_neg_distr<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGl_pos_distr_cond_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">tytok</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'l3</span> <span class="main">×</span> <span class="tfree">'l3'</span> <span class="main">×</span> <span class="tfree">'l3''</span> <span class="main">×</span>
    <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGl_pos_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>
    <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_FGl_pos_distr_imp rel_F_pos_distr_cond_eq rel_G_pos_distr_cond_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGl_neg_distr_cond_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">tytok</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'l3</span> <span class="main">×</span> <span class="tfree">'l3'</span> <span class="main">×</span> <span class="tfree">'l3''</span> <span class="main">×</span>
    <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGl_neg_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>
    <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_FGl_neg_distr_imp rel_F_neg_distr_cond_eq rel_G_neg_distr_cond_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rell_FGl</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">L3</span></span></span> <span class="main">=</span> rel_FGl <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">L3</span></span></span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mapl_FGl</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">l3</span></span></span> <span class="main">=</span> map_FGl <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">l3</span></span></span> id id id id id id id id"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGlbd <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> Fbd <span class="main">×</span>
    <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> Gbd <span class="main">+</span>
    <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> Fbd"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set1_FGl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGl <span class="main">⇒</span> <span class="tfree">'l1</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">set1_FGl</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span>set1_F <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">.</span> set1_G <span class="bound">y</span><span class="main">)</span> <span class="main">∪</span> set2_F <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set2_FGl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGl <span class="main">⇒</span> <span class="tfree">'l2</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">set2_FGl</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span>set1_F <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">.</span> set2_G <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set3_FGl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'l3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGl <span class="main">⇒</span> <span class="tfree">'l3</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">set3_FGl</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> set3_F <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">bd_FGl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGlbd rel"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bd_FGl</span> <span class="main">=</span> bd_F <span class="keyword1">*c</span> bd_G <span class="keyword1">+c</span> bd_F"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set1_FGl_map<span class="main">:</span> <span class="quoted"><span class="quoted">"set1_FGl <span class="main">∘</span> mapl_FGl <span class="free">l1</span> <span class="free">l2</span> <span class="free">l3</span> <span class="main">=</span> image <span class="free">l1</span> <span class="main">∘</span> set1_FGl"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff set1_FGl_def mapl_FGl_def map_FGl_def
      mapl_F_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mapl_G_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
      set1_F_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> set2_F_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span>
      set1_G_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span>
      image_Un image_UN<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set2_FGl_map<span class="main">:</span> <span class="quoted"><span class="quoted">"set2_FGl <span class="main">∘</span> mapl_FGl <span class="free">l1</span> <span class="free">l2</span> <span class="free">l3</span> <span class="main">=</span> image <span class="free">l2</span> <span class="main">∘</span> set2_FGl"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff set2_FGl_def mapl_FGl_def map_FGl_def
      mapl_F_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mapl_G_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
      set1_F_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> set2_G_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> image_UN<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set3_FGl_map<span class="main">:</span> <span class="quoted"><span class="quoted">"set3_FGl <span class="main">∘</span> mapl_FGl <span class="free">l1</span> <span class="free">l2</span> <span class="free">l3</span> <span class="main">=</span> image <span class="free">l3</span> <span class="main">∘</span> set3_FGl"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff set3_FGl_def mapl_FGl_def map_FGl_def
      mapl_F_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mapl_G_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> set3_F_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bd_FGl_card_order<span class="main">:</span> <span class="quoted"><span class="quoted">"card_order bd_FGl"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bd_FGl_def <span class="keyword1"><span class="command">using</span></span> bd_F_card_order bd_G_card_order
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_order_csum card_order_cprod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bd_FGl_cinfinite<span class="main">:</span> <span class="quoted"><span class="quoted">"cinfinite bd_FGl"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bd_FGl_def <span class="keyword1"><span class="command">using</span></span> bd_F_cinfinite bd_G_cinfinite
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cinfinite_csum disjI2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGl"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> set1_FGl_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"card_of <span class="main">(</span>set1_FGl <span class="free">x</span><span class="main">)</span> <span class="keyword1">≤o</span>
      <span class="main">(</span>bd_FGl <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGlbd rel<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> set2_FGl_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"card_of <span class="main">(</span>set2_FGl <span class="free">x</span><span class="main">)</span> <span class="keyword1">≤o</span>
      <span class="main">(</span>bd_FGl <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGlbd rel<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> set3_FGl_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"card_of <span class="main">(</span>set3_FGl <span class="free">x</span><span class="main">)</span> <span class="keyword1">≤o</span>
      <span class="main">(</span>bd_FGl <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGlbd rel<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set1_FGl_def set2_FGl_def set3_FGl_def bd_FGl_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ordLeq_transitive<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Un_csum<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> csum_mono<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> comp_single_set_bd<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> fset<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">set1_G</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> gset<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">set1_F</span></span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set1_G_bound<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set1_F_bound<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_order_on_Card_order<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> bd_G_card_order<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set2_F_bound<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ordLeq_transitive<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> comp_single_set_bd<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> fset<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">set2_G</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> gset<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">set1_F</span></span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set2_G_bound<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set1_F_bound<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_order_on_Card_order<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> bd_G_card_order<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ordLeq_csum1<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Card_order_cprod<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ordLeq_transitive<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set3_F_bound<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ordLeq_csum2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_order_on_Card_order<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> bd_F_card_order<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_FGl_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set1_FGl <span class="free">x</span> <span class="main">⟹</span> <span class="free">l1</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">l1'</span> <span class="bound">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set2_FGl <span class="free">x</span> <span class="main">⟹</span> <span class="free">l2</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">l2'</span> <span class="bound">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set3_FGl <span class="free">x</span> <span class="main">⟹</span> <span class="free">l3</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">l3'</span> <span class="bound">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mapl_FGl <span class="free">l1</span> <span class="free">l2</span> <span class="free">l3</span> <span class="free">x</span> <span class="main">=</span> mapl_FGl <span class="free">l1'</span> <span class="free">l2'</span> <span class="free">l3'</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_FGl_def map_FGl_def mapl_G_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> mapl_F_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 5 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mapl_F_cong mapl_G_cong assms <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set1_FGl_def set2_FGl_def set3_FGl_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rell_FGl_mono_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rell_FGl <span class="free">L1</span> <span class="free">L2</span> <span class="free">L3</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set1_FGl <span class="free">x</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set1_FGl <span class="free">y</span> <span class="main">⟹</span> <span class="free">L1</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">L1'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set2_FGl <span class="free">x</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set2_FGl <span class="free">y</span> <span class="main">⟹</span> <span class="free">L2</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">L2'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set3_FGl <span class="free">x</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set3_FGl <span class="free">y</span> <span class="main">⟹</span> <span class="free">L3</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">L3'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rell_FGl <span class="free">L1'</span> <span class="free">L2'</span> <span class="free">L3'</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> rell_FGl_def rel_FGl_def rell_G_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> rell_F_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 5 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rell_F_mono_strong rell_G_mono_strong assms<span class="main"><span class="main">(</span></span>2-4<span class="main"><span class="main">)</span></span>
      <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set1_FGl_def set2_FGl_def set3_FGl_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Composition in a covariant position›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span>
  <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span> <span class="tfree">'co6</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGco <span class="main">=</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G<span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co6</span><span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> F"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The type variables <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'co1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'co3</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'contra1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> have each been merged.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel_FGco</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="free"><span class="bound"><span class="entity">Co6</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="main">=</span>
  rel_F <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="main">(</span>rel_G <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co6</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">map_FGco</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span> <span class="free"><span class="bound"><span class="entity">co3</span></span></span> <span class="free"><span class="bound"><span class="entity">co4</span></span></span> <span class="free"><span class="bound"><span class="entity">co5</span></span></span> <span class="free"><span class="bound"><span class="entity">co6</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">contra4</span></span></span> <span class="main">=</span>
  map_F <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co5</span></span></span> <span class="main">(</span>map_G <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span> <span class="free"><span class="bound"><span class="entity">co3</span></span></span> <span class="free"><span class="bound"><span class="entity">co4</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">co3</span></span></span> <span class="free"><span class="bound"><span class="entity">co6</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">contra4</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGco_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">L1</span> <span class="main">≤</span> <span class="free">L1'</span><span class="main">;</span> <span class="free">Co1</span> <span class="main">≤</span> <span class="free">Co1'</span><span class="main">;</span> <span class="free">Co2</span> <span class="main">≤</span> <span class="free">Co2'</span><span class="main">;</span> <span class="free">Co3</span> <span class="main">≤</span> <span class="free">Co3'</span><span class="main">;</span> <span class="free">Co4</span> <span class="main">≤</span> <span class="free">Co4'</span><span class="main">;</span> <span class="free">Co5</span> <span class="main">≤</span> <span class="free">Co5'</span><span class="main">;</span> <span class="free">Co6</span> <span class="main">≤</span> <span class="free">Co6'</span><span class="main">;</span>
     <span class="free">Contra1'</span> <span class="main">≤</span> <span class="free">Contra1</span><span class="main">;</span> <span class="free">Contra2'</span> <span class="main">≤</span> <span class="free">Contra2</span><span class="main">;</span> <span class="free">Contra3'</span> <span class="main">≤</span> <span class="free">Contra3</span><span class="main">;</span> <span class="free">Contra4'</span> <span class="main">≤</span> <span class="free">Contra4</span> <span class="main">⟧</span> <span class="main">⟹</span>
  rel_FGco <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Co3</span> <span class="free">Co4</span> <span class="free">Co5</span> <span class="free">Co6</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">Contra3</span> <span class="free">Contra4</span> <span class="main">≤</span>
  rel_FGco <span class="free">L1'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Co3'</span> <span class="free">Co4'</span> <span class="free">Co5'</span> <span class="free">Co6'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span> <span class="free">Contra3'</span> <span class="free">Contra4'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGco_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_mono<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_mono<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGco_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_FGco <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGco_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_F_eq rel_G_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGco_conversep<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_FGco <span class="free">L1</span><span class="main">¯¯</span> <span class="free">Co1</span><span class="main">¯¯</span> <span class="free">Co2</span><span class="main">¯¯</span> <span class="free">Co3</span><span class="main">¯¯</span> <span class="free">Co4</span><span class="main">¯¯</span> <span class="free">Co5</span><span class="main">¯¯</span> <span class="free">Co6</span><span class="main">¯¯</span> <span class="free">Contra1</span><span class="main">¯¯</span> <span class="free">Contra2</span><span class="main">¯¯</span> <span class="free">Contra3</span><span class="main">¯¯</span> <span class="free">Contra4</span><span class="main">¯¯</span> <span class="main">=</span>
  <span class="main">(</span>rel_FGco <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Co3</span> <span class="free">Co4</span> <span class="free">Co5</span> <span class="free">Co6</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">Contra3</span> <span class="free">Contra4</span><span class="main">)</span><span class="main">¯¯</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGco_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_F_conversep rel_G_conversep<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_FGco_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"map_FGco id id id id id id id id id id id <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> map_FGco_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_F_id0 map_G_id0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_FGco_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"map_FGco <span class="free">l1</span> <span class="free">co1</span> <span class="free">co2</span> <span class="free">co3</span> <span class="free">co4</span> <span class="free">co5</span> <span class="free">co6</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="free">contra3</span> <span class="free">contra4</span> <span class="main">∘</span>
  map_FGco <span class="free">l1'</span> <span class="free">co1'</span> <span class="free">co2'</span> <span class="free">co3'</span> <span class="free">co4'</span> <span class="free">co5'</span> <span class="free">co6'</span> <span class="free">contra1'</span> <span class="free">contra2'</span> <span class="free">contra3'</span> <span class="free">contra4'</span> <span class="main">=</span>
  map_FGco <span class="main">(</span><span class="free">l1</span> <span class="main">∘</span> <span class="free">l1'</span><span class="main">)</span> <span class="main">(</span><span class="free">co1</span> <span class="main">∘</span> <span class="free">co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">co2</span> <span class="main">∘</span> <span class="free">co2'</span><span class="main">)</span> <span class="main">(</span><span class="free">co3</span> <span class="main">∘</span> <span class="free">co3'</span><span class="main">)</span> <span class="main">(</span><span class="free">co4</span> <span class="main">∘</span> <span class="free">co4'</span><span class="main">)</span> <span class="main">(</span><span class="free">co5</span> <span class="main">∘</span> <span class="free">co5'</span><span class="main">)</span> <span class="main">(</span><span class="free">co6</span> <span class="main">∘</span> <span class="free">co6'</span><span class="main">)</span>
    <span class="main">(</span><span class="free">contra1'</span> <span class="main">∘</span> <span class="free">contra1</span><span class="main">)</span> <span class="main">(</span><span class="free">contra2'</span> <span class="main">∘</span> <span class="free">contra2</span><span class="main">)</span> <span class="main">(</span><span class="free">contra3'</span> <span class="main">∘</span> <span class="free">contra3</span><span class="main">)</span> <span class="main">(</span><span class="free">contra4'</span> <span class="main">∘</span> <span class="free">contra4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> map_FGco_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_F_comp map_G_comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_FGco_parametric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_fun <span class="main">(</span>rel_fun <span class="free">L1</span> <span class="free">L1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co1</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co2</span> <span class="free">Co2'</span><span class="main">)</span>
    <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co3</span> <span class="free">Co3'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co4</span> <span class="free">Co4'</span><span class="main">)</span>
    <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co5</span> <span class="free">Co5'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co6</span> <span class="free">Co6'</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra1'</span> <span class="free">Contra1</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra2'</span> <span class="free">Contra2</span><span class="main">)</span>
    <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra3'</span> <span class="free">Contra3</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra4'</span> <span class="free">Contra4</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_FGco <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Co3</span> <span class="free">Co4</span> <span class="free">Co5</span> <span class="free">Co6</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">Contra3</span> <span class="free">Contra4</span><span class="main">)</span>
  <span class="main">(</span>rel_FGco <span class="free">L1'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Co3'</span> <span class="free">Co4'</span> <span class="free">Co5'</span> <span class="free">Co6'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span> <span class="free">Contra3'</span> <span class="free">Contra4'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  map_FGco map_FGco"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGco_def map_FGco_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_funI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> map_F_rel_cong map_G_rel_cong<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_FGco_pos_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co3</span> <span class="main">⇒</span> <span class="tfree">'co3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co3'</span> <span class="main">⇒</span> <span class="tfree">'co3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co4</span> <span class="main">⇒</span> <span class="tfree">'co4'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co4'</span> <span class="main">⇒</span> <span class="tfree">'co4''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co5</span> <span class="main">⇒</span> <span class="tfree">'co5'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co5'</span> <span class="main">⇒</span> <span class="tfree">'co5''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co6</span> <span class="main">⇒</span> <span class="tfree">'co6'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co6'</span> <span class="main">⇒</span> <span class="tfree">'co6''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra3</span> <span class="main">⇒</span> <span class="tfree">'contra3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra3'</span> <span class="main">⇒</span> <span class="tfree">'contra3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra4</span> <span class="main">⇒</span> <span class="tfree">'contra4'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra4'</span> <span class="main">⇒</span> <span class="tfree">'contra4''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_FGco_pos_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co6</span></span></span> <span class="free"><span class="bound"><span class="entity">Co6'</span></span></span>
    <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    <span class="main">(</span>rel_FGco <span class="bound">L1</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="free"><span class="bound"><span class="entity">Co6</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="main">::</span>
      <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGco <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_FGco <span class="bound">L1'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co6'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span> <span class="main">≤</span>
    rel_FGco <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co5'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co6</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co6'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_FGco_neg_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co3</span> <span class="main">⇒</span> <span class="tfree">'co3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co3'</span> <span class="main">⇒</span> <span class="tfree">'co3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co4</span> <span class="main">⇒</span> <span class="tfree">'co4'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co4'</span> <span class="main">⇒</span> <span class="tfree">'co4''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co5</span> <span class="main">⇒</span> <span class="tfree">'co5'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co5'</span> <span class="main">⇒</span> <span class="tfree">'co5''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co6</span> <span class="main">⇒</span> <span class="tfree">'co6'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co6'</span> <span class="main">⇒</span> <span class="tfree">'co6''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra3</span> <span class="main">⇒</span> <span class="tfree">'contra3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra3'</span> <span class="main">⇒</span> <span class="tfree">'contra3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra4</span> <span class="main">⇒</span> <span class="tfree">'contra4'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra4'</span> <span class="main">⇒</span> <span class="tfree">'contra4''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_FGco_neg_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co6</span></span></span> <span class="free"><span class="bound"><span class="entity">Co6'</span></span></span>
    <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    rel_FGco <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co5'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co6</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co6'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span><span class="main">)</span> <span class="main">≤</span>
    <span class="main">(</span>rel_FGco <span class="bound">L1</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="free"><span class="bound"><span class="entity">Co6</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="main">::</span>
      <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGco <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_FGco <span class="bound">L1'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co6'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sufficient conditions for subdistributivity over relation composition.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGco_pos_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co5</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co5</span> <span class="main">⇒</span> <span class="tfree">'co5'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co5'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co5'</span> <span class="main">⇒</span> <span class="tfree">'co5''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'co1</span> <span class="main">×</span> <span class="tfree">'co1'</span> <span class="main">×</span> <span class="tfree">'co1''</span> <span class="main">×</span> <span class="tfree">'co5</span> <span class="main">×</span> <span class="tfree">'co5'</span> <span class="main">×</span> <span class="tfree">'co5''</span> <span class="main">×</span>
      <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">×</span> <span class="tfree">'co1'</span> <span class="main">×</span> <span class="tfree">'co1''</span> <span class="main">×</span> <span class="tfree">'co2</span> <span class="main">×</span> <span class="tfree">'co2'</span> <span class="main">×</span> <span class="tfree">'co2''</span> <span class="main">×</span> <span class="tfree">'f1</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_FGco</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_F_pos_distr_cond
      <span class="main">(</span>rel_G <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Co3</span> <span class="free">Co4</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span>
      <span class="main">(</span>rel_G <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Co3'</span> <span class="free">Co4'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span><span class="main">)</span> <span class="free">Co3</span> <span class="free">Co3'</span> <span class="free">Co6</span> <span class="free">Co6'</span>
      <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra3</span> <span class="free">Contra3'</span> <span class="free">Contra4</span> <span class="free">Contra4'</span> <span class="free">tytok_F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rel_G_pos_distr_cond <span class="free">Co3</span> <span class="free">Co3'</span> <span class="free">Co4</span> <span class="free">Co4'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGco_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Co3</span> <span class="free">Co3'</span> <span class="free">Co4</span> <span class="free">Co4'</span> <span class="free">Co5</span> <span class="free">Co5'</span> <span class="free">Co6</span> <span class="free">Co6'</span>
    <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">Contra3</span> <span class="free">Contra3'</span> <span class="free">Contra4</span> <span class="free">Contra4'</span> <span class="free">tytok_FGco</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGco_pos_distr_cond_def rel_FGco_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_pos_distr<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_mono<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_pos_distr<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGco_neg_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co5</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co5</span> <span class="main">⇒</span> <span class="tfree">'co5'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co5'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co5'</span> <span class="main">⇒</span> <span class="tfree">'co5''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'co1</span> <span class="main">×</span> <span class="tfree">'co1'</span> <span class="main">×</span> <span class="tfree">'co1''</span> <span class="main">×</span> <span class="tfree">'co5</span> <span class="main">×</span> <span class="tfree">'co5'</span> <span class="main">×</span> <span class="tfree">'co5''</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">×</span> <span class="tfree">'co1'</span> <span class="main">×</span> <span class="tfree">'co1''</span> <span class="main">×</span> <span class="tfree">'co2</span> <span class="main">×</span> <span class="tfree">'co2'</span> <span class="main">×</span> <span class="tfree">'co2''</span> <span class="main">×</span> <span class="tfree">'f1</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_FGco</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_F_neg_distr_cond
      <span class="main">(</span>rel_G <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Co3</span> <span class="free">Co4</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span>
      <span class="main">(</span>rel_G <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Co3'</span> <span class="free">Co4'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span><span class="main">)</span> <span class="free">Co3</span> <span class="free">Co3'</span> <span class="free">Co6</span> <span class="free">Co6'</span>
      <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra3</span> <span class="free">Contra3'</span> <span class="free">Contra4</span> <span class="free">Contra4'</span> <span class="free">tytok_F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rel_G_neg_distr_cond <span class="free">Co3</span> <span class="free">Co3'</span> <span class="free">Co4</span> <span class="free">Co4'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGco_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Co3</span> <span class="free">Co3'</span> <span class="free">Co4</span> <span class="free">Co4'</span> <span class="free">Co5</span> <span class="free">Co5'</span> <span class="free">Co6</span> <span class="free">Co6'</span>
    <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">Contra3</span> <span class="free">Contra3'</span> <span class="free">Contra4</span> <span class="free">Contra4'</span> <span class="free">tytok_FGco</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGco_neg_distr_cond_def rel_FGco_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_neg_distr<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_mono<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_neg_distr<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGco_pos_distr_cond_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">tytok</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGco_pos_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>
    <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_FGco_pos_distr_imp<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_G_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_pos_distr_cond_eq rel_G_pos_distr_cond_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGco_neg_distr_cond_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">tytok</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGco_neg_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>
    <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_FGco_neg_distr_imp<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_G_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_neg_distr_cond_eq rel_G_neg_distr_cond_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rell_FGco</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="main">=</span> rel_FGco <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mapl_FGco</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main">=</span> map_FGco <span class="free"><span class="bound"><span class="entity">l1</span></span></span> id id id id id id id id id id"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span> <span class="tfree">'co6</span><span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGcobd <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G<span class="main">,</span>
    <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co6</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> Fbd"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set1_FGco</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span> <span class="tfree">'co6</span><span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGco <span class="main">⇒</span> <span class="tfree">'l1</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">set1_FGco</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> set1_F <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bd_FGco</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span> <span class="tfree">'co6</span><span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGcobd rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bd_FGco</span> <span class="main">=</span> bd_F"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set1_FGco_map<span class="main">:</span> <span class="quoted"><span class="quoted">"set1_FGco <span class="main">∘</span> mapl_FGco <span class="free">l1</span> <span class="main">=</span> image <span class="free">l1</span> <span class="main">∘</span> set1_FGco"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff set1_FGco_def mapl_FGco_def map_FGco_def
      mapl_F_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mapl_G_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mapl_G_id0
      set1_F_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bd_FGco_card_order<span class="main">:</span> <span class="quoted"><span class="quoted">"card_order bd_FGco"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bd_FGco_def <span class="keyword1"><span class="command">using</span></span> bd_F_card_order <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bd_FGco_cinfinite<span class="main">:</span> <span class="quoted"><span class="quoted">"cinfinite bd_FGco"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bd_FGco_def <span class="keyword1"><span class="command">using</span></span> bd_F_cinfinite <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set1_FGco_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span> <span class="tfree">'co6</span><span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGco"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card_of <span class="main">(</span>set1_FGco <span class="free">x</span><span class="main">)</span> <span class="keyword1">≤o</span> <span class="main">(</span>bd_FGco <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span> <span class="tfree">'co6</span><span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGcobd rel<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set1_FGco_def bd_FGco_def <span class="keyword1"><span class="command">using</span></span> set1_F_bound <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_FGco_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set1_FGco <span class="free">x</span> <span class="main">⟹</span> <span class="free">l1</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">l1'</span> <span class="bound">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mapl_FGco <span class="free">l1</span> <span class="free">x</span> <span class="main">=</span> mapl_FGco <span class="free">l1'</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_FGco_def map_FGco_def mapl_G_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> mapl_F_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> mapl_G_id0
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mapl_F_cong assms <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set1_FGco_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rell_FGco_mono_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rell_FGco <span class="free">L1</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set1_FGco <span class="free">x</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set1_FGco <span class="free">y</span> <span class="main">⟹</span> <span class="free">L1</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">L1'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rell_FGco <span class="free">L1'</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> rell_FGco_def rel_FGco_def rel_G_eq rell_F_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rell_F_mono_strong assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set1_FGco_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Composition in a contravariant position›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span>
  <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span>
    <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'contra5</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGcontra <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G<span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra5</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> F"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The type variables <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'co1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'contra1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> have each been merged.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel_FGcontra</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra5</span></span></span> <span class="main">=</span>
  rel_F <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="main">(</span>rel_G <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra5</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">map_FGcontra</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span> <span class="free"><span class="bound"><span class="entity">co3</span></span></span> <span class="free"><span class="bound"><span class="entity">co4</span></span></span> <span class="free"><span class="bound"><span class="entity">co5</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">contra4</span></span></span> <span class="free"><span class="bound"><span class="entity">contra5</span></span></span> <span class="main">=</span>
  map_F <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co3</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co4</span></span></span> <span class="free"><span class="bound"><span class="entity">co5</span></span></span> <span class="main">(</span>map_G <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">contra4</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra5</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGcontra_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">L1</span> <span class="main">≤</span> <span class="free">L1'</span><span class="main">;</span> <span class="free">Co1</span> <span class="main">≤</span> <span class="free">Co1'</span><span class="main">;</span> <span class="free">Co2</span> <span class="main">≤</span> <span class="free">Co2'</span><span class="main">;</span> <span class="free">Co3</span> <span class="main">≤</span> <span class="free">Co3'</span><span class="main">;</span> <span class="free">Co4</span> <span class="main">≤</span> <span class="free">Co4'</span><span class="main">;</span> <span class="free">Co5</span> <span class="main">≤</span> <span class="free">Co5'</span><span class="main">;</span>
     <span class="free">Contra1'</span> <span class="main">≤</span> <span class="free">Contra1</span><span class="main">;</span> <span class="free">Contra2'</span> <span class="main">≤</span> <span class="free">Contra2</span><span class="main">;</span> <span class="free">Contra3'</span> <span class="main">≤</span> <span class="free">Contra3</span><span class="main">;</span>
     <span class="free">Contra4'</span> <span class="main">≤</span> <span class="free">Contra4</span><span class="main">;</span> <span class="free">Contra5'</span> <span class="main">≤</span> <span class="free">Contra5</span> <span class="main">⟧</span> <span class="main">⟹</span>
  rel_FGcontra <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Co3</span> <span class="free">Co4</span> <span class="free">Co5</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">Contra3</span> <span class="free">Contra4</span> <span class="free">Contra5</span> <span class="main">≤</span>
  rel_FGcontra <span class="free">L1'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Co3'</span> <span class="free">Co4'</span> <span class="free">Co5'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span> <span class="free">Contra3'</span> <span class="free">Contra4'</span> <span class="free">Contra5'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGcontra_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_mono<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_mono<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGcontra_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_FGcontra <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGcontra_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_F_eq rel_G_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGcontra_conversep<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_FGcontra <span class="free">L1</span><span class="main">¯¯</span> <span class="free">Co1</span><span class="main">¯¯</span> <span class="free">Co2</span><span class="main">¯¯</span> <span class="free">Co3</span><span class="main">¯¯</span> <span class="free">Co4</span><span class="main">¯¯</span> <span class="free">Co5</span><span class="main">¯¯</span> <span class="free">Contra1</span><span class="main">¯¯</span> <span class="free">Contra2</span><span class="main">¯¯</span> <span class="free">Contra3</span><span class="main">¯¯</span> <span class="free">Contra4</span><span class="main">¯¯</span> <span class="free">Contra5</span><span class="main">¯¯</span> <span class="main">=</span>
  <span class="main">(</span>rel_FGcontra <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Co3</span> <span class="free">Co4</span> <span class="free">Co5</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">Contra3</span> <span class="free">Contra4</span> <span class="free">Contra5</span><span class="main">)</span><span class="main">¯¯</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGcontra_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_F_conversep rel_G_conversep<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_FGcontra_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"map_FGcontra id id id id id id id id id id id <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> map_FGcontra_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_F_id0 map_G_id0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_FGcontra_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_FGcontra <span class="free">l1</span> <span class="free">co1</span> <span class="free">co2</span> <span class="free">co3</span> <span class="free">co4</span> <span class="free">co5</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="free">contra3</span> <span class="free">contra4</span> <span class="free">contra5</span> <span class="main">∘</span>
  map_FGcontra <span class="free">l1'</span> <span class="free">co1'</span> <span class="free">co2'</span> <span class="free">co3'</span> <span class="free">co4'</span> <span class="free">co5'</span> <span class="free">contra1'</span> <span class="free">contra2'</span> <span class="free">contra3'</span> <span class="free">contra4'</span> <span class="free">contra5'</span> <span class="main">=</span>
  map_FGcontra <span class="main">(</span><span class="free">l1</span> <span class="main">∘</span> <span class="free">l1'</span><span class="main">)</span> <span class="main">(</span><span class="free">co1</span> <span class="main">∘</span> <span class="free">co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">co2</span> <span class="main">∘</span> <span class="free">co2'</span><span class="main">)</span> <span class="main">(</span><span class="free">co3</span> <span class="main">∘</span> <span class="free">co3'</span><span class="main">)</span> <span class="main">(</span><span class="free">co4</span> <span class="main">∘</span> <span class="free">co4'</span><span class="main">)</span> <span class="main">(</span><span class="free">co5</span> <span class="main">∘</span> <span class="free">co5'</span><span class="main">)</span>
    <span class="main">(</span><span class="free">contra1'</span> <span class="main">∘</span> <span class="free">contra1</span><span class="main">)</span> <span class="main">(</span><span class="free">contra2'</span> <span class="main">∘</span> <span class="free">contra2</span><span class="main">)</span> <span class="main">(</span><span class="free">contra3'</span> <span class="main">∘</span> <span class="free">contra3</span><span class="main">)</span>
    <span class="main">(</span><span class="free">contra4'</span> <span class="main">∘</span> <span class="free">contra4</span><span class="main">)</span> <span class="main">(</span><span class="free">contra5'</span> <span class="main">∘</span> <span class="free">contra5</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> map_FGcontra_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_F_comp map_G_comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_FGcontra_parametric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_fun <span class="main">(</span>rel_fun <span class="free">L1</span> <span class="free">L1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co1</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co2</span> <span class="free">Co2'</span><span class="main">)</span>
    <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co3</span> <span class="free">Co3'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co4</span> <span class="free">Co4'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co5</span> <span class="free">Co5'</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra1'</span> <span class="free">Contra1</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra2'</span> <span class="free">Contra2</span><span class="main">)</span>
    <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra3'</span> <span class="free">Contra3</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra4'</span> <span class="free">Contra4</span><span class="main">)</span>
    <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra5'</span> <span class="free">Contra5</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_FGcontra <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Co3</span> <span class="free">Co4</span> <span class="free">Co5</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">Contra3</span> <span class="free">Contra4</span> <span class="free">Contra5</span><span class="main">)</span>
  <span class="main">(</span>rel_FGcontra <span class="free">L1'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Co3'</span> <span class="free">Co4'</span> <span class="free">Co5'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span> <span class="free">Contra3'</span> <span class="free">Contra4'</span> <span class="free">Contra5'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  map_FGcontra map_FGcontra"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGcontra_def map_FGcontra_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_funI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> map_F_rel_cong map_G_rel_cong<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_FGcontra_pos_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co3</span> <span class="main">⇒</span> <span class="tfree">'co3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co3'</span> <span class="main">⇒</span> <span class="tfree">'co3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co4</span> <span class="main">⇒</span> <span class="tfree">'co4'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co4'</span> <span class="main">⇒</span> <span class="tfree">'co4''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co5</span> <span class="main">⇒</span> <span class="tfree">'co5'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co5'</span> <span class="main">⇒</span> <span class="tfree">'co5''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra3</span> <span class="main">⇒</span> <span class="tfree">'contra3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra3'</span> <span class="main">⇒</span> <span class="tfree">'contra3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra4</span> <span class="main">⇒</span> <span class="tfree">'contra4'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra4'</span> <span class="main">⇒</span> <span class="tfree">'contra4''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra5</span> <span class="main">⇒</span> <span class="tfree">'contra5'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra5'</span> <span class="main">⇒</span> <span class="tfree">'contra5''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_FGcontra_pos_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5'</span></span></span>
    <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra5</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra5'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    <span class="main">(</span>rel_FGcontra <span class="bound">L1</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra5</span></span></span> <span class="main">::</span>
      <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGcontra <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_FGcontra <span class="bound">L1'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra5'</span></span></span> <span class="main">≤</span>
    rel_FGcontra <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co5'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra5</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra5'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_FGcontra_neg_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co3</span> <span class="main">⇒</span> <span class="tfree">'co3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co3'</span> <span class="main">⇒</span> <span class="tfree">'co3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co4</span> <span class="main">⇒</span> <span class="tfree">'co4'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co4'</span> <span class="main">⇒</span> <span class="tfree">'co4''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co5</span> <span class="main">⇒</span> <span class="tfree">'co5'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co5'</span> <span class="main">⇒</span> <span class="tfree">'co5''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra3</span> <span class="main">⇒</span> <span class="tfree">'contra3'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra3'</span> <span class="main">⇒</span> <span class="tfree">'contra3''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra4</span> <span class="main">⇒</span> <span class="tfree">'contra4'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra4'</span> <span class="main">⇒</span> <span class="tfree">'contra4''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra5</span> <span class="main">⇒</span> <span class="tfree">'contra5'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra5'</span> <span class="main">⇒</span> <span class="tfree">'contra5''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_FGcontra_neg_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5'</span></span></span>
    <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra5</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra5'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    rel_FGcontra <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co5'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra5</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra5'</span></span></span><span class="main">)</span> <span class="main">≤</span>
    <span class="main">(</span>rel_FGcontra <span class="bound">L1</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra5</span></span></span> <span class="main">::</span>
      <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGcontra <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_FGcontra <span class="bound">L1'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co5'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra3'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra4'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra5'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sufficient conditions for subdistributivity over relation composition.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGcontra_pos_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co3</span> <span class="main">⇒</span> <span class="tfree">'co3'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co3'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co3'</span> <span class="main">⇒</span> <span class="tfree">'co3''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'co1</span> <span class="main">×</span> <span class="tfree">'co1'</span> <span class="main">×</span> <span class="tfree">'co1''</span> <span class="main">×</span> <span class="tfree">'co3</span> <span class="main">×</span> <span class="tfree">'co3'</span> <span class="main">×</span> <span class="tfree">'co3''</span> <span class="main">×</span>
      <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'contra1</span> <span class="main">×</span> <span class="tfree">'contra1'</span> <span class="main">×</span> <span class="tfree">'contra1''</span> <span class="main">×</span> <span class="tfree">'contra2</span> <span class="main">×</span> <span class="tfree">'contra2'</span> <span class="main">×</span> <span class="tfree">'contra2''</span> <span class="main">×</span>
      <span class="tfree">'f1</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_FGcontra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_F_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co4</span> <span class="free">Co4'</span> <span class="free">Co5</span> <span class="free">Co5'</span>
      <span class="main">(</span>rel_G <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">Contra3</span> <span class="free">Contra4</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span>
      <span class="main">(</span>rel_G <span class="free">Contra1'</span> <span class="free">Contra2'</span> <span class="free">Contra3'</span> <span class="free">Contra4'</span> <span class="free">Co1'</span> <span class="free">Co2'</span><span class="main">)</span>
      <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra5</span> <span class="free">Contra5'</span> <span class="free">tytok_F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rel_G_neg_distr_cond <span class="free">Contra3</span> <span class="free">Contra3'</span> <span class="free">Contra4</span> <span class="free">Contra4'</span> <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">tytok_G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGcontra_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Co3</span> <span class="free">Co3'</span> <span class="free">Co4</span> <span class="free">Co4'</span> <span class="free">Co5</span> <span class="free">Co5'</span>
    <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">Contra3</span> <span class="free">Contra3'</span> <span class="free">Contra4</span> <span class="free">Contra4'</span> <span class="free">Contra5</span> <span class="free">Contra5'</span>
    <span class="free">tytok_FGcontra</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGcontra_pos_distr_cond_def rel_FGcontra_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_pos_distr<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_mono<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_neg_distr<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGcontra_neg_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co3</span> <span class="main">⇒</span> <span class="tfree">'co3'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co3'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co3'</span> <span class="main">⇒</span> <span class="tfree">'co3''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'co1</span> <span class="main">×</span> <span class="tfree">'co1'</span> <span class="main">×</span> <span class="tfree">'co1''</span> <span class="main">×</span> <span class="tfree">'co3</span> <span class="main">×</span> <span class="tfree">'co3'</span> <span class="main">×</span> <span class="tfree">'co3''</span> <span class="main">×</span>
      <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'contra1</span> <span class="main">×</span> <span class="tfree">'contra1'</span> <span class="main">×</span> <span class="tfree">'contra1''</span> <span class="main">×</span> <span class="tfree">'contra2</span> <span class="main">×</span> <span class="tfree">'contra2'</span> <span class="main">×</span> <span class="tfree">'contra2''</span> <span class="main">×</span>
      <span class="tfree">'f1</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_FGcontra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_F_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co4</span> <span class="free">Co4'</span> <span class="free">Co5</span> <span class="free">Co5'</span>
      <span class="main">(</span>rel_G <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">Contra3</span> <span class="free">Contra4</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span>
      <span class="main">(</span>rel_G <span class="free">Contra1'</span> <span class="free">Contra2'</span> <span class="free">Contra3'</span> <span class="free">Contra4'</span> <span class="free">Co1'</span> <span class="free">Co2'</span><span class="main">)</span>
      <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra5</span> <span class="free">Contra5'</span> <span class="free">tytok_F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rel_G_pos_distr_cond <span class="free">Contra3</span> <span class="free">Contra3'</span> <span class="free">Contra4</span> <span class="free">Contra4'</span> <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">tytok_G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGcontra_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Co3</span> <span class="free">Co3'</span> <span class="free">Co4</span> <span class="free">Co4'</span> <span class="free">Co5</span> <span class="free">Co5'</span>
    <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">Contra3</span> <span class="free">Contra3'</span> <span class="free">Contra4</span> <span class="free">Contra4'</span> <span class="free">Contra5</span> <span class="free">Contra5'</span> <span class="free">tytok_FGcontra</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGcontra_neg_distr_cond_def rel_FGcontra_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_neg_distr<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_mono<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_pos_distr<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGcontra_pos_distr_cond_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">tytok</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGcontra_pos_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>
    <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_FGcontra_pos_distr_imp<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_G_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_pos_distr_cond_eq rel_G_neg_distr_cond_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGcontra_neg_distr_cond_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">tytok</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGcontra_neg_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>
    <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_FGcontra_neg_distr_imp<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_G_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_neg_distr_cond_eq rel_G_pos_distr_cond_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rell_FGcontra</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="main">=</span> rel_FGcontra <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mapl_FGcontra</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main">=</span> map_FGcontra <span class="free"><span class="bound"><span class="entity">l1</span></span></span> id id id id id id id id id id"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'contra5</span><span class="main">,</span>
    <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGcontrabd <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">)</span> G<span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra5</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> Fbd"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set1_FGcontra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'contra5</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGcontra <span class="main">⇒</span> <span class="tfree">'l1</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">set1_FGcontra</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> set1_F <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bd_FGcontra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'contra5</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGcontrabd rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bd_FGcontra</span> <span class="main">=</span> bd_F"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set1_FGcontra_map<span class="main">:</span> <span class="quoted"><span class="quoted">"set1_FGcontra <span class="main">∘</span> mapl_FGcontra <span class="free">l1</span> <span class="main">=</span> image <span class="free">l1</span> <span class="main">∘</span> set1_FGcontra"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff set1_FGcontra_def mapl_FGcontra_def map_FGcontra_def
      mapl_F_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mapl_G_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mapl_G_id0
      set1_F_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bd_FGcontra_card_order<span class="main">:</span> <span class="quoted"><span class="quoted">"card_order bd_FGcontra"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bd_FGcontra_def <span class="keyword1"><span class="command">using</span></span> bd_F_card_order <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bd_FGcontra_cinfinite<span class="main">:</span> <span class="quoted"><span class="quoted">"cinfinite bd_FGcontra"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bd_FGcontra_def <span class="keyword1"><span class="command">using</span></span> bd_F_cinfinite <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set1_FGcontra_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'contra5</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGcontra"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card_of <span class="main">(</span>set1_FGcontra <span class="free">x</span><span class="main">)</span> <span class="keyword1">≤o</span> <span class="main">(</span>bd_FGcontra <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'co3</span><span class="main">,</span> <span class="tfree">'co4</span><span class="main">,</span> <span class="tfree">'co5</span><span class="main">,</span>
    <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'contra3</span><span class="main">,</span> <span class="tfree">'contra4</span><span class="main">,</span> <span class="tfree">'contra5</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">)</span> FGcontrabd rel<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set1_FGcontra_def bd_FGcontra_def <span class="keyword1"><span class="command">using</span></span> set1_F_bound <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_FGcontra_contrang<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set1_FGcontra <span class="free">x</span> <span class="main">⟹</span> <span class="free">l1</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">l1'</span> <span class="bound">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mapl_FGcontra <span class="free">l1</span> <span class="free">x</span> <span class="main">=</span> mapl_FGcontra <span class="free">l1'</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_FGcontra_def map_FGcontra_def mapl_G_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> mapl_F_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> mapl_G_id0
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mapl_F_cong assms <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set1_FGcontra_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rell_FGcontra_mono_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rell_FGcontra <span class="free">L1</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set1_FGcontra <span class="free">x</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set1_FGcontra <span class="free">y</span> <span class="main">⟹</span> <span class="free">L1</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">L1'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rell_FGcontra <span class="free">L1'</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> rell_FGcontra_def rel_FGcontra_def rel_G_eq rell_F_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rell_F_mono_strong assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set1_FGcontra_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Composition in a fixed position›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> FGf <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> G<span class="main">)</span> F"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The type variables <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'f2</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'f4</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'f6</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> have each been merged.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel_FGf</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="main">=</span>
  rel_F <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="main">(=)</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="main">(=)</span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="main">(=)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">map_FGf</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span> <span class="main">=</span> map_F <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> id <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span> id <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span> id"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGf_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">L1</span> <span class="main">≤</span> <span class="free">L1'</span><span class="main">;</span> <span class="free">L2</span> <span class="main">≤</span> <span class="free">L2'</span><span class="main">;</span> <span class="free">Co1</span> <span class="main">≤</span> <span class="free">Co1'</span><span class="main">;</span> <span class="free">Co2</span> <span class="main">≤</span> <span class="free">Co2'</span><span class="main">;</span> <span class="free">Contra1'</span> <span class="main">≤</span> <span class="free">Contra1</span><span class="main">;</span> <span class="free">Contra2'</span> <span class="main">≤</span> <span class="free">Contra2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  rel_FGf <span class="free">L1</span> <span class="free">L2</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">≤</span> rel_FGf <span class="free">L1'</span> <span class="free">L2'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGf_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGf_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_FGf <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGf_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_F_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGf_conversep<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_FGf <span class="free">L1</span><span class="main">¯¯</span> <span class="free">L2</span><span class="main">¯¯</span> <span class="free">Co1</span><span class="main">¯¯</span> <span class="free">Co2</span><span class="main">¯¯</span> <span class="free">Contra1</span><span class="main">¯¯</span> <span class="free">Contra2</span><span class="main">¯¯</span> <span class="main">=</span> <span class="main">(</span>rel_FGf <span class="free">L1</span> <span class="free">L2</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span><span class="main">¯¯</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGf_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_F_conversep<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_FGf_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"map_FGf id id id id id id <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> map_FGf_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_F_id0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_FGf_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"map_FGf <span class="free">l1</span> <span class="free">l2</span> <span class="free">co1</span> <span class="free">co2</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="main">∘</span>
  map_FGf <span class="free">l1'</span> <span class="free">l2'</span> <span class="free">co1'</span> <span class="free">co2'</span> <span class="free">contra1'</span> <span class="free">contra2'</span> <span class="main">=</span>
  map_FGf <span class="main">(</span><span class="free">l1</span> <span class="main">∘</span> <span class="free">l1'</span><span class="main">)</span> <span class="main">(</span><span class="free">l2</span> <span class="main">∘</span> <span class="free">l2'</span><span class="main">)</span> <span class="main">(</span><span class="free">co1</span> <span class="main">∘</span> <span class="free">co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">co2</span> <span class="main">∘</span> <span class="free">co2'</span><span class="main">)</span> <span class="main">(</span><span class="free">contra1'</span> <span class="main">∘</span> <span class="free">contra1</span><span class="main">)</span> <span class="main">(</span><span class="free">contra2'</span> <span class="main">∘</span> <span class="free">contra2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> map_FGf_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_F_comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_FGf_parametric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_fun <span class="main">(</span>rel_fun <span class="free">L1</span> <span class="free">L1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">L2</span> <span class="free">L2'</span><span class="main">)</span>
    <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co1</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co2</span> <span class="free">Co2'</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra1'</span> <span class="free">Contra1</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra2'</span> <span class="free">Contra2</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_FGf <span class="free">L1</span> <span class="free">L2</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span>
  <span class="main">(</span>rel_FGf <span class="free">L1'</span> <span class="free">L2'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  map_FGf map_FGf"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGf_def map_FGf_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_funI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> map_F_rel_cong<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_FGf_pos_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span>
      <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span> <span class="main">×</span> <span class="tfree">'f3</span> <span class="main">×</span> <span class="tfree">'f4</span> <span class="main">×</span> <span class="tfree">'f5</span> <span class="main">×</span> <span class="tfree">'f6</span> <span class="main">×</span> <span class="tfree">'f7</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_FGf_pos_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L2</span> <span class="main">::</span> <span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L2'</span> <span class="main">::</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    <span class="main">(</span>rel_FGf <span class="bound">L1</span> <span class="bound">L2</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="main">::</span>
      <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> FGf <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_FGf <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main">≤</span>
    rel_FGf <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L2</span> <span class="keyword1">OO</span> <span class="bound">L2'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_FGf_neg_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span>
      <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span> <span class="main">×</span> <span class="tfree">'f3</span> <span class="main">×</span> <span class="tfree">'f4</span> <span class="main">×</span> <span class="tfree">'f5</span> <span class="main">×</span> <span class="tfree">'f6</span> <span class="main">×</span> <span class="tfree">'f7</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_FGf_neg_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L2</span> <span class="main">::</span> <span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L2'</span> <span class="main">::</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    rel_FGf <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L2</span> <span class="keyword1">OO</span> <span class="bound">L2'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> <span class="main">≤</span>
    <span class="main">(</span>rel_FGf <span class="bound">L1</span> <span class="bound">L2</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="main">::</span>
      <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span><span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> FGf <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_FGf <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sufficient conditions for subdistributivity over relation composition.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGf_pos_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">tytok_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f2</span> <span class="main">×</span> <span class="tfree">'f2</span> <span class="main">×</span> <span class="tfree">'f2</span> <span class="main">×</span>
      <span class="main">(</span><span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> G<span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_FGf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span>
      <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span> <span class="main">×</span> <span class="tfree">'f3</span> <span class="main">×</span> <span class="tfree">'f4</span> <span class="main">×</span> <span class="tfree">'f5</span> <span class="main">×</span> <span class="tfree">'f6</span> <span class="main">×</span> <span class="tfree">'f7</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_F_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="main">(</span><span class="main">(=)</span> <span class="main">::</span> <span class="tfree">'f4</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="main">(</span><span class="main">(=)</span> <span class="main">::</span> <span class="tfree">'f4</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span>
      <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="main">(</span><span class="main">(=)</span> <span class="main">::</span> <span class="tfree">'f6</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="main">(</span><span class="main">(=)</span> <span class="main">::</span> <span class="tfree">'f6</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="free">tytok_F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGf_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_FGf</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGf_pos_distr_cond_def rel_FGf_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_pos_distr<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_mono<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_OO<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGf_neg_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">tytok_F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f2</span> <span class="main">×</span> <span class="tfree">'f2</span> <span class="main">×</span> <span class="tfree">'f2</span> <span class="main">×</span>
      <span class="main">(</span><span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> G<span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_FGf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span>
      <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span> <span class="main">×</span> <span class="tfree">'f3</span> <span class="main">×</span> <span class="tfree">'f4</span> <span class="main">×</span> <span class="tfree">'f5</span> <span class="main">×</span> <span class="tfree">'f6</span> <span class="main">×</span> <span class="tfree">'f7</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_F_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="main">(</span><span class="main">(=)</span> <span class="main">::</span> <span class="tfree">'f4</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="main">(</span><span class="main">(=)</span> <span class="main">::</span> <span class="tfree">'f4</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span>
      <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="main">(</span><span class="main">(=)</span> <span class="main">::</span> <span class="tfree">'f6</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="main">(</span><span class="main">(=)</span> <span class="main">::</span> <span class="tfree">'f6</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="free">tytok_F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGf_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_FGf</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_FGf_neg_distr_cond_def rel_FGf_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_neg_distr<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_F_mono<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_OO<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGf_pos_distr_cond_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">tytok</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span>
      <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span> <span class="main">×</span> <span class="tfree">'f3</span> <span class="main">×</span> <span class="tfree">'f4</span> <span class="main">×</span> <span class="tfree">'f5</span> <span class="main">×</span> <span class="tfree">'f6</span> <span class="main">×</span> <span class="tfree">'f7</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGf_pos_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rel_FGf_pos_distr_imp rel_F_pos_distr_cond_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_FGf_neg_distr_cond_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">tytok</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span>
      <span class="tfree">'f1</span> <span class="main">×</span> <span class="tfree">'f2</span> <span class="main">×</span> <span class="tfree">'f3</span> <span class="main">×</span> <span class="tfree">'f4</span> <span class="main">×</span> <span class="tfree">'f5</span> <span class="main">×</span> <span class="tfree">'f6</span> <span class="main">×</span> <span class="tfree">'f7</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_FGf_neg_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rel_FGf_neg_distr_imp rel_F_neg_distr_cond_eq<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rell_FGf</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="main">=</span> rel_FGf <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mapl_FGf</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">=</span> map_FGf <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> id id id id"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> FGfbd <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="main">(</span><span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> G<span class="main">)</span> Fbd"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set1_FGf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span>
    <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> FGf <span class="main">⇒</span> <span class="tfree">'l1</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">set1_FGf</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> set1_F <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set2_FGf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span>
    <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> FGf <span class="main">⇒</span> <span class="tfree">'l2</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">set2_FGf</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> set2_F <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bd_FGf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> FGfbd rel"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bd_FGf</span> <span class="main">=</span> bd_F"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set1_FGf_map<span class="main">:</span> <span class="quoted"><span class="quoted">"set1_FGf <span class="main">∘</span> mapl_FGf <span class="free">l1</span> <span class="free">l2</span> <span class="main">=</span> image <span class="free">l1</span> <span class="main">∘</span> set1_FGf"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff set1_FGf_def mapl_FGf_def map_FGf_def mapl_F_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
      set1_F_map<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bd_FGf_card_order<span class="main">:</span> <span class="quoted"><span class="quoted">"card_order bd_FGf"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bd_FGf_def <span class="keyword1"><span class="command">using</span></span> bd_F_card_order <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bd_FGf_cinfinite<span class="main">:</span> <span class="quoted"><span class="quoted">"cinfinite bd_FGf"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bd_FGf_def <span class="keyword1"><span class="command">using</span></span> bd_F_cinfinite <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> FGf"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> set1_FGf_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"card_of <span class="main">(</span>set1_FGf <span class="free">x</span><span class="main">)</span> <span class="keyword1">≤o</span> <span class="main">(</span>bd_FGf <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span>
      <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> FGfbd rel<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> set2_FGf_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"card_of <span class="main">(</span>set2_FGf <span class="free">x</span><span class="main">)</span> <span class="keyword1">≤o</span> <span class="main">(</span>bd_FGf <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span>
      <span class="tfree">'f1</span><span class="main">,</span> <span class="tfree">'f2</span><span class="main">,</span> <span class="tfree">'f3</span><span class="main">,</span> <span class="tfree">'f4</span><span class="main">,</span> <span class="tfree">'f5</span><span class="main">,</span> <span class="tfree">'f6</span><span class="main">,</span> <span class="tfree">'f7</span><span class="main">)</span> FGfbd rel<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set1_FGf_def set2_FGf_def bd_FGf_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set1_F_bound set2_F_bound<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_FGf_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set1_FGf <span class="free">x</span> <span class="main">⟹</span> <span class="free">l1</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">l1'</span> <span class="bound">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set2_FGf <span class="free">x</span> <span class="main">⟹</span> <span class="free">l2</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">l2'</span> <span class="bound">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mapl_FGf <span class="free">l1</span> <span class="free">l2</span> <span class="free">x</span> <span class="main">=</span> mapl_FGf <span class="free">l1'</span> <span class="free">l2'</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_FGf_def map_FGf_def mapl_F_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mapl_F_cong assms <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set1_FGf_def set2_FGf_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rell_FGf_mono_strong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rell_FGf <span class="free">L1</span> <span class="free">L2</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set1_FGf <span class="free">x</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set1_FGf <span class="free">y</span> <span class="main">⟹</span> <span class="free">L1</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">L1'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set2_FGf <span class="free">x</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set2_FGf <span class="free">y</span> <span class="main">⟹</span> <span class="free">L2</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">L2'</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rell_FGf <span class="free">L1'</span> <span class="free">L2'</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> rell_FGf_def rel_FGf_def rell_F_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> 0 3 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rell_F_mono_strong assms<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set1_FGf_def set2_FGf_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Fixpoints">
<div class="head">
<h1>Theory Fixpoints</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Andreas Lochbihler, ETH Zurich
   Author: Joshua Schneider, ETH Zurich *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Least and greatest fixpoints›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Fixpoints <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Axiomatised_BNF_CC.html">Axiomatised_BNF_CC</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Least fixpoint›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹\BNFCC{} structure›</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">typedef_overloaded</span><span class="main">,</span> <span class="operator">bnf_internals</span><span class="main">]</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span>set_T<span class="main">:</span> <span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">=</span>
  C_T <span class="main">(</span><span class="free"><span class="entity">D_T</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T<span class="main">,</span> <span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">for</span></span>
    map<span class="main">:</span> mapl_T
    rel<span class="main">:</span> rell_T

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">rel_T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">L1</span> <span class="entity">Co1</span> <span class="entity">Co2</span> <span class="entity">Contra1</span> <span class="entity">Contra2</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_T</span> <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">(</span>C_T <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>C_T <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"rel_G <span class="main">(</span><span class="free">rel_T</span> <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">map_T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">map_T</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span> <span class="main">(</span>C_T <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span>
    C_T <span class="main">(</span>map_G id id <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span> <span class="main">(</span>mapl_G <span class="main">(</span><span class="free">map_T</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The mapper and relator generated by the datatype package coincide with our generalised definitions
  restricted to live arguments.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rell_T_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"rell_T <span class="free">L1</span> <span class="main">=</span> rel_T <span class="free">L1</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> T.rel_induct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> rell_G_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_T.intros<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_T.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> T.rel_intros<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> rell_G_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_G_mono'<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_T_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"mapl_T <span class="free">l1</span> <span class="main">=</span> map_T <span class="free">l1</span> id id id id"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> id_apply<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapl_G_def map_G_comp<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> mapl_G_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> mapl_G_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_T_mono <span class="main">[</span><span class="operator">mono</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">L1</span> <span class="main">≤</span> <span class="free">L1'</span><span class="main">;</span> <span class="free">Co1</span> <span class="main">≤</span> <span class="free">Co1'</span><span class="main">;</span> <span class="free">Co2</span> <span class="main">≤</span> <span class="free">Co2'</span><span class="main">;</span> <span class="free">Contra1'</span> <span class="main">≤</span> <span class="free">Contra1</span><span class="main">;</span> <span class="free">Contra2'</span> <span class="main">≤</span> <span class="free">Contra2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  rel_T <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">≤</span> rel_T <span class="free">L1'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_T.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_T.intros<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_G_mono'<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_T_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_T <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rell_T_alt_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> T.rel_eq <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_T_conversep<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_T <span class="free">L1</span><span class="main">¯¯</span> <span class="free">Co1</span><span class="main">¯¯</span> <span class="free">Co2</span><span class="main">¯¯</span> <span class="free">Contra1</span><span class="main">¯¯</span> <span class="free">Contra2</span><span class="main">¯¯</span> <span class="main">=</span> <span class="main">(</span>rel_T <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span><span class="main">¯¯</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_T.induct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_T.intros<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> conversep_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> rel_G_conversep<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_G_mono'<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_T.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_T.intros<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> conversep_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> rel_G_conversep<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> conversep_conversep<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_G_mono'<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_T_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"map_T id id id id id <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_T_alt_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> T.map_id0 <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_T_id<span class="main">:</span> <span class="quoted"><span class="quoted">"map_T id id id id id <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_T_id0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_T_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"map_T <span class="free">l1</span> <span class="free">co1</span> <span class="free">co2</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="main">∘</span> map_T <span class="free">l1'</span> <span class="free">co1'</span> <span class="free">co2'</span> <span class="free">contra1'</span> <span class="free">contra2'</span> <span class="main">=</span>
  map_T <span class="main">(</span><span class="free">l1</span> <span class="main">∘</span> <span class="free">l1'</span><span class="main">)</span> <span class="main">(</span><span class="free">co1</span> <span class="main">∘</span> <span class="free">co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">co2</span> <span class="main">∘</span> <span class="free">co2'</span><span class="main">)</span> <span class="main">(</span><span class="free">contra1'</span> <span class="main">∘</span> <span class="free">contra1</span><span class="main">)</span> <span class="main">(</span><span class="free">contra2'</span> <span class="main">∘</span> <span class="free">contra2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapl_G_def map_G_comp<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> map_G_mapl_G<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"map_G <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mapl_G_cong<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_T_parametric<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_fun <span class="main">(</span>rel_fun <span class="free">L1</span> <span class="free">L1'</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co1</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co2</span> <span class="free">Co2'</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra1'</span> <span class="free">Contra1</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra2'</span> <span class="free">Contra2</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_T <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> <span class="main">(</span>rel_T <span class="free">L1'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  map_T map_T"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_funI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_T.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_T.intros<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> map_G_mapl_G<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> map_G_rel_cong<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_T_pos_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_T_pos_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    <span class="main">(</span>rel_T <span class="bound">L1</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_T <span class="bound">L1'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main">≤</span>
    rel_T <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_T_neg_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_T_neg_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    rel_T <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> <span class="main">≤</span>
    <span class="main">(</span>rel_T <span class="bound">L1</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_T <span class="bound">L1'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We inherit the conditions for subdistributivity over relation composition via
  a composition witness, which is derived from a witness for the underlying functor <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> G<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">rel_T_witness</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_T_witness</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main">(</span>C_T <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Cy</span></span></span> <span class="main">=</span> C_T
  <span class="main">(</span>mapl_G <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> id
    <span class="main">(</span>rel_G_witness <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> rel_T <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="bound">x</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span>
      rel_T <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main">(</span><span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>
    <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span>
    <span class="main">(</span>mapl_G <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">rel_T_witness</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> id <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span>
      D_T <span class="free"><span class="bound"><span class="entity">Cy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_T_pos_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">×</span>
      <span class="main">(</span><span class="tfree">'l1'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">×</span>
      <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">×</span> <span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_G_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_T_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_T_pos_distr_cond_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI predicate2I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> relcomppE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> L1 L1' x z y
    <span class="keyword1"><span class="command">using</span></span> prems <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_T.cases<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_T.intros<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rel_G_pos_distr<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> predicate2D<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> assms relcomppI<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_G_mono'<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">L1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">×</span>
         <span class="main">(</span><span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T
          <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T<span class="main">)</span><span class="main">)</span> <span class="main">×</span>
        <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">×</span>
          <span class="main">(</span><span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T
           <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T<span class="main">)</span><span class="main">)</span> <span class="main">×</span>
         <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T<span class="main">)</span> <span class="main">×</span>
        <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">×</span>
        <span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cond<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_G_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> rel_OO<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_T <span class="free">L1</span> <span class="main">(</span><span class="free">Co1</span> <span class="keyword1">OO</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Co2</span> <span class="keyword1">OO</span> <span class="free">Co2'</span><span class="main">)</span> <span class="main">(</span><span class="free">Contra1</span> <span class="keyword1">OO</span> <span class="free">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Contra2</span> <span class="keyword1">OO</span> <span class="free">Contra2'</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> rel_T_witness1<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_T <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">x</span>
      <span class="main">(</span>rel_T_witness <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> rel_T_witness2<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_T <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span>
      <span class="main">(</span>rel_T_witness <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rel_OO <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> x y
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> x_expansion<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> mapl_G fst id <span class="main">(</span>mapl_G <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>
      <span class="main">(</span><span class="bound">x</span><span class="main">,</span> rel_T_witness <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> id <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapl_G_def map_G_comp<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> map_G_id<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> id_def<span class="main"><span class="main">]</span></span> comp_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_T.intros<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_G <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span> <span class="main"><span class="main">_</span></span>"</span></span></span> x_expansion<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_G <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> mapl_G_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mapl_G_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_G_rel_cong<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_witness1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cond<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_G <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span> <span class="main"><span class="main">_</span></span>"</span></span></span> mapl_G_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_G <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_G_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_G_rel_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prems<span class="main"><span class="main">]</span></span><span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_T.intros<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_G <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span> <span class="main"><span class="main">_</span></span>"</span></span></span> mapl_G_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_G <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_G_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_G_rel_cong<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_witness2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cond<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> rel_T_neg_distr_cond_def<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_G <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span> <span class="main"><span class="main">_</span></span>"</span></span></span> mapl_G_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_G <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_G_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> map_G_rel_cong<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_T_neg_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">×</span>
         <span class="main">(</span><span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T
          <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T<span class="main">)</span><span class="main">)</span> <span class="main">×</span>
        <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">×</span>
          <span class="main">(</span><span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T
           <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T<span class="main">)</span><span class="main">)</span> <span class="main">×</span>
         <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T<span class="main">)</span> <span class="main">×</span>
        <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T <span class="main">×</span>
        <span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_G_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_T_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_T_neg_distr_cond_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI predicate2I relcomppI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">L1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">L1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> T"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_T <span class="main">(</span><span class="skolem">L1</span> <span class="keyword1">OO</span> <span class="skolem">L1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Co1</span> <span class="keyword1">OO</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Co2</span> <span class="keyword1">OO</span> <span class="free">Co2'</span><span class="main">)</span>
    <span class="main">(</span><span class="free">Contra1</span> <span class="keyword1">OO</span> <span class="free">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Contra2</span> <span class="keyword1">OO</span> <span class="free">Contra2'</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_T <span class="main">(</span>relcompp_witness <span class="skolem">L1</span> <span class="skolem">L1'</span><span class="main">)</span> id id id id
    <span class="main">(</span>rel_T_witness <span class="main">(</span><span class="skolem">L1</span> <span class="keyword1">OO</span> <span class="skolem">L1'</span><span class="main">)</span> <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_T <span class="skolem">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="skolem">x</span> <span class="var">?z</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> map_T_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_T_parametric<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> rel_fun_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_T_witness1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms *<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> relcomppE <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> relcompp_witness<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_T <span class="skolem">L1'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span> <span class="var">?z</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_T <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_T_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_T_parametric<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> rel_fun_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_T_witness2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms *<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> relcomppE <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> relcompp_witness<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_T_pos_distr_cond_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tytok</span><span class="main">.</span> rel_T_pos_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="bound">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rel_T_pos_distr_imp rel_G_pos_distr_cond_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_T_neg_distr_cond_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tytok</span><span class="main">.</span> rel_T_neg_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="bound">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rel_T_neg_distr_imp rel_G_neg_distr_cond_eq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The BNF axioms are proved by the datatype package.›</span></span>

<span class="keyword1"><span class="command">thm</span></span> T.set_map T.bd_card_order T.bd_cinfinite T.set_bd T.map_cong<span class="main">[</span><span class="operator">OF</span> refl<span class="main">]</span>
  T.rel_mono_strong T.wit


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Parametricity laws›</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> C_T_parametric<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_G <span class="main">(</span>rel_T <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">===&gt;</span>
  rel_T <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> C_T C_T"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_T.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> D_T_parametric<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_T <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">===&gt;</span>
  rel_G <span class="main">(</span>rel_T <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> D_T D_T"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_T.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rec_T_parametric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>rel_G <span class="main">(</span>rel_prod <span class="main">(</span>rel_T <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">===&gt;</span> <span class="free">A</span><span class="main">)</span> <span class="main">===&gt;</span>
  rel_T <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">===&gt;</span> <span class="free">A</span><span class="main">)</span> rec_T rec_T"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_funI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> f g x y
    <span class="keyword1"><span class="command">using</span></span> prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> mapl_G_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> map_G_rel_cong<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Greatest fixpoints›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹\BNFCC{} structure›</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">notes</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">typedef_overloaded</span><span class="main">,</span> <span class="operator">bnf_internals</span><span class="main">]</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">codatatype</span></span> <span class="main">(</span>set_U<span class="main">:</span> <span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">=</span>
  C_U <span class="main">(</span><span class="free"><span class="entity">D_U</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U<span class="main">,</span> <span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">for</span></span>
    map<span class="main">:</span> mapl_U
    rel<span class="main">:</span> rell_U

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">coinductive</span></span> <span class="entity">rel_U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">L1</span> <span class="entity">Co1</span> <span class="entity">Co2</span> <span class="entity">Contra1</span> <span class="entity">Contra2</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_U</span> <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"rel_G <span class="main">(</span><span class="free">rel_U</span> <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">(</span>D_U <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>D_U <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">map_U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"D_U <span class="main">(</span><span class="free">map_U</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span>
    mapl_G <span class="main">(</span><span class="free">map_U</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main">(</span>map_G id id <span class="free"><span class="bound"><span class="entity">co1</span></span></span> <span class="free"><span class="bound"><span class="entity">co2</span></span></span> <span class="free"><span class="bound"><span class="entity">contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">contra2</span></span></span> <span class="main">(</span>D_U <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rell_U_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"rell_U <span class="free">L1</span> <span class="main">=</span> rel_U <span class="free">L1</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_U.coinduct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> U.rel_cases<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rell_G_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_G_mono'<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> U.rel_coinduct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_U.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rell_G_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mapl_U_alt_def<span class="main">:</span> <span class="quoted"><span class="quoted">"mapl_U <span class="free">l1</span> <span class="main">=</span> map_U <span class="free">l1</span> id id id id"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> id_apply<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapl_G_def map_G_comp<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> U.map_sel<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> rell_G_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_G_rel_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rel_G_eq_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_U_mono <span class="main">[</span><span class="operator">mono</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">L1</span> <span class="main">≤</span> <span class="free">L1'</span><span class="main">;</span> <span class="free">Co1</span> <span class="main">≤</span> <span class="free">Co1'</span><span class="main">;</span> <span class="free">Co2</span> <span class="main">≤</span> <span class="free">Co2'</span><span class="main">;</span> <span class="free">Contra1'</span> <span class="main">≤</span> <span class="free">Contra1</span><span class="main">;</span> <span class="free">Contra2'</span> <span class="main">≤</span> <span class="free">Contra2</span> <span class="main">⟧</span> <span class="main">⟹</span>
  rel_U <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">≤</span> rel_U <span class="free">L1'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_U.coinduct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_U <span class="free"><span class="free">L1</span></span> <span class="free"><span class="free">Co1</span></span> <span class="free"><span class="free">Co2</span></span> <span class="free"><span class="free">Contra1</span></span> <span class="free"><span class="free">Contra2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_U.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_G_mono'<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_U_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_U <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rell_U_alt_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> U.rel_eq <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_U_conversep<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_U <span class="free">L1</span><span class="main">¯¯</span> <span class="free">Co1</span><span class="main">¯¯</span> <span class="free">Co2</span><span class="main">¯¯</span> <span class="free">Contra1</span><span class="main">¯¯</span> <span class="free">Contra2</span><span class="main">¯¯</span> <span class="main">=</span> <span class="main">(</span>rel_U <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span><span class="main">¯¯</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_U.coinduct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_U.cases<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> conversep_iff<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> conversep_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> rel_G_conversep<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_G_mono'<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_U.coinduct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> conversep_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_U.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> conversep_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> conversep_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> rel_G_conversep<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> conversep_conversep<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_G_mono'<span class="main"><span class="keyword3">;</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_U_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"map_U id id id id id <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mapl_U_alt_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> U.map_id0 <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_U_id<span class="main">:</span> <span class="quoted"><span class="quoted">"map_U id id id id id <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_U_id0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_U_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"map_U <span class="free">l1</span> <span class="free">co1</span> <span class="free">co2</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="main">∘</span> map_U <span class="free">l1'</span> <span class="free">co1'</span> <span class="free">co2'</span> <span class="free">contra1'</span> <span class="free">contra2'</span> <span class="main">=</span>
  map_U <span class="main">(</span><span class="free">l1</span> <span class="main">∘</span> <span class="free">l1'</span><span class="main">)</span> <span class="main">(</span><span class="free">co1</span> <span class="main">∘</span> <span class="free">co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">co2</span> <span class="main">∘</span> <span class="free">co2'</span><span class="main">)</span> <span class="main">(</span><span class="free">contra1'</span> <span class="main">∘</span> <span class="free">contra1</span><span class="main">)</span> <span class="main">(</span><span class="free">contra2'</span> <span class="main">∘</span> <span class="free">contra2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapl_G_def map_G_comp<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> rell_G_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_G_rel_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rel_G_eq_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_U_parametric<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_fun <span class="main">(</span>rel_fun <span class="free">L1</span> <span class="free">L1'</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co1</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Co2</span> <span class="free">Co2'</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra1'</span> <span class="free">Contra1</span><span class="main">)</span> <span class="main">(</span>rel_fun <span class="main">(</span>rel_fun <span class="free">Contra2'</span> <span class="free">Contra2</span><span class="main">)</span>
  <span class="main">(</span>rel_fun <span class="main">(</span>rel_U <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> <span class="main">(</span>rel_U <span class="free">L1'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  map_U map_U"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_funI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">coinduction</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mapl_G_def map_G_comp<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_U.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">hypsubst</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> map_G_rel_cong<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_funE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_U_pos_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_U_pos_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    <span class="main">(</span>rel_U <span class="bound">L1</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_U <span class="bound">L1'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main">≤</span>
    rel_U <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_U_neg_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_U_neg_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    rel_U <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> <span class="main">≤</span>
    <span class="main">(</span>rel_U <span class="bound">L1</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_U <span class="bound">L1'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">rel_U_witness</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">×</span>
    <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"D_U <span class="main">(</span><span class="free">rel_U_witness</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="free"><span class="bound"><span class="entity">xy</span></span></span><span class="main">)</span> <span class="main">=</span>
  mapl_G <span class="main">(</span><span class="free">rel_U_witness</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> id
    <span class="main">(</span>rel_G_witness <span class="main">(</span>rel_U <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main">(</span>D_U <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">xy</span></span></span><span class="main">)</span><span class="main">,</span> D_U <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">xy</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_U_pos_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">×</span>
      <span class="main">(</span><span class="tfree">'l1'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">×</span>
      <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">×</span> <span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_G_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_U_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_U_pos_distr_cond_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI predicate2I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> relcomppE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> L1 L1' x z y
    <span class="keyword1"><span class="command">using</span></span> prems <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_pos_distr<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> predicate2D<span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> assms relcomppI<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_G_mono'<span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_U.cases<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_U_witness1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">L1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">×</span>
             <span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">×</span>
              <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U<span class="main">)</span> <span class="main">×</span>
             <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">×</span>
             <span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cond<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_G_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> rel_OO<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_U <span class="free">L1</span> <span class="main">(</span><span class="free">Co1</span> <span class="keyword1">OO</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Co2</span> <span class="keyword1">OO</span> <span class="free">Co2'</span><span class="main">)</span> <span class="main">(</span><span class="free">Contra1</span> <span class="keyword1">OO</span> <span class="free">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Contra2</span> <span class="keyword1">OO</span> <span class="free">Contra2'</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_U <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">x</span>
      <span class="main">(</span>rel_U_witness <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rel_OO <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_U.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_G <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span> <span class="main"><span class="main">_</span></span>"</span></span></span> map_G_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mapl_G_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_G_rel_cong<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_G_witness1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cond<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_U_witness2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">L1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">×</span>
             <span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">×</span>
              <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U<span class="main">)</span> <span class="main">×</span>
             <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">×</span>
             <span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cond<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_G_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> rel_OO<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_U <span class="free">L1</span> <span class="main">(</span><span class="free">Co1</span> <span class="keyword1">OO</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Co2</span> <span class="keyword1">OO</span> <span class="free">Co2'</span><span class="main">)</span> <span class="main">(</span><span class="free">Contra1</span> <span class="keyword1">OO</span> <span class="free">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Contra2</span> <span class="keyword1">OO</span> <span class="free">Contra2'</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_U <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span>
      <span class="main">(</span>rel_U_witness <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rel_OO <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_U.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_G <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_G_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mapl_G_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_G_rel_cong<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_G_witness2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> cond<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_U_neg_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">×</span>
          <span class="main">(</span><span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">×</span>
           <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U<span class="main">)</span> <span class="main">×</span>
          <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U <span class="main">×</span>
          <span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_G_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_U_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_U_neg_distr_cond_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI predicate2I relcomppI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">L1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">L1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> U"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_U <span class="main">(</span><span class="skolem">L1</span> <span class="keyword1">OO</span> <span class="skolem">L1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Co1</span> <span class="keyword1">OO</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Co2</span> <span class="keyword1">OO</span> <span class="free">Co2'</span><span class="main">)</span>
    <span class="main">(</span><span class="free">Contra1</span> <span class="keyword1">OO</span> <span class="free">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Contra2</span> <span class="keyword1">OO</span> <span class="free">Contra2'</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_U <span class="main">(</span>relcompp_witness <span class="skolem">L1</span> <span class="skolem">L1'</span><span class="main">)</span> id id id id
    <span class="main">(</span>rel_U_witness <span class="main">(</span><span class="skolem">L1</span> <span class="keyword1">OO</span> <span class="skolem">L1'</span><span class="main">)</span> <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_U <span class="skolem">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="skolem">x</span> <span class="var">?z</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> map_U_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_U_parametric<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> rel_fun_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_U_witness1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms *<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> relcomppE <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> relcompp_witness<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_U <span class="skolem">L1'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span> <span class="var">?z</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_U <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_U_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_U_parametric<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> rel_fun_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_U_witness2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms *<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> relcomppE <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> relcompp_witness<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_U_pos_distr_cond_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tytok</span><span class="main">.</span> rel_U_pos_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="bound">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rel_U_pos_distr_imp rel_G_pos_distr_cond_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_U_neg_distr_cond_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tytok</span><span class="main">.</span> rel_U_neg_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="bound">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rel_U_neg_distr_imp rel_G_neg_distr_cond_eq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The BNF axioms are proved by the datatype package.›</span></span>

<span class="keyword1"><span class="command">thm</span></span> U.set_map U.bd_card_order U.bd_cinfinite U.set_bd U.map_cong<span class="main">[</span><span class="operator">OF</span> refl<span class="main">]</span>
  U.rel_mono_strong U.wit


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Parametricity laws›</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> C_U_parametric<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_G <span class="main">(</span>rel_U <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">===&gt;</span>
  rel_U <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> C_U C_U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rel_U.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> D_U_parametric<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_U <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">===&gt;</span>
  rel_G <span class="main">(</span>rel_U <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> D_U D_U"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_U.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> corec_U_parametric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> rel_G <span class="main">(</span>rel_sum <span class="main">(</span>rel_U <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> <span class="main">===&gt;</span>
  <span class="free">A</span> <span class="main">===&gt;</span> rel_U <span class="free">L1</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span> corec_U corec_U"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_funI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> f g x y
    <span class="keyword1"><span class="command">using</span></span> prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> mapl_G_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> map_G_rel_cong<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_sum.cases<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Subtypes">
<div class="head">
<h1>Theory Subtypes</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Andreas Lochbihler, ETH Zurich
   Author: Joshua Schneider, ETH Zurich *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Subtypes›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Subtypes <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Axiomatised_BNF_CC.html">Axiomatised_BNF_CC</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/BNF_Axiomatization.html">HOL-Library.BNF_Axiomatization</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹\BNFCC{} structure›</span></span>

<span class="keyword1"><span class="command">consts</span></span> P <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'live1</span><span class="main">,</span> <span class="tfree">'live2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> G <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  P_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">co1</span> <span class="bound">co2</span> <span class="bound">contra1</span> <span class="bound">contra2</span><span class="main">.</span> P <span class="bound">x</span> <span class="main">⟹</span> P <span class="main">(</span>map_G <span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">co1</span> <span class="bound">co2</span> <span class="bound">contra1</span> <span class="bound">contra2</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> P <span class="bound">x</span><span class="main">}</span>"</span><span class="antiquote">}</span></span> is closed under the mapper of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type</span> G<span class="antiquote">}</span></span>›</span>
<span class="keyword2"><span class="keyword">and</span></span>
  ex_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> P <span class="bound">x</span>"</span></span> <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> P <span class="bound">x</span><span class="main">}</span>"</span><span class="antiquote">}</span></span> is non-empty›</span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'live1</span><span class="main">,</span> <span class="tfree">'live2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> S <span class="main">=</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'live1</span><span class="main">,</span> <span class="tfree">'live2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> G<span class="main">.</span> P <span class="bound">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ex_P<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The subtype <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> S<span class="antiquote"><span class="antiquote">}</span></span></span></span> is isomorphic to the set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> P <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'live1</span> <span class="main">⇒</span> <span class="tfree">'live1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'live2</span> <span class="main">⇒</span> <span class="tfree">'live2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'live1</span><span class="main">,</span> <span class="tfree">'live2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> S <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'live1'</span><span class="main">,</span> <span class="tfree">'live2'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> S <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">rel_S</span> <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="main">=</span> vimage2p Rep_S Rep_S <span class="main">(</span>rel_G <span class="free"><span class="bound"><span class="entity">L1</span></span></span> <span class="free"><span class="bound"><span class="entity">L2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">map_S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'live1</span> <span class="main">⇒</span> <span class="tfree">'live1'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'live2</span> <span class="main">⇒</span> <span class="tfree">'live2'</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'live1</span><span class="main">,</span> <span class="tfree">'live2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> S <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'live1'</span><span class="main">,</span> <span class="tfree">'live2'</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> S"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">map_S</span> <span class="main">=</span> <span class="main">(</span>id <span class="main">---&gt;</span> id <span class="main">---&gt;</span> id <span class="main">---&gt;</span> id <span class="main">---&gt;</span> id <span class="main">---&gt;</span> id <span class="main">---&gt;</span> Rep_S <span class="main">---&gt;</span> Abs_S<span class="main">)</span> map_G"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_S_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">L1</span> <span class="main">≤</span> <span class="free">L1'</span><span class="main">;</span> <span class="free">L2</span> <span class="main">≤</span> <span class="free">L2'</span><span class="main">;</span> <span class="free">Co1</span> <span class="main">≤</span> <span class="free">Co1'</span><span class="main">;</span> <span class="free">Co2</span> <span class="main">≤</span> <span class="free">Co2'</span><span class="main">;</span> <span class="free">Contra1'</span> <span class="main">≤</span> <span class="free">Contra1</span><span class="main">;</span> <span class="free">Contra2'</span> <span class="main">≤</span> <span class="free">Contra2</span> <span class="main">⟧</span>
  <span class="main">⟹</span> rel_S <span class="free">L1</span> <span class="free">L2</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">≤</span> rel_S <span class="free">L1'</span> <span class="free">L2'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_S_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> rel_G_mono'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_S_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_S <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_S_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def fun_eq_iff rel_G_eq Rep_S_inject<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_S_conversep<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_S <span class="free">L1</span><span class="main">¯¯</span> <span class="free">L2</span><span class="main">¯¯</span> <span class="free">Co1</span><span class="main">¯¯</span> <span class="free">Co2</span><span class="main">¯¯</span> <span class="free">Contra1</span><span class="main">¯¯</span> <span class="free">Contra2</span><span class="main">¯¯</span> <span class="main">=</span> <span class="main">(</span>rel_S <span class="free">L1</span> <span class="free">L2</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span><span class="main">)</span><span class="main">¯¯</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_S_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> rel_G_conversep<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_fun_def fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_S_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"map_S id id id id id id <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_S_def fun_eq_iff map_G_id Rep_S_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_S_id<span class="main">:</span> <span class="quoted"><span class="quoted">"map_S id id id id id id <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_S_id0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_S_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_S <span class="free">l1</span> <span class="free">l2</span> <span class="free">co1</span> <span class="free">co2</span> <span class="free">contra1</span> <span class="free">contra2</span> <span class="main">∘</span> map_S <span class="free">l1'</span> <span class="free">l2'</span> <span class="free">co1'</span> <span class="free">co2'</span> <span class="free">contra1'</span> <span class="free">contra2'</span> <span class="main">=</span>
  map_S <span class="main">(</span><span class="free">l1</span> <span class="main">∘</span> <span class="free">l1'</span><span class="main">)</span> <span class="main">(</span><span class="free">l2</span> <span class="main">∘</span> <span class="free">l2'</span><span class="main">)</span> <span class="main">(</span><span class="free">co1</span> <span class="main">∘</span> <span class="free">co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">co2</span> <span class="main">∘</span> <span class="free">co2'</span><span class="main">)</span> <span class="main">(</span><span class="free">contra1'</span> <span class="main">∘</span> <span class="free">contra1</span><span class="main">)</span> <span class="main">(</span><span class="free">contra2'</span> <span class="main">∘</span> <span class="free">contra2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_S_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Abs_S_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command">using</span></span> Rep_S<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_map<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map_G_comp<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> fun_cong<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_S_parametric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">L1</span> <span class="main">===&gt;</span> <span class="free">L1'</span><span class="main">)</span> <span class="main">===&gt;</span> <span class="main">(</span><span class="free">L2</span> <span class="main">===&gt;</span> <span class="free">L2'</span><span class="main">)</span> <span class="main">===&gt;</span> <span class="main">(</span><span class="free">Co1</span> <span class="main">===&gt;</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">===&gt;</span> <span class="main">(</span><span class="free">Co2</span> <span class="main">===&gt;</span> <span class="free">Co2'</span><span class="main">)</span> <span class="main">===&gt;</span>
    <span class="main">(</span><span class="free">Contra1'</span> <span class="main">===&gt;</span> <span class="free">Contra1</span><span class="main">)</span> <span class="main">===&gt;</span> <span class="main">(</span><span class="free">Contra2'</span> <span class="main">===&gt;</span> <span class="free">Contra2</span><span class="main">)</span> <span class="main">===&gt;</span>
  rel_S <span class="free">L1</span> <span class="free">L2</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="main">===&gt;</span> rel_S <span class="free">L1'</span> <span class="free">L2'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span><span class="main">)</span>
  map_S map_S"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_funI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_S_def map_S_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Abs_S_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> … x _ <span class="keyword1"><span class="command">using</span></span> Rep_S<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_map<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Abs_S_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> … y <span class="keyword1"><span class="command">using</span></span> Rep_S<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_map<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> map_G_parametric<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span>
        <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> map_S_rel_cong <span class="main">=</span> map_S_parametric<span class="main">[</span><span class="operator">unfolded</span> rel_fun_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">rotated</span> -1<span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context includes lifting_syntax *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_S_pos_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_S_pos_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L2</span> <span class="main">::</span> <span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L2'</span> <span class="main">::</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    <span class="main">(</span>rel_S <span class="bound">L1</span> <span class="bound">L2</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> S <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_S <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main">≤</span>
    rel_S <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L2</span> <span class="keyword1">OO</span> <span class="bound">L2'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_S_neg_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_S_neg_distr_cond</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L1'</span> <span class="main">::</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="main">(</span><span class="bound">L2</span> <span class="main">::</span> <span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L2'</span> <span class="main">::</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    rel_S <span class="main">(</span><span class="bound">L1</span> <span class="keyword1">OO</span> <span class="bound">L1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">L2</span> <span class="keyword1">OO</span> <span class="bound">L2'</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span><span class="main">)</span>
      <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span> <span class="main">≤</span>
    <span class="main">(</span>rel_S <span class="bound">L1</span> <span class="bound">L2</span> <span class="free"><span class="bound"><span class="entity">Co1</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2</span></span></span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> S <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="keyword1">OO</span>
      rel_S <span class="bound">L1'</span> <span class="bound">L2'</span> <span class="free"><span class="bound"><span class="entity">Co1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Co2'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra1'</span></span></span> <span class="free"><span class="bound"><span class="entity">Contra2'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  rel_S_neg_distr_cond_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tytok</span><span class="main">.</span> rel_S_neg_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="bound">tytok</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The subtype inherits the conditions for positive subdistributivity.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_S_pos_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_G_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_S_pos_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_S_pos_distr_cond_def rel_S_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI predicate2I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_G_pos_distr<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> predicate2D<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> relcomppI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_S_pos_distr_cond_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tytok</span><span class="main">.</span> rel_S_pos_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="bound">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> rel_S_pos_distr_imp rel_G_pos_distr_cond_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span>
  rel_S_pos_distr <span class="main">=</span> rel_S_pos_distr_cond_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
  rel_S_neg_distr <span class="main">=</span> rel_S_neg_distr_cond_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following composition witness depends only on the abstract condition
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> rel_S_neg_distr_cond<span class="antiquote"><span class="antiquote">}</span></span></span></span>, without additional assumptions.
›</span></span>

<span class="keyword1"><span class="command">consts</span></span>
  rel_S_witness <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> S <span class="main">×</span>
    <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> S <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> S"</span></span>

<span class="keyword1"><span class="command">specification</span></span> <span class="main">(</span><span class="quoted">rel_S_witness</span><span class="main">)</span>
  rel_S_witness1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span>
    <span class="main">(</span><span class="bound">tytok</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself<span class="main">)</span>
    <span class="main">(</span><span class="bound">x</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> S<span class="main">)</span> <span class="main">(</span><span class="bound">y</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> S<span class="main">)</span><span class="main">.</span>
    <span class="main">⟦</span> rel_S_neg_distr_cond <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">tytok</span><span class="main">;</span>
      rel_S <span class="bound">L1</span> <span class="bound">L2</span> <span class="main">(</span><span class="bound">Co1</span> <span class="keyword1">OO</span> <span class="bound">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Co2</span> <span class="keyword1">OO</span> <span class="bound">Co2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra1</span> <span class="keyword1">OO</span> <span class="bound">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra2</span> <span class="keyword1">OO</span> <span class="bound">Contra2'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span>
    rel_S <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">Co1</span> <span class="bound">Co2</span> <span class="bound">Contra1</span> <span class="bound">Contra2</span> <span class="bound">x</span>
    <span class="main">(</span>rel_S_witness <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  rel_S_witness2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span>
    <span class="main">(</span><span class="bound">tytok</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself<span class="main">)</span>
    <span class="main">(</span><span class="bound">x</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1</span><span class="main">,</span> <span class="tfree">'l2</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> S<span class="main">)</span> <span class="main">(</span><span class="bound">y</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1''</span><span class="main">,</span> <span class="tfree">'l2''</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> S<span class="main">)</span><span class="main">.</span>
    <span class="main">⟦</span> rel_S_neg_distr_cond <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">tytok</span><span class="main">;</span>
      rel_S <span class="bound">L1</span> <span class="bound">L2</span> <span class="main">(</span><span class="bound">Co1</span> <span class="keyword1">OO</span> <span class="bound">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Co2</span> <span class="keyword1">OO</span> <span class="bound">Co2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra1</span> <span class="keyword1">OO</span> <span class="bound">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra2</span> <span class="keyword1">OO</span> <span class="bound">Contra2'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span>
    rel_S <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">Co1'</span> <span class="bound">Co2'</span> <span class="bound">Contra1'</span> <span class="bound">Contra2'</span>
    <span class="main">(</span>rel_S_witness <span class="bound">L1</span> <span class="bound">L2</span> <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">L1</span></span> <span class="bound"><span class="bound">L2</span></span> <span class="bound"><span class="bound">Co1</span></span> <span class="bound"><span class="bound">Co1'</span></span> <span class="bound"><span class="bound">Co2</span></span> <span class="bound"><span class="bound">Co2'</span></span> <span class="bound"><span class="bound">Contra1</span></span> <span class="bound"><span class="bound">Contra1'</span></span> <span class="bound"><span class="bound">Contra2</span></span> <span class="bound"><span class="bound">Contra2'</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">SOME</span></span> <span class="bound"><span class="bound">z</span></span><span class="main"><span class="main">.</span></span>
     rel_S <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">Co1</span></span> <span class="bound"><span class="bound">Co2</span></span> <span class="bound"><span class="bound">Contra1</span></span> <span class="bound"><span class="bound">Contra2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">z</span></span> <span class="main"><span class="main">∧</span></span>
     rel_S <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">∧</span></span> <span class="bound"><span class="bound">L2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">Co1'</span></span> <span class="bound"><span class="bound">Co2'</span></span> <span class="bound"><span class="bound">Contra1'</span></span> <span class="bound"><span class="bound">Contra2'</span></span> <span class="bound"><span class="bound">z</span></span> <span class="bound"><span class="bound">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> all_conj_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> imp_conjR<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> L1 L2 Co1 Co1' Co2 Co2' Contra1 Contra1' Contra2 Contra2' x y
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> rel_S_neg_distr<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span>
          <span class="var">?L1.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?L1'.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y'</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span>
          <span class="var">?L2.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> <span class="var">?L2'.0</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">y'</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">y</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">y'</span></span> <span class="main"><span class="main">∧</span></span> <span class="skolem"><span class="skolem">L2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> predicate2D<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_S_mono<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> predicate2D<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fastforce</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> relcomppE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set1_S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'live1</span><span class="main">,</span> <span class="tfree">'live2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> S <span class="main">⇒</span> <span class="tfree">'live1</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">set1_S</span> <span class="main">=</span> set1_G <span class="main">∘</span> Rep_S"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">set2_S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'live1</span><span class="main">,</span> <span class="tfree">'live2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> S <span class="main">⇒</span> <span class="tfree">'live2</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">set2_S</span> <span class="main">=</span> set2_G <span class="main">∘</span> Rep_S"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_S_alt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_S <span class="free">L1</span> <span class="free">L2</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span>set1_S <span class="bound">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">∧</span>
  set2_S <span class="bound">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> map_S fst fst id id id id <span class="bound">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> map_S snd snd id id id id <span class="bound">z</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set1_S_def set2_S_def o_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>3 4 5 7<span class="main"><span class="main">)</span></span> OO_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"rel_S_witness <span class="free"><span class="free">L1</span></span> <span class="free"><span class="free">L2</span></span> <span class="main"><span class="main">(=)</span></span> <span class="main"><span class="main">(=)</span></span> <span class="main"><span class="main">(=)</span></span> <span class="main"><span class="main">(=)</span></span> <span class="main"><span class="main">(=)</span></span> <span class="main"><span class="main">(=)</span></span> <span class="main"><span class="main">(=)</span></span> <span class="main"><span class="main">(=)</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">y</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> rel_S_witness1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rel_S_neg_distr_cond_eq<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> rel_S_witness2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rel_S_neg_distr_cond_eq<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_S_def vimage2p_def rell_G_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> G.Domainp_rel<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> eq_refl<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> predicate1D<span class="main"><span class="main">,</span></span>
          <span class="operator">OF</span> DomainPI<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> pred_G_def<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> bspec<span class="main"><span class="main">,</span></span>
          <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"conversep <span class="main"><span class="main">_</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"conversep <span class="main"><span class="main">_</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">unfolded</span> G.rel_conversep Domainp_conversep<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> conversep_iff<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rangep.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> G.Domainp_rel<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> eq_refl<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> predicate1D<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> DomainPI<span class="main"><span class="main">,</span></span>
          <span class="operator">unfolded</span> pred_G_def<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> bspec<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"conversep <span class="main"><span class="main">_</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"conversep <span class="main"><span class="main">_</span></span>"</span></span></span><span class="main"><span class="main">,</span></span>
          <span class="operator">unfolded</span> G.rel_conversep Domainp_conversep<span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> conversep_iff<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rangep.simps<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">_</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_S_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> rel_S_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_S_parametric<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span>
          <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_S_def vimage2p_def<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> rell_G_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">_</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_S_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> rel_S_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_S_parametric<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span>
          <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_S_def vimage2p_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> rell_G_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">hypsubst</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_S_parametric<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?L1.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"eq_onp <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">L1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span>
          <span class="var">?L2.0</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"eq_onp <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">L2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span>
          <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_S_def vimage2p_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> rell_G_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> G.rel_refl_strong<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subsetD<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subsetD<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def eq_onp_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">bnf</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'live1</span><span class="main">,</span> <span class="tfree">'live2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> S"</span></span>
  map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">l1</span> <span class="bound">l2</span><span class="main">.</span> map_S <span class="bound">l1</span> <span class="bound">l2</span> id id id id"</span></span>
  sets<span class="main">:</span> <span class="quoted"><span class="quoted">"set1_S"</span></span> <span class="quoted"><span class="quoted">"set2_S"</span></span>
  bd<span class="main">:</span> <span class="quoted"><span class="quoted">"bd_G <span class="main">::</span> <span class="main">(</span><span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> Gbd rel"</span></span>
  rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">L1</span> <span class="bound">L2</span><span class="main">.</span> rel_S <span class="bound">L1</span> <span class="bound">L2</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_S_id0<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_S_comp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_S_def set1_S_def set2_S_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"Abs_S"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> mapl_G_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> G.map_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set1_S_def map_S_def fun_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Abs_S_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command">using</span></span> Rep_S<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_map<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G.set_map mapl_G_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set2_S_def map_S_def fun_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Abs_S_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command">using</span></span> Rep_S<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_map<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G.set_map mapl_G_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> bd_G_card_order<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> bd_G_cinfinite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set1_S_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set1_G_bound<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set2_S_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set2_G_bound<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>23 24 25 27<span class="main"><span class="main">)</span></span> eq_OO<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_S_pos_distr_cond_def<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_S_pos_distr_imp<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_G_pos_distr_cond_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_S_alt<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Closedness under zippings›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> P_zip_closed<span class="main">:</span> <span class="comment1">― ‹This is <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">command</span> lift_bnf<span class="antiquote">}</span></span>'s property that is too strong.›</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"P <span class="main">(</span>mapl_G fst fst <span class="free">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"P <span class="main">(</span>mapl_G snd snd <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"P <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">consts</span></span> rel_S_neg_distr_cond' <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If the set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> P <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is closed under zippings for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> rel_S_neg_distr_cond'<span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  we inherit the condition for negative subdistributivity from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> G<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  P_rel_G_zipping<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">L1</span> <span class="main">::</span> <span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">L2</span> <span class="main">::</span> <span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool<span class="main">)</span>
    <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span>
    <span class="main">(</span><span class="bound">tytok</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself<span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span>
    <span class="main">⟦</span> P <span class="bound">x</span><span class="main">;</span> P <span class="bound">y</span><span class="main">;</span>
      rel_G <span class="bound">L1</span> <span class="bound">L2</span> <span class="main">(</span><span class="bound">Co1</span> <span class="keyword1">OO</span> <span class="bound">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Co2</span> <span class="keyword1">OO</span> <span class="bound">Co2'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra1</span> <span class="keyword1">OO</span> <span class="bound">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="bound">Contra2</span> <span class="keyword1">OO</span> <span class="bound">Contra2'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">;</span>
      rel_G <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">Co1</span> <span class="bound">Co2</span> <span class="bound">Contra1</span> <span class="bound">Contra2</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">;</span>
      rel_G <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">Co1'</span> <span class="bound">Co2'</span> <span class="bound">Contra1'</span> <span class="bound">Contra2'</span> <span class="bound">z</span> <span class="bound">y</span><span class="main">;</span>
      rel_S_neg_distr_cond' <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">tytok</span> <span class="main">⟧</span>
    <span class="main">⟹</span> P <span class="bound">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
  rel_S_neg_distr_cond'_stronger<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">tytok</span><span class="main">.</span>
    rel_S_neg_distr_cond' <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">tytok</span> <span class="main">⟹</span>
    rel_G_neg_distr_cond <span class="bound">Co1</span> <span class="bound">Co1'</span> <span class="bound">Co2</span> <span class="bound">Co2'</span> <span class="bound">Contra1</span> <span class="bound">Contra1'</span> <span class="bound">Contra2</span> <span class="bound">Contra2'</span> <span class="bound">tytok</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
  rel_S_neg_distr_cond'_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tytok</span><span class="main">.</span> rel_S_neg_distr_cond' <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(=)</span> <span class="bound">tytok</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_S_witness'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'live1</span> <span class="main">⇒</span> <span class="tfree">'live1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'live2</span> <span class="main">⇒</span> <span class="tfree">'live2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'live1</span><span class="main">,</span> <span class="tfree">'live2</span><span class="main">,</span> <span class="tfree">'co1</span><span class="main">,</span> <span class="tfree">'co2</span><span class="main">,</span> <span class="tfree">'contra1</span><span class="main">,</span> <span class="tfree">'contra2</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> S <span class="main">×</span>
    <span class="main">(</span><span class="tfree">'live1''</span><span class="main">,</span> <span class="tfree">'live2''</span><span class="main">,</span> <span class="tfree">'co1''</span><span class="main">,</span> <span class="tfree">'co2''</span><span class="main">,</span> <span class="tfree">'contra1''</span><span class="main">,</span> <span class="tfree">'contra2''</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> S <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'live1</span> <span class="main">×</span> <span class="tfree">'live1''</span><span class="main">,</span> <span class="tfree">'live2</span> <span class="main">×</span> <span class="tfree">'live2''</span><span class="main">,</span> <span class="tfree">'co1'</span><span class="main">,</span> <span class="tfree">'co2'</span><span class="main">,</span> <span class="tfree">'contra1'</span><span class="main">,</span> <span class="tfree">'contra2'</span><span class="main">,</span> <span class="tfree">'fixed</span><span class="main">)</span> S"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">rel_S_witness'</span> <span class="main">=</span> <span class="main">(</span>id <span class="main">---&gt;</span> id <span class="main">---&gt;</span> id <span class="main">---&gt;</span> id <span class="main">---&gt;</span> id <span class="main">---&gt;</span> id <span class="main">---&gt;</span>
    id <span class="main">---&gt;</span> id <span class="main">---&gt;</span> id <span class="main">---&gt;</span> id <span class="main">---&gt;</span> map_prod Rep_S Rep_S <span class="main">---&gt;</span> Abs_S<span class="main">)</span> rel_G_witness"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_S_witness'1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">L1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">L2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> S"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_S <span class="free">L1</span> <span class="free">L2</span> <span class="main">(</span><span class="free">Co1</span> <span class="keyword1">OO</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Co2</span> <span class="keyword1">OO</span> <span class="free">Co2'</span><span class="main">)</span> <span class="main">(</span><span class="free">Contra1</span> <span class="keyword1">OO</span> <span class="free">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Contra2</span> <span class="keyword1">OO</span> <span class="free">Contra2'</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rel_S_neg_distr_cond' <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_S <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="free">x</span>
    <span class="main">(</span>rel_S_witness' <span class="free">L1</span> <span class="free">L2</span> <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> rel_S_def rel_S_witness'_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Abs_S_inverse<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> P_rel_G_zipping<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Rep_S<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span> Rep_S<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_G_witness1<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_S_neg_distr_cond'_stronger<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_G_witness2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_S_neg_distr_cond'_stronger<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_G_witness1<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_S_neg_distr_cond'_stronger<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_S_witness'2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">L1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">L2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> S"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_S <span class="free">L1</span> <span class="free">L2</span> <span class="main">(</span><span class="free">Co1</span> <span class="keyword1">OO</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Co2</span> <span class="keyword1">OO</span> <span class="free">Co2'</span><span class="main">)</span> <span class="main">(</span><span class="free">Contra1</span> <span class="keyword1">OO</span> <span class="free">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Contra2</span> <span class="keyword1">OO</span> <span class="free">Contra2'</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rel_S_neg_distr_cond' <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_S <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">L1</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">L2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span>
    <span class="main">(</span>rel_S_witness' <span class="free">L1</span> <span class="free">L2</span> <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> rel_S_def rel_S_witness'_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Abs_S_inverse<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> P_rel_G_zipping<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Rep_S<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span> Rep_S<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_G_witness1<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_S_neg_distr_cond'_stronger<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_G_witness2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_S_neg_distr_cond'_stronger<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_G_witness2<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_S_neg_distr_cond'_stronger<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_S_neg_distr_imp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Co1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1</span> <span class="main">⇒</span> <span class="tfree">'co1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co1'</span> <span class="main">⇒</span> <span class="tfree">'co1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2</span> <span class="main">⇒</span> <span class="tfree">'co2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Co2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'co2'</span> <span class="main">⇒</span> <span class="tfree">'co2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1</span> <span class="main">⇒</span> <span class="tfree">'contra1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra1'</span> <span class="main">⇒</span> <span class="tfree">'contra1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2</span> <span class="main">⇒</span> <span class="tfree">'contra2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Contra2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'contra2'</span> <span class="main">⇒</span> <span class="tfree">'contra2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_S'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2''</span><span class="main">)</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok_S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1''</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2''</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_S_neg_distr_cond' <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_S'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_S_neg_distr_cond <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span> <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="free">tytok_S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_S_neg_distr_cond_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI predicate2I relcomppI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">L1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">L1'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l1'</span> <span class="main">⇒</span> <span class="tfree">'l1''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">L2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">L2'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l2'</span> <span class="main">⇒</span> <span class="tfree">'l2''</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> S"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> S"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_S <span class="main">(</span><span class="skolem">L1</span> <span class="keyword1">OO</span> <span class="skolem">L1'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">L2</span> <span class="keyword1">OO</span> <span class="skolem">L2'</span><span class="main">)</span> <span class="main">(</span><span class="free">Co1</span> <span class="keyword1">OO</span> <span class="free">Co1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Co2</span> <span class="keyword1">OO</span> <span class="free">Co2'</span><span class="main">)</span>
    <span class="main">(</span><span class="free">Contra1</span> <span class="keyword1">OO</span> <span class="free">Contra1'</span><span class="main">)</span> <span class="main">(</span><span class="free">Contra2</span> <span class="keyword1">OO</span> <span class="free">Contra2'</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_S <span class="main">(</span>relcompp_witness <span class="skolem">L1</span> <span class="skolem">L1'</span><span class="main">)</span> <span class="main">(</span>relcompp_witness <span class="skolem">L2</span> <span class="skolem">L2'</span><span class="main">)</span> id id id id
    <span class="main">(</span>rel_S_witness' <span class="main">(</span><span class="skolem">L1</span> <span class="keyword1">OO</span> <span class="skolem">L1'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">L2</span> <span class="keyword1">OO</span> <span class="skolem">L2'</span><span class="main">)</span> <span class="free">Co1</span> <span class="free">Co1'</span> <span class="free">Co2</span> <span class="free">Co2'</span>
    <span class="free">Contra1</span> <span class="free">Contra1'</span> <span class="free">Contra2</span> <span class="free">Contra2'</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_S <span class="skolem">L1</span> <span class="skolem">L2</span> <span class="free">Co1</span> <span class="free">Co2</span> <span class="free">Contra1</span> <span class="free">Contra2</span> <span class="skolem">x</span> <span class="var">?z</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> map_S_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_S_rel_cong<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_S_witness'1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> * assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> relcomppE <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> relcompp_witness<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_S <span class="skolem">L1'</span> <span class="skolem">L2'</span> <span class="free">Co1'</span> <span class="free">Co2'</span> <span class="free">Contra1'</span> <span class="free">Contra2'</span> <span class="var">?z</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_S <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_S_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_S_rel_cong<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_S_witness'2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> * assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> relcomppE <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> relcompp_witness<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context includes lifting_syntax *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Subtypes of BNFs without co- and contravariance›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If all variables are live, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">command</span></span> lift_bnf<span class="antiquote"><span class="antiquote">}</span></span></span></span>'s requirement <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>P_zip_closed›</span></span></span></span> is equivalent
  to our closedness under zippings, and Popescu's weaker condition is equivalent to negative
  subdistributivity restricted to the subset.
›</span></span>

<span class="keyword1"><span class="command">bnf_axiomatization</span></span> <span class="tfree">'a</span> H

<span class="keyword1"><span class="command">consts</span></span> Q <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> H <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  Q_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">l</span><span class="main">.</span> Q <span class="bound">x</span> <span class="main">⟹</span> Q <span class="main">(</span>map_H <span class="bound">l</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Q_rel_H_zipping<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> H"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> H"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'c</span><span class="main">)</span> H"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Q_zip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'c</span><span class="main">)</span> H<span class="main">.</span> <span class="main">⟦</span> Q <span class="main">(</span>map_H fst <span class="bound">z</span><span class="main">)</span><span class="main">;</span> Q <span class="main">(</span>map_H snd <span class="bound">z</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> Q <span class="bound">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Q <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Q <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="free">L</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> related<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_H <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">L</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">x</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">L</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">z</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Q <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_H fst <span class="free">z</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> related<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="main">(=)</span> <span class="free">x</span> <span class="main">(</span>map_H fst <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.rel_map <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> H.rel_mono_strong<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.rel_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_H snd <span class="free">z</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> related<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="main">(=)</span> <span class="main">(</span>map_H snd <span class="free">z</span><span class="main">)</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.rel_map <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> H.rel_mono_strong<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.rel_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹Q <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹Q <span class="free">y</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Q_zip <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Q_zip<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'c</span><span class="main">)</span> H"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Q_rel_H_zipping<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">L</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span>
      <span class="main">⟦</span> Q <span class="bound">x</span><span class="main">;</span> Q <span class="bound">y</span><span class="main">;</span> rel_H <span class="bound">L</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">;</span> rel_H <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">L</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">;</span>
        rel_H <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y'</span><span class="main">)</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y'</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">L</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="bound">z</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span> Q <span class="bound">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Q <span class="main">(</span>map_H fst <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Q <span class="main">(</span>map_H snd <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Q <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span> <span class="main">(</span><span class="bound">a'</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a'</span> <span class="main">=</span> <span class="bound">a</span> <span class="main">∧</span> top <span class="bound">a</span> <span class="bound">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?L'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">c'</span><span class="main">)</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c'</span> <span class="main">=</span> <span class="bound">c</span> <span class="main">∧</span> top <span class="bound">b</span> <span class="bound">c</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_H <span class="var">?L</span> <span class="main">(</span>map_H fst <span class="free">z</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="var">?L'</span> <span class="free">z</span> <span class="main">(</span>map_H snd <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.rel_map Grp_apply <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> H.rel_refl_strong<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="main">(</span><span class="var">?L</span> <span class="keyword1">OO</span> <span class="var">?L'</span><span class="main">)</span> <span class="main">(</span>map_H fst <span class="free">z</span><span class="main">)</span> <span class="main">(</span>map_H snd <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.rel_compp<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_H top <span class="main">(</span>map_H fst <span class="free">z</span><span class="main">)</span> <span class="main">(</span>map_H snd <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relcompp_apply<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> top_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Q <span class="main">(</span>map_H fst <span class="free">z</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Q <span class="main">(</span>map_H snd <span class="free">z</span><span class="main">)</span>›</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Q <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Q_rel_H_zipping <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Q_neg_distr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> H"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> H"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Q_zip_weak<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'c</span><span class="main">)</span> H<span class="main">.</span> <span class="main">⟦</span> Q <span class="main">(</span>map_H fst <span class="bound">z</span><span class="main">)</span><span class="main">;</span> Q <span class="main">(</span>map_H snd <span class="bound">z</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">∃</span><span class="bound">z'</span><span class="main">.</span> Q <span class="bound">z'</span> <span class="main">∧</span> set_H <span class="bound">z'</span> <span class="main">⊆</span> set_H <span class="bound">z</span> <span class="main">∧</span> map_H fst <span class="bound">z'</span> <span class="main">=</span> map_H fst <span class="bound">z</span> <span class="main">∧</span> map_H snd <span class="bound">z'</span> <span class="main">=</span> map_H snd <span class="bound">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Q <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Q <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> related<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_H <span class="main">(</span><span class="free">L</span> <span class="keyword1">OO</span> <span class="free">L'</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_H <span class="free">L</span> <span class="keyword1">OO</span> eq_onp Q <span class="keyword1">OO</span> rel_H <span class="free">L'</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> related <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    *<span class="main">:</span> <span class="quoted"><span class="quoted">"set_H <span class="skolem">z</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">L</span> <span class="keyword1">OO</span> <span class="free">L'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"map_H fst <span class="skolem">z</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"map_H snd <span class="skolem">z</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> H.rel_compp_Grp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> GrpE<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Q <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹Q <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Q <span class="main">(</span>map_H fst <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Q <span class="main">(</span>map_H snd <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Q <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"set_H <span class="skolem">z'</span> <span class="main">⊆</span> set_H <span class="skolem">z</span>"</span></span>
    <span class="quoted"><span class="quoted">"map_H fst <span class="skolem">z'</span> <span class="main">=</span> map_H fst <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"map_H snd <span class="skolem">z'</span> <span class="main">=</span> map_H snd <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Q_zip_weak <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"set_H <span class="skolem">z'</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">L</span> <span class="keyword1">OO</span> <span class="free">L'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> map_H fst <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> map_H snd <span class="skolem">z'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_H <span class="main">(</span>relcompp_witness <span class="free">L</span> <span class="free">L'</span><span class="main">)</span> <span class="skolem">z'</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Q <span class="skolem">z'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Q <span class="var">?z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Q_map<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="free">L</span> <span class="free">x</span> <span class="var">?z</span>"</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="free">L'</span> <span class="var">?z</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.rel_map <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> H.rel_refl_strong
        relcompp_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">L</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">L'</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"fst <span class="skolem"><span class="skolem">p</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"snd <span class="skolem"><span class="skolem">p</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span></span> <span class="skolem"><span class="skolem">p</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq_onp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Q_zip_weak<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'c</span><span class="main">)</span> H"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Q_neg_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">L</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span> <span class="main">(</span><span class="bound">L'</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span>
      <span class="main">⟦</span> Q <span class="bound">x</span><span class="main">;</span> Q <span class="bound">y</span><span class="main">;</span> rel_H <span class="main">(</span><span class="bound">L</span> <span class="keyword1">OO</span> <span class="bound">L'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>rel_H <span class="bound">L</span> <span class="keyword1">OO</span> eq_onp Q <span class="keyword1">OO</span> rel_H <span class="bound">L'</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Q <span class="main">(</span>map_H fst <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Q <span class="main">(</span>map_H snd <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">z'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Q <span class="free">z'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set_H <span class="free">z'</span> <span class="main">⊆</span> set_H <span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"map_H fst <span class="free">z'</span> <span class="main">=</span> map_H fst <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"map_H snd <span class="free">z'</span> <span class="main">=</span> map_H snd <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Grp <span class="main">(</span>set_H <span class="free">z</span><span class="main">)</span> fst<span class="main">)</span><span class="main">¯¯</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?L'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Grp <span class="main">(</span>set_H <span class="free">z</span><span class="main">)</span> snd"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="var">?L</span> <span class="main">(</span>map_H fst <span class="free">z</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="var">?L'</span> <span class="free">z</span> <span class="main">(</span>map_H snd <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.rel_map Grp_apply <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> H.rel_refl_strong<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="main">(</span><span class="var">?L</span> <span class="keyword1">OO</span> <span class="var">?L'</span><span class="main">)</span> <span class="main">(</span>map_H fst <span class="free">z</span><span class="main">)</span> <span class="main">(</span>map_H snd <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.rel_compp<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Q <span class="main">(</span>map_H fst <span class="free">z</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Q <span class="main">(</span>map_H snd <span class="free">z</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_H <span class="var">?L</span> <span class="keyword1">OO</span> eq_onp Q <span class="keyword1">OO</span> rel_H <span class="var">?L'</span><span class="main">)</span> <span class="main">(</span>map_H fst <span class="free">z</span><span class="main">)</span> <span class="main">(</span>map_H snd <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Q_neg_distr<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Q <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="var">?L</span> <span class="main">(</span>map_H fst <span class="free">z</span><span class="main">)</span> <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="var">?L'</span> <span class="skolem">z'</span> <span class="main">(</span>map_H snd <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq_onp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> snd <span class="bound">b</span> <span class="main">=</span> snd <span class="bound">a</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> set_H <span class="free">z</span><span class="main">)</span> <span class="skolem">z'</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.rel_map Grp_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_H <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set_H <span class="free">z</span><span class="main">)</span> <span class="skolem">z'</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> H.rel_mono_strong<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pred_H <span class="main">(</span>Domainp <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="main">(</span><span class="bound">b</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'c</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set_H <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="skolem">z'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.Domainp_rel<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Domainp_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_H <span class="skolem">z'</span> <span class="main">⊆</span> set_H <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> H.axiom10_H <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_H fst <span class="skolem">z'</span> <span class="main">=</span> map_H fst <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> H.rel_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> H.rel_map<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> H.rel_mono_strong<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> <span class="quoted"><span class="quoted">‹rel_H <span class="var">?L</span> <span class="main">(</span>map_H fst <span class="free">z</span><span class="main">)</span> <span class="skolem">z'</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Grp_apply<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map_H snd <span class="skolem">z'</span> <span class="main">=</span> map_H snd <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> H.rel_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> H.rel_map<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> H.rel_mono_strong<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> <span class="quoted"><span class="quoted">‹rel_H <span class="var">?L'</span> <span class="skolem">z'</span> <span class="main">(</span>map_H snd <span class="free">z</span><span class="main">)</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Grp_apply<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹Q <span class="skolem">z'</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Quotient_Preservation">
<div class="head">
<h1>Theory Quotient_Preservation</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Andreas Lochbihler, ETH Zurich
   Author: Joshua Schneider, ETH Zurich *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Quotient preservation›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quotient_Preservation <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Axiomatised_BNF_CC.html">Axiomatised_BNF_CC</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> G_Quotient<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">T_l1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l1</span> <span class="main">⇒</span> <span class="tfree">'l1'</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">T_l2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'l2</span> <span class="main">⇒</span> <span class="tfree">'l2'</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">tytok</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l1'</span> <span class="main">×</span> <span class="tfree">'l1</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'l2'</span> <span class="main">×</span> <span class="tfree">'l2</span> <span class="main">×</span> <span class="tfree">'f</span><span class="main">)</span> itself"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Quotient <span class="free">R_l1</span> <span class="free">Abs_l1</span> <span class="free">Rep_l1</span> <span class="free">T_l1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Quotient <span class="free">R_l2</span> <span class="free">Abs_l2</span> <span class="free">Rep_l2</span> <span class="free">T_l2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Quotient <span class="free">R_co1</span> <span class="free">Abs_co1</span> <span class="free">Rep_co1</span> <span class="free">T_co1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Quotient <span class="free">R_co2</span> <span class="free">Abs_co2</span> <span class="free">Rep_co2</span> <span class="free">T_co2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Quotient <span class="free">R_contra1</span> <span class="free">Abs_contra1</span> <span class="free">Rep_contra1</span> <span class="free">T_contra1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Quotient <span class="free">R_contra2</span> <span class="free">Abs_contra2</span> <span class="free">Rep_contra2</span> <span class="free">T_contra2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rel_G_pos_distr_cond <span class="free">T_co1</span> <span class="free">T_co1</span><span class="main">¯¯</span> <span class="free">T_co2</span> <span class="free">T_co2</span><span class="main">¯¯</span> <span class="free">T_contra1</span> <span class="free">T_contra1</span><span class="main">¯¯</span> <span class="free">T_contra2</span> <span class="free">T_contra2</span><span class="main">¯¯</span>
      <span class="free">tytok</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Quotient <span class="main">(</span>rel_G <span class="free">R_l1</span> <span class="free">R_l2</span> <span class="free">R_co1</span> <span class="free">R_co2</span> <span class="free">R_contra1</span> <span class="free">R_contra2</span><span class="main">)</span>
    <span class="main">(</span>map_G <span class="free">Abs_l1</span> <span class="free">Abs_l2</span> <span class="free">Abs_co1</span> <span class="free">Abs_co2</span> <span class="free">Rep_contra1</span> <span class="free">Rep_contra2</span><span class="main">)</span>                             
    <span class="main">(</span>map_G <span class="free">Rep_l1</span> <span class="free">Rep_l2</span> <span class="free">Rep_co1</span> <span class="free">Rep_co2</span> <span class="free">Abs_contra1</span> <span class="free">Abs_contra2</span><span class="main">)</span>
    <span class="main">(</span>rel_G <span class="free">T_l1</span> <span class="free">T_l2</span> <span class="free">T_co1</span> <span class="free">T_co2</span> <span class="free">T_contra1</span> <span class="free">T_contra2</span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> G <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Quotient_alt_def5
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_G <span class="free">T_l1</span> <span class="free">T_l2</span> <span class="free">T_co1</span> <span class="free">T_co2</span> <span class="free">T_contra1</span> <span class="free">T_contra2</span> <span class="main">≤</span>
    rel_G <span class="main">(</span>Grp UNIV <span class="free">Abs_l1</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">Abs_l2</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">Abs_co1</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">Abs_co2</span><span class="main">)</span>
    <span class="main">(</span>Grp UNIV <span class="free">Rep_contra1</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">(</span>Grp UNIV <span class="free">Rep_contra2</span><span class="main">)</span><span class="main">¯¯</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_mono<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Quotient_alt_def5<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>5-6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Quotient_alt_def5<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">,</span></span>
          <span class="operator">unfolded</span> conversep_le_swap<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Grp UNIV <span class="main">(</span>map_G <span class="free">Abs_l1</span> <span class="free">Abs_l2</span> <span class="free">Abs_co1</span> <span class="free">Abs_co2</span> <span class="free">Rep_contra1</span> <span class="free">Rep_contra2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_G_Grp_weak <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Grp UNIV <span class="main">(</span>map_G <span class="free">Rep_l1</span> <span class="free">Rep_l2</span> <span class="free">Rep_co1</span> <span class="free">Rep_co2</span> <span class="free">Abs_contra1</span> <span class="free">Abs_contra2</span><span class="main">)</span> <span class="main">=</span>
    rel_G <span class="main">(</span>Grp UNIV <span class="free">Rep_l1</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">Rep_l2</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">Rep_co1</span><span class="main">)</span> <span class="main">(</span>Grp UNIV <span class="free">Rep_co2</span><span class="main">)</span>
    <span class="main">(</span>Grp UNIV <span class="free">Abs_contra1</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">(</span>Grp UNIV <span class="free">Abs_contra2</span><span class="main">)</span><span class="main">¯¯</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_G_Grp_weak<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> rel_G <span class="free">T_l1</span><span class="main">¯¯</span> <span class="free">T_l2</span><span class="main">¯¯</span> <span class="free">T_co1</span><span class="main">¯¯</span> <span class="free">T_co2</span><span class="main">¯¯</span> <span class="free">T_contra1</span><span class="main">¯¯</span> <span class="free">T_contra2</span><span class="main">¯¯</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_mono<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Quotient_alt_def5<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>5-6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Quotient_alt_def5<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_G_conversep<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> relcomppI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map_G_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> map_G_rel_cong<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>6<span class="main"><span class="keyword3">]</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> assms<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> Quotient_equiv_abs1<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> assms<span class="main"><span class="main">(</span></span>5-6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> Quotient_rep_equiv1<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rel_G_conversep<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"map_G <span class="free">Abs_l1</span> <span class="free">Abs_l2</span> <span class="free">Abs_co1</span> <span class="free">Abs_co2</span> <span class="free">Rep_contra1</span> <span class="free">Rep_contra2</span> <span class="skolem">y</span> <span class="main">=</span>
        map_G <span class="free">Abs_l1</span> <span class="free">Abs_l2</span> <span class="free">Abs_co1</span> <span class="free">Abs_co2</span> <span class="free">Rep_contra1</span> <span class="free">Rep_contra2</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> map_G_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> map_G_rel_cong<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> assms<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> Quotient_equiv_abs2<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> assms<span class="main"><span class="main">(</span></span>5-6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> Quotient_rep_equiv2<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rel_G_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> map_G_rel_cong<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> assms<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> Quotient_rel_abs<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>5-6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> Quotient_rep_reflp<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> rel_G_conversep<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
        assms<span class="main"><span class="main">(</span></span>1-6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Quotient_alt_def5<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_G_pos_distr<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Operation_Examples">
<div class="head">
<h1>Theory Operation_Examples</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Andreas Lochbihler, ETH Zurich
   Author: Joshua Schneider, ETH Zurich *)</span>

<span class="keyword1"><span class="command">theory</span></span> Operation_Examples <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Composition.html">Composition</a>
  <a href="Fixpoints.html">Fixpoints</a>
  <a href="Subtypes.html">Subtypes</a>
  <a href="Quotient_Preservation.html">Quotient_Preservation</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Concrete_Examples">
<div class="head">
<h1>Theory Concrete_Examples</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Andreas Lochbihler, ETH Zurich
   Author: Joshua Schneider, ETH Zurich *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Concrete \BNFCC{}s›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Concrete_Examples <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Preliminaries.html">Preliminaries</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Rewrite.html">HOL-Library.Rewrite</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Cardinality.html">HOL-Library.Cardinality</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Function space›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_fun_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="free">B</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">A'</span> <span class="main">===&gt;</span> <span class="free">B'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">A'</span> <span class="main">≤</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≤</span> <span class="free">B'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_fun_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(=)</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> fun.rel_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_fun_conversep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">¯¯</span> <span class="main">===&gt;</span> <span class="free">B</span><span class="main">¯¯</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="free">B</span><span class="main">)</span><span class="main">¯¯</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_fun_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>id <span class="main">---&gt;</span> id<span class="main">)</span> <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> map_fun.id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_fun_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">---&gt;</span> <span class="free">g</span><span class="main">)</span> <span class="main">∘</span> <span class="main">(</span><span class="free">f'</span> <span class="main">---&gt;</span> <span class="free">g'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">f'</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">---&gt;</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">g'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> map_fun.comp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_fun_parametric<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="free">A'</span><span class="main">)</span> <span class="main">===&gt;</span> <span class="main">(</span><span class="free">B</span> <span class="main">===&gt;</span> <span class="free">B'</span><span class="main">)</span> <span class="main">===&gt;</span> <span class="main">(</span><span class="free">A'</span> <span class="main">===&gt;</span> <span class="free">B</span><span class="main">)</span> <span class="main">===&gt;</span> <span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="free">B'</span><span class="main">)</span><span class="main">)</span> <span class="main">(---&gt;)</span> <span class="main">(---&gt;)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> map_fun_parametric<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_fun_pos_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a'</span> <span class="main">⇒</span> <span class="tfree">'a''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'b'</span> <span class="main">×</span> <span class="tfree">'b''</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_fun_pos_distr_cond</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">B</span> <span class="main">::</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">B'</span> <span class="main">::</span> <span class="tfree">'b'</span> <span class="main">⇒</span> <span class="tfree">'b''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">===&gt;</span> <span class="bound">B</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="main">===&gt;</span> <span class="bound">B'</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span> <span class="main">===&gt;</span> <span class="main">(</span><span class="bound">B</span> <span class="keyword1">OO</span> <span class="bound">B'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_fun_neg_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a'</span> <span class="main">⇒</span> <span class="tfree">'a''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
    <span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'b'</span> <span class="main">×</span> <span class="tfree">'b''</span><span class="main">)</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_fun_neg_distr_cond</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">B</span> <span class="main">::</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">B'</span> <span class="main">::</span> <span class="tfree">'b'</span> <span class="main">⇒</span> <span class="tfree">'b''</span> <span class="main">⇒</span> bool<span class="main">)</span><span class="main">.</span>
    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span> <span class="main">===&gt;</span> <span class="main">(</span><span class="bound">B</span> <span class="keyword1">OO</span> <span class="bound">B'</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">===&gt;</span> <span class="bound">B</span><span class="main">)</span> <span class="keyword1">OO</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="main">===&gt;</span> <span class="bound">B'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span>
  rel_fun_pos_distr <span class="main">=</span> rel_fun_pos_distr_cond_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
  rel_fun_neg_distr <span class="main">=</span> rel_fun_neg_distr_cond_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_fun_pos_distr_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_fun_pos_distr_cond <span class="free">A</span> <span class="free">A'</span> <span class="free">tytok</span> <span class="main">=</span> True"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_fun_pos_distr_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> pos_fun_distr<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_fun_neg_distr_imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> left_unique <span class="free">A</span><span class="main">;</span> right_total <span class="free">A</span><span class="main">;</span> right_unique <span class="free">A'</span><span class="main">;</span> left_total <span class="free">A'</span> <span class="main">⟧</span> <span class="main">⟹</span>
  rel_fun_neg_distr_cond <span class="free">A</span> <span class="free">A'</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_fun_neg_distr_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> neg_fun_distr1<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> predicate2D<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_fun_pos_distr_cond_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_fun_pos_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_fun_neg_distr_cond_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_fun_neg_distr_cond <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rel_fun_neg_distr_imp left_unique_eq right_unique_eq right_total_eq left_total_eq<span class="main">)</span>

<span class="keyword1"><span class="command">thm</span></span> fun.set_map fun.map_cong0 fun.rel_mono_strong


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Covariant powerset›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_set_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≤</span> <span class="free">A'</span> <span class="main">⟹</span> rel_set <span class="free">A</span> <span class="main">≤</span> rel_set <span class="free">A'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> rel_set_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_set <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> rel_set_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_set_conversep<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_set <span class="free">A</span><span class="main">¯¯</span> <span class="main">=</span> <span class="main">(</span>rel_set <span class="free">A</span><span class="main">)</span><span class="main">¯¯</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> rel_set_conversep<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_set_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"image id <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> image_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_set_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"image <span class="free">f</span> <span class="main">∘</span> image <span class="free">g</span> <span class="main">=</span> image <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff image_image o_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_set_parametric<span class="main">:</span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="free">B</span><span class="main">)</span> <span class="main">===&gt;</span> rel_set <span class="free">A</span> <span class="main">===&gt;</span> rel_set <span class="free">B</span><span class="main">)</span> image image"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> image_transfer<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_set_pos_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a'</span> <span class="main">⇒</span> <span class="tfree">'a''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_set_pos_distr_cond</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="main">⟷</span> rel_set <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">OO</span> rel_set <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="main">≤</span> rel_set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_set_neg_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a'</span> <span class="main">⇒</span> <span class="tfree">'a''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_set_neg_distr_cond</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span> <span class="main">⟷</span> rel_set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">A'</span></span></span><span class="main">)</span> <span class="main">≤</span> rel_set <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">OO</span> rel_set <span class="free"><span class="bound"><span class="entity">A'</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span>
  rel_set_pos_distr <span class="main">=</span> rel_set_pos_distr_cond_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
  rel_set_neg_distr <span class="main">=</span> rel_set_neg_distr_cond_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_set_pos_distr_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_set_pos_distr_cond <span class="free">A</span> <span class="free">A'</span> <span class="main">=</span> True"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_set_pos_distr_cond_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_set_OO<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_set_neg_distr_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_set_neg_distr_cond <span class="free">A</span> <span class="free">A'</span> <span class="main">=</span> True"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_set_neg_distr_cond_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_set_OO<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_set_pos_distr_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_set_pos_distr_cond <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_set_neg_distr_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_set_neg_distr_cond <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bounded sets›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define bounded sets as a subtype, with an additional fixed parameter which controls the bound.
  Using the \BNFCC{} structure on the covariant powerset functor, it suffices to show the
  preconditions for the closedness of \BNFCC{} under subtypes.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bset <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">A</span> <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">≤</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'k</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> <span class="var">?bset</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_bset

<span class="keyword1"><span class="command">lemma</span></span> bset_map_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">A</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≡</span> image <span class="free">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">∧</span> card <span class="free">A</span> <span class="main">≤</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span> <span class="main">∧</span> card <span class="free">B</span> <span class="main">≤</span> <span class="keyword1">CARD</span><span class="main">(</span><span class="tfree">'k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_image_le<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> order_trans<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> map_bset <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bset <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bset"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">image</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> bset_map_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> rel_bset <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bset <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bset <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">rel_set</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">neg_distr_cond_bset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'k</span> itself <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">neg_distr_cond_bset</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">⟷</span> rel_bset <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span><span class="main">)</span> <span class="main">≤</span> rel_bset <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1">OO</span> <span class="main">(</span>rel_bset <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="tfree">'k</span><span class="main">)</span> bset <span class="main">⇒</span> <span class="main">_</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> right_unique_rel_set_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"right_unique <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rel_set <span class="free">R</span> <span class="free">X</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">=</span> image <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="free">R</span> <span class="skolem">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹rel_set <span class="free">R</span> <span class="free">X</span> <span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹right_unique <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="skolem">x</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_unique_def rel_set_def f_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> theI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="skolem">x</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_unique_def rel_set_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">f</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rel_set <span class="free">R</span> <span class="free">X</span> <span class="free">Y</span>›</span></span> that
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rel_setD2 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> right_uniqueD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹right_unique <span class="free">R</span>›</span></span><span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> the_equality<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">R</span> <span class="bound">x</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">=</span> image <span class="skolem">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def image_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> left_unique_rel_set_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"left_unique <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rel_set <span class="free">R</span> <span class="free">Y</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">=</span> image <span class="free">f</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="free">R</span> <span class="bound">y</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹rel_set <span class="free">R</span> <span class="free">Y</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹left_unique <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_unique_def rel_set_def f_def<span class="main">)</span>  <span class="main">(</span><span class="operator">metis</span> theI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_unique_def rel_set_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">f</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rel_set <span class="free">R</span> <span class="free">Y</span> <span class="free">X</span>›</span></span> that
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rel_setD1 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> left_uniqueD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹left_unique <span class="free">R</span>›</span></span><span class="main"><span class="main">]</span></span>
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> the_equality<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">R</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">=</span> image <span class="skolem">f</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def image_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> neg_distr_cond_bset_right_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"right_unique <span class="free">C</span> <span class="main">⟹</span> neg_distr_cond_bset <span class="free">C</span> <span class="free">D</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neg_distr_cond_bset_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> 6 2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_image_le<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> order_trans<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> right_unique_rel_set_lemma
      <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_set_OO<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> neg_distr_cond_bset_left_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"left_unique <span class="free">D</span> <span class="main">⟹</span> neg_distr_cond_bset <span class="free">C</span> <span class="free">D</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> neg_distr_cond_bset_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> 6 2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_image_le<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> order_trans<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> left_unique_rel_set_lemma
      <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_set_OO<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> neg_distr_cond_bset_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"neg_distr_cond_bset <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">tytok</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> neg_distr_cond_bset_right_unique right_unique_eq<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Contravariant powerset (sets as predicates)›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> pred <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">map_pred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'b</span> pred"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">map_pred</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">---&gt;</span> id<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_pred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> pred <span class="main">⇒</span> <span class="tfree">'b</span> pred <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_pred</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">===&gt;</span> <span class="main">(⟷)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_pred_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A'</span> <span class="main">≤</span> <span class="free">A</span> <span class="main">⟹</span> rel_pred <span class="free">A</span> <span class="main">≤</span> rel_pred <span class="free">A'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rel_pred_def
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rel_fun_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_pred_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_pred <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_pred_def rel_fun_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_pred_conversep<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_pred <span class="free">A</span><span class="main">¯¯</span> <span class="main">=</span> <span class="main">(</span>rel_pred <span class="free">A</span><span class="main">)</span><span class="main">¯¯</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rel_fun_conversep<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(=)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_pred_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_pred_id0<span class="main">:</span> <span class="quoted"><span class="quoted">"map_pred id <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_pred_def map_fun_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_pred_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"map_pred <span class="free">f</span> <span class="main">∘</span> map_pred <span class="free">g</span> <span class="main">=</span> map_pred <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> map_fun_comp<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main">=</span></span><span class="quoted">id</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> g'<span class="main"><span class="main">=</span></span><span class="quoted">id</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_pred_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_pred_parametric<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A'</span> <span class="main">===&gt;</span> <span class="free">A</span><span class="main">)</span> <span class="main">===&gt;</span> rel_pred <span class="free">A</span> <span class="main">===&gt;</span> rel_pred <span class="free">A'</span><span class="main">)</span> map_pred map_pred"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def rel_pred_def map_pred_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_pred_pos_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a'</span> <span class="main">⇒</span> <span class="tfree">'a''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_pred_pos_distr_cond</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟷</span> rel_pred <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">OO</span> rel_pred <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≤</span> rel_pred <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_pred_neg_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a'</span> <span class="main">⇒</span> <span class="tfree">'a''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_pred_neg_distr_cond</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟷</span>  rel_pred <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">≤</span> rel_pred <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">OO</span> rel_pred <span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span>
  rel_pred_pos_distr <span class="main">=</span> rel_pred_pos_distr_cond_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span>
  rel_pred_neg_distr <span class="main">=</span> rel_pred_neg_distr_cond_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_pred_pos_distr_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_pred_pos_distr_cond <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> True"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_pred_pos_distr_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_pred_def rel_fun_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_pred_pos_distr_cond_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_pred_pos_distr_cond <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> neg_fun_distr3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"left_unique <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"right_total <span class="free">R</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"right_unique <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"left_total <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_fun <span class="main">(</span><span class="free">R</span> <span class="keyword1">OO</span> <span class="free">R'</span><span class="main">)</span> <span class="main">(</span><span class="free">S</span> <span class="keyword1">OO</span> <span class="free">S'</span><span class="main">)</span> <span class="main">≤</span> rel_fun <span class="free">R</span> <span class="free">S</span> <span class="keyword1">OO</span> rel_fun <span class="free">R'</span> <span class="free">S'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> functional_converse_relation<span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> functional_relation<span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_fun_def OO_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> all_comm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> all_conj_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> choice<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  As there are no live variables, we can get a weaker condition than if we derived it
  from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> rel_fun<span class="antiquote"><span class="antiquote">}</span></span></span></span>'s condition!
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_pred_neg_distr_imp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"right_unique <span class="free">B</span> <span class="main">∧</span> left_total <span class="free">B</span> <span class="main">∨</span> left_unique <span class="free">A</span> <span class="main">∧</span> right_total <span class="free">A</span> <span class="main">⟹</span> rel_pred_neg_distr_cond <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_pred_neg_distr_cond_def rel_pred_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def rel_pred_neg_distr_cond_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_fun <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quasi_keyword">asm</span> eq_OO<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> neg_fun_distr2<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> predicate2D<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span>
      <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_unique_eq right_unique_eq left_total_eq right_total_eq<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> neg_fun_distr3<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> predicate2D<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span>
      <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_unique_eq right_unique_eq left_total_eq right_total_eq<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_pred_neg_distr_cond_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_pred_neg_distr_cond <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rel_pred_neg_distr_imp left_unique_eq right_total_eq<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> left_unique_rel_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"left_total <span class="free">A</span> <span class="main">⟹</span> left_unique <span class="main">(</span>rel_pred <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_pred_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> left_unique_fun<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> left_unique_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> right_unique_rel_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"right_total <span class="free">A</span> <span class="main">⟹</span> right_unique <span class="main">(</span>rel_pred <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_pred_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> right_unique_fun<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> right_unique_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> left_total_rel_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"left_unique <span class="free">A</span> <span class="main">⟹</span> left_total <span class="main">(</span>rel_pred <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_pred_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> left_total_fun<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> left_total_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> right_total_rel_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"right_unique <span class="free">A</span> <span class="main">⟹</span> right_total <span class="main">(</span>rel_pred <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_pred_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> right_total_fun<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> right_total_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context includes lifting_syntax *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Filter›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Similarly to bounded sets, we exploit the definition of filters as a subtype in order to
  lift the \BNFCC{} operations. Here we use that the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> is_filter<span class="antiquote"><span class="antiquote">}</span></span></span></span> predicate is closed under
  zippings.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_filter_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_filter <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_filter <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">---&gt;</span> id<span class="main">)</span> <span class="main">---&gt;</span> id<span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">=</span> Abs_filter <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_filter <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">---&gt;</span> id<span class="main">)</span> <span class="main">---&gt;</span> id<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">.</span> eventually <span class="bound">P</span> <span class="skolem">F'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_filter.intro<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_rev_mp <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_fun_def o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F'_def eventually_Abs_filter<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_pred2_neg_distr_cond</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a'</span> <span class="main">⇒</span> <span class="tfree">'a''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_pred2_neg_distr_cond</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟷</span>
  rel_pred <span class="main">(</span>rel_pred <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">OO</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> rel_pred <span class="main">(</span>rel_pred <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="keyword1">OO</span> rel_pred <span class="main">(</span>rel_pred <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">consts</span></span> rel_pred2_witness <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a'</span> <span class="main">⇒</span> <span class="tfree">'a''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span>
  <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a''</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">specification</span></span> <span class="main">(</span><span class="quoted">rel_pred2_witness</span><span class="main">)</span>
  rel_pred2_witness1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">K</span> <span class="bound">K'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span> rel_pred2_neg_distr_cond <span class="bound">K</span> <span class="bound">K'</span><span class="main">;</span> rel_pred <span class="main">(</span>rel_pred <span class="main">(</span><span class="bound">K</span> <span class="keyword1">OO</span> <span class="bound">K'</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span>
    rel_pred <span class="main">(</span>rel_pred <span class="bound">K</span><span class="main">)</span> <span class="bound">x</span> <span class="main">(</span>rel_pred2_witness <span class="bound">K</span> <span class="bound">K'</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  rel_pred2_witness2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">K</span> <span class="bound">K'</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span> rel_pred2_neg_distr_cond <span class="bound">K</span> <span class="bound">K'</span><span class="main">;</span> rel_pred <span class="main">(</span>rel_pred <span class="main">(</span><span class="bound">K</span> <span class="keyword1">OO</span> <span class="bound">K'</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟧</span> <span class="main">⟹</span>
    rel_pred <span class="main">(</span>rel_pred <span class="bound">K'</span><span class="main">)</span> <span class="main">(</span>rel_pred2_witness <span class="bound">K</span> <span class="bound">K'</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">K</span></span> <span class="bound"><span class="bound">K'</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">SOME</span></span> <span class="bound"><span class="bound">z</span></span><span class="main"><span class="main">.</span></span> rel_pred <span class="main"><span class="main">(</span></span>rel_pred <span class="bound"><span class="bound">K</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">z</span></span> <span class="main"><span class="main">∧</span></span> rel_pred <span class="main"><span class="main">(</span></span>rel_pred <span class="bound"><span class="bound">K'</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">z</span></span> <span class="bound"><span class="bound">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> all_conj_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> imp_conjR<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> relcomppE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_pred <span class="main"><span class="main">(</span></span>rel_pred <span class="main"><span class="main">_</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_pred <span class="main"><span class="main">(</span></span>rel_pred <span class="main"><span class="main">_</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">z</span></span><span class="main"><span class="main">.</span></span> rel_pred <span class="main"><span class="main">(</span></span>rel_pred <span class="main"><span class="main">_</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">_</span></span> <span class="bound"><span class="bound">z</span></span> <span class="main"><span class="main">∧</span></span> rel_pred <span class="main"><span class="main">(</span></span>rel_pred <span class="main"><span class="main">_</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">z</span></span> <span class="main"><span class="main">_</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_pred2_neg_distr_cond_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> rel_pred2_witness <span class="main">=</span> rel_pred2_witness1 rel_pred2_witness2

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel_filter_neg_distr_cond'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_filter_neg_distr_cond'</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="main">⟷</span> left_total <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∧</span> right_unique <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∨</span> right_total <span class="free"><span class="bound"><span class="entity">C'</span></span></span> <span class="main">∧</span> left_unique <span class="free"><span class="bound"><span class="entity">C'</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_filter_neg_distr_cond'_stronger<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rel_filter_neg_distr_cond' <span class="free">C</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_pred2_neg_distr_cond <span class="free">C</span> <span class="free">C'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_pred2_neg_distr_cond_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_pred <span class="main">(</span>rel_pred <span class="main">(</span><span class="free">C</span> <span class="keyword1">OO</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> rel_pred <span class="main">(</span>rel_pred <span class="free">C</span> <span class="keyword1">OO</span> rel_pred <span class="free">C'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rel_pred_mono rel_pred_pos_distr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> rel_pred <span class="main">(</span>rel_pred <span class="free">C</span><span class="main">)</span> <span class="keyword1">OO</span> rel_pred <span class="main">(</span>rel_pred <span class="free">C'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_pred_neg_distr<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_pred_neg_distr_imp<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> rel_filter_neg_distr_cond'_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> left_unique_rel_pred right_total_rel_pred right_unique_rel_pred left_total_rel_pred<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rel_pred <span class="main">(</span>rel_pred <span class="main">(</span><span class="free">C</span> <span class="keyword1">OO</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_filter_neg_distr_cond'_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_filter_neg_distr_cond' <span class="main">(=)</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rel_filter_neg_distr_cond'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_total_eq right_unique_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_filter_rel_witness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"is_filter <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"is_filter <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> FG<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_pred <span class="main">(</span>rel_pred <span class="main">(</span><span class="free">C</span> <span class="keyword1">OO</span> <span class="free">C'</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cond<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_filter_neg_distr_cond' <span class="free">C</span> <span class="free">C'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_filter <span class="main">(</span>rel_pred2_witness <span class="free">C</span> <span class="free">C'</span> <span class="main">(</span><span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rel_pred <span class="main">(</span>rel_pred <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?C'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rel_pred <span class="main">(</span>rel_pred <span class="free">C'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?wit</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rel_pred2_witness <span class="free">C</span> <span class="free">C'</span> <span class="main">(</span><span class="free">F</span><span class="main">,</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_pred2_neg_distr_cond <span class="free">C</span> <span class="free">C'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cond <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_filter_neg_distr_cond'_stronger<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> FG <span class="keyword1"><span class="command">have</span></span> wit1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="free">F</span> <span class="var">?wit</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wit2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C'</span> <span class="var">?wit</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rel_pred2_witness<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> wit1<span class="main">[</span><span class="operator">unfolded</span> rel_pred_def<span class="main">,</span> <span class="operator">THEN</span> rel_funD<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True"</span></span><span class="main">]</span> F
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_filter.True<span class="main">)</span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">Q</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?wit</span> <span class="skolem">P</span> <span class="main">⟶</span> <span class="var">?wit</span> <span class="skolem">Q</span> <span class="main">⟶</span> <span class="var">?wit</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="var">?wit</span> <span class="skolem">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="var">?wit</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cond <span class="keyword1"><span class="command">unfolding</span></span> rel_filter_neg_distr_cond'_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE conjE<span class="main"><span class="keyword3">;</span></span> <span class="operator">use</span> nothing <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">intro</span> conjI strip›</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"left_total <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"right_unique <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"left_unique <span class="main">(</span><span class="free">C</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"right_total <span class="main">(</span><span class="free">C</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> left_unique_fun left_unique_eq right_total_fun right_total_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> functional_converse_relation<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="skolem"><span class="skolem">Q'</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> P' <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="skolem">P'</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q' <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="skolem">Q'</span> <span class="skolem">Q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> PQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">Q'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>

    <span class="keyword1"><span class="command">with</span></span> wit1 P' Q' <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">P</span> <span class="main">⟷</span> <span class="free">F</span> <span class="skolem">P'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">Q</span> <span class="main">⟷</span> <span class="free">F</span> <span class="skolem">Q'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> PQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">Q'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rel_funD <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_pred_def<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that P Q PQ
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_filter.conj<span class="main"><span class="main">[</span></span><span class="operator">OF</span> F<span class="main"><span class="main">]</span></span><span class="main">)</span>

    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> P' Q' <span class="quoted"><span class="quoted">‹left_total <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="skolem">Q'</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> apply_rsp' left_total_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P Q that <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_filter.mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> F<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"right_total <span class="free">C'</span>"</span></span> <span class="quoted"><span class="quoted">"left_unique <span class="free">C'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"right_unique <span class="main">(</span><span class="free">C'</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"left_total <span class="main">(</span><span class="free">C'</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> right_unique_fun right_unique_eq left_total_fun left_total_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> functional_relation<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="skolem"><span class="skolem">Q'</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> P' <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C'</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="skolem">P</span> <span class="skolem">P'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q' <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C'</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="skolem">Q</span> <span class="skolem">Q'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> PQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C'</span> <span class="main">===&gt;</span> <span class="main">(=)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">Q'</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>

    <span class="keyword1"><span class="command">with</span></span> wit2 P' Q' <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">P</span> <span class="main">⟷</span> <span class="free">G</span> <span class="skolem">P'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">Q</span> <span class="main">⟷</span> <span class="free">G</span> <span class="skolem">Q'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> PQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">Q'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rel_funD <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_pred_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that P Q PQ
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_filter.conj<span class="main"><span class="main">[</span></span><span class="operator">OF</span> G<span class="main"><span class="main">]</span></span><span class="main">)</span>

    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> P' Q' <span class="quoted"><span class="quoted">‹right_total <span class="free">C'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="skolem">Q'</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> apply_rsp' right_total_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P Q that <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_filter.mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> G<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?wit</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> imp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context includes lifting_syntax *)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following example shows that filters do not satisfy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">command</span></span> lift_bnf<span class="antiquote"><span class="antiquote">}</span></span></span></span>'s condition.›</span></span>

<span class="keyword1"><span class="command">experiment</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">unbundle</span></span> lifting_syntax

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">raw_filtermap</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">---&gt;</span> id<span class="main">)</span> <span class="main">---&gt;</span> id<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> raw_filtermap_apply<span class="main">:</span> <span class="quoted"><span class="quoted">"raw_filtermap <span class="free">f</span> <span class="free">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">.</span> <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">P</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> raw_filtermap_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_fun_def comp_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"filtermap <span class="free">f</span> <span class="main">=</span> Abs_filter <span class="main">∘</span> raw_filtermap <span class="free">f</span> <span class="main">∘</span> Rep_filter"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> filtermap_def eventually_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff raw_filtermap_apply<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Z</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Z</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="main">(</span>False<span class="main">,</span> False<span class="main">)</span><span class="main">,</span> <span class="main">(</span>False<span class="main">,</span> True<span class="main">)</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span><span class="main">(</span>False<span class="main">,</span> False<span class="main">)</span><span class="main">,</span> <span class="main">(</span>True<span class="main">,</span> False<span class="main">)</span><span class="main">}</span><span class="main">,</span>
    <span class="main">{</span><span class="main">(</span>False<span class="main">,</span> False<span class="main">)</span><span class="main">,</span> <span class="main">(</span>False<span class="main">,</span> True<span class="main">)</span><span class="main">,</span> <span class="main">(</span>True<span class="main">,</span> False<span class="main">)</span><span class="main">,</span> <span class="main">(</span>True<span class="main">,</span> True<span class="main">)</span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Z'</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">.</span> Collect <span class="bound">P</span> <span class="main">∈</span> Z<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"is_filter <span class="main">(</span>raw_filtermap fst Z'<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Z_def raw_filtermap_apply
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> is_filter.intro<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">smt</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"is_filter <span class="main">(</span>raw_filtermap snd Z'<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Z_def raw_filtermap_apply
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> is_filter.intro<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_eq_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">smt</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_filter Z'"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> is_filter.mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∈</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">(</span></span>False<span class="main"><span class="main">,</span></span> False<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">(</span></span>False<span class="main"><span class="main">,</span></span> True<span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span></span>
        <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">∈</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">(</span></span>False<span class="main"><span class="main">,</span></span> False<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">(</span></span>False<span class="main"><span class="main">,</span></span> True<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">(</span></span>True<span class="main"><span class="main">,</span></span> False<span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> 3 0 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Z_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* experiment *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Almost-everywhere equal sequences›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">aeseq_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">f</span> <span class="entity">g</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">aeseq_eq</span> <span class="free">f</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">≠</span> <span class="free">g</span> <span class="bound">n</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> equivp_aeseq_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"equivp aeseq_eq"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> equivpI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reflp aeseq_eq"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def aeseq_eq.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symp aeseq_eq"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symp_def aeseq_eq.simps eq_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">h</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">g</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">h</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">h</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">g</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">h</span> <span class="bound">n</span><span class="main">}</span>"</span></span><span class="main">]</span> that
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transp aeseq_eq"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> transp_def aeseq_eq.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">quotient_type</span></span> <span class="tfree">'a</span> aeseq <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">/</span> <span class="quoted">aeseq_eq</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> equivp_aeseq_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> map_aeseq <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> aeseq <span class="main">⇒</span> <span class="tfree">'b</span> aeseq"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(∘)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aeseq_eq.simps <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_aeseq_id<span class="main">:</span> <span class="quoted"><span class="quoted">"map_aeseq id <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equivp_reflp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> equivp_aeseq_eq<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_aeseq_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"map_aeseq <span class="free">f</span> <span class="main">(</span>map_aeseq <span class="free">g</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> map_aeseq <span class="main">(</span><span class="free">f</span> <span class="main">∘</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_assoc equivp_reflp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> equivp_aeseq_eq<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> rel_aeseq <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> aeseq <span class="main">⇒</span> <span class="tfree">'b</span> aeseq <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">R</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">R</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="bound">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> aeseq_eq.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">R</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span> <span class="main">⟷</span> finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">R</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g'</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> ff'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">f'</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gg'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">g'</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">R</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">f</span> <span class="skolem">f'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">g</span> <span class="skolem">g'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">R</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> ff' gg' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">R</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">f'</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">g'</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">R</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g'</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">R</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g'</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> ff' gg' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">R</span> <span class="main">(</span><span class="skolem">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g'</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">f'</span> <span class="bound">n</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="main">≠</span> <span class="skolem">g'</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">R</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_aeseq_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">≤</span> <span class="free">S</span> <span class="main">⟹</span> rel_aeseq <span class="free">R</span> <span class="main">≤</span> rel_aeseq <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_aeseq_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_aeseq <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aeseq_eq.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_aeseq_conversep<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_aeseq <span class="free">R</span><span class="main">¯¯</span> <span class="main">=</span> <span class="main">(</span>rel_aeseq <span class="free">R</span><span class="main">)</span><span class="main">¯¯</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_aeseq_parametric<span class="main">:</span> <span class="keyword2"><span class="keyword">includes</span></span> lifting_syntax <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> <span class="free">B</span><span class="main">)</span> <span class="main">===&gt;</span> rel_aeseq <span class="free">A</span> <span class="main">===&gt;</span> rel_aeseq <span class="free">B</span><span class="main">)</span> map_aeseq map_aeseq"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> rel_funI<span class="main"><span class="keyword3">;</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rel_funD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_aeseq_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_aeseq <span class="main">(</span><span class="free">R</span> <span class="keyword1">OO</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> rel_aeseq <span class="free">R</span> <span class="keyword1">OO</span> rel_aeseq <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> f h
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> relcomppI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">SOME</span></span> <span class="bound"><span class="bound">z</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">R</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">f</span></span> <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">z</span></span> <span class="main"><span class="main">∧</span></span> <span class="free"><span class="free">S</span></span> <span class="bound"><span class="bound">z</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">h</span></span> <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> someI2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> f h g
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">¬</span></span> <span class="free"><span class="free">R</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">f</span></span> <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">g</span></span> <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span> <span class="main"><span class="main">∪</span></span> <span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">¬</span></span> <span class="free"><span class="free">S</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">g</span></span> <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">h</span></span> <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DDS">
<div class="head">
<h1>Theory DDS</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Andreas Lochbihler, ETH Zurich
   Author: Joshua Schneider, ETH Zurich *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Example: deterministic discrete system›</span></span>

<span class="keyword1"><span class="command">theory</span></span> DDS <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Concrete_Examples.html">Concrete_Examples</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Rewrite.html">HOL-Library.Rewrite</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/FSet.html">HOL-Library.FSet</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">unbundle</span></span> lifting_syntax

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition and generalised mapper and relator›</span></span>

<span class="keyword1"><span class="command">codatatype</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dds <span class="main">=</span> DDS <span class="main">(</span><span class="free"><span class="entity">run</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dds"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">for</span></span> map<span class="main">:</span> map_dds'
      rel<span class="main">:</span> rel_dds'

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">map_dds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a'</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b'</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dds <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a'</span><span class="main">,</span> <span class="tfree">'b'</span><span class="main">)</span> dds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"run <span class="main">(</span><span class="free">map_dds</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> map_prod <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="free">map_dds</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span> <span class="main">(</span>run <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_dds_id<span class="main">:</span> <span class="quoted"><span class="quoted">"map_dds id id <span class="free">S</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def prod.rel_map <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prod.rel_refl_strong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> map_dds_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"map_dds <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>map_dds <span class="free">f'</span> <span class="free">g'</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> map_dds <span class="main">(</span><span class="free">f'</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">g'</span><span class="main">)</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def prod.rel_map <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prod.rel_refl_strong<span class="main">)</span>

<span class="keyword1"><span class="command">coinductive</span></span> <span class="entity">rel_dds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b'</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dds <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a'</span><span class="main">,</span> <span class="tfree">'b'</span><span class="main">)</span> dds <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">A</span> <span class="entity">B</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rel_dds</span> <span class="free">A</span> <span class="free">B</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">S'</span></span></span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"rel_fun <span class="free">A</span> <span class="main">(</span>rel_prod <span class="free">B</span> <span class="main">(</span><span class="free">rel_dds</span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>run <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span> <span class="main">(</span>run <span class="free"><span class="bound"><span class="entity">S'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_dds'_rel_dds<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_dds' <span class="free">B</span> <span class="main">=</span> rel_dds <span class="main">(=)</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_dds.coinduct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> dds.rel_cases<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_fun_mono<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> predicate2D<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> order_refl<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> prod.rel_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> order_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> dds.rel_coinduct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rel_dds.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_dds_eq <span class="main">[</span><span class="operator">relator_eq</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_dds <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext iffI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> dds.coinduct<span class="main">)</span><span class="main">(</span><span class="operator">erule</span> rel_dds.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> rel_dds.coinduct<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> prod.rel_refl_strong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_dds_mono <span class="main">[</span><span class="operator">relator_mono</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rel_dds <span class="free">A</span> <span class="free">B</span> <span class="main">≤</span> rel_dds <span class="free">A'</span> <span class="free">B'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">A'</span> <span class="main">≤</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≤</span> <span class="free">B'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_dds.coinduct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_dds.cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> BNF_Def.rel_fun_mono<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> that<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> predicate2D<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_dds_conversep<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_dds <span class="free">A</span><span class="main">¯¯</span> <span class="free">B</span><span class="main">¯¯</span> <span class="main">=</span> <span class="main">(</span>rel_dds <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">¯¯</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> ext iffI<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_dds.coinduct<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> rel_dds.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> conversep_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> conversep_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> rel_fun_conversep prod.rel_conversep<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> BNF_Def.rel_fun_mono<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> conversep_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rel_dds.coinduct<span class="main"><span class="keyword3">;</span></span> <span class="operator">erule</span> rel_dds.cases<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> conversep_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quasi_keyword">asm</span> conversep_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> rel_fun_conversep prod.rel_conversep<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> BNF_Def.rel_fun_mono<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> conversep_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> DDS_parametric <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">===&gt;</span> rel_prod <span class="free">B</span> <span class="main">(</span>rel_dds <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">===&gt;</span> rel_dds <span class="free">A</span> <span class="free">B</span><span class="main">)</span> DDS DDS"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rel_dds.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> run_parametric <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_dds <span class="free">A</span> <span class="free">B</span> <span class="main">===&gt;</span> <span class="free">A</span> <span class="main">===&gt;</span> rel_prod <span class="free">B</span> <span class="main">(</span>rel_dds <span class="free">A</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> run run"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_dds.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> corec_dds_parametric <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">===&gt;</span> <span class="free">A</span> <span class="main">===&gt;</span> rel_prod <span class="free">B</span> <span class="main">(</span>rel_sum <span class="main">(</span>rel_dds <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">===&gt;</span> <span class="free">S</span> <span class="main">===&gt;</span> rel_dds <span class="free">A</span> <span class="free">B</span><span class="main">)</span> corec_dds corec_dds"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_funI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">premises</span></span> prems <span class="keyword2"><span class="keyword">for</span></span> f g s s' <span class="keyword1"><span class="command">using</span></span> prems<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">s'</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> comp_transfer<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> prod.map_transfer<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> id_transfer<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rel_sum.cases<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_dds_parametric <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A'</span> <span class="main">===&gt;</span> <span class="free">A</span><span class="main">)</span> <span class="main">===&gt;</span> <span class="main">(</span><span class="free">B</span> <span class="main">===&gt;</span> <span class="free">B'</span><span class="main">)</span> <span class="main">===&gt;</span> rel_dds <span class="free">A</span> <span class="free">B</span> <span class="main">===&gt;</span> rel_dds <span class="free">A'</span> <span class="free">B'</span><span class="main">)</span> map_dds map_dds"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> map_dds_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>

<span class="keyword1"><span class="command">lemmas</span></span> map_dds_rel_cong <span class="main">=</span> map_dds_parametric<span class="main">[</span><span class="operator">unfolded</span> rel_fun_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">rotated</span> -1<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> rel_dds_Grp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_dds <span class="main">(</span>Grp UNIV <span class="free">f</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">(</span>Grp UNIV <span class="free">g</span><span class="main">)</span> <span class="main">=</span> Grp UNIV <span class="main">(</span>map_dds <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext iffI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Grp_apply<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fold</span> rel_dds_eq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_dds <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_dds_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> map_dds_parametric<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span>
      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Grp_apply rel_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> GrpE<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_dds <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span>"</span></span></span> map_dds_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> map_dds_parametric<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> -1<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> rel_dds_eq<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Grp_apply rel_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> rel_dds_pos_distr <span class="main">[</span><span class="operator">relator_distr</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rel_dds <span class="free">A</span> <span class="free">B</span> <span class="keyword1">OO</span> rel_dds <span class="free">C</span> <span class="free">D</span> <span class="main">≤</span> rel_dds <span class="main">(</span><span class="free">A</span> <span class="keyword1">OO</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span><span class="free">B</span> <span class="keyword1">OO</span> <span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> relcomppE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y z
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_fun_mono<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> predicate2D<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> order_refl<span class="main"><span class="main">,</span></span>
          <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_prod <span class="free"><span class="free">B</span></span> <span class="main"><span class="main">(</span></span>rel_dds <span class="free"><span class="free">A</span></span> <span class="free"><span class="free">B</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">OO</span></span> rel_prod <span class="free"><span class="free">D</span></span> <span class="main"><span class="main">(</span></span>rel_dds <span class="free"><span class="free">C</span></span> <span class="free"><span class="free">D</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> prod.rel_compp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> eq_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> prod.rel_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> order_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_fun_pos_distr<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> predicate2D<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> relcomppI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> rel_dds.cases<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Quotient_dds <span class="main">[</span><span class="operator">quot_map</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Quotient <span class="free">R1</span> <span class="free">Abs1</span> <span class="free">Rep1</span> <span class="free">T1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Quotient <span class="free">R2</span> <span class="free">Abs2</span> <span class="free">Rep2</span> <span class="free">T2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Quotient <span class="main">(</span>rel_dds <span class="free">R1</span> <span class="free">R2</span><span class="main">)</span> <span class="main">(</span>map_dds <span class="free">Rep1</span> <span class="free">Abs2</span><span class="main">)</span> <span class="main">(</span>map_dds <span class="free">Abs1</span> <span class="free">Rep2</span><span class="main">)</span> <span class="main">(</span>rel_dds <span class="free">T1</span> <span class="free">T2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Quotient_alt_def5
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_dds <span class="free">T1</span> <span class="free">T2</span> <span class="main">≤</span> rel_dds <span class="main">(</span>Grp UNIV <span class="free">Rep1</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">(</span>Grp UNIV <span class="free">Abs2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_dds_mono<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Quotient_alt_def5<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">,</span></span>
          <span class="operator">unfolded</span> conversep_le_swap<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Quotient_alt_def5<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Grp UNIV <span class="main">(</span>map_dds <span class="free">Rep1</span> <span class="free">Abs2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rel_dds_Grp <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Grp UNIV <span class="main">(</span>map_dds <span class="free">Abs1</span> <span class="free">Rep2</span><span class="main">)</span> <span class="main">=</span> rel_dds <span class="main">(</span>Grp UNIV <span class="free">Abs1</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">(</span>Grp UNIV <span class="free">Rep2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_dds_Grp<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> rel_dds <span class="free">T1</span><span class="main">¯¯</span> <span class="free">T2</span><span class="main">¯¯</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_dds_mono<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Quotient_alt_def5<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Quotient_alt_def5<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_dds_conversep<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> predicate2I<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> relcomppI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map_dds_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> map_dds_rel_cong<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> Quotient_rep_equiv1<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> Quotient_equiv_abs1<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rel_dds_conversep<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"map_dds <span class="free">Rep1</span> <span class="free">Abs2</span> <span class="skolem">y</span> <span class="main">=</span> map_dds <span class="free">Rep1</span> <span class="free">Abs2</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> map_dds_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> map_dds_rel_cong<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> Quotient_rep_equiv2<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> Quotient_equiv_abs2<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> rel_dds_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> map_dds_rel_cong<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> Quotient_rep_reflp<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> Quotient_rel_abs<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> rel_dds_conversep<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
        assms<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> Quotient_alt_def5<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_dds_pos_distr<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is just the co-iterator.›</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">dds_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"run <span class="main">(</span><span class="free">dds_of</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> map_prod id <span class="main">(</span><span class="free">dds_of</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dds_of_parametric <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">S</span> <span class="main">===&gt;</span> <span class="free">A</span> <span class="main">===&gt;</span> rel_prod <span class="free">B</span> <span class="free">S</span><span class="main">)</span> <span class="main">===&gt;</span> <span class="free">S</span> <span class="main">===&gt;</span> rel_dds <span class="free">A</span> <span class="free">B</span><span class="main">)</span> dds_of dds_of"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dds_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Evenness of partial sums›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">even_psum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int<span class="main">,</span> bool<span class="main">)</span> dds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">even_psum</span> <span class="main">=</span> dds_of <span class="main">(</span><span class="main">λ</span><span class="bound">psum</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>even <span class="main">(</span><span class="bound">psum</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span><span class="main">,</span> <span class="bound">psum</span> <span class="main">+</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">even_psum_nat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">,</span> bool<span class="main">)</span> dds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">even_psum_nat</span> <span class="main">=</span> map_dds int id even_psum"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Composition›</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">compose</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dds <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> dds <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> dds"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∙</span>"</span> 120<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"run <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main"><span class="free">∙</span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">S1'</span><span class="main">)</span> <span class="main">=</span> run <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="bound">a</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">S2'</span><span class="main">)</span> <span class="main">=</span> run <span class="free"><span class="bound"><span class="entity">S2</span></span></span> <span class="bound">b</span> <span class="keyword1">in</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">S1'</span> <span class="main"><span class="free">∙</span></span> <span class="bound">S2'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compose_parametric <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_dds <span class="free">A</span> <span class="free">B</span> <span class="main">===&gt;</span> rel_dds <span class="free">B</span> <span class="free">C</span> <span class="main">===&gt;</span> rel_dds <span class="free">A</span> <span class="free">C</span><span class="main">)</span> <span class="main">(∙)</span> <span class="main">(∙)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> compose_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For the following lemma, a direct proof by induction is easy as the inner functor of
  the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">type</span></span> dds<span class="antiquote"><span class="antiquote">}</span></span></span></span> codatatype is fairly simple.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"map_dds <span class="free">f</span> <span class="free">g</span> <span class="free">S1</span> <span class="main">∙</span> <span class="free">S2</span> <span class="main">=</span> map_dds <span class="free">f</span> id <span class="main">(</span><span class="free">S1</span> <span class="main">∙</span> map_dds <span class="free">g</span> id <span class="free">S2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">coinduction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">S1</span></span> <span class="quoted"><span class="free">S2</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_map_prod rel_fun_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹However, we can also follow the systematic route via parametricity:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> compose_map1<span class="main">:</span> <span class="quoted"><span class="quoted">"map_dds <span class="free">f</span> <span class="free">g</span> <span class="free">S1</span> <span class="main">∙</span> <span class="free">S2</span> <span class="main">=</span> map_dds <span class="free">f</span> id <span class="main">(</span><span class="free">S1</span> <span class="main">∙</span> map_dds <span class="free">g</span> id <span class="free">S2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">S1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dds"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">S2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> dds"</span></span>
  <span class="keyword1"><span class="command">using</span></span> compose_parametric<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Grp UNIV <span class="free">f</span><span class="main">)</span><span class="main">¯¯</span>"</span></span> <span class="quoted"><span class="quoted">"Grp UNIV <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"Grp UNIV id <span class="main">::</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> bool"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">_</span></span> <span class="main"><span class="main">===&gt;</span></span> rel_dds <span class="main"><span class="main">⌑</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">===&gt;</span></span> <span class="main"><span class="main">_</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quasi_keyword">asm</span> conversep_conversep<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">_</span></span> <span class="main"><span class="main">===&gt;</span></span> rel_dds <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">⌑</span></span> <span class="main"><span class="main">===&gt;</span></span> <span class="main"><span class="main">_</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quasi_keyword">asm</span> conversep_Grp_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rel_dds_conversep rel_dds_Grp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def Grp_apply<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> compose_map2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S1</span> <span class="main">∙</span> map_dds <span class="free">f</span> <span class="free">g</span> <span class="free">S2</span> <span class="main">=</span> map_dds id <span class="free">g</span> <span class="main">(</span>map_dds id <span class="free">f</span> <span class="free">S1</span> <span class="main">∙</span> <span class="free">S2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">S1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dds"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">S2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'c</span><span class="main">)</span> dds"</span></span>
  <span class="keyword1"><span class="command">using</span></span> compose_parametric<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Grp UNIV id <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Grp UNIV <span class="free">f</span><span class="main">)</span><span class="main">¯¯</span>"</span></span> <span class="quoted"><span class="quoted">"Grp UNIV <span class="free">g</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"rel_dds <span class="main"><span class="main">⌑</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">===&gt;</span></span> <span class="main"><span class="main">_</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quasi_keyword">asm</span> conversep_conversep<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rewrite</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">_</span></span> <span class="main"><span class="main">===&gt;</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">===&gt;</span></span> rel_dds <span class="main"><span class="main">⌑</span></span> <span class="main"><span class="main">_</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quasi_keyword">asm</span> conversep_Grp_id<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rel_dds_conversep rel_dds_Grp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def Grp_apply<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">parallel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> dds <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'d</span><span class="main">)</span> dds <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">+</span> <span class="tfree">'c</span><span class="main">,</span> <span class="tfree">'b</span> <span class="main">+</span> <span class="tfree">'d</span><span class="main">)</span> dds"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">∥</span>"</span> 130<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"run <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main"><span class="free">∥</span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span>
     Inl <span class="bound">a</span> <span class="main">⇒</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">S1'</span><span class="main">)</span> <span class="main">=</span> run <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="bound">a</span> <span class="keyword1">in</span> <span class="main">(</span>Inl <span class="bound">b</span><span class="main">,</span> <span class="bound">S1'</span> <span class="main"><span class="free">∥</span></span> <span class="free"><span class="bound"><span class="entity">S2</span></span></span><span class="main">)</span>
   <span class="main">|</span> Inr <span class="bound">c</span> <span class="main">⇒</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span> <span class="bound">S2'</span><span class="main">)</span> <span class="main">=</span> run <span class="free"><span class="bound"><span class="entity">S2</span></span></span> <span class="bound">c</span> <span class="keyword1">in</span> <span class="main">(</span>Inr <span class="bound">d</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S1</span></span></span> <span class="main"><span class="free">∥</span></span> <span class="bound">S2'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> parallel_parametric <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>rel_dds <span class="free">A</span> <span class="free">B</span> <span class="main">===&gt;</span> rel_dds <span class="free">C</span> <span class="free">D</span> <span class="main">===&gt;</span> rel_dds <span class="main">(</span>rel_sum <span class="free">A</span> <span class="free">C</span><span class="main">)</span> <span class="main">(</span>rel_sum <span class="free">B</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">(∥)</span> <span class="main">(∥)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> parallel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>

<span class="keyword1"><span class="command">lemma</span></span> map_parallel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_dds <span class="free">f</span> <span class="free">h</span> <span class="free">S1</span> <span class="main">∥</span> map_dds <span class="free">g</span> <span class="free">k</span> <span class="free">S2</span> <span class="main">=</span> map_dds <span class="main">(</span>map_sum <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="main">(</span>map_sum <span class="free">h</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">S1</span> <span class="main">∥</span> <span class="free">S2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> parallel_parametric<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>Grp UNIV <span class="free">f</span><span class="main">)</span><span class="main">¯¯</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> B<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Grp UNIV <span class="free">h</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
      C<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>Grp UNIV <span class="free">g</span><span class="main">)</span><span class="main">¯¯</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> D<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Grp UNIV <span class="free">k</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.rel_conversep sum.rel_Grp rel_dds_Grp<span class="main">)</span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def Grp_apply<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Graph traversal: refinement and quotients›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_Image<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">R</span> <span class="main">``</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> finite <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Image_def<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> fset.lifting <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> fImage <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> fset <span class="main">⇒</span> <span class="tfree">'a</span> fset <span class="main">⇒</span> <span class="tfree">'b</span> fset"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">Image</span> <span class="keyword2"><span class="keyword">parametric</span></span> Image_parametric
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_Image <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite_imageI<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> fImage_iff <span class="main">=</span> Image_iff<span class="main">[</span><span class="operator">Transfer.transferred</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> fImageI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span> <span class="main">=</span> ImageI<span class="main">[</span><span class="operator">Transfer.transferred</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> fImageE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span> <span class="main">=</span> ImageE<span class="main">[</span><span class="operator">Transfer.transferred</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> rev_fImageI <span class="main">=</span> rev_ImageI<span class="main">[</span><span class="operator">Transfer.transferred</span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> fImage_mono <span class="main">=</span> Image_mono<span class="main">[</span><span class="operator">Transfer.transferred</span><span class="main">]</span>

<span class="keyword1"><span class="command">lifting_update</span></span> fset.lifting
<span class="keyword1"><span class="command">lifting_forget</span></span> fset.lifting
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> graph <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> fset"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">traverse</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> fset<span class="main">,</span> <span class="tfree">'a</span> fset<span class="main">)</span> dds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">traverse</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">=</span> dds_of <span class="main">(</span><span class="main">λ</span><span class="bound">visited</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>fImage <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">A</span><span class="main">)</span> <span class="main">|-|</span> <span class="bound">visited</span><span class="main">,</span> <span class="bound">visited</span> <span class="main">|∪|</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">{||}</span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> graph' <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> list"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">traverse_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> graph' <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">,</span> <span class="tfree">'a</span> list<span class="main">)</span> dds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">traverse_impl</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">=</span>
   dds_of <span class="main">(</span><span class="main">λ</span><span class="bound">visited</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span>map snd <span class="main">[</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">←</span><span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="bound">A</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">|∉|</span> <span class="bound">visited</span><span class="main">]</span><span class="main">,</span>
    <span class="bound">visited</span> <span class="main">|∪|</span> fset_of_list <span class="bound">A</span><span class="main">)</span><span class="main">)</span> <span class="main">{||}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_fset_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> fset <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list_fset_rel</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟷</span> fset_of_list <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> traverse_refinement<span class="main">:</span> <span class="comment1">― ‹This is the refinement lemma.›</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>list_fset_rel <span class="main">===&gt;</span> rel_dds list_fset_rel list_fset_rel<span class="main">)</span> traverse_impl traverse"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> traverse_impl_def traverse_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rel_funI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> dds_of_parametric<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(=)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def list_fset_rel_def fset_of_list_elem <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_fimage_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> fset_of_list_parametric <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>list_all2 <span class="free">A</span> <span class="main">===&gt;</span> rel_fset <span class="free">A</span><span class="main">)</span> fset_of_list fset_of_list"</span></span>
  <span class="keyword1"><span class="command">including</span></span> fset.lifting <span class="keyword1"><span class="command">unfolding</span></span> rel_fun_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span><span class="main">(</span><span class="operator">rule</span> list.set_transfer<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> rel_fun_def<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> traverse_impl_parametric <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">transfer_rule</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bi_unique <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>list_all2 <span class="main">(</span>rel_prod <span class="free">A</span> <span class="free">A</span><span class="main">)</span> <span class="main">===&gt;</span> rel_dds <span class="main">(</span>list_all2 <span class="free">A</span><span class="main">)</span> <span class="main">(</span>list_all2 <span class="free">A</span><span class="main">)</span><span class="main">)</span> traverse_impl traverse_impl"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> traverse_impl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer_prover</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  By constructing finite sets as a quotient of lists, we can synthesise an abstract version
  of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> traverse_impl<span class="antiquote"><span class="antiquote">}</span></span></span></span> automatically, together with a polymorphic refinement lemma.
›</span></span>

<span class="keyword1"><span class="command">quotient_type</span></span> <span class="tfree">'a</span> fset' <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span> <span class="main">/</span> <span class="quoted"><span class="quoted">"vimage2p set set <span class="main">(=)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> equivpI reflpI sympI transpI <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage2p_def<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> traverse'' <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> fset' <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> fset'<span class="main">,</span> <span class="tfree">'a</span> fset'<span class="main">)</span> dds"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"traverse_impl <span class="main">::</span> <span class="tfree">'a</span> graph' <span class="main">⇒</span> <span class="main">_</span>"</span></span> <span class="keyword2"><span class="keyword">parametric</span></span> traverse_impl_parametric
  <span class="keyword1"><span class="command">unfolding</span></span> traverse_impl_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> dds_of_parametric<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(=)</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_fun_def vimage2p_def fset_of_list_elem<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Generalised rewriting›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">accumulate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> fset<span class="main">,</span> <span class="tfree">'a</span> fset<span class="main">)</span> dds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">accumulate</span> <span class="main">=</span> dds_of <span class="main">(</span><span class="main">λ</span><span class="bound">A</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">A</span> <span class="main">|∪|</span> <span class="bound">X</span><span class="main">,</span> <span class="bound">A</span> <span class="main">|∪|</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">{||}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> accumulate_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_dds <span class="main">(|⊆|)</span> <span class="main">(|⊆|)</span> accumulate accumulate"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> accumulate_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> dds_of_parametric<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(|⊆|)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_funI rel_prod.intros<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> funion_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> traverse_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(|⊆|)</span> <span class="main">===&gt;</span> rel_dds <span class="main">(=)</span> <span class="main">(|⊆|)</span><span class="main">)</span> traverse traverse"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> traverse_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_funI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> dds_of_parametric<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(=)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_funI rel_prod.intros<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fminus_mono<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> fImage_mono<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">|⊆|</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_dds <span class="main">(=)</span> <span class="main">(|⊆|)</span> <span class="main">(</span>traverse <span class="free">G</span> <span class="main">∙</span> accumulate<span class="main">)</span> <span class="main">(</span>traverse <span class="free">H</span> <span class="main">∙</span> accumulate<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> compose_parametric<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> traverse_mono<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> accumulate_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">seen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> fset<span class="main">,</span> <span class="tfree">'a</span> fset<span class="main">)</span> dds"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">seen</span> <span class="main">=</span> dds_of <span class="main">(</span><span class="main">λ</span><span class="bound">S</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">S</span> <span class="main">|∩|</span> <span class="bound">X</span><span class="main">,</span> <span class="bound">S</span> <span class="main">|∪|</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="main">{||}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> seen_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"rel_dds <span class="main">(|⊆|)</span> <span class="main">(|⊆|)</span> seen seen"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> seen_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> dds_of_parametric<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(|⊆|)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> rel_funI rel_prod.intros<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finter_mono funion_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">|⊆|</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rel_dds <span class="main">(=)</span> <span class="main">(|⊆|)</span> <span class="main">(</span>traverse <span class="free">G</span> <span class="main">∙</span> seen<span class="main">)</span> <span class="main">(</span>traverse <span class="free">H</span> <span class="main">∙</span> seen<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> compose_parametric<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> rel_funD<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> traverse_mono<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> rel_funD<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> seen_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>