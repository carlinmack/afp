<div id="RTrancl">
<div class="head">
<h1>Theory RTrancl</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Executable Transitive Closures 
    Author:      René Thiemann       &lt;rene.thiemann@uibk.ac.at&gt;
    Maintainer:  René Thiemann
    License:     LGPL
*)</span>

<span class="comment1">(*
Copyright 2012 Christian Sternagel, René Thiemann

This file is part of IsaFoR/CeTA.

IsaFoR/CeTA is free software: you can redistribute it and/or modify it under the
terms of the GNU Lesser General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.

IsaFoR/CeTA is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License along
with IsaFoR/CeTA. If not, see &lt;http://www.gnu.org/licenses/&gt;.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹A work-list algorithm for reflexive-transitive closures›</span></span>


<span class="keyword1"><span class="command">theory</span></span> RTrancl
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../Regular-Sets/Regexp_Method.html">Regular-Sets.Regexp_Method</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In previous work \cite{rtrancl_fin} we described a generic work-list
algorithm to compute reflexive-transitive closures for \emph{finite} relations:
given a finite relation $r$, it computed $<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">r</span></span><span class="main"><span class="main">^*</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>$. 

In the following, we develop a similar, though different work-list algorithm
for reflexive-transitive closures, it computes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">r</span></span><span class="main"><span class="main">^*</span></span> <span class="main"><span class="main">``</span></span> <span class="free"><span class="free">init</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for a given
relation $r$ and finite set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">init</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
The main differences are that
\begin{itemize}
\item The relation $r$ does not have to be finite, only <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">b</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">a</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">b</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> <span class="free"><span class="free">r</span></span><span class="main"><span class="main">^*</span></span> <span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has to be finite
  for each $a$. Moreover, it is no longer required that $r$ is given 
  explicitly as a list of pairs.
 Instead $r$ must be provided in the form of a function which computes 
  for each element the
  set of one-step successors.
\item One can use a subsumption relation to indicate which elements to no longer
  have to be explored.
\end{itemize}

These new features have been essential to certify size-change termination 
proofs \cite{sct} where the transitive closure of all size-change graphs 
has to be computed. Here, the relation is size-change graph composition.
\begin{itemize}
\item Given an initial set of size-change graphs with $n$ arguments, 
  there are roughly $N := 3^{n^2}$ many potential size-change graphs that
  have to be considered as left-hand sides of the composition relation. 
  Since the composition relation is even larger than $N$,
  an explicit representation of the composition relation would have been 
  too expensive. However, using the new algorithm the number of generated
  graphs is usually far below the theoretical upper bound.
\item Subsumption was useful to generate even fewer elements.
\end{itemize}

›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The generic case›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Let $r$ be some finite relation.

  We present a standard work-list algorithm to compute all elements
  that are reachable from some initial set. 
  The algorithm is generic in the sense that the
  underlying data structure can freely be chosen, you just have to provide
  certain operations like union, selection of an element. 

  In contrast to \cite{rtrancl_fin}, the algorithm does not demand that $r$ is finite
  and that $r$ is explicitly provided (e.g., as a list of pairs).
  Instead, it suffices that for every element, only finitely many 
  elements can be reached via $r$, and $r$ can be provided as a function which
  computes for every element $a$ all one-step successors w.r.t.\ $r$. 
  Hence, $r$ can in particular be any 
  well-founded and finitely branching relation. 
  
  The algorithm can further be parametrized by a subsumption relation 
  which allows for early pruning. 
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the following locales, $r$ is a relation of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span> <span class="main"><span class="main">⇒</span></span> <span class="tfree"><span class="tfree">'a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  the successors of an element are represented by some collection 
  type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> which size can be measured using the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">size</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> function. 
  The selection function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">sel</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is used to meant to split a non-empty
  collection into one element and a remaining collection. The union on
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is given by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">un</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span> 

<span class="keyword1"><span class="command">locale</span></span> subsumption <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="free">subsumes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 
       subsumes_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span><span class="main">.</span> <span class="free">subsumes</span> <span class="bound">a</span> <span class="bound">a</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> subsumes_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">subsumes</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">subsumes</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">⟹</span> <span class="free">subsumes</span> <span class="bound">a</span> <span class="bound">c</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> subsumes_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="free">subsumes</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">r</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">d</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">r</span> <span class="bound">a</span><span class="main">)</span><span class="main">.</span> <span class="free">subsumes</span> <span class="bound">d</span> <span class="bound">c</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">R</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">≡</span> <span class="main">{</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">r</span> <span class="bound">a</span><span class="main">)</span> <span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> subsumption_impl <span class="main">=</span> subsumption <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">subsumes</span></span> <span class="quoted"><span class="free">set_of</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">subsumes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">set_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> 
      <span class="free">sel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> <span class="free">un</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="free">size</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> set_of_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">b</span><span class="main">.</span> finite <span class="main">(</span><span class="free">set_of</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> sel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">b</span> <span class="bound">a</span> <span class="bound">c</span><span class="main">.</span> <span class="free">set_of</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">sel</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">set_of</span> <span class="bound">b</span> <span class="main">=</span> insert <span class="bound">a</span> <span class="main">(</span><span class="free">set_of</span> <span class="bound">c</span><span class="main">)</span> <span class="main">∧</span> <span class="free">size</span> <span class="bound">b</span> <span class="main">&gt;</span> <span class="free">size</span> <span class="bound">c</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> un<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_of</span> <span class="main">(</span><span class="free">un</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">set_of</span> <span class="free">a</span> <span class="main">∪</span> <span class="free">set_of</span> <span class="free">b</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> relation_subsumption_impl <span class="main">=</span> subsumption_impl <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">subsumes</span></span> <span class="quoted"><span class="free">set_of</span></span> <span class="quoted"><span class="free">sel</span></span> <span class="quoted"><span class="free">un</span></span> <span class="quoted"><span class="free">size</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">r</span> <span class="free">subsumes</span> <span class="free">set_of</span> <span class="free">sel</span> <span class="free">un</span> <span class="free">size</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rtrancl_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span><span class="main">.</span> finite <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">r</span> <span class="bound">a</span><span class="main">)</span><span class="main">}</span><span class="main">^*</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1" id="RTrancl-finite_Rs"><span class="command">lemma</span></span> finite_Rs<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> init<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">init</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>R<span class="main">^*</span> <span class="main">``</span> <span class="free">init</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span><span class="main">.</span> <span class="main">{</span><span class="bound">b</span> <span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> R<span class="main">^*</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="var">?R</span> <span class="bound">a</span> <span class="main">|</span> <span class="bound">a</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">init</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"R<span class="main">^*</span> <span class="main">``</span> <span class="free">init</span> <span class="main">=</span> <span class="main">⋃</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="var">?R</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_fin<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> R<span class="main">^*</span><span class="main">}</span> <span class="main">|</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">init</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> init <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹a standard work-list algorithm with subsumption›</span></span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">mk_rtrancl_main</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">mk_rtrancl_main</span> <span class="free"><span class="bound"><span class="entity">todo</span></span></span> <span class="free"><span class="bound"><span class="entity">fin</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">set_of</span> <span class="free"><span class="bound"><span class="entity">todo</span></span></span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">fin</span></span></span>
      <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">tod</span><span class="main">)</span> <span class="main">=</span> <span class="free">sel</span> <span class="free"><span class="bound"><span class="entity">todo</span></span></span>
             <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">fin</span></span></span><span class="main">.</span> <span class="free">subsumes</span> <span class="bound">b</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">mk_rtrancl_main</span> <span class="bound">tod</span> <span class="free"><span class="bound"><span class="entity">fin</span></span></span>
                 <span class="keyword1">else</span> <span class="free">mk_rtrancl_main</span> <span class="main">(</span><span class="free">un</span> <span class="main">(</span><span class="free">r</span> <span class="bound">a</span><span class="main">)</span> <span class="bound">tod</span><span class="main">)</span> <span class="main">(</span>insert <span class="bound">a</span> <span class="free"><span class="bound"><span class="entity">fin</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">mk_rtrancl_main</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">todo</span><span class="main">,</span> <span class="bound">fin</span><span class="main">)</span><span class="main">.</span> card <span class="main">(</span>R<span class="main">^*</span> <span class="main">``</span> <span class="main">(</span><span class="free">set_of</span> <span class="bound">todo</span><span class="main">)</span> <span class="main">-</span> <span class="bound">fin</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">todo</span><span class="main">,</span> <span class="bound">fin</span><span class="main">)</span><span class="main">.</span> <span class="free">size</span> <span class="bound">todo</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>measures <span class="main">[</span><span class="var">?r1</span><span class="main">,</span><span class="var">?r2</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">todo</span> <span class="skolem">fin</span> <span class="skolem">pair</span> <span class="skolem">tod</span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> nempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_of</span> <span class="skolem">todo</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pair1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pair</span> <span class="main">=</span> <span class="free">sel</span> <span class="skolem">todo</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pair2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">tod</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">pair</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> pair1 pair2 <span class="keyword1"><span class="command">have</span></span> pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sel</span> <span class="skolem">todo</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">tod</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> set_of_fin <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">set_of</span> <span class="skolem">todo</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> sel <span class="main">=</span> sel<span class="main">[</span><span class="operator">OF</span> nempty pair<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">tod</span><span class="main">,</span><span class="skolem">fin</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">todo</span><span class="main">,</span><span class="skolem">fin</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> measures <span class="main">[</span><span class="var">?r1</span><span class="main">,</span><span class="var">?r2</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> measures_lesseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ measures_less<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> split<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sel 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">size</span> <span class="skolem">tod</span> <span class="main">&lt;</span> <span class="free">size</span> <span class="skolem">todo</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> sel <span class="keyword1"><span class="command">have</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"R<span class="main">^*</span> <span class="main">``</span> <span class="free">set_of</span> <span class="skolem">tod</span> <span class="main">-</span> <span class="skolem">fin</span> <span class="main">⊆</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">set_of</span> <span class="skolem">todo</span> <span class="main">-</span> <span class="skolem">fin</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⊆</span> <span class="var">?r</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?l</span> <span class="main">≤</span> card <span class="var">?r</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ subset<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_Diff<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_Rs<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fin<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">todo</span> <span class="skolem">fin</span> <span class="skolem">a</span> <span class="skolem">tod</span> <span class="skolem">pair</span>
    <span class="keyword3"><span class="command">assume</span></span> nempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_of</span> <span class="skolem">todo</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pair1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pair</span> <span class="main">=</span> <span class="free">sel</span> <span class="skolem">todo</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pair2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">tod</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">pair</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nmem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">fin</span><span class="main">.</span> <span class="free">subsumes</span> <span class="bound">b</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> pair1 pair2 <span class="keyword1"><span class="command">have</span></span> pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sel</span> <span class="skolem">todo</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">tod</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> nmem subsumes_refl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> nmem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">fin</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> set_of_fin <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">set_of</span> <span class="skolem">todo</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> sel <span class="main">=</span> sel<span class="main">[</span><span class="operator">OF</span> nempty pair<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">un</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">tod</span><span class="main">,</span>insert <span class="skolem">a</span> <span class="skolem">fin</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">todo</span><span class="main">,</span><span class="skolem">fin</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> measures <span class="main">[</span><span class="var">?r1</span><span class="main">,</span><span class="var">?r2</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> measures_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> split<span class="main"><span class="keyword3">,</span></span> 
        <span class="operator">rule</span> psubset_card_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_Diff<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_Rs<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fin<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"R<span class="main">^*</span> <span class="main">``</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">un</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">tod</span><span class="main">)</span> <span class="main">-</span> insert <span class="skolem">a</span> <span class="skolem">fin</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"R<span class="main">^*</span> <span class="main">``</span> <span class="free">set_of</span> <span class="skolem">todo</span> <span class="main">-</span> <span class="skolem">fin</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> sel <span class="keyword1"><span class="command">have</span></span> at<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="skolem">todo</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nmem at <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⊂</span> <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≠</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ar <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"R<span class="main">^*</span> <span class="main">``</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">⊆</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">set_of</span> <span class="skolem">todo</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> cb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> R<span class="main">^*</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ca<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> R <span class="keyword1">O</span> R<span class="main">^*</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> R<span class="main">^*</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ ab<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">regexp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> at <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">set_of</span> <span class="skolem">todo</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⊆</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sel <span class="keyword1"><span class="command">unfolding</span></span> un <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
      
<span class="keyword1"><span class="command">declare</span></span> mk_rtrancl_main.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1" id="RTrancl-mk_rtrancl_main_sound"><span class="command">lemma</span></span> mk_rtrancl_main_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_of</span> <span class="free">todo</span> <span class="main">∪</span> <span class="free">fin</span> <span class="main">⊆</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">init</span> <span class="main">⟹</span> mk_rtrancl_main <span class="free">todo</span> <span class="free">fin</span> <span class="main">⊆</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">init</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">todo</span></span> <span class="quoted"><span class="free">fin</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> mk_rtrancl_main.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">todo</span> <span class="skolem">fin</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> mk_rtrancl_main.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">todo</span></span> <span class="quoted"><span class="skolem">fin</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">set_of</span> <span class="skolem">todo</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">using</span></span> True 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> nempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">set_of</span> <span class="skolem">todo</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">tod</span></span> <span class="keyword2"><span class="keyword">where</span></span> selt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sel</span> <span class="skolem">todo</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">tod</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">note</span></span> sel <span class="main">=</span> sel<span class="main">[</span><span class="operator">OF</span> False selt<span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> False refl selt<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> 1<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> False refl selt<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> simp nempty if_False Let_def selt
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">fin</span><span class="main">.</span> <span class="free">subsumes</span> <span class="bound">b</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mk_rtrancl_main <span class="skolem">todo</span> <span class="skolem">fin</span> <span class="main">=</span> mk_rtrancl_main <span class="skolem">tod</span> <span class="skolem">fin</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> IH1<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"mk_rtrancl_main <span class="skolem">todo</span> <span class="skolem">fin</span> <span class="main">=</span> mk_rtrancl_main <span class="main">(</span><span class="free">un</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">tod</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">fin</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> sel 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">set_of</span> <span class="skolem">todo</span> <span class="main">∪</span> insert <span class="skolem">a</span> <span class="skolem">fin</span> <span class="main">⊆</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">init</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
          <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> R"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> sel 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">init</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">init</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ca<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> R<span class="main">^*</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> ca ab <span class="keyword1"><span class="command">have</span></span> cb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> R<span class="main">^*</span> <span class="keyword1">O</span> R"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> R<span class="main">^*</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ cb<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">regexp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">init</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">with</span></span> subset
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">set_of</span> <span class="main">(</span><span class="free">un</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">tod</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">fin</span><span class="main">)</span> <span class="main">⊆</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">init</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> un <span class="keyword1"><span class="command">using</span></span> sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RTrancl-mk_rtrancl_main_complete"><span class="command">lemma</span></span> mk_rtrancl_main_complete<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⋀</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">init</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="free">todo</span> <span class="main">∪</span> <span class="free">fin</span> <span class="main">∧</span> <span class="free">subsumes</span> <span class="bound">b</span> <span class="bound">a</span><span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="main">⟦</span> <span class="main">⋀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">fin</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">r</span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="free">todo</span> <span class="main">∪</span> <span class="free">fin</span> <span class="main">∧</span> <span class="free">subsumes</span> <span class="bound">c</span> <span class="bound">b</span><span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">c</span> <span class="main">∈</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">init</span> 
  <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> mk_rtrancl_main <span class="free">todo</span> <span class="free">fin</span> <span class="main">∧</span> <span class="free">subsumes</span> <span class="bound">b</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">todo</span></span> <span class="quoted"><span class="free">fin</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> mk_rtrancl_main.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">todo</span> <span class="skolem">fin</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">init</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> finr <span class="main">=</span> 1<span class="main">(</span>4<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> init <span class="main">=</span> 1<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> mk_rtrancl_main.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">todo</span></span> <span class="quoted"><span class="skolem">fin</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">set_of</span> <span class="skolem">todo</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"mk_rtrancl_main <span class="skolem">todo</span> <span class="skolem">fin</span> <span class="main">=</span> <span class="skolem">fin</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> c <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">init</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> R<span class="main">^*</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> ac
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> base
      <span class="keyword1"><span class="command">from</span></span> init<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">∈</span> <span class="skolem">fin</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> db<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subsumes</span> <span class="skolem">d</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> cb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> subsumes_step<span class="main">[</span><span class="operator">OF</span> db cb<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subsumes</span> <span class="skolem">a</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> finr<span class="main">[</span><span class="operator">OF</span> d a<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="skolem">fin</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ea<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subsumes</span> <span class="skolem">e</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> subsumes_trans<span class="main">[</span><span class="operator">OF</span> ea ac<span class="main">]</span> e
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> nempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">set_of</span> <span class="skolem">todo</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">tod</span></span> <span class="keyword2"><span class="keyword">where</span></span> selt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sel</span> <span class="skolem">todo</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span><span class="skolem">tod</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> nempty simp if_False Let_def selt
    <span class="keyword1"><span class="command">note</span></span> sel <span class="main">=</span> sel<span class="main">[</span><span class="operator">OF</span> False selt<span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> False refl selt<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> _ _ _ c<span class="main">]</span>
    <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> 1<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> False refl selt<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> _ _ _ c<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">fin</span><span class="main">.</span> <span class="free">subsumes</span> <span class="bound">b</span> <span class="skolem">A</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> oTrue <span class="main">=</span> this
      <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"mk_rtrancl_main <span class="skolem">todo</span> <span class="skolem">fin</span> <span class="main">=</span> mk_rtrancl_main <span class="skolem">tod</span> <span class="skolem">fin</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">fin</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ba<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subsumes</span> <span class="skolem">b</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> True<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> 
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">init</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> init<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="skolem">todo</span> <span class="main">∪</span> <span class="skolem">fin</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ca<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subsumes</span> <span class="skolem">c</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>        
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="skolem">tod</span> <span class="main">∪</span> <span class="skolem">fin</span> <span class="main">∧</span> <span class="free">subsumes</span> <span class="bound">b</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c ca sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b subsumes_trans<span class="main">[</span><span class="operator">OF</span> ba<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> ca <span class="keyword1"><span class="command">unfolding</span></span> True<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">c</span>
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">fin</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> finr<span class="main">[</span><span class="operator">OF</span> a c<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="skolem">todo</span> <span class="main">∪</span> <span class="skolem">fin</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">subsumes</span> <span class="skolem">e</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="skolem">tod</span> <span class="main">∪</span> <span class="skolem">fin</span> <span class="main">∧</span> <span class="free">subsumes</span> <span class="bound">d</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">e</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> e ec <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">from</span></span> subsumes_trans<span class="main">[</span><span class="operator">OF</span> ba<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> True<span class="main"><span class="main">]</span></span> ec<span class="main">]</span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"mk_rtrancl_main <span class="skolem">todo</span> <span class="skolem">fin</span> <span class="main">=</span> mk_rtrancl_main <span class="main">(</span><span class="free">un</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">A</span><span class="main">)</span> <span class="skolem">tod</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">A</span> <span class="skolem">fin</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IH2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">init</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> init<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">un</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">(</span><span class="skolem">tod</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> insert <span class="skolem">A</span> <span class="skolem">fin</span> <span class="main">∧</span> <span class="free">subsumes</span> <span class="bound">b</span> <span class="skolem">a</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> sel <span class="keyword1"><span class="command">unfolding</span></span> un <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> insert <span class="skolem">A</span> <span class="skolem">fin</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="main">(</span><span class="free">un</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">A</span><span class="main">)</span> <span class="skolem">tod</span><span class="main">)</span> <span class="main">∪</span> insert <span class="skolem">A</span> <span class="skolem">fin</span> <span class="main">∧</span> <span class="free">subsumes</span> <span class="bound">c</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">fin</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">from</span></span> finr<span class="main">[</span><span class="operator">OF</span> True b<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sel <span class="keyword1"><span class="command">unfolding</span></span> un <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a un <span class="keyword1"><span class="command">using</span></span> b subsumes_refl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_rtrancl</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mk_rtrancl</span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="main">≡</span> mk_rtrancl_main <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="main">{}</span>"</span></span>

<span class="keyword1" id="RTrancl-mk_rtrancl_sound"><span class="command">lemma</span></span> mk_rtrancl_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"mk_rtrancl <span class="free">init</span> <span class="main">⊆</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">set_of</span> <span class="free">init</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mk_rtrancl_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mk_rtrancl_main_sound<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="RTrancl-mk_rtrancl_complete"><span class="command">lemma</span></span> mk_rtrancl_complete<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">set_of</span> <span class="free">init</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> mk_rtrancl <span class="free">init</span> <span class="main">∧</span> <span class="free">subsumes</span> <span class="bound">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mk_rtrancl_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> mk_rtrancl_main_complete<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ a<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> 
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="free">init</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">set_of</span> <span class="free">init</span> <span class="main">∪</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">subsumes</span> <span class="bound">b</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subsumes_refl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="RTrancl-mk_rtrancl_no_subsumption"><span class="command">lemma</span></span> mk_rtrancl_no_subsumption<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">subsumes</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mk_rtrancl <span class="free">init</span> <span class="main">=</span> R<span class="main">^*</span> <span class="main">``</span> <span class="free">set_of</span> <span class="free">init</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mk_rtrancl_sound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">init</span></span><span class="main">]</span> mk_rtrancl_complete<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">init</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Instantiation using list operations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹It follows an implementation based on lists. 
 Here, the working list algorithm is implemented outside the locale so that
 it can be used for code generation. In general, it is not terminating, 
 therefore we use partial\_function instead of function.›</span></span>

<span class="keyword1"><span class="command">partial_function</span></span><span class="main">(</span>tailrec<span class="main">)</span> <span class="entity">mk_rtrancl_list_main</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">mk_rtrancl_list_main</span> <span class="free"><span class="bound"><span class="entity">subsumes</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">todo</span></span></span> <span class="free"><span class="bound"><span class="entity">fin</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">todo</span></span></span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">fin</span></span></span>
     <span class="main">|</span> Cons <span class="bound">a</span> <span class="bound">tod</span> <span class="main">⇒</span> 
             <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">b</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">fin</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">subsumes</span></span></span> <span class="bound">b</span> <span class="bound">a</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">mk_rtrancl_list_main</span> <span class="free"><span class="bound"><span class="entity">subsumes</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">tod</span> <span class="free"><span class="bound"><span class="entity">fin</span></span></span>
                 <span class="keyword1">else</span> <span class="free">mk_rtrancl_list_main</span> <span class="free"><span class="bound"><span class="entity">subsumes</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">a</span> <span class="main">@</span> <span class="bound">tod</span><span class="main">)</span> <span class="main">(</span><span class="bound">a</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">fin</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_rtrancl_list</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">mk_rtrancl_list</span> <span class="free"><span class="bound"><span class="entity">subsumes</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="main">≡</span> mk_rtrancl_list_main <span class="free"><span class="bound"><span class="entity">subsumes</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">init</span></span></span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> subsumption_list <span class="main">=</span> subsumption <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">subsumes</span></span> <span class="quoted">set</span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">subsumes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">locale</span></span> relation_subsumption_list <span class="main">=</span> subsumption_list <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">subsumes</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">r</span> <span class="free">subsumes</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rtrancl_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span><span class="main">.</span> finite <span class="main">{</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">r</span> <span class="bound">a</span><span class="main">)</span><span class="main">}</span><span class="main">^*</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span><span class="main">(</span>input<span class="main">)</span> <span class="entity">sel_list</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sel_list</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> Cons <span class="bound">h</span> <span class="bound">t</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">h</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> subsumption_list <span class="main">⊆</span> subsumption_impl <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">subsumes</span></span> <span class="quoted">set</span> <span class="quoted">sel_list</span> <span class="quoted">append</span> <span class="quoted">length</span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_set<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">b</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sel_list <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">b</span> <span class="main">=</span> insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">c</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">c</span> <span class="main">&lt;</span> length <span class="skolem">b</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> relation_subsumption_list <span class="main">⊆</span> relation_subsumption_impl <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">subsumes</span></span> <span class="quoted">set</span> <span class="quoted">sel_list</span> <span class="quoted">append</span> <span class="quoted">length</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rtrancl_fin<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> relation_subsumption_list
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The main equivalence proof between the generic work list algorithm
and the one operating on lists›</span></span>
<span class="keyword1" id="RTrancl-mk_rtrancl_list_main"><span class="command">lemma</span></span> mk_rtrancl_list_main<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fin</span> <span class="main">=</span> set <span class="free">finl</span> <span class="main">⟹</span> set <span class="main">(</span>mk_rtrancl_list_main <span class="free">subsumes</span> <span class="free">r</span> <span class="free">todo</span> <span class="free">finl</span><span class="main">)</span> <span class="main">=</span> mk_rtrancl_main <span class="free">todo</span> <span class="free">fin</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">todo</span></span> <span class="quoted"><span class="free">fin</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">finl</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> mk_rtrancl_main.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">todo</span> <span class="skolem">fin</span> <span class="skolem">finl</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> simp <span class="main">=</span> mk_rtrancl_list_main.simps<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="skolem">todo</span></span> <span class="quoted"><span class="skolem">finl</span></span><span class="main">]</span> mk_rtrancl_main.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">todo</span></span> <span class="quoted"><span class="skolem">fin</span></span><span class="main">]</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">todo</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">unfolding</span></span> Nil 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">tod</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">fin</span><span class="main">.</span> <span class="free">subsumes</span> <span class="bound">b</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> set <span class="main">(</span>mk_rtrancl_list_main <span class="free">subsumes</span> <span class="free">r</span> <span class="skolem">tod</span> <span class="skolem">finl</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">unfolding</span></span> Cons 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> mk_rtrancl_main <span class="skolem">tod</span> <span class="skolem">fin</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">unfolding</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> l r
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ refl _ True<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> 1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Cons<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> set <span class="main">(</span>mk_rtrancl_list_main <span class="free">subsumes</span> <span class="free">r</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">a</span> <span class="main">@</span> <span class="skolem">tod</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">finl</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">unfolding</span></span> Cons 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> mk_rtrancl_main <span class="main">(</span><span class="free">r</span> <span class="skolem">a</span> <span class="main">@</span> <span class="skolem">tod</span><span class="main">)</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">fin</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> simp <span class="keyword1"><span class="command">unfolding</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> l r
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ refl _ False<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> 1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Cons<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="RTrancl-mk_rtrancl_list"><span class="command">lemma</span></span> mk_rtrancl_list<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>mk_rtrancl_list <span class="free">subsumes</span> <span class="free">r</span> <span class="free">init</span><span class="main">)</span> <span class="main">=</span> mk_rtrancl <span class="free">init</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mk_rtrancl_list_def mk_rtrancl_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mk_rtrancl_list_main<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>