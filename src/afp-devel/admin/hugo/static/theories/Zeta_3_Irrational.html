<div id="Zeta_3_Irrational">
<div class="head">
<h1>Theory Zeta_3_Irrational</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:   Zeta_3_Irrational.thy
  Author: Manuel Eberl, TU München
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Irrationality of $\zeta(3)$›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Zeta_3_Irrational
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../E_Transcendental/E_Transcendental.html">E_Transcendental.E_Transcendental</a>"</span>
  <span class="quoted">"<a href="../Prime_Number_Theorem/Prime_Number_Theorem.html">Prime_Number_Theorem.Prime_Number_Theorem</a>"</span>
  <span class="quoted">"<a href="../Prime_Distribution_Elementary/PNT_Consequences.html">Prime_Distribution_Elementary.PNT_Consequences</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Ap\'{e}ry's original proof of the irrationality of $\zeta(3)$ contained several
  tricky identities of sums involving binomial coefficients that are difficult to
  prove. I instead follow Beukers's proof, which consists of several fairly
  straightforward manipulations of integrals with absolutely no caveats.

  Both Ap\'{e}ry and Beukers make use of an asymptotic upper bound on
  $\text{lcm}\{1\ldots n\}$ -- namely $\text{lcm}\{1\ldots n\} \in o(c^n)$ for
  any $c &gt; e$, which is a consequence of the Prime Number Theorem (which, fortunately,
  is available in the \emph{Archive of Formal Proofs}~\cite{afp_primes1,afp_primes2}).

  I follow the concise presentation of Beukers's proof in Filaseta's lecture
  notes~\cite{filaseta}, which turned out to be very amenable to formalisation.

  There is another earlier formalisation of the irrationality of $\zeta(3)$ by
  Mahboubi\ \emph{et al.}~\cite{mahboubi}, who followed Ap\'{e}ry's original proof,
  but were ultimately forced to find a more elementary way to prove the asymptotics
  of $\text{lcm}\{1\ldots n\}$ than the Prime Number Theorem.

  First, we will require some auxiliary material before we get started with the actual
  proof.
›</span></span>

<span class="comment1">(* TODO: A lot of this (if not all of it) should really be in the library *)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary facts about polynomials›</span></span>

<span class="keyword1" id="Zeta_3_Irrational-degree_higher_pderiv"><span class="command">lemma</span></span> degree_higher_pderiv<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span> <span class="main">-</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_semiring_1<span class="main">,</span>semiring_no_zero_divisors<span class="main">,</span>semiring_char_0<span class="main">}</span> poly"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_pderiv<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-pcompose_power_left"><span class="command">lemma</span></span> pcompose_power_left<span class="main">:</span> <span class="quoted"><span class="quoted">"pcompose <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> pcompose <span class="free">p</span> <span class="free">q</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pcompose_mult pcompose_1<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-pderiv_sum"><span class="command">lemma</span></span> pderiv_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> pderiv <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pderiv_add<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-higher_pderiv_minus"><span class="command">lemma</span></span> higher_pderiv_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> idom poly<span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pderiv_minus<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-pderiv_power"><span class="command">lemma</span></span> pderiv_power<span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> smult <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> pderiv <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pderiv_power_Suc <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power_Suc<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-pderiv_monom"><span class="command">lemma</span></span> pderiv_monom<span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="main">(</span>monom <span class="free">c</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> monom <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_altdef pderiv_smult pderiv_power pderiv_pCons mult_ac<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-higher_pderiv_monom"><span class="command">lemma</span></span> higher_pderiv_monom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span>monom <span class="free">c</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> monom <span class="main">(</span>of_nat <span class="main">(</span>pochhammer <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pderiv_monom pochhammer_rec Suc_diff_le Suc_diff_Suc mult_ac<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-higher_pderiv_mult"><span class="command">lemma</span></span> higher_pderiv_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span>
     <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> Polynomial.smult <span class="main">(</span>of_nat <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="skolem">n</span> <span class="keyword1">choose</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="skolem">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pderiv <span class="main">^^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
          <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc pderiv_sum pderiv_smult pderiv_mult sum.distrib smult_add_right <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Suc_diff_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>insert <span class="main">0</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="bound">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted">Suc</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>insert <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="bound">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="main">(</span><span class="bound">k</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>pderiv <span class="main">^^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.insert<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                 <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">q</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="skolem">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                 <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">q</span> <span class="main">+</span> <span class="main">(</span>pderiv <span class="main">^^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.distrib <span class="dynamic"><span class="dynamic">algebra_simps</span></span> smult_add_right eq smult_add_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">∪</span><span class="main">{</span><span class="main">0</span><span class="main">,</span>Suc <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span>Suc <span class="skolem">n</span> <span class="keyword1">choose</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="main">-</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.union_disjoint<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span><span class="main">∪</span><span class="main">{</span><span class="main">0</span><span class="main">,</span>Suc <span class="skolem">n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{..</span>Suc <span class="skolem">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary facts about integrals›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_sigma_finite<span class="main">)</span> Fubini_set_integrable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span><span class="main">::</span><span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set_borel_measurable <span class="main">(</span><span class="free">M1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> integ1<span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable <span class="free">M1</span> <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∫</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span><span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> integ2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">in</span> <span class="free">M1</span><span class="main">.</span> set_integrable <span class="free">M2</span> <span class="free">B</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_integrable <span class="main">(</span><span class="free">M1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Fubini_integrable<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> integ1
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable <span class="free">M1</span> <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∫</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span><span class="free">M2</span><span class="main">)</span> <span class="main">⟷</span>
        integrable <span class="free">M1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">LINT</span> <span class="bound">y</span><span class="main">|</span><span class="free">M2</span><span class="main">.</span> norm <span class="main">(</span>indicat_real <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def set_lebesgue_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="main">…</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> integ2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M1</span><span class="main">.</span> integrable <span class="free">M2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> indicat_real <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> indicat_real <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> elim <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable <span class="free">M2</span> <span class="free">B</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> <span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def <span class="keyword1"><span class="command">using</span></span> True
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> integrable_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_sigma_finite<span class="main">)</span> set_integral_fst'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">::</span> <span class="main">{</span>second_countable_topology<span class="main">,</span> banach<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_integrable <span class="main">(</span><span class="free">M1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set_lebesgue_integral <span class="main">(</span><span class="free">M1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∂</span><span class="free">M2</span><span class="main">)</span> <span class="main">∂</span><span class="free">M1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_lebesgue_integral <span class="main">(</span><span class="free">M1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∫</span><span class="bound">z</span><span class="main">.</span> indicator <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">z</span> <span class="main">∂</span><span class="main">(</span><span class="free">M1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_lebesgue_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">∫</span><span class="bound">y</span><span class="main">.</span> indicator <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∂</span><span class="free">M2</span> <span class="main">∂</span><span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> integral_fst' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_integrable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∂</span><span class="free">M2</span><span class="main">)</span> <span class="main">∂</span><span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Bochner_Integration.integral_cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_sigma_finite<span class="main">)</span> set_integral_snd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">::</span> <span class="main">{</span>second_countable_topology<span class="main">,</span> banach<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_integrable <span class="main">(</span><span class="free">M1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set_lebesgue_integral <span class="main">(</span><span class="free">M1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span>
             <span class="main">(</span><span class="main">∫</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∂</span><span class="free">M1</span><span class="main">)</span> <span class="main">∂</span><span class="free">M2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_lebesgue_integral <span class="main">(</span><span class="free">M1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∫</span><span class="bound">z</span><span class="main">.</span> indicator <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="bound">z</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">z</span> <span class="main">∂</span><span class="main">(</span><span class="free">M1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_lebesgue_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">y</span><span class="main">.</span> <span class="main">∫</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∂</span><span class="free">M1</span> <span class="main">∂</span><span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> integral_snd<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_integrable_def case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∂</span><span class="free">M1</span><span class="main">)</span> <span class="main">∂</span><span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Bochner_Integration.integral_cong refl<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_sigma_finite<span class="main">)</span> Fubini_set_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable <span class="main">(</span><span class="free">M1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span>case_prod <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∂</span><span class="free">M1</span><span class="main">)</span> <span class="main">∂</span><span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∂</span><span class="free">M2</span><span class="main">)</span> <span class="main">∂</span><span class="free">M1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∂</span><span class="free">M1</span><span class="main">)</span> <span class="main">∂</span><span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∂</span><span class="free">M1</span><span class="main">)</span> <span class="main">∂</span><span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Bochner_Integration.integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">y</span><span class="main">.</span> indicator <span class="main">(</span><span class="free">A</span> <span class="main">×</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∂</span><span class="free">M2</span><span class="main">)</span> <span class="main">∂</span><span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Fubini_integral<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_integrable_def case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">y</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∂</span><span class="free">M2</span><span class="main">)</span> <span class="main">∂</span><span class="free">M1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Bochner_Integration.integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_sigma_finite<span class="main">)</span> nn_integral_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span><span class="free">M1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span><span class="main">(</span><span class="free">M1</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∂</span><span class="main">(</span><span class="free">M2</span> <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> <span class="free">M1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> distr_pair_swap<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> nn_integral_distr<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-set_integrable_bound"><span class="command">lemma</span></span> set_integrable_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">::</span><span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_integrable <span class="free">M</span> <span class="free">A</span> <span class="free">f</span> <span class="main">⟹</span> set_borel_measurable <span class="free">M</span> <span class="free">A</span> <span class="free">g</span> <span class="main">⟹</span>
           <span class="main">(</span><span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> set_integrable <span class="free">M</span> <span class="free">A</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> Bochner_Integration.integrable_bound<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Zeta_3_Irrational-set_integrableI_nonneg"><span class="command">lemma</span></span> set_integrableI_nonneg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_borel_measurable <span class="free">M</span> <span class="free">A</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_integrable <span class="free">M</span> <span class="free">A</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integrableI_nonneg<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="free">A</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> indicat_real <span class="free">A</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span>indicator <span class="free">A</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span>indicator <span class="free">A</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-set_integral_eq_nn_integral"><span class="command">lemma</span></span> set_integral_eq_nn_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_borel_measurable <span class="free">M</span> <span class="free">A</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_nn_integral <span class="free">M</span> <span class="free">A</span> <span class="free">f</span> <span class="main">=</span> ennreal <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set_integrable <span class="free">M</span> <span class="free">A</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"set_lebesgue_integral <span class="free">M</span> <span class="free">A</span> <span class="free">f</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> ennreal <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ennreal <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable <span class="free">M</span> <span class="free">A</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integrableI_nonneg<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_lebesgue_integral <span class="free">M</span> <span class="free">A</span> <span class="free">f</span> <span class="main">=</span> enn2real <span class="main">(</span>set_nn_integral <span class="free">M</span> <span class="free">A</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_lebesgue_integral_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> * eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> integral_eq_nn_integral<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def set_integrable_def mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_lebesgue_integral <span class="free">M</span> <span class="free">A</span> <span class="free">f</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-set_integral_0"><span class="command">lemma</span></span> set_integral_0 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable <span class="free">M</span> <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_integrable_def<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-set_integrable_sum"><span class="command">lemma</span></span> set_integrable_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> set_integrable <span class="free">M</span> <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_integrable <span class="free">M</span> <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_integral_add<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-set_integral_sum"><span class="command">lemma</span></span> set_integral_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span> <span class="main">::</span> <span class="main">{</span>banach<span class="main">,</span> second_countable_topology<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> set_integrable <span class="free">M</span> <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_lebesgue_integral <span class="free">M</span> <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">B</span><span class="main">.</span> set_lebesgue_integral <span class="free">M</span> <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> set_integral_add<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_integrable_sum<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Zeta_3_Irrational-set_nn_integral_cong"><span class="command">lemma</span></span> set_nn_integral_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> <span class="free">M'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> space <span class="free">M</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set_nn_integral <span class="free">M</span> <span class="free">A</span> <span class="free">f</span> <span class="main">=</span> set_nn_integral <span class="free">M'</span> <span class="free">B</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-set_nn_integral_mono"><span class="command">lemma</span></span> set_nn_integral_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> space <span class="free">M</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set_nn_integral <span class="free">M</span> <span class="free">A</span> <span class="free">f</span> <span class="main">≤</span> set_nn_integral <span class="free">M</span> <span class="free">A</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">F</span> <span class="keyword1">has_field_derivative</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> has_bochner_integral_FTC_Icc_real<span class="main">:</span>
      <span class="quoted"><span class="quoted">"has_bochner_integral lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">F</span> <span class="free">b</span> <span class="main">-</span> <span class="free">F</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?has</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> integral_FTC_Icc_real<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="bound">x</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> <span class="free">F</span> <span class="free">b</span> <span class="main">-</span> <span class="free">F</span> <span class="free">a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?eq</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">F</span> <span class="keyword1">has_vector_derivative</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> has_field_derivative_iff_has_vector_derivative<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> deriv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?has</span></span></span> <span class="var"><span class="quoted"><span class="var">?eq</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> has_bochner_integral_FTC_Icc<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>›</span></span> 1 cont<span class="main">]</span> integral_FTC_Icc<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>›</span></span> 1 cont<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-integral_by_parts_integrable"><span class="command">lemma</span></span> integral_by_parts_integrable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="free">F</span> <span class="free">G</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_f<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_g<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">F</span> <span class="keyword1">has_field_derivative</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">has_field_derivative</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"integrable lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">G</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> indicator <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable lborel <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">G</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> borel_integrable_compact <span class="dynamic"><span class="dynamic">continuous_intros</span></span> assms<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> DERIV_continuous_on assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-integral_by_parts"><span class="command">lemma</span></span> integral_by_parts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="free">F</span> <span class="free">G</span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_f<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_g<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">F</span> <span class="keyword1">has_field_derivative</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">has_field_derivative</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> indicator <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="bound">x</span> <span class="main">∂</span>lborel<span class="main">)</span>
            <span class="main">=</span>  <span class="free">F</span> <span class="free">b</span> <span class="main">*</span> <span class="free">G</span> <span class="free">b</span> <span class="main">-</span> <span class="free">F</span> <span class="free">a</span> <span class="main">*</span> <span class="free">G</span> <span class="free">a</span> <span class="main">-</span> <span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">G</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> indicator <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="bound">x</span> <span class="main">∂</span>lborel"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">G</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> indicator <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span> <span class="bound">x</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> <span class="free">F</span> <span class="free">b</span> <span class="main">*</span> <span class="free">G</span> <span class="free">b</span> <span class="main">-</span> <span class="free">F</span> <span class="free">a</span> <span class="main">*</span> <span class="free">G</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral_FTC_Icc_real<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> assms DERIV_continuous_on<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_continuous_on assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> DERIV_continuous_on assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">F</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">G</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span><span class="main">(</span><span class="free">F</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">+</span> <span class="main">∫</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">G</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∂</span>lborel"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Bochner_Integration.integral_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> borel_integrable_compact<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> assms<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> borel_integrable_compact<span class="main"><span class="keyword3">;</span></span> <span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-interval_lebesgue_integral_by_parts"><span class="command">lemma</span></span> interval_lebesgue_integral_by_parts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_f<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_g<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">F</span> <span class="keyword1">has_field_derivative</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">has_field_derivative</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span> <span class="free">b</span> <span class="main">*</span> <span class="free">G</span> <span class="free">b</span> <span class="main">-</span> <span class="free">F</span> <span class="free">a</span> <span class="main">*</span> <span class="free">G</span> <span class="free">a</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">G</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> integral_by_parts<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_integral_Icc set_lebesgue_integral_def mult_ac<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-interval_lebesgue_integral_by_parts_01"><span class="command">lemma</span></span> interval_lebesgue_integral_by_parts_01<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_f<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cont_g<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">F</span> <span class="keyword1">has_field_derivative</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">G</span> <span class="keyword1">has_field_derivative</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">F</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span> <span class="main">1</span> <span class="main">*</span> <span class="free">G</span> <span class="main">1</span> <span class="main">-</span> <span class="free">F</span> <span class="main">0</span> <span class="main">*</span> <span class="free">G</span> <span class="main">0</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">G</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> interval_lebesgue_integral_by_parts<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_ereal_def one_ereal_def<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-continuous_on_imp_set_integrable_cbox"><span class="command">lemma</span></span> continuous_on_imp_set_integrable_cbox<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> euclidean_space <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="keyword1">absolutely_integrable_on</span> cbox <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> absolutely_integrable_continuous<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicat_real <span class="main">(</span>cbox <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable borel"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> borel_measurable_continuous_on_indicator<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> integrable_completion<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Shifted Legendre polynomials›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The first ingredient we need to show Apéry's theorem is the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹shifted
  Legendre polynomials›</span></span>
    \[P_n(X) = \frac{1}{n!} \frac{\partial^n}{\partial X^n} (X^n(1-X)^n)\]
  and the auxiliary polynomials
    \[Q_{n,k}(X) = \frac{\partial^k}{\partial X^k} (X^n(1-X)^n)\ .\]
  Note that $P_n$ is in fact an \emph{integer} polynomial.

  Only some very basic properties of these will be proven, since that is all we will need.
›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gen_shleg_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gen_shleg_poly</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shleg_poly</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">shleg_poly</span> <span class="main">=</span> gen_shleg_poly <span class="free">n</span> <span class="keyword1">div</span> <span class="main">[:</span>fact <span class="free">n</span><span class="main">:]</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can easily prove the following more explicit formula for $Q_{n,k}$:
  \[Q_{n,k}(X) = \sum_{i=0}^k (-1)^{k-1} {k \choose i}
      n^{\underline{i}}\, n^{\underline{k-i}}\, X^{n-i}\, (1-X)^{n-k+i}\]
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-gen_shleg_poly_altdef"><span class="command">lemma</span></span> gen_shleg_poly_altdef<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gen_shleg_poly <span class="free">k</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> smult <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span>
                    pochhammer <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">k</span><span class="main">+</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">k</span><span class="main">+</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span>
          smult <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pderiv_smult pderiv_pcompose funpow_Suc_right pderiv_pCons
                   higher_pderiv_minus <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> funpow.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen_shleg_poly <span class="free">k</span> <span class="main">=</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_shleg_poly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">::</span>int<span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pderiv <span class="main">^^</span> <span class="free">k</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span>
                 <span class="main">(</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> higher_pderiv_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> smult <span class="main">(</span>of_nat <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>monom <span class="main">1</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>monom <span class="main">1</span> <span class="free">n</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_altdef pcompose_pCons pcompose_power_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> smult <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>monom <span class="main">1</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>pderiv <span class="main">^^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>monom <span class="main">1</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> * mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> smult <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">(</span>monom <span class="main">(</span>pochhammer <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span>
                    monom <span class="main">(</span>pochhammer <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">∘<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> higher_pderiv_monom<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> smult <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">(</span><span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">-</span><span class="main">1</span><span class="main">:]</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_altdef <span class="dynamic"><span class="dynamic">algebra_simps</span></span> pcompose_smult pcompose_power_left pcompose_pCons<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-degree_gen_shleg_poly"><span class="command">lemma</span></span> degree_gen_shleg_poly <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>gen_shleg_poly <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">n</span> <span class="main">-</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_shleg_poly_def degree_higher_pderiv degree_power_eq<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-gen_shleg_poly_n"><span class="command">lemma</span></span> gen_shleg_poly_n<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_shleg_poly <span class="free">n</span> <span class="main">=</span> smult <span class="main">(</span>fact <span class="free">n</span><span class="main">)</span> shleg_poly"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_shleg_poly <span class="free">n</span> <span class="main">=</span> <span class="main">[:</span>fact <span class="free">n</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> gen_shleg_poly_def <span class="keyword1"><span class="command">using</span></span> fact_dvd_higher_pderiv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">-</span><span class="main">1</span><span class="main">:]</span><span class="main">^</span><span class="free">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"smult <span class="main">(</span>fact <span class="free">n</span><span class="main">)</span> shleg_poly <span class="main">=</span> smult <span class="main">(</span>fact <span class="free">n</span><span class="main">)</span> <span class="main">(</span>gen_shleg_poly <span class="free">n</span> <span class="keyword1">div</span> <span class="main">[:</span>fact <span class="free">n</span><span class="main">:]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shleg_poly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> r
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span>fact <span class="free">n</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">r</span> <span class="keyword1">div</span> <span class="main">[:</span>fact <span class="free">n</span><span class="main">:]</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nonzero_mult_div_cancel_left<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-degree_shleg_poly"><span class="command">lemma</span></span> degree_shleg_poly <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree shleg_poly <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> degree_gen_shleg_poly<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_shleg_poly_n<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-pderiv_gen_shleg_poly"><span class="command">lemma</span></span> pderiv_gen_shleg_poly <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="main">(</span>gen_shleg_poly <span class="free">k</span><span class="main">)</span> <span class="main">=</span> gen_shleg_poly <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_shleg_poly_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following functions are the interpretation of the shifted Legendre polynomials
  and the auxiliary polynomials as a function from reals to reals.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Gen_Shleg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Gen_Shleg</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> poly <span class="main">(</span>of_int_poly <span class="main">(</span>gen_shleg_poly <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Shleg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Shleg</span> <span class="main">=</span> poly <span class="main">(</span>of_int_poly shleg_poly<span class="main">)</span>"</span></span>

<span class="keyword1" id="Zeta_3_Irrational-Gen_Shleg_altdef"><span class="command">lemma</span></span> Gen_Shleg_altdef<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Gen_Shleg <span class="free">k</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">*</span> of_nat <span class="main">(</span><span class="free">k</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span>
                            of_int <span class="main">(</span>pochhammer <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span> <span class="main">*</span> pochhammer <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">k</span><span class="main">+</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                            <span class="free">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">k</span><span class="main">+</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gen_Shleg_def gen_shleg_poly_altdef poly_sum mult_ac<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-Gen_Shleg_0"><span class="command">lemma</span></span> Gen_Shleg_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> Gen_Shleg <span class="free">k</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gen_Shleg_altdef zero_power<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-Gen_Shleg_1"><span class="command">lemma</span></span> Gen_Shleg_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> Gen_Shleg <span class="free">k</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gen_Shleg_altdef zero_power<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-Gen_Shleg_n_0"><span class="command">lemma</span></span> Gen_Shleg_n_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Gen_Shleg <span class="free">n</span> <span class="main">0</span> <span class="main">=</span> fact <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gen_Shleg <span class="free">n</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">*</span> real <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span>
        <span class="main">(</span>real <span class="main">(</span>pochhammer <span class="main">(</span>Suc <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span>
         real <span class="main">(</span>pochhammer <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">0</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gen_Shleg_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">*</span> real <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span>
        <span class="main">(</span>real <span class="main">(</span>pochhammer <span class="main">(</span>Suc <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span>
         real <span class="main">(</span>pochhammer <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">0</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> fact <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pochhammer_fact <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> pochhammer_of_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-Gen_Shleg_n_1"><span class="command">lemma</span></span> Gen_Shleg_n_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Gen_Shleg <span class="free">n</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> fact <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Gen_Shleg <span class="free">n</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">*</span> real <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span>
        <span class="main">(</span>real <span class="main">(</span>pochhammer <span class="main">(</span>Suc <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span>
         real <span class="main">(</span>pochhammer <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">0</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gen_Shleg_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span> <span class="main">*</span> real <span class="main">(</span><span class="free">n</span> <span class="keyword1">choose</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span>
        <span class="main">(</span>real <span class="main">(</span>pochhammer <span class="main">(</span>Suc <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span> <span class="main">*</span>
         real <span class="main">(</span>pochhammer <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">0</span> <span class="main">^</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.mono_neutral_right<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> fact <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pochhammer_fact <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> pochhammer_of_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-Shleg_altdef"><span class="command">lemma</span></span> Shleg_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"Shleg <span class="free">x</span> <span class="main">=</span> Gen_Shleg <span class="free">n</span> <span class="free">x</span> <span class="main">/</span> fact <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Shleg_def Gen_Shleg_def gen_shleg_poly_n<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-Shleg_0"><span class="command">lemma</span></span> Shleg_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Shleg <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Shleg_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Shleg <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Shleg_altdef<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-Gen_Shleg_0_left"><span class="command">lemma</span></span> Gen_Shleg_0_left<span class="main">:</span> <span class="quoted"><span class="quoted">"Gen_Shleg <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gen_Shleg_def gen_shleg_poly_def power_mult_distrib<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-has_field_derivative_Gen_Shleg"><span class="command">lemma</span></span> has_field_derivative_Gen_Shleg<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Gen_Shleg <span class="free">k</span> <span class="keyword1">has_field_derivative</span> Gen_Shleg <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span> <span class="main">=</span> poly_DERIV
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Gen_Shleg_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-continuous_on_Gen_Shleg"><span class="command">lemma</span></span> continuous_on_Gen_Shleg<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> <span class="main">(</span>Gen_Shleg <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Gen_Shleg_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-continuous_on_Gen_Shleg'"><span class="command">lemma</span></span> continuous_on_Gen_Shleg' <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> <span class="free">f</span> <span class="main">⟹</span> continuous_on <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Gen_Shleg <span class="free">k</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_compose2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> continuous_on_Gen_Shleg<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Zeta_3_Irrational-continuous_on_Shleg"><span class="command">lemma</span></span> continuous_on_Shleg<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> Shleg"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Shleg_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-continuous_on_Shleg'"><span class="command">lemma</span></span> continuous_on_Shleg' <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"continuous_on <span class="free">A</span> <span class="free">f</span> <span class="main">⟹</span> continuous_on <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Shleg <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_compose2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> continuous_on_Shleg<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted">UNIV</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Zeta_3_Irrational-measurable_Gen_Shleg"><span class="command">lemma</span></span> measurable_Gen_Shleg <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Gen_Shleg <span class="free">n</span> <span class="main">∈</span> borel_measurable borel"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> borel_measurable_continuous_onI continuous_on_Gen_Shleg<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-measurable_Shleg"><span class="command">lemma</span></span> measurable_Shleg <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Shleg <span class="main">∈</span> borel_measurable borel"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> borel_measurable_continuous_onI continuous_on_Shleg<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary facts about the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ζ›</span></span></span></span> function›</span></span>

<span class="keyword1" id="Zeta_3_Irrational-Re_zeta_ge_1"><span class="command">lemma</span></span> Re_zeta_ge_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"Re <span class="main">(</span>zeta <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="keyword1">sums</span> Re <span class="main">(</span>zeta <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sums_Re<span class="main">[</span><span class="operator">OF</span> sums_zeta<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_real <span class="free">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_Reals_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>zeta <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sums_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ *<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_single<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-sums_zeta_of_nat_offset"><span class="command">lemma</span></span> sums_zeta_of_nat_offset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span>zeta <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">sums</span> zeta <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sums_zeta<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_nat <span class="free">n</span>"</span></span><span class="main">]</span> n
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> of_nat_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sums_split_initial_segment<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span>zeta <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> Suc <span class="bound">k</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">&lt;</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> Suc <span class="bound">k</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted">Suc</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-sums_Re_zeta_of_nat_offset"><span class="command">lemma</span></span> sums_Re_zeta_of_nat_offset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> Re <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">sums</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_Re sums_zeta_of_nat_offset assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Divisor of a sum of rationals›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A finite sum of rationals of the form $\frac{a_1}{b_1} + \ldots + \frac{a_n}{b_n}$
  can be brought into the form $\frac{c}{d}$, where $d$ is the LCM of the $b_i$ (or
  some integer multiple thereof).
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-sum_rationals_common_divisor"><span class="command">lemma</span></span> sum_rationals_common_divisor<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> int"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> real_of_int <span class="bound">c</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> insert <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def Lcm_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> insert <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> insert <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> real_of_int <span class="skolem">c</span> <span class="main">/</span> real_of_int <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">=</span> lcm <span class="skolem">d</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">d</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">=</span> lcm <span class="skolem">d</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">y</span><span class="main">∈</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">/</span> <span class="skolem">d</span> <span class="main">+</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">/</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert c <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">/</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">e1</span><span class="main">)</span> <span class="main">/</span> lcm <span class="skolem">d</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e1_def real_of_int_div<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">/</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">/</span> lcm <span class="skolem">d</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e2_def real_of_int_div<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">e1</span><span class="main">)</span> <span class="main">/</span> lcm <span class="skolem">d</span> <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="main">+</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span>insert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_divide_distrib lcm.commute d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-sum_rationals_common_divisor'"><span class="command">lemma</span></span> sum_rationals_common_divisor'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> int"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">dvd</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> real_of_int <span class="bound">c</span> <span class="main">/</span> real_of_int <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="keyword1">dvd</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> d'_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Lcm_dvd_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> real_of_int <span class="bound">c</span> <span class="main">/</span> <span class="main">(</span><span class="keyword1">LCM</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_rationals_common_divisor<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> real_of_int <span class="skolem">c</span> <span class="main">/</span> real_of_int <span class="skolem">d'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> d'_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real_of_int <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The first double integral›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We shall now investigate the double integral
  \[I_1 := \int_0^1 \int_0^1 -\frac{\ln(xy)}{1-xy}\,x^r y^s\, \text{d}x\,\text{d}y\ .\]
  Since everything is non-negative for now, we can work over the extended non-negative
  real numbers and the issues of integrability or summability do not arise at all.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">beukers_nn_integral1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> ennreal"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">beukers_nn_integral1</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">beukers_integral1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">beukers_integral1</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> beukers_denom_ineq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> beukers_denom_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> xyz <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xyz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xyz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_right_mono<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We first evaluate the improper integral
    \[\int_0^1 -\ln x \cdot x^e\,\text{d}x = \frac{1}{(e+1)^2}\ .\]
  for any $e&gt;-1$.
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-integral_0_1_ln_times_powr"><span class="command">lemma</span></span> integral_0_1_ln_times_powr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">-</span>ln <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">e</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>ln <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span>ln <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">e</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">e</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"isCont <span class="skolem">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="keyword1">has_real_derivative</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span> <span class="keyword1">has_real_derivative</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> F_def f_def <span class="keyword1"><span class="command">using</span></span> that assms
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> that assms<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span> powr_add power_numeral_reduce<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> lborel<span class="main">.</span> ereal <span class="main">0</span> <span class="main">&lt;</span> ereal <span class="bound">x</span> <span class="main">⟶</span> ereal <span class="bound">x</span> <span class="main">&lt;</span> ereal <span class="main">1</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> AE_I2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def mult_nonpos_nonneg<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">F</span> <span class="main">∘</span> real_of_ereal<span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>at_right <span class="main">(</span>ereal <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ereal_tendsto_simps F_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">F</span> <span class="main">∘</span> real_of_ereal<span class="main">)</span> <span class="main">⤏</span> <span class="skolem">F</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>at_left <span class="main">(</span>ereal <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ereal_tendsto_simps F_def
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">real_asymp</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span>ereal <span class="main">0</span><span class="main">..</span>ereal <span class="main">1</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">F</span> <span class="main">1</span> <span class="main">-</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> interval_integral_FTC_nonneg<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">F</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">use</span> 0 1 2 3 4 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">-</span>ln <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">e</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_def zero_ereal_def one_ereal_def f_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span>einterval <span class="main">(</span>ereal <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ereal <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> interval_integral_FTC_nonneg<span class="main">)</span>
       <span class="main">(</span><span class="operator">use</span> 0 1 2 3 4 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">0</span> <span class="main">1</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integrable_def einterval_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-interval_lebesgue_integral_lborel_01_cong"><span class="command">lemma</span></span> interval_lebesgue_integral_lborel_01_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"interval_lebesgue_integral lborel <span class="main">0</span> <span class="main">1</span> <span class="free">f</span> <span class="main">=</span>
           interval_lebesgue_integral lborel <span class="main">0</span> <span class="main">1</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> interval_integral_Ioo<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_lebesgue_integral_cong assms<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-nn_integral_0_1_ln_times_powr"><span class="command">lemma</span></span> nn_integral_0_1_ln_times_powr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span> <span class="keyword1">powr</span> <span class="free">e</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">e</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">e</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">e</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"interval_lebesgue_integrable lborel <span class="main">0</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> ln <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_0_1_ln_times_powr<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">*</span> ln <span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span> <span class="keyword1">powr</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="keyword1">then</span> ln <span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span> <span class="keyword1">powr</span> <span class="free">e</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span> <span class="keyword1">powr</span> <span class="free">e</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span> <span class="keyword1">powr</span> <span class="free">e</span> <span class="main">*</span> indicator <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">e</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_eq_integral<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> AE_I2 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def interval_lebesgue_integrable_def
               set_integrable_def one_ereal_def zero_ereal_def interval_integral_Ioo
                mult_ac mult_nonpos_nonneg set_lebesgue_integral_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-nn_integral_0_1_ln_times_power"><span class="command">lemma</span></span> nn_integral_0_1_ln_times_power<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span> <span class="keyword1">powr</span> real <span class="free">n</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_nn_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_realpow<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_0_1_ln_times_powr<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Next, we also evaluate the more trivial integral
    \[\int_0^1 x^n\ \text{d}x\ .\]
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-nn_integral_0_1_power"><span class="command">lemma</span></span> nn_integral_0_1_power<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="bound">y</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> real <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> <span class="skolem">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="bound">y</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="bound">y</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong_AE AE_I<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def emeasure_lborel_countable<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">1</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">0</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_FTC_Icc<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  $I_1$ can alternatively be written as the triple integral
    \[\int_0^1\int_0^1\int_0^1
        \frac{x^r y^s}{1-(1-xy)w}\ \text{d}x\,\text{d}y\,\text{d}w\ .\]
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_nn_integral1_altdef"><span class="command">lemma</span></span> beukers_nn_integral1_altdef<span class="main">:</span>
  <span class="quoted"><span class="quoted">"beukers_nn_integral1 <span class="free">r</span> <span class="free">s</span> <span class="main">=</span>
     <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">w</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span>
       ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="free">r</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="free">s</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">w</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span>
           ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="free">r</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="free">s</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">w</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span>
           ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="free">r</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="free">s</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_prod <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> lborel_pair.nn_integral_snd <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold indicator_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lborel_prod <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="free">r</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="free">s</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">w</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">*</span><span class="skolem">x</span><span class="main">^</span><span class="free">r</span><span class="main">*</span><span class="skolem">y</span><span class="main">^</span><span class="free">s</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
             ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">x</span><span class="main">^</span><span class="free">r</span><span class="main">*</span><span class="skolem">y</span><span class="main">^</span><span class="free">s</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> xy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> <span class="main">-</span>ln <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span>
              <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">w</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> xy w <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> beukers_denom_ineq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">w</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">*</span><span class="skolem">x</span><span class="main">^</span><span class="free">r</span><span class="main">*</span><span class="skolem">y</span><span class="main">^</span><span class="free">s</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
              ennreal <span class="main">(</span><span class="skolem">x</span><span class="main">^</span><span class="free">r</span><span class="main">*</span><span class="skolem">y</span><span class="main">^</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">w</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_cmult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ennreal_mult'<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">w</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
                 <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">w</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_cong_AE AE_I<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emeasure_lborel_countable indicator_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">w</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
                   ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="main">0</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xy deriv less_imp_le<span class="main">[</span><span class="operator">OF</span> beukers_denom_ineq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_FTC_Icc<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> xy
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ennreal_mult' ennreal_mult'' <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">w</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">*</span><span class="skolem">x</span><span class="main">^</span><span class="free">r</span><span class="main">*</span><span class="skolem">y</span><span class="main">^</span><span class="free">s</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">*</span> indicator <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span>
           ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">x</span><span class="main">^</span><span class="free">r</span><span class="main">*</span><span class="skolem">y</span><span class="main">^</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> indicator <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> beukers_nn_integral1 <span class="free">r</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> beukers_nn_integral1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="free">s</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">I1</span> <span class="free">I2'</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">I2</span> <span class="main">::</span> <span class="quoted">ennreal</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">×</span> real <span class="main">×</span> real<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">≡</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  By unfolding the geometric series, pulling the summation out and evaluating the integrals,
  we find that
    \[I_1 = \sum_{k=0}^\infty \frac{1}{(k+r+1)^2(k+s+1)} + \frac{1}{(k+r+1)(k+s+1)^2}\ .\]
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_nn_integral1_series"><span class="command">lemma</span></span> beukers_nn_integral1_series<span class="main">:</span>
  <span class="quoted"><span class="quoted">"beukers_nn_integral1 <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"beukers_nn_integral1 <span class="free">r</span> <span class="free">s</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> beukers_nn_integral1_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_nn_integral_cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> xy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">^</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="free">r</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">^</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_suminf_cmult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> ennreal_mult'' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_add mult_ac power_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> geometric_sums<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_ennreal_eq<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="free">r</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">^</span><span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span>
                 ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="free">r</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">^</span><span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_mult'' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="free">r</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">^</span><span class="free">s</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">^</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_suminf <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_cong<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold lborel_prod <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel.nn_integral_fst <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_nn_integral_cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>ennreal <span class="main">(</span><span class="main">-</span>ln <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">y</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_nn_integral_cong<span class="main">)</span>
           <span class="main">(</span><span class="operator">use</span> x <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> ln_mult ring_distribs mult_nonpos_nonneg <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main">:</span> ennreal_plus›</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">+</span>
                      <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">y</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
                 ennreal <span class="main">(</span><span class="main">-</span>ln <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_cmult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ennreal_mult''<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_0_1_power<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span><span class="main">-</span>ln <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_mult'' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">y</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
                   ennreal <span class="main">(</span><span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_cmult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">use</span> x <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> nn_integral_cong <span class="quasi_keyword">simp</span><span class="main">:</span> indicator_def mult_ac <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main">:</span> ennreal_mult'›</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_0_1_ln_times_power<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span><span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_mult'' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span><span class="main">-</span> ln <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span>
                   ennreal <span class="main">(</span><span class="main">-</span>ln <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_plus<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_nonpos_nonneg divide_nonpos_nonneg<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">y</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
                      ennreal <span class="main">(</span><span class="main">-</span>ln <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                       ennreal <span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_nn_integral_cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> ennreal_plus<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_nonpos_nonneg divide_nonpos_nonneg<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_add <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
                  ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_cmult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ennreal_mult'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_0_1_ln_times_power<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> ennreal_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
                  ennreal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_cmult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ennreal_mult'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_0_1_power<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> ennreal_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span>
                 ennreal <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_plus <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Remembering that $\zeta(3) = \sum k^{-3}$, it is easy to see that if $r = s$, this sum is simply
    \[2\left(\zeta(3) - \sum_{k=1}^r \frac{1}{k^3}\right)\ .\]
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_nn_integral1_same"><span class="command">lemma</span></span> beukers_nn_integral1_same<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"beukers_nn_integral1 <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"beukers_nn_integral1 <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> ennreal <span class="main">(</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> beukers_nn_integral1_series
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms power_Suc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">x</span><span class="main"><span class="main">]</span></span> *
                   times_divide_eq_right mult_1_right add_ac <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> mult_2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span> <span class="keyword1">sums</span>
              <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sums_mult<span class="main">[</span><span class="operator">OF</span> sums_Re_zeta_of_nat_offset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">.</span> ennreal <span class="main">(</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="main">…</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_ennreal_eq<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"beukers_nn_integral1 <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sums_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ sums_zero **<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_integral1_same"><span class="command">lemma</span></span> beukers_integral1_same<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"beukers_integral1 <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">^</span> <span class="free">r</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">^</span> <span class="free">s</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">using</span></span> that mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonpos_nonneg divide_nonpos_nonneg<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> beukers_nn_integral1_same<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> beukers_nn_integral1_def beukers_integral1_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integral_eq_nn_integral AE_I2<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lborel_prod <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold set_borel_measurable_def
             <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> divide_nonpos_nonneg mult_nonpos_nonneg<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In contrast, for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>r &gt; s›</span></span></span></span>, we find that
    \[I_1 = \frac{1}{r-s} \sum_{k=s+1}^r \frac{1}{k^2}\ .\]
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_nn_integral1_different"><span class="command">lemma</span></span> beukers_nn_integral1_different<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"beukers_nn_integral1 <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="free">s</span><span class="main">&lt;..</span><span class="free">r</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
          <span class="keyword1">sums</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>Re <span class="main">(</span>zeta <span class="main">(</span>of_nat <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">s</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="bound">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                               <span class="main">(</span>Re <span class="main">(</span>zeta <span class="main">(</span>of_nat <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="bound">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="keyword1">sums</span> <span class="var">?S</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sums_mult sums_diff sums_Re_zeta_of_nat_offset<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="bound">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">s</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="bound">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> diff_divide_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="bound">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="free">s</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="bound">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">}</span><span class="main">-</span><span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">s</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span><span class="main">/</span><span class="bound">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Groups_Big.sum_diff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">r</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">s</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">s</span><span class="main">&lt;..</span><span class="free">r</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="free">s</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> real <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">r</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> real <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="free">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x_def y_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real <span class="free">r</span> <span class="main">-</span> real <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square x_def y_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> of_nat_diff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_def y_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> beukers_nn_integral1_series <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> suminf_ennreal_eq<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_integral1_different"><span class="command">lemma</span></span> beukers_integral1_different<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"beukers_integral1 <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="free">s</span><span class="main">&lt;..</span><span class="free">r</span><span class="main">}</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">^</span> <span class="free">r</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">^</span> <span class="free">s</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">using</span></span> that mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonpos_nonneg divide_nonpos_nonneg<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> beukers_nn_integral1_different<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> beukers_nn_integral1_def beukers_integral1_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integral_eq_nn_integral AE_I2<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lborel_prod <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold set_borel_measurable_def
             <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> divide_nonpos_nonneg mult_nonpos_nonneg <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_nonneg divide_nonneg_nonneg<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  It is also easy to see that if we exchange <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>r›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s›</span></span></span></span>, nothing changes.
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_nn_integral1_swap"><span class="command">lemma</span></span> beukers_nn_integral1_swap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"beukers_nn_integral1 <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> beukers_nn_integral1 <span class="free">s</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> beukers_nn_integral1_def lborel_prod <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_pair.nn_integral_swap<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="main">(</span><span class="operator">intro</span> nn_integral_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_nn_integral1_finite"><span class="command">lemma</span></span> beukers_nn_integral1_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"beukers_nn_integral1 <span class="free">r</span> <span class="free">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> beukers_nn_integral1_different<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> beukers_nn_integral1_different<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
     <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> beukers_nn_integral1_same beukers_nn_integral1_swap<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_integral1_integrable"><span class="command">lemma</span></span> beukers_integral1_integrable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>
     <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="free">r</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="free">s</span> <span class="main">::</span> real<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_integrableI_nonneg AE_I2<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≥</span> ln <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">^</span> <span class="free">r</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">^</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonpos_nonneg divide_nonpos_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> xy <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">-</span> ln <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">^</span> <span class="free">r</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">^</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span>
           <span class="main">-</span> ln <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">r</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">^</span> <span class="free">s</span><span class="main">)</span> <span class="main">∂</span>lborel <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> beukers_nn_integral1_finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> beukers_nn_integral1_def case_prod_unfold<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lborel_prod <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_integral1_integrable'"><span class="command">lemma</span></span> beukers_integral1_integrable'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>
     <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">^</span><span class="free">r</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="free">s</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_integrableI_nonneg AE_I2<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> xyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">^</span><span class="free">r</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">^</span><span class="free">s</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> xyz beukers_denom_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_nonneg_nonneg divide_nonneg_nonneg<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span>
           <span class="bound">x</span> <span class="main">^</span> <span class="free">r</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">^</span> <span class="free">s</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> beukers_nn_integral1_finite
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> beukers_nn_integral1_altdef case_prod_unfold<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lborel_prod <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_borel_measurable_def<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_integral1_conv_nn_integral"><span class="command">lemma</span></span> beukers_integral1_conv_nn_integral<span class="main">:</span>
  <span class="quoted"><span class="quoted">"beukers_integral1 <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> enn2real <span class="main">(</span>beukers_nn_integral1 <span class="free">r</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">^</span> <span class="free">r</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">^</span> <span class="free">s</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">using</span></span> mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_nonpos_nonneg mult_nonpos_nonneg<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> beukers_integral1_def <span class="keyword1"><span class="command">using</span></span> beukers_nn_integral1_finite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integral_eq_nn_integral<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold beukers_nn_integral1_def
                   set_borel_measurable_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod
             <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> AE_I2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> divide_nonpos_nonneg mult_nonpos_nonneg<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_integral1_swap"><span class="command">lemma</span></span> beukers_integral1_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"beukers_integral1 <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> beukers_integral1 <span class="free">s</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> beukers_integral1_conv_nn_integral beukers_nn_integral1_swap<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The second double integral›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">n</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">×</span> real<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">D'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">×</span> real <span class="main">×</span> real<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">≡</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">D'</span> <span class="main">≡</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≡</span> Gen_Shleg <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≡</span> Shleg <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The next integral to consider is the following variant of $I_1$:
  \[I_2 :=
      \int_0^1 \int_0^1 -\frac{\ln(xy)}{1-xy} P_n(x) P_n(y)\,\text{d}x\,\text{d}y\ .\]
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">beukers_integral2</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">beukers_integral2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  $I_2$ is simply a sum of integrals of type $I_1$, so using our results for
  $I_1$, we can write $I_2$ in the form $A \zeta(3) + \frac{B}{\text{lcm}\{1\ldots n\}^3}$
  where $A$ and $B$ are integers and $A &gt; 0$:
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_integral2_conv_int_combination"><span class="command">lemma</span></span> beukers_integral2_conv_int_combination<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">A</span> <span class="free">B</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"beukers_integral2 <span class="main">=</span> of_int <span class="free">A</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> of_int <span class="free">B</span> <span class="main">/</span> of_nat <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Set.filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">×</span><span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Set.filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">×</span><span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I4</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Set.filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&gt;</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">×</span><span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> shleg_poly <span class="free">n</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="bound">i</span><span class="main">:</span><span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SIGMA</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">:</span><span class="var">?I4</span><span class="main">.</span> <span class="main">{</span><span class="bound">j</span><span class="main">&lt;..</span><span class="bound">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> beukers_integral1"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> poly.coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B1</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">∈</span><span class="skolem">I</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="main">-</span><span class="numeral">2</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="bound">k</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">B2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B2</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">,</span><span class="bound">k</span><span class="main">)</span><span class="main">∈</span><span class="skolem">J</span><span class="main">.</span> real_of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span><span class="main">)</span> <span class="main">/</span> real_of_int <span class="main">(</span><span class="bound">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="bound">i</span><span class="main">-</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">^</span> <span class="numeral">3</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">h</span> <span class="skolem">j</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h_def beukers_integral1_swap<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"beukers_integral2 <span class="main">=</span>
        <span class="main">(</span><span class="main">∫</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">×</span><span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span>
           <span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">^</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> beukers_integral2_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.cartesian_product <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_altdef P_def Shleg_def mult_ac case_prod_unfold p_def
                  sum_distrib_left sum_distrib_right sum_negf sum_divide_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">×</span><span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> set_integral_sum<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ij</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">×</span> nat"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="free">D</span>
          <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> real_of_int <span class="main">(</span>coeff <span class="skolem">p</span> <span class="main">(</span>fst <span class="skolem">ij</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="main">(</span>snd <span class="skolem">ij</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                 <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">^</span> fst <span class="skolem">ij</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">^</span> snd <span class="skolem">ij</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold <span class="keyword1"><span class="command">using</span></span> beukers_integral1_integrable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">ij</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">ij</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integrable_mult_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def case_prod_unfold<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="free">D</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">pa</span><span class="main">.</span> real_of_int <span class="main">(</span>coeff <span class="skolem">p</span> <span class="main">(</span>fst <span class="skolem">ij</span><span class="main">)</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="main">(</span>snd <span class="skolem">ij</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
                 <span class="main">-</span>ln <span class="main">(</span>fst <span class="bound">pa</span> <span class="main">*</span> snd <span class="bound">pa</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fst <span class="bound">pa</span> <span class="main">*</span> snd <span class="bound">pa</span><span class="main">)</span> <span class="main">*</span> fst <span class="bound">pa</span> <span class="main">^</span> fst <span class="skolem">ij</span> <span class="main">*</span> snd <span class="bound">pa</span> <span class="main">^</span> snd <span class="skolem">ij</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> beukers_integral1_def h_def case_prod_unfold mult.assoc D_def
            <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> set_integral_mult_right<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="var">?I1</span><span class="main">∪</span><span class="var">?I2</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="var">?I1</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">+</span>
                  <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="var">?I2</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.union_disjoint<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="var">?I1</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> h_def D_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> beukers_integral1_same<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="skolem">A</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">-</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">=</span><span class="main">1</span><span class="main">..</span><span class="bound">i</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_subtractf sum_distrib_left sum_distrib_right <span class="dynamic"><span class="dynamic">algebra_simps</span></span> A_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_int <span class="skolem">A</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">B1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> I_def B1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.Sigma <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_distrib_left sum_negf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="var">?I2</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="var">?I3</span><span class="main">∪</span><span class="var">?I4</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="var">?I3</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">+</span>
                  <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="var">?I4</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.union_disjoint<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="var">?I3</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="var">?I4</span><span class="main">.</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.reindex_bij_witness<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">+</span> <span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">∈</span><span class="var">?I4</span><span class="main">.</span> <span class="main">∑</span><span class="bound">k</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">&lt;..</span><span class="bound">i</span><span class="main">}</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">i</span> <span class="main">*</span> coeff <span class="skolem">p</span> <span class="bound">j</span> <span class="main">/</span> <span class="bound">k</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sum_distrib_left
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong refl<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h_def beukers_integral1_different sum_divide_distrib sum_distrib_left mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">B2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> J_def B2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.Sigma <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B1'</span><span class="main">.</span> <span class="skolem">B1</span> <span class="main">=</span> real_of_int <span class="bound">B1'</span> <span class="main">/</span> real_of_int <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B1_def case_prod_unfold
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_rationals_common_divisor'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def I_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B1</span> <span class="main">=</span> real_of_int <span class="skolem">B1'</span> <span class="main">/</span> real_of_int <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B2'</span><span class="main">.</span> <span class="skolem">B2</span> <span class="main">=</span> real_of_int <span class="bound">B2'</span> <span class="main">/</span> real_of_int <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> B2_def case_prod_unfold J_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_rationals_common_divisor'<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">assume</span></span> ijk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="skolem">k</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">dvd</span> int <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> int_dvd_int_iff <span class="keyword1"><span class="command">using</span></span> ijk
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_dvd_mono dvd_power_same dvd_Lcm<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def power_numeral_reduce<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">k</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> int <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">dvd</span> int <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def J_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B2</span> <span class="main">=</span> real_of_int <span class="skolem">B2'</span> <span class="main">/</span> real_of_int <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"beukers_integral2 <span class="main">=</span>
                  of_int <span class="skolem">A</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> of_int <span class="main">(</span><span class="skolem">B1'</span> <span class="main">+</span> <span class="skolem">B2'</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_divide_distrib d_def<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="main">0</span> <span class="main">=</span> <span class="free">P</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def p_def Shleg_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_0_coeff_0<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coeff <span class="skolem">p</span> <span class="main">0</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum_pos2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B1'</span> <span class="main">+</span> <span class="skolem">B2'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_integral2_integrable"><span class="command">lemma</span></span> beukers_integral2_integrable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set_integrable lborel <span class="free">D</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="free">P</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def Shleg_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> compact_imp_bounded compact_continuous_image <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bounded_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> borel_measurable borel"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> C<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ AE_I2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="free">D</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> beukers_integral1_integrable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integrable_mult_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> xy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">P</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult abs_divide D_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">*</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy C<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> C<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">≥</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono divide_left_mono<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def divide_nonpos_nonneg mult_nonpos_nonneg<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> norm <span class="main">(</span><span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">*</span> <span class="skolem">C</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_divide abs_mult D_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">y</span><span class="main">)</span>
           <span class="main">≤</span> norm <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">C</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> ln <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square abs_mult abs_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def set_borel_measurable_def case_prod_unfold <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lborel_prod<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The triple integral›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lastly, we turn to the triple integral
  \[I_3 := \int_0^1 \int_0^1 \int_0^1
      \frac{(x(1-x)y(1-y)w(1-w))^n}{(1-(1-xy)w)^{n+1}}\ \text{d}x\,\text{d}y\,\text{d}w\ .\]
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">beukers_nn_integral3</span> <span class="main">::</span> <span class="quoted">ennreal</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">beukers_nn_integral3</span> <span class="main">=</span>
     <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">w</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">D'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">beukers_integral3</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">beukers_integral3</span> <span class="main">=</span>
     <span class="main">(</span><span class="main">∫</span><span class="main">(</span><span class="bound">w</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">D'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We first prove the following bound
  (which is a consequence of the arithmetic--geometric mean inequality)
  that will help us to bound the triple integral.
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_integral3_integrand_bound"><span class="command">lemma</span></span> beukers_integral3_integrand_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">*</span><span class="free">y</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">27</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ineq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> ineq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">≤</span> <span class="numeral">4</span> <span class="main">/</span> <span class="numeral">27</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_nonpos_nonneg<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> x <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≥</span> <span class="numeral">2</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="free">x</span> <span class="main">*</span> sqrt <span class="free">y</span> <span class="main">*</span> sqrt <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> arith_geo_mean_sqrt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span>"</span></span><span class="main">]</span> xyz
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_sqrt_mult<span class="main">)</span>

  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">*</span><span class="free">y</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="free">x</span> <span class="main">*</span> sqrt <span class="free">y</span> <span class="main">*</span> sqrt <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xyz beukers_denom_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_left_mono mult_nonneg_nonneg mult_pos_pos<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">*</span><span class="free">y</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sqrt <span class="free">x</span> <span class="main">*</span> sqrt <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="free">y</span> <span class="main">*</span> sqrt <span class="free">y</span> <span class="main">*</span>
               <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="free">z</span> <span class="main">*</span> sqrt <span class="free">z</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xyz <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="free">x</span> <span class="main">*</span> sqrt <span class="free">y</span> <span class="main">*</span> sqrt <span class="free">z</span><span class="main">)</span> <span class="main">=</span>
               sqrt <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xyz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> real_sqrt_mult <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> real_sqrt_mult_self<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xyz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono mult_mono real_sqrt_le_mono ineq1 ineq2<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">/</span> <span class="numeral">27</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">argo</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Connecting the above bound with our results of $I_1$, it is easy to see that
  $I_3 \leq 2 \cdot 27^{-n} \cdot \zeta(3)$:
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_nn_integral3_le"><span class="command">lemma</span></span> beukers_nn_integral3_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"beukers_nn_integral3 <span class="main">≤</span> ennreal <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> D' <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D'</span> <span class="main">∈</span> sets <span class="main">(</span>borel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> borel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> borel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> D'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"beukers_nn_integral3 <span class="main">=</span>
          <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">w</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">D'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> beukers_nn_integral3_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">w</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">D'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_nn_integral_mono ennreal_leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">w</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">*</span><span class="skolem">y</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">w</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">*</span><span class="skolem">y</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">w</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> beukers_denom_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> 1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_right_mono power_mono beukers_integral3_integrand_bound<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">w</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">D'</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lborel_prod <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> case_prod_unfold
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_cmult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> nn_integral_cong <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> ennreal_mult'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">w</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="free">D'</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">×</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal <span class="main">(</span><span class="main">-</span> <span class="main">(</span>ln <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> beukers_nn_integral1_altdef<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> beukers_nn_integral1_def D'_def case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> beukers_nn_integral1_same<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def beukers_nn_integral1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_mult' <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_nn_integral3_finite"><span class="command">lemma</span></span> beukers_nn_integral3_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"beukers_nn_integral3 <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_less_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> beukers_nn_integral3_le<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_integral3_integrable"><span class="command">lemma</span></span> beukers_integral3_integrable<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set_integrable lborel <span class="free">D'</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">w</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold <span class="keyword1"><span class="command">using</span></span> less_imp_le<span class="main">[</span><span class="operator">OF</span> beukers_denom_ineq<span class="main">]</span> beukers_nn_integral3_finite
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integrableI_nonneg AE_I2 impI<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D'_def set_borel_measurable_def beukers_nn_integral3_def case_prod_unfold
           <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lborel_prod <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> divide_nonneg_nonneg mult_nonneg_nonneg<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_integral3_conv_nn_integral"><span class="command">lemma</span></span> beukers_integral3_conv_nn_integral<span class="main">:</span>
  <span class="quoted"><span class="quoted">"beukers_integral3 <span class="main">=</span> enn2real beukers_nn_integral3"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> beukers_integral3_def <span class="keyword1"><span class="command">using</span></span> beukers_nn_integral3_finite less_imp_le<span class="main">[</span><span class="operator">OF</span> beukers_denom_ineq<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integral_eq_nn_integral AE_I2 impI<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D'_def set_borel_measurable_def beukers_nn_integral3_def case_prod_unfold
           <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lborel_prod<span class="main">)</span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_integral3_le"><span class="command">lemma</span></span> beukers_integral3_le<span class="main">:</span> <span class="quoted"><span class="quoted">"beukers_integral3 <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"beukers_integral3 <span class="main">=</span> enn2real beukers_nn_integral3"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> beukers_integral3_conv_nn_integral<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> enn2real <span class="main">(</span>ennreal <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> enn2real_mono beukers_nn_integral3_le<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Re_zeta_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> enn2real_ennreal mult_nonneg_nonneg<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  It is also easy to see that $I_3 &gt; 0$.
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_nn_integral3_pos"><span class="command">lemma</span></span> beukers_nn_integral3_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"beukers_nn_integral3 <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> D' <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D'</span> <span class="main">∈</span> sets <span class="main">(</span>borel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> borel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> borel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> D'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="keyword1">AE</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="keyword1">in</span> lborel<span class="main">.</span> ennreal <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span>
             <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> indicator <span class="free">D'</span> <span class="main">(</span><span class="bound">w</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>"</span></span>
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="keyword1">AE</span> <span class="bound">z</span> <span class="keyword1">in</span> lborel<span class="main">.</span> <span class="var">?P</span> <span class="bound">z</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> xyw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">D'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">*</span><span class="skolem">y</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">w</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> beukers_denom_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> divide_pos_pos mult_pos_pos zero_less_power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> xyw <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?P</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def D'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?P</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">D'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">z</span></span><span class="main">∈</span>space lborel<span class="main">.</span> <span class="main">¬</span><span class="var">?P</span> <span class="bound">z</span><span class="main">}</span> <span class="main">=</span> <span class="free">D'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emeasure lborel <span class="free">D'</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">D'</span> <span class="main">=</span> box <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D'_def box_def Basis_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emeasure lborel <span class="main">…</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> emeasure_lborel_box<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Basis_prod_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> AE_iff_measurable<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">D'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nn_integral lborel <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">::</span>real<span class="main">×</span>real<span class="main">×</span>real<span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> beukers_nn_integral3"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> beukers_nn_integral3_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> nn_integral_less<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lborel_prod<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_integral3_pos"><span class="command">lemma</span></span> beukers_integral3_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"beukers_integral3 <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> enn2real beukers_nn_integral3"</span></span>
    <span class="keyword1"><span class="command">using</span></span> beukers_nn_integral3_pos beukers_nn_integral3_finite
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> enn2real_positive_iff<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> beukers_integral3"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> beukers_integral3_conv_nn_integral <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Connecting the double and triple integral›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we will prove the most technically involved part,
  namely that $I_2 = I_3$. I will not go into detail about how this works --
  the reader is advised to simply look at Filaseta's presentation of the proof.

  The basic idea is to integrate by parts <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> times with respect to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> to eliminate
  the factor $P(y)$, then change variables $z = \frac{1-w}{1-(1-xy)w}$, and then
  apply the same integration by parts <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> times to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> to eliminate $P(x)$.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The first expand \[-\frac{\ln (xy)}{1-xy} = \int_0^1 \frac{1}{1-(1-xy)z}\,\text{d}z\ .\]
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_aux_ln_conv_integral"><span class="command">lemma</span></span> beukers_aux_ln_conv_integral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>ln <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> u <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_strict_right_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">using</span></span> less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span><span class="main">.</span> ln <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">=</span>ereal <span class="main">0</span><span class="main">..</span>ereal <span class="main">1</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?F</span> <span class="main">1</span> <span class="main">-</span> <span class="var">?F</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> interval_integral_FTC_finite<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> cont deriv<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> cont
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> neq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>deriv <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> has_field_derivative_iff_has_vector_derivative <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> less<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span> xy <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> deriv<span class="main">)</span>
         <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span>ln <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_ereal_def one_ereal_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The first part we shall show is the integration by parts.
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_aux_by_parts_aux"><span class="command">lemma</span></span> beukers_aux_by_parts_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">Q</span> <span class="free">n</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">k</span><span class="main">)</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span>fact <span class="free">k</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span> <span class="main">=</span> DERIV_chain2<span class="main">[</span><span class="operator">OF</span> has_field_derivative_Gen_Shleg<span class="main">]</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">-</span>fact <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="skolem">k</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> fact <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span>Suc <span class="skolem">k</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> y xz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xz <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xz y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xz <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> neq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">G</span> <span class="keyword1">has_real_derivative</span> <span class="skolem">g</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">y</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">unfolding</span></span> G_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> neq xz y<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl power_not_zero<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> g_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> deriv2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Q</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> <span class="free">Q</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">y</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc_diff_Suc Q_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span>fact <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span>Suc <span class="skolem">k</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span> <span class="bound">y</span> <span class="main">*</span> <span class="skolem">G</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems deriv deriv2 cont
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> interval_lebesgue_integral_by_parts_01<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> G <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem">G</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span>fact <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="skolem">k</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> interval_lebesgue_integral_uminus<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_aux_by_parts"><span class="command">lemma</span></span> beukers_aux_by_parts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="main">1</span> <span class="main">/</span> fact <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">Q</span> <span class="free">n</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> interval_lebesgue_integral_mult_right <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> P_def Q_def Shleg_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> beukers_aux_by_parts_aux<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">subst</span> interval_lebesgue_integral_mult_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q_def mult_ac Gen_Shleg_0_left power_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We then get the following by applying the integration by parts to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span>:
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_aux_integral_transform1"><span class="command">lemma</span></span> beukers_aux_integral_transform1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> cbox<span class="main">:</span> <span class="quoted"><span class="quoted">"cbox <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">::</span> <span class="main">(</span>real <span class="main">×</span> real<span class="main">)</span> set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cbox_def Basis_prod_def inner_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> box<span class="main">:</span> <span class="quoted"><span class="quoted">"box <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">::</span> <span class="main">(</span>real <span class="main">×</span> real<span class="main">)</span> set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> box_def Basis_prod_def inner_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span>cbox <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lborel_prod case_prod_unfold P_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_on_imp_set_integrable_cbox <span class="dynamic"><span class="dynamic">continuous_intros</span></span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">×</span> real"</span></span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> fst <span class="skolem">p</span> <span class="main">*</span> snd <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> p z cbox <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fst <span class="skolem">p</span> <span class="main">*</span> snd <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span>box <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  box <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span>cbox <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lborel_prod case_prod_unfold P_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_on_imp_set_integrable_cbox <span class="dynamic"><span class="dynamic">continuous_intros</span></span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">×</span> real"</span></span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> fst <span class="skolem">p</span> <span class="main">*</span> snd <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> p z cbox <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fst <span class="skolem">p</span> <span class="main">*</span> snd <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> integrable'<span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="free">D</span>
          <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> box D_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> D_def lborel_prod <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> box integrable
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_pair.set_integral_fst'<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_integral_Ioo lborel_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> interval_lebesgue_integral_mult_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> interval_lebesgue_integral_lborel_01_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> beukers_aux_by_parts<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> interval_lebesgue_integral_mult_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> D_def lborel_prod <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> box integrable'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_pair.set_integral_fst'<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def interval_integral_Ioo lborel_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We then change variables for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span>:
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_aux_integral_transform2"><span class="command">lemma</span></span> beukers_aux_integral_transform2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">w</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> w <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_left_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">g</span> <span class="keyword1">has_real_derivative</span> <span class="skolem">g'</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">w</span> <span class="keyword1">within</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">w</span>
    <span class="keyword1"><span class="command">unfolding</span></span> g_def g'_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> that xy neq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> refl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> power2_eq_square<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">xa</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> neq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">w</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> xy w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">(</span><span class="skolem">g</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">xa</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> continuous_on_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> cont'<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="skolem">g'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> neq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> g'_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> interval_lebesgue_integral_mult_right <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        <span class="main">-</span><span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">=</span><span class="skolem">g</span> <span class="main">0</span><span class="main">..</span><span class="skolem">g</span> <span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> interval_integral_endpoints_reverse<span class="main">)</span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def zero_ereal_def one_ereal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">=</span><span class="skolem">g</span> <span class="main">0</span><span class="main">..</span><span class="skolem">g</span> <span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="skolem">g'</span> <span class="bound">w</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">g</span> <span class="bound">w</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> deriv cont cont'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> interval_integral_substitution_finite <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> g' <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem">g'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_ereal_def one_ereal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="bound">z</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> interval_lebesgue_integral_uminus <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> xy
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> interval_lebesgue_integral_lborel_01_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> g_def g'_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_mult_distrib power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> interval_lebesgue_integral_mult_right <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lastly, we apply the same integration by parts to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span>:
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_aux_integral_transform3"><span class="command">lemma</span></span> beukers_aux_integral_transform3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> cbox<span class="main">:</span> <span class="quoted"><span class="quoted">"cbox <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">::</span> <span class="main">(</span>real <span class="main">×</span> real<span class="main">)</span> set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cbox_def Basis_prod_def inner_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> box<span class="main">:</span> <span class="quoted"><span class="quoted">"box <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">::</span> <span class="main">(</span>real <span class="main">×</span> real<span class="main">)</span> set<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> box_def Basis_prod_def inner_prod_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel
          <span class="main">(</span>cbox <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lborel_prod case_prod_unfold P_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_on_imp_set_integrable_cbox <span class="dynamic"><span class="dynamic">continuous_intros</span></span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">×</span> real"</span></span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> fst <span class="skolem">p</span> <span class="main">*</span> snd <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p cbox w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> fst <span class="skolem">p</span> <span class="main">*</span> snd <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fst <span class="skolem">p</span> <span class="main">*</span> snd <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> integrable<span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="free">D</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">/</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span>cbox <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lborel_prod case_prod_unfold P_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> continuous_on_imp_set_integrable_cbox <span class="dynamic"><span class="dynamic">continuous_intros</span></span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">×</span> real"</span></span> <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> cbox <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> fst <span class="skolem">p</span> <span class="main">*</span> snd <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p cbox w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> fst <span class="skolem">p</span> <span class="main">*</span> snd <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fst <span class="skolem">p</span> <span class="main">*</span> snd <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> integrable'<span class="main">:</span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="free">D</span>
                        <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold D_def lborel_prod <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_pair.set_integral_snd<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> interval_integral_Ioo<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> interval_lebesgue_integral_mult_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> interval_lebesgue_integral_lborel_01_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> beukers_aux_by_parts<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">x</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span>
                     <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> interval_lebesgue_integral_mult_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="free">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable' <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold D_def lborel_prod <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_pair.set_integral_snd<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> interval_integral_Ioo<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We need to show the existence of some of these triple integrals.
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_aux_integrable1"><span class="command">lemma</span></span> beukers_aux_integrable1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span><span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>
     <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> D <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">∈</span> sets <span class="main">(</span>borel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> borel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> D_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="free">P</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> compact_imp_bounded compact_continuous_image <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bounded_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> D'_def case_prod_unfold
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_prod <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
         <span class="operator">intro</span> lborel_pair.Fubini_set_integrable AE_I2 impI<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xy mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> borel_integrable_atLeastAtMost'<span class="main">)</span>
         <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">&lt;</span><span class="main">1</span>›</span></span> beukers_denom_neq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span> xy <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main">!</span><span class="main">:</span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span> <span class="quasi_keyword">simp</span><span class="main">:</span> P_def›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="free">D</span>
             <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">z</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> norm <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span>lborel<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ AE_I2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="free">D</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="skolem">C</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span>ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> beukers_integral1_integrable<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integrable_mult_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> norm <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              norm <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">¦</span><span class="free">P</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">P</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted">norm</span><span class="main"><span class="main">]</span></span> set_lebesgue_integral_cong allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">z</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> beukers_denom_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> xy <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_mult D_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_mult D_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> norm <span class="main">(</span><span class="main">¦</span><span class="free">P</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">P</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_integral_mult_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> interval_integral_Ioo<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> norm <span class="main">(</span>norm <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">P</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> ln <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> beukers_aux_ln_conv_integral<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> norm <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">P</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> ln <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xy mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def divide_nonpos_nonneg abs_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">P</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> ln <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
                   norm <span class="main">(</span><span class="skolem">C</span> <span class="main">*</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> ln <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xy C<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> C<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> norm_mult norm_divide
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono C<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def divide_nonpos_nonneg<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> norm <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">≤</span> norm <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">C</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> ln <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_borel_measurable lborel <span class="free">D</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span>
              <span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> norm <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> lborel_prod <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> set_borel_measurable_def
                  case_prod_unfold set_lebesgue_integral_def P_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">measurable</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>
            <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">LBINT</span> <span class="bound">y</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">¦</span><span class="free">P</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">P</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="main">/</span> <span class="main">¦</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> fst <span class="bound">x</span> <span class="main">*</span> snd <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span><span class="main">¦</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold D_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold lborel_prod <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> set_borel_measurable_def P_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_aux_integrable2"><span class="command">lemma</span></span> beukers_aux_integrable2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set_integrable lborel <span class="free">D'</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> borel_measurable borel"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> borel_measurable_continuous_onI <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="free">P</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> compact_imp_bounded compact_continuous_image <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bounded_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> D'_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ AE_I2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>
            <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
      <span class="keyword1"><span class="command">using</span></span> beukers_integral1_integrable'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integrable_mult_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lborel_prod case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> xyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            norm <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xyz beukers_denom_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult power_divide mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xyz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">…</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">z</span><span class="main">)</span> <span class="main">≤</span>
               <span class="skolem">C</span> <span class="main">*</span> <span class="main">1</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">1</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xyz C<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> beukers_denom_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono divide_right_mono power_mono zero_le_power mult_nonneg_nonneg divide_nonneg_nonneg<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">C</span> <span class="main">*</span> <span class="main">1</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">1</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">z</span><span class="main">)</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">*</span><span class="skolem">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
                    norm <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold set_borel_measurable_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Zeta_3_Irrational-beukers_aux_integrable3"><span class="command">lemma</span></span> beukers_aux_integrable3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set_integrable lborel <span class="free">D'</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">w</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> borel_measurable borel"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> borel_measurable_continuous_onI <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded <span class="main">(</span><span class="free">P</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> compact_imp_bounded compact_continuous_image <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="main">⟹</span> norm <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bounded_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> D'_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ AE_I2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>
            <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
      <span class="keyword1"><span class="command">using</span></span> beukers_integral1_integrable'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_integrable_mult_right<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lborel_prod case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">w</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> xyw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            norm <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xyw beukers_denom_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult power_divide mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">1</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">1</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xyw C<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> beukers_denom_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_mono divide_right_mono power_mono zero_le_power mult_nonneg_nonneg divide_nonneg_nonneg<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">C</span> <span class="main">*</span> <span class="main">1</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">1</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">w</span><span class="main">)</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
                    norm <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">C</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold set_borel_measurable_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Now we only need to put all of these results together:
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_integral2_conv_3"><span class="command">lemma</span></span> beukers_integral2_conv_3<span class="main">:</span> <span class="quoted"><span class="quoted">"beukers_integral2 <span class="main">=</span> beukers_integral3"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> cont_P<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on <span class="main">{</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">}</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> P_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> D <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">∈</span> sets borel"</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">∈</span> sets <span class="main">(</span>borel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> borel<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> D_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">∈</span> borel_measurable borel"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> borel_measurable_continuous_onI <span class="dynamic"><span class="dynamic">continuous_intros</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"beukers_integral2 <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> beukers_integral2_def case_prod_unfold
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_lebesgue_integral_cong allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">measurable</span><span class="main">)</span>
       <span class="main">(</span><span class="operator">subst</span> beukers_aux_ln_conv_integral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> interval_lebesgue_integral_mult_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_integral_Ioo<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_pair.Fubini_set_integral <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_integrable lborel <span class="main">(</span><span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span> <span class="main">×</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">)</span>
            <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> beukers_aux_integrable1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?this</span> <span class="main">⟷</span> set_integrable <span class="main">(</span>lborel <span class="keyword1">⨂<span class="hidden">⇩</span><sub>M</sub></span> lborel<span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span> <span class="main">×</span> <span class="free">D</span><span class="main">)</span>
                           <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">z</span><span class="main">,</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_integrable_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_pair.integrable_product_swap_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> integrable_cong<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indicator_def case_prod_unfold lborel_prod D_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="main">…</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_lebesgue_integral_cong<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> beukers_aux_integral_transform1 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> beukers_aux_integrable2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_pair.Fubini_set_integral <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold lborel_prod D_def D'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_lebesgue_integral_cong allI impI<span class="main"><span class="keyword3">;</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            <span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> interval_lebesgue_integral_mult_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac interval_integral_Ioo<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> beukers_aux_integral_transform2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> interval_lebesgue_integral_mult_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac interval_integral_Ioo<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">z</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">z</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="free">P</span> <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> borel_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">:</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> beukers_aux_integrable3
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> lborel_pair.Fubini_set_integral <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold lborel_prod D_def D'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_integral_mult_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac interval_integral_Ioo<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="bound">w</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> interval_lebesgue_integral_lborel_01_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> beukers_aux_integral_transform3<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_ac power_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="bound">w</span><span class="main">=</span><span class="main">0</span><span class="main">..</span><span class="main">1</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">LBINT</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">:</span><span class="free">D</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">*</span><span class="bound">w</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="bound">x</span><span class="main">*</span><span class="bound">y</span><span class="main">)</span><span class="main">*</span><span class="bound">w</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> set_integral_mult_right <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold mult_ac power_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> beukers_integral3"</span></span>
    <span class="keyword1"><span class="command">using</span></span> beukers_integral3_integrable <span class="keyword1"><span class="command">unfolding</span></span> D'_def D_def beukers_integral3_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> lborel_prod <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> lborel_pair.set_integral_fst'<span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_unfold interval_integral_Ioo lborel_prod <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The main result›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Combining all of the results so far, we can derive the key inequalities
  \[0 &lt; A\zeta(3) + B &lt; 2 \zeta(3) \cdot 27^{-n} \cdot \text{lcm}\{1\ldots n\}^3\]
  for integers $A$, $B$ with $A &gt; 0$.
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-zeta_3_linear_combination_bounds"><span class="command">lemma</span></span> zeta_3_linear_combination_bounds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">A</span> <span class="free">B</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="free">B</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> beukers_integral2"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">^</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Nat.gr0I<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> beukers_integral2_conv_int_combination <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A'</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="main">::</span> <span class="quoted">int</span>
    <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="skolem">A'</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">B</span> <span class="main">/</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_def d_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">A'</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> beukers_integral3_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I_def beukers_integral2_conv_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">B</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> A<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> beukers_integral2_conv_3 beukers_integral3_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">B</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">B</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If $\zeta(3) = \frac{a}{b}$ for some integers $a$ and $b$, we can thus derive
  the inequality $2b\zeta(3) \cdot 27^{-n} \cdot \text{lcm}\{1\ldots n\}^3\geq 1$ for any
  natural number $n$.
›</span></span>
<span class="keyword1" id="Zeta_3_Irrational-beukers_key_inequality"><span class="command">lemma</span></span> beukers_key_inequality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">/</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> zeta_3_linear_combination_bounds <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="main">::</span> <span class="quoted">int</span>
    <span class="keyword2"><span class="keyword">where</span></span> AB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span> <span class="main">&lt;..</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> AB <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_pos_pos<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">A</span> <span class="main">*</span> <span class="main">(</span>Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">B</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ab<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="skolem">A</span> <span class="main">*</span> of_int <span class="free">a</span> <span class="main">+</span> of_int <span class="main">(</span><span class="skolem">B</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> of_int <span class="main">(</span><span class="skolem">A</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">B</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">A</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">B</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> real_of_int <span class="main">(</span><span class="skolem">A</span> <span class="main">*</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">B</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_distribs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">/</span> <span class="free">b</span> <span class="main">=</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ab<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">B</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> AB <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="free">n</span><span class="main">}</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(* TODO: Move *)</span>
<span class="keyword1" id="Zeta_3_Irrational-smallo_power"><span class="command">lemma</span></span> smallo_power<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_induct_non_zero<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> landau_o.small.mult<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This is now a contradiction, since $\text{lcm}\{1\ldots n\} \in o(3^n)$ by the
  Prime Number Theorem -- hence the main result.
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> zeta_3_irrational<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="numeral">3</span> <span class="main">∉</span> <span class="main">ℚ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"zeta <span class="numeral">3</span> <span class="main">∈</span> <span class="main">ℚ</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ab'<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="numeral">3</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">/</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹zeta <span class="numeral">3</span> <span class="main">∈</span> <span class="main">ℚ</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"zeta <span class="numeral">3</span> <span class="main">=</span> of_rat <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> Rats_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> rat_of_int <span class="main">(</span>fst <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> rat_of_int <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> quotient_of_div<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_rat <span class="main">…</span> <span class="main">=</span> <span class="main">(</span>of_int <span class="main">(</span>fst <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_int <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> complex<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_rat_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_int <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="main">(</span>nat <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> quotient_of_denom_pos'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zeta <span class="numeral">3</span> <span class="main">=</span> of_int <span class="main">(</span>fst <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> of_nat <span class="main">(</span>nat <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> quotient_of_denom_pos'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span>snd <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>quotient_of <span class="skolem">r</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">/</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">interpret</span></span> prime_number_theorem
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">rule</span> prime_number_theorem<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> Lcm_upto_smallo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> exp <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> exp <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> c
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span>nat <span class="main">⌊</span>real <span class="bound">n</span><span class="main">⌋</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="keyword1">powr</span> real <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lcm_upto.smallo'
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.small.compose<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c filterlim_real_sequentially<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="keyword1">powr</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> c <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_realpow<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span>
          <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> Re_zeta_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">1</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_approx_32 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> of_nat_power
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.small.divide_right smallo_power Lcm_upto_smallo<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">3</span></span><span class="main"><span class="main">]</span></span> power_mult<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral">3</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> lim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> smalloD_tendsto<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> Re <span class="main">(</span>zeta <span class="numeral">3</span><span class="main">)</span> <span class="main">*</span> real <span class="main">(</span>Lcm <span class="main">{</span><span class="main">1</span><span class="main">..</span><span class="skolem">n</span><span class="main">}</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">27</span> <span class="main">^</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> beukers_key_inequality<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> ab <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="main">0</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_lowerbound<span class="main"><span class="main">[</span></span><span class="operator">OF</span> lim<span class="main"><span class="main">]</span></span> always_eventually allI<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>